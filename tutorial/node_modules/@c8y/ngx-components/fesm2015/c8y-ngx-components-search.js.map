{"version":3,"file":"c8y-ngx-components-search.js","sources":["../../search/search.service.ts","../../search/search-box.component.ts","../../search/search-grid.component.ts","../../search/search-results.component.ts","../../search/search.module.ts","../../search/c8y-ngx-components-search.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { IManagedObject } from '@c8y/client';\nimport { SubAssetsService } from '@c8y/ngx-components/sub-assets';\nimport { find, get, isUndefined, some } from 'lodash-es';\nimport { Pagination } from '@c8y/ngx-components';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AssetSearchService extends SubAssetsService {\n  protected GRID_CONFIG_STORAGE_KEY = 'search-grid-config';\n  protected DEFAULT_PAGE_SIZE = 50;\n  private readonly FRAGMENTS_FOR_NO_DEVICE = [\n    'c8y_Dashboard',\n    'c8y_Report',\n    'c8y_Kpi',\n    'c8y_ExportConfiguration',\n    'c8y_IsBinary',\n    'c8y_NoDevice',\n    'c8y_IsDeviceGroup',\n    'c8y_Group',\n    'com_cumulocity_model_smartrest_SmartRestTemplate',\n    'com_cumulocity_model_devicesimulator_SensorTemplate',\n    '_attachments',\n    'c8y_IsDeviceType',\n    'c8y_objectmapping_ObjectMapping'\n  ];\n  private readonly TYPES_FOR_NO_DEVICE = [\n    'c8y_ConfigurationDump',\n    'c8y_Firmware',\n    'c8y_SmartRule',\n    'c8y_Software',\n    'impact_object_mapping',\n    'c8y_UserPreference',\n    'c8y_TenantPolicy',\n    'c8y_PrivateSmartRule',\n    'c8y_SmartRest2Template',\n    'c8y_JsonSchema',\n    'c8y_DeviceShellTemplate',\n    'c8y_DemoStatus',\n    'c8y_DataBroker',\n    'c8y_Application_',\n    'brandingVariables',\n    'c8y_DeviceSimulator',\n    'c8y_CertificateMetadata',\n    'lwm2m_post_registration',\n    'c8y_microservice_manifest_',\n    'c8y_CepAgent'\n  ];\n  private readonly DEVICE_FRAGMENT_TYPE = 'c8y_IsDevice';\n\n  /**\n   * Will return only valid assets (groups and devices) and filter out\n   * none useful inventories (e.g. c8y_JsonSchema).\n   * @param data All managed objects that should be filtered.\n   */\n  filterOnlyAssets(data: IManagedObject[]) {\n    return data.filter(mo => mo.c8y_IsDeviceGroup || this.isAnyDevice(mo));\n  }\n\n  buildCombinedRootQueryFilter(columns, pagination) {\n    const rootQuery = {\n      __filter: {\n        __and: { __not: { __has: `c8y_IsBinary` } }\n      }\n    };\n    const userQuery = this.getQueryObj(columns, pagination);\n    const queryPart = this.queriesUtil.addOrderbys(rootQuery, userQuery.__orderby, 'append');\n    const fullQuery = this.queriesUtil.addAndFilter(queryPart, userQuery.__filter);\n    return this.queriesUtil.buildQuery(fullQuery);\n  }\n\n  /**\n   * Returns the full-text search results.\n   *\n   * @param term The search term.\n   * @param pagination The currently used pagination.\n   */\n  search(\n    term: string,\n    pagination: Pagination = { currentPage: 1, pageSize: this.DEFAULT_PAGE_SIZE }\n  ) {\n    return this.inventoryService.list({\n      text: term,\n      withTotalPages: true,\n      pageSize: pagination.pageSize,\n      withChildren: false,\n      currentPage: pagination.currentPage || 1\n    });\n  }\n\n  private isRootDevice(mo) {\n    return !!mo[this.DEVICE_FRAGMENT_TYPE];\n  }\n\n  private isAnyDevice(mo) {\n    const isDevice = this.isRootDevice(mo) || !this.hasFragmentOrTypeFromBlacklist(mo);\n    return isDevice;\n  }\n\n  private hasFragmentOrTypeFromBlacklist(mo) {\n    return this.hasTypeFromBlacklist(mo) || this.hasFragmentFromBlacklist(mo);\n  }\n\n  private hasTypeFromBlacklist(mo) {\n    const moType = get(mo, 'type', '');\n    return some(this.TYPES_FOR_NO_DEVICE, type => moType.includes(type));\n  }\n\n  private hasFragmentFromBlacklist(mo) {\n    return find(this.FRAGMENTS_FOR_NO_DEVICE, f => !isUndefined(mo[f]));\n  }\n}\n","import { Component, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { IManagedObject, InventoryService, IResultList, Paging } from '@c8y/client';\nimport { TypeaheadComponent } from '@c8y/ngx-components';\nimport { DeviceGridService } from '@c8y/ngx-components/device-grid';\nimport { BsDropdownDirective } from 'ngx-bootstrap/dropdown';\nimport { defer, empty, merge, Observable, of, pipe } from 'rxjs';\nimport { map, switchMap, tap } from 'rxjs/operators';\nimport { AssetSearchService } from './search.service';\n\n@Component({\n  selector: 'c8y-search-box',\n  templateUrl: './search-box.component.html'\n})\nexport class SearchBoxComponent {\n  term = '';\n  selected;\n  filterPipe = pipe(\n    map((data: IManagedObject[]) => {\n      return this.searchService.filterOnlyAssets(data);\n    })\n  );\n  results$: Observable<IResultList<IManagedObject>>;\n  recentSearchResults: IManagedObject[] = [];\n  recentlyRegisteredResults$: Observable<IResultList<IManagedObject>>;\n  isLoading = false;\n  noMatch = false;\n\n  private readonly RECENT_SEARCH_STORAGE_KEY = 'recent_search_view';\n  private readonly MAX_RECENT_SEARCH_RESULTS = 5;\n  private readonly DEFAULT_FILTER: object = {\n    withTotalPages: true,\n    pageSize: 5,\n    withChildren: false\n  };\n  private readonly KEYCODE_ENTER = 13;\n  private readonly KEYCODE_ESC = 27;\n\n  @ViewChild(TypeaheadComponent, { static: false })\n  private typeahead: TypeaheadComponent;\n\n  @ViewChild('dropdown', { static: false })\n  private dropdown: BsDropdownDirective;\n\n  constructor(\n    private router: Router,\n    private inventory: InventoryService,\n    private deviceGridService: DeviceGridService,\n    private searchService: AssetSearchService\n  ) {}\n\n  async ngOnInit() {\n    const recentSearchIds = JSON.parse(localStorage.getItem(this.RECENT_SEARCH_STORAGE_KEY));\n    if (recentSearchIds && recentSearchIds.length > 0) {\n      const { data } = await this.inventory.list({ ids: recentSearchIds.join(',') });\n      this.recentSearchResults = data;\n      this.recentlyRegisteredResults$ = defer(() =>\n        this.inventory.list({\n          q: '$orderby=creationTime desc',\n          ...this.DEFAULT_FILTER\n        })\n      );\n    }\n  }\n\n  onOpenChange(isOpen: boolean): void {\n    if (isOpen) {\n      // needs to request an animation frame as\n      // otherwise the typeahead is undefined\n      requestAnimationFrame(() => {\n        this.subscribeOnSearch();\n        this.typeahead.dropdown.show();\n        this.typeahead.searchControl.nativeElement.focus();\n      });\n    }\n  }\n\n  open(event: Event, mo: IManagedObject) {\n    event.stopPropagation();\n    const isAlreadyRecent = this.recentSearchResults.find(({ id }) => id === mo.id);\n    if (!isAlreadyRecent) {\n      this.recentSearchResults.unshift(mo);\n      this.recentSearchResults = this.recentSearchResults.slice(0, this.MAX_RECENT_SEARCH_RESULTS);\n    }\n    const recentSearchIds = this.recentSearchResults.map(({ id }) => id);\n    localStorage.setItem(this.RECENT_SEARCH_STORAGE_KEY, JSON.stringify(recentSearchIds));\n    this.router.navigateByUrl(this.deviceGridService.getHref(mo, '/'));\n    this.dropdown.hide();\n  }\n\n  reset() {\n    this.typeahead.onSearch.emit('');\n    this.selected = undefined;\n    this.typeahead.searchControl.nativeElement.focus();\n  }\n\n  keyDown(event: KeyboardEvent) {\n    const keyCode = event.keyCode;\n    if (keyCode === this.KEYCODE_ENTER) {\n      // enter hit can be faster then typeahead debounce,\n      // therefore we take the term from the DOM element\n      // itself:\n      const searchTerm = (event.target as any).value;\n      this.navigate(['/assetsearch'], { queryParams: { search: searchTerm } });\n      this.dropdown.hide();\n    } else if (keyCode === this.KEYCODE_ESC) {\n      if (this.term === '') {\n        this.dropdown.hide();\n      }\n      this.reset();\n    }\n  }\n\n  filter(on) {\n    this.navigate(['/assetsearch'], { queryParams: { filter: on } });\n    this.dropdown.hide();\n  }\n\n  openSearch() {\n    this.router.navigateByUrl('/assetsearch');\n    this.dropdown.hide();\n  }\n\n  private subscribeOnSearch() {\n    if (!this.results$) {\n      this.results$ = this.typeahead.onSearch.pipe(\n        tap(term => this.onTypingStarted(term)),\n        switchMap(term => this.mergeRequest(term))\n      );\n    }\n  }\n\n  private navigate(commands, extras?) {\n    this.router\n      .navigateByUrl('/', { skipLocationChange: true })\n      .then(() => this.router.navigate(commands, extras));\n  }\n\n  private mergeRequest(term: string): Observable<IResultList<IManagedObject>> {\n    return merge(\n      of({ data: [] } as IResultList<IManagedObject>),\n      this.queryInventoryService(term).pipe(\n        tap(({ data, paging }) => this.onLoadingDone(data, paging))\n      )\n    );\n  }\n\n  private queryInventoryService(term: string) {\n    if (term) {\n      return defer(() => this.searchService.search(term));\n    }\n    return empty();\n  }\n\n  private onLoadingDone(data: IManagedObject[], paging: Paging<IManagedObject>) {\n    this.isLoading = false;\n    this.noMatch =\n      paging && paging.nextPage === null && this.searchService.filterOnlyAssets(data).length === 0;\n  }\n\n  private onTypingStarted(term) {\n    this.noMatch = false;\n    this.term = term;\n    this.isLoading = term.length > 0;\n  }\n}\n","import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';\nimport {\n  ActionControl,\n  BuiltInActionType,\n  BulkActionControl,\n  DataGridComponent,\n  DataSourceModifier,\n  FilteringActionType,\n  FilteringModifier,\n  gettext,\n  Pagination,\n  Row,\n  ServerSideDataResult\n} from '@c8y/ngx-components';\nimport { DeviceGridColumn } from '@c8y/ngx-components/device-grid';\nimport { IManagedObject, SmartGroupsService } from '@c8y/client';\nimport { AssetSearchService } from './search.service';\nimport {\n  AssetTypeGridColumn,\n  DeleteAssetsModalComponent,\n  DeleteModalCheckboxes,\n  SubAssetsService\n} from '@c8y/ngx-components/sub-assets';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport {\n  AlarmsDeviceGridColumn,\n  DeviceGridService,\n  ImeiDeviceGridColumn,\n  ModelDeviceGridColumn,\n  NameDeviceGridColumn,\n  RegistrationDateDeviceGridColumn,\n  SerialNumberDeviceGridColumn,\n  SystemIdDeviceGridColumn\n} from '@c8y/ngx-components/device-grid';\n\n@Component({\n  selector: 'c8y-search-grid',\n  templateUrl: './search-grid.component.html'\n})\nexport class SearchGridComponent {\n  @Input('parent-group') parentGroup: IManagedObject;\n  @Input() title: string = '';\n  @Input() loadingItemsLabel: string = gettext('Loading resultsâ€¦');\n  @Input('columns') set _columns(value: DeviceGridColumn[]) {\n    if (value) {\n      this.columns = value;\n    } else {\n      this.columns = this.searchService.getDefaultColumns();\n    }\n  }\n  @Input('pagination') set _pagination(value: Pagination) {\n    if (value) {\n      this.pagination = value;\n    } else {\n      this.pagination = this.searchService.getDefaultPagination();\n    }\n  }\n  @Input('actionControls') set _actionControls(value: ActionControl[]) {\n    if (value) {\n      this.actionControls = value;\n    } else {\n      this.actionControls = this.searchService.getDefaultActionControls();\n    }\n  }\n  @Input() selectable: boolean = false;\n  @Input('bulkActionControls') set _bulkActionControls(value: BulkActionControl[]) {\n    if (value) {\n      this.bulkActionControls = value;\n    } else {\n      this.bulkActionControls = this.searchService.getDefaultBulkActionControls();\n    }\n  }\n  @Output() onColumnsChange: EventEmitter<DeviceGridColumn[]> = new EventEmitter<\n    DeviceGridColumn[]\n  >();\n\n  @Input()\n  searchText = '';\n\n  @Input()\n  filteringName: string;\n\n  columns: DeviceGridColumn[];\n  pagination: Pagination = this.searchService.getDefaultPagination();\n  actionControls: ActionControl[];\n  bulkActionControls: BulkActionControl[] = this.searchService.getDefaultBulkActionControls();\n  serverSideDataCallback: any;\n  refresh: EventEmitter<any> = new EventEmitter();\n\n  @ViewChild(DataGridComponent, { static: true })\n  dataGrid: DataGridComponent;\n\n  private sizeCount = 0;\n\n  constructor(\n    public searchService: AssetSearchService,\n    private bsModalService: BsModalService,\n    private smartGroupsService: SmartGroupsService,\n    private subAssetsGridService: SubAssetsService\n  ) {}\n\n  ngOnInit(): void {\n    if (!this.filteringName) {\n      this.columns = this.searchService.getDefaultColumns();\n    } else {\n      this.columns = [\n        new AssetTypeGridColumn({ sortOrder: 'desc' }),\n        new NameDeviceGridColumn({\n          sortOrder: 'asc',\n          filter: { externalFilterQuery: { names: [this.filteringName] } }\n        }),\n        new ModelDeviceGridColumn(),\n        new SerialNumberDeviceGridColumn({ visible: false }),\n        new RegistrationDateDeviceGridColumn({ visible: false }),\n        new SystemIdDeviceGridColumn({ visible: false }),\n        new ImeiDeviceGridColumn({ visible: false }),\n        new AlarmsDeviceGridColumn()\n      ];\n    }\n    this.serverSideDataCallback = this.onDataSourceModifier.bind(this);\n    this.setActionControls();\n  }\n\n  trackByName(_index, column: DeviceGridColumn): string {\n    return column.name;\n  }\n\n  async onDataSourceModifier(\n    dataSourceModifier: DataSourceModifier\n  ): Promise<ServerSideDataResult> {\n    let response;\n    if (dataSourceModifier.searchText) {\n      response = await this.searchService.search(\n        dataSourceModifier.searchText,\n        dataSourceModifier.pagination\n      );\n    } else {\n      response = await this.searchService.getData(\n        dataSourceModifier.columns,\n        dataSourceModifier.pagination,\n        undefined\n      );\n    }\n    const { res, data, paging } = response;\n    const filteredData = this.searchService.filterOnlyAssets(data);\n\n    if (paging.currentPage === 1) {\n      this.sizeCount = 0;\n    }\n    this.sizeCount += filteredData.length;\n    this.onColumnsChange.emit(dataSourceModifier.columns);\n\n    return {\n      res,\n      data: filteredData,\n      paging,\n      filteredSize: this.sizeCount,\n      size: undefined\n    };\n  }\n\n  setActionControls() {\n    const actionControls: ActionControl[] = [];\n    const deleteAction: ActionControl = {\n      type: BuiltInActionType.Delete,\n      callback: (asset: Row) => this.onDeleteAsset(asset as IManagedObject, this.parentGroup)\n    };\n    actionControls.push(deleteAction);\n    if (!this.actionControls) {\n      this.actionControls = actionControls;\n    }\n  }\n\n  updateFiltering(\n    columnNames: string[],\n    action: {\n      type: FilteringActionType;\n      payload?: { filteringModifier: FilteringModifier };\n    }\n  ) {\n    const { type } = action;\n    if (type === FilteringActionType.ResetFilter) {\n      this.dataGrid.clearFilters();\n    } else {\n      this.dataGrid.updateFiltering(columnNames, action, false);\n    }\n  }\n\n  configChange(config) {\n    this.searchService.saveConfig(config);\n  }\n\n  private onDeleteAsset(asset, parentRef) {\n    const initialState = {\n      showWithDeviceUserCheckbox: this.subAssetsGridService.shouldShowWithDeviceUserCheckbox(asset),\n      asset,\n      showWithCascadeCheckbox:\n        !this.smartGroupsService.isSmartGroup(asset) &&\n        !this.smartGroupsService.isSmartGroupV2(asset)\n    };\n\n    const modalRef = this.bsModalService.show(DeleteAssetsModalComponent, { initialState });\n\n    modalRef.content.closeSubject.subscribe(async (result: DeleteModalCheckboxes) => {\n      if (result) {\n        await this.subAssetsGridService.deleteAsset(asset, parentRef, result);\n        this.refresh.emit();\n      }\n    });\n  }\n}\n","import { Component, OnDestroy, ViewChild } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { SearchGridComponent } from './search-grid.component';\nimport { FilteringActionType, AlertService, Status, gettext, Alert } from '@c8y/ngx-components';\n\n@Component({\n  selector: 'c8y-search-results',\n  templateUrl: './search-results.component.html'\n})\nexport class SearchResultsComponent implements OnDestroy {\n  filter: string = '';\n  searchTerm: string = '';\n  @ViewChild(SearchGridComponent, { static: true })\n  searchGrid: SearchGridComponent;\n  filteringName: string;\n  private unsubscribe$ = new Subject<any>();\n\n  constructor(private route: ActivatedRoute, private alert: AlertService) {}\n\n  ngOnInit() {\n    this.route.queryParams.subscribe(params => {\n      if (params.filter) {\n        this.filteringName = params.filter;\n      }\n    });\n  }\n\n  ngAfterViewInit(): void {\n    this.route.queryParams\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(({ filter, search }) => this.onQueryParamsChange(filter, search));\n\n    this.searchGrid.dataGrid.searchText$.pipe(takeUntil(this.unsubscribe$)).subscribe(text => {\n      if (text) {\n        this.resetFilter();\n      }\n      this.searchTerm = text;\n    });\n\n    this.searchGrid.dataGrid.onFilter\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => this.resetSearch());\n\n    // to prevent race condition (search empty):\n    this.searchTerm = this.route.snapshot.queryParams.search || '';\n  }\n\n  resetSearch() {\n    this.searchTerm = '';\n    if (this.searchTerm) {\n      this.alert.add({\n        text: gettext('Search reset. Full text search does not support filtering.'),\n        type: Status.WARNING,\n        timeout: 5000\n      } as Alert);\n    }\n  }\n\n  resetFilter() {\n    this.filter = '';\n    if (this.searchGrid.dataGrid.filteringApplied) {\n      this.alert.add({\n        text: gettext('Filter reset. Full text search does not support filtering.'),\n        type: Status.WARNING,\n        timeout: 5000\n      } as Alert);\n      this.searchGrid.dataGrid.clearFilters();\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  private onQueryParamsChange(filter: string, searchTerm: string) {\n    if (!this.shouldFilter(filter) && searchTerm) {\n      this.search(searchTerm);\n    } else if (this.shouldFilter(filter) && searchTerm) {\n      this.search(searchTerm);\n    }\n  }\n\n  private shouldFilter(filter) {\n    if (!filter) {\n      return false;\n    }\n    this.resetSearch();\n    this.filter = filter || '';\n    this.searchGrid.updateFiltering(['name'], {\n      type: FilteringActionType.ApplyFilter,\n      payload: {\n        filteringModifier: {\n          externalFilterQuery: {\n            names: [this.filter]\n          }\n        }\n      }\n    });\n    return true;\n  }\n\n  private search(searchTerm: string) {\n    this.searchTerm = searchTerm || '';\n    this.searchGrid.dataGrid.searchText$.next(this.searchTerm);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CoreModule, HOOK_ROUTE, HOOK_SEARCH, Search } from '@c8y/ngx-components';\nimport { DeviceGridModule } from '@c8y/ngx-components/device-grid';\nimport { BsDropdownModule } from 'ngx-bootstrap/dropdown';\nimport { SearchBoxComponent } from './search-box.component';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchGridComponent } from './search-grid.component';\nimport { AssetSearchService } from './search.service';\n\n@NgModule({\n  declarations: [SearchResultsComponent, SearchBoxComponent, SearchGridComponent],\n  imports: [CoreModule, DeviceGridModule, BsDropdownModule],\n  entryComponents: [SearchResultsComponent, SearchBoxComponent],\n  exports: [SearchResultsComponent, SearchBoxComponent, SearchGridComponent],\n  providers: [\n    AssetSearchService,\n    {\n      provide: HOOK_ROUTE,\n      useValue: [\n        {\n          path: 'assetsearch',\n          component: SearchResultsComponent\n        }\n      ],\n      multi: true\n    },\n    {\n      provide: HOOK_SEARCH,\n      useValue: [\n        {\n          template: SearchBoxComponent\n        }\n      ] as Search[],\n      multi: true\n    }\n  ]\n})\nexport class SearchModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"]}