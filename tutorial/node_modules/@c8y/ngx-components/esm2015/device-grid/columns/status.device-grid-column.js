import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { PushStatus, SendStatus, gettext } from '@c8y/ngx-components';
export class StatusDeviceGridColumn extends BaseDeviceGridColumn {
    constructor() {
        super();
        const responseIntervalPath = 'c8y_RequiredAvailability.responseInterval';
        const responseIntervalLessThanOrEqualTo0 = { [responseIntervalPath]: { __le: 0 } };
        const responseIntervalNotDefined = { __not: { __has: responseIntervalPath } };
        const availabilityStatusPath = 'c8y_Availability.status';
        const availabilityStatusAvailable = { [availabilityStatusPath]: SendStatus.AVAILABLE };
        const availabilityStatusUnavailable = { [availabilityStatusPath]: SendStatus.UNAVAILABLE };
        const availabilityStatusMaintenance = { [availabilityStatusPath]: SendStatus.MAINTENANCE };
        const availabilityStatusNotDefined = { __not: { __has: availabilityStatusPath } };
        const connectionStatusPath = 'c8y_Connection.status';
        const connectionStatusConnected = { [connectionStatusPath]: PushStatus.CONNECTED };
        const connectionStatusDisconnected = { [connectionStatusPath]: PushStatus.DISCONNECTED };
        const connectionStatusMaintenance = { [connectionStatusPath]: PushStatus.MAINTENANCE };
        const deviceUnderMaintenance = {
            __or: [
                responseIntervalLessThanOrEqualTo0,
                availabilityStatusMaintenance,
                connectionStatusMaintenance
            ]
        };
        const deviceNotUnderMaintenance = {
            // using __and of __nots because backend does not support __not with __ors
            __and: [
                { __not: responseIntervalLessThanOrEqualTo0 },
                { __not: availabilityStatusMaintenance },
                { __not: connectionStatusMaintenance }
            ]
        };
        this.name = 'status';
        this.header = gettext('Status');
        this.dataType = "icon" /* Icon */;
        this.cellRendererComponent = StatusCellRendererComponent;
        this.filterable = true;
        this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendOnline: {
                        type: 'boolean'
                    },
                    sendOffline: {
                        type: 'boolean'
                    },
                    sendUnknown: {
                        type: 'boolean'
                    },
                    sendNotMonitored: {
                        type: 'boolean'
                    },
                    pushOnline: {
                        type: 'boolean'
                    },
                    pushOffline: {
                        type: 'boolean'
                    },
                    pushNotMonitored: {
                        type: 'boolean'
                    },
                    maintenance: {
                        type: 'boolean'
                    }
                }
            },
            form: [
                {
                    type: 'template',
                    template: this.getLabelTemplate(gettext('Show devices with send status'))
                },
                {
                    key: 'sendOnline',
                    title: gettext('Online')
                },
                {
                    key: 'sendOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'sendUnknown',
                    title: gettext('Unknown')
                },
                {
                    key: 'sendNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: this.getLabelTemplate(gettext('Show devices with push status'))
                },
                {
                    key: 'pushOnline',
                    title: gettext('Online')
                },
                {
                    key: 'pushOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'pushNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: this.getLabelTemplate(gettext('Show devices with maintenance status'))
                },
                {
                    key: 'maintenance',
                    title: gettext('Device is under maintenance')
                }
            ],
            getFilter(model) {
                const filter = {};
                const ors = [];
                if (model) {
                    if (model.sendOnline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusAvailable]
                        });
                    }
                    if (model.sendOffline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusUnavailable]
                        });
                    }
                    if (model.sendUnknown) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusNotDefined]
                        });
                    }
                    if (model.sendNotMonitored || model.pushNotMonitored) {
                        ors.push(responseIntervalNotDefined);
                    }
                    if (model.pushOnline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, connectionStatusConnected]
                        });
                    }
                    if (model.pushOffline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, connectionStatusDisconnected]
                        });
                    }
                    if (model.maintenance) {
                        ors.push(deviceUnderMaintenance);
                    }
                    if (ors.length) {
                        filter.__or = ors;
                    }
                }
                return filter;
            }
        };
        this.sortable = true;
        this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldmljZS1ncmlkL2NvbHVtbnMvc3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUMvRSxPQUFPLEVBQWtCLFVBQVUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEYsTUFBTSxPQUFPLHNCQUF1QixTQUFRLG9CQUFvQjtJQUM5RDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBRVIsTUFBTSxvQkFBb0IsR0FBRywyQ0FBMkMsQ0FBQztRQUN6RSxNQUFNLGtDQUFrQyxHQUFHLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDbkYsTUFBTSwwQkFBMEIsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxvQkFBb0IsRUFBRSxFQUFFLENBQUM7UUFFOUUsTUFBTSxzQkFBc0IsR0FBRyx5QkFBeUIsQ0FBQztRQUN6RCxNQUFNLDJCQUEyQixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUN2RixNQUFNLDZCQUE2QixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRixNQUFNLDZCQUE2QixHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRixNQUFNLDRCQUE0QixHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVB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QUcsQ0FBQyxJQUFJLENBQUM7NEJBQ1AsS0FBSyxFQUFFLENBQUMseUJBQXlCLEVBQUUseUJBQXlCLENBQUM7eUJBQzlELENBQUMsQ0FBQztxQkFDSjtvQkFDRCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUU7d0JBQ3JCLEdBQUcsQ0FBQyxJQUFJLENBQUM7NEJBQ1AsS0FBSyxFQUFFLENBQUMseUJBQXlCLEVBQUUsNEJBQTRCLENBQUM7eUJBQ2pFLENBQUMsQ0FBQztxQkFDSjtvQkFDRCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUU7d0JBQ3JCLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztxQkFDbEM7b0JBRUQsSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFO3dCQUNkLE1BQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO3FCQUNuQjtpQkFDRjtnQkFDRCxPQUFPLE1BQU0sQ0FBQztZQUNoQixDQUFDO1NBQ0YsQ0FBQztRQUVGLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxhQUFhLEdBQUc7WUFDbkIsa0JBQWtCLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxDQUFDO1NBQ3ZELENBQUM7SUFDSixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlRGV2aWNlR3JpZENvbHVtbiB9IGZyb20gJy4vYmFzZS5kZXZpY2UtZ3JpZC1jb2x1bW4nO1xuaW1wb3J0IHsgU3RhdHVzQ2VsbFJlbmRlcmVyQ29tcG9uZW50IH0gZnJvbSAnLi9zdGF0dXMuY2VsbC1yZW5kZXJlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29sdW1uRGF0YVR5cGUsIFB1c2hTdGF0dXMsIFNlbmRTdGF0dXMsIGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcblxuZXhwb3J0IGNsYXNzIFN0YXR1c0RldmljZUdyaWRDb2x1bW4gZXh0ZW5kcyBCYXNlRGV2aWNlR3JpZENvbHVtbiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBjb25zdCByZXNwb25zZUludGVydmFsUGF0aCA9ICdjOHlfUmVxdWlyZWRBdmFpbGFiaWxpdHkucmVzcG9uc2VJbnRlcnZhbCc7XG4gICAgY29uc3QgcmVzcG9uc2VJbnRlcnZhbExlc3NUaGFuT3JFcXVhbFRvMCA9IHsgW3Jlc3BvbnNlSW50ZXJ2YWxQYXRoXTogeyBfX2xlOiAwIH0gfTtcbiAgICBjb25zdCByZXNwb25zZUludGVydmFsTm90RGVmaW5lZCA9IHsgX19ub3Q6IHsgX19oYXM6IHJlc3BvbnNlSW50ZXJ2YWxQYXRoIH0gfTtcblxuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggPSAnYzh5X0F2YWlsYWJpbGl0eS5zdGF0dXMnO1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c0F2YWlsYWJsZSA9IHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiBTZW5kU3RhdHVzLkFWQUlMQUJMRSB9O1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c1VuYXZhaWxhYmxlID0geyBbYXZhaWxhYmlsaXR5U3RhdHVzUGF0aF06IFNlbmRTdGF0dXMuVU5BVkFJTEFCTEUgfTtcbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNNYWludGVuYW5jZSA9IHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiBTZW5kU3RhdHVzLk1BSU5URU5BTkNFIH07XG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzTm90RGVmaW5lZCA9IHsgX19ub3Q6IHsgX19oYXM6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfSB9O1xuXG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c1BhdGggPSAnYzh5X0Nvbm5lY3Rpb24uc3RhdHVzJztcbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzQ29ubmVjdGVkID0geyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiBQdXNoU3RhdHVzLkNPTk5FQ1RFRCB9O1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXNEaXNjb25uZWN0ZWQgPSB7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IFB1c2hTdGF0dXMuRElTQ09OTkVDVEVEIH07XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlID0geyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiBQdXNoU3RhdHVzLk1BSU5URU5BTkNFIH07XG5cbiAgICBjb25zdCBkZXZpY2VVbmRlck1haW50ZW5hbmNlID0ge1xuICAgICAgX19vcjogW1xuICAgICAgICByZXNwb25zZUludGVydmFsTGVzc1RoYW5PckVxdWFsVG8wLFxuICAgICAgICBhdmFpbGFiaWxpdHlTdGF0dXNNYWludGVuYW5jZSxcbiAgICAgICAgY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlXG4gICAgICBdXG4gICAgfTtcbiAgICBjb25zdCBkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlID0ge1xuICAgICAgLy8gdXNpbmcgX19hbmQgb2YgX19ub3RzIGJlY2F1c2UgYmFja2VuZCBkb2VzIG5vdCBzdXBwb3J0IF9fbm90IHdpdGggX19vcnNcbiAgICAgIF9fYW5kOiBbXG4gICAgICAgIHsgX19ub3Q6IHJlc3BvbnNlSW50ZXJ2YWxMZXNzVGhhbk9yRXF1YWxUbzAgfSxcbiAgICAgICAgeyBfX25vdDogYXZhaWxhYmlsaXR5U3RhdHVzTWFpbnRlbmFuY2UgfSxcbiAgICAgICAgeyBfX25vdDogY29ubmVjdGlvblN0YXR1c01haW50ZW5hbmNlIH1cbiAgICAgIF1cbiAgICB9O1xuXG4gICAgdGhpcy5uYW1lID0gJ3N0YXR1cyc7XG4gICAgdGhpcy5oZWFkZXIgPSBnZXR0ZXh0KCdTdGF0dXMnKTtcbiAgICB0aGlzLmRhdGFUeXBlID0gQ29sdW1uRGF0YVR5cGUuSWNvbjtcbiAgICB0aGlzLmNlbGxSZW5kZXJlckNvbXBvbmVudCA9IFN0YXR1c0NlbGxSZW5kZXJlckNvbXBvbmVudDtcblxuICAgIHRoaXMuZmlsdGVyYWJsZSA9IHRydWU7XG4gICAgdGhpcy5maWx0ZXJpbmdDb25maWcgPSB7XG4gICAgICBzY2hlbWE6IHtcbiAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBzZW5kT25saW5lOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmRPZmZsaW5lOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmRVbmtub3duOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmROb3RNb25pdG9yZWQ6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE9ubGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoT2ZmbGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1haW50ZW5hbmNlOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmb3JtOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiB0aGlzLmdldExhYmVsVGVtcGxhdGUoXG4gICAgICAgICAgICBnZXR0ZXh0KCdTaG93IGRldmljZXMgd2l0aCBzZW5kIHN0YXR1cycpXG4gICAgICAgICAgKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZE9ubGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09ubGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kT2ZmbGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09mZmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZFVua25vd24nLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdVbmtub3duJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmROb3RNb25pdG9yZWQnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdOb3QgbW9uaXRvcmVkJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICd0ZW1wbGF0ZScsXG4gICAgICAgICAgdGVtcGxhdGU6IHRoaXMuZ2V0TGFiZWxUZW1wbGF0ZShcbiAgICAgICAgICAgIGdldHRleHQoJ1Nob3cgZGV2aWNlcyB3aXRoIHB1c2ggc3RhdHVzJylcbiAgICAgICAgICApXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdwdXNoT25saW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT25saW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3B1c2hPZmZsaW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT2ZmbGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdwdXNoTm90TW9uaXRvcmVkJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiB0aGlzLmdldExhYmVsVGVtcGxhdGUoXG4gICAgICAgICAgICBnZXR0ZXh0KCdTaG93IGRldmljZXMgd2l0aCBtYWludGVuYW5jZSBzdGF0dXMnKVxuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnRGV2aWNlIGlzIHVuZGVyIG1haW50ZW5hbmNlJylcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIGdldEZpbHRlcihtb2RlbCkge1xuICAgICAgICBjb25zdCBmaWx0ZXI6IGFueSA9IHt9O1xuICAgICAgICBjb25zdCBvcnMgPSBbXTtcblxuICAgICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE9ubGluZSkge1xuICAgICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgICBfX2FuZDogW2RldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UsIGF2YWlsYWJpbGl0eVN0YXR1c0F2YWlsYWJsZV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE9mZmxpbmUpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBhdmFpbGFiaWxpdHlTdGF0dXNVbmF2YWlsYWJsZV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZFVua25vd24pIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBhdmFpbGFiaWxpdHlTdGF0dXNOb3REZWZpbmVkXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5zZW5kTm90TW9uaXRvcmVkIHx8IG1vZGVsLnB1c2hOb3RNb25pdG9yZWQpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHJlc3BvbnNlSW50ZXJ2YWxOb3REZWZpbmVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnB1c2hPbmxpbmUpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBjb25uZWN0aW9uU3RhdHVzQ29ubmVjdGVkXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5wdXNoT2ZmbGluZSkge1xuICAgICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgICBfX2FuZDogW2RldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UsIGNvbm5lY3Rpb25TdGF0dXNEaXNjb25uZWN0ZWRdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLm1haW50ZW5hbmNlKSB7XG4gICAgICAgICAgICBvcnMucHVzaChkZXZpY2VVbmRlck1haW50ZW5hbmNlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAob3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgZmlsdGVyLl9fb3IgPSBvcnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWx0ZXI7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc29ydGFibGUgPSB0cnVlO1xuICAgIHRoaXMuc29ydGluZ0NvbmZpZyA9IHtcbiAgICAgIHBhdGhTb3J0aW5nQ29uZmlnczogW3sgcGF0aDogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9XVxuICAgIH07XG4gIH1cbn1cbiJdfQ==