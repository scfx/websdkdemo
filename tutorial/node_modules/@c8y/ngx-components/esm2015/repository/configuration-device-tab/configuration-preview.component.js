import { __awaiter } from "tslib";
import { Component, Input } from '@angular/core';
import { DeviceConfigurationOperation } from '../repository.model';
import { OperationService, OperationStatus, UserService } from '@c8y/client';
import { DeviceConfigurationService } from './device-configuration.service';
import { map } from 'rxjs/operators';
import { saveAs } from 'file-saver';
import { BsModalService } from 'ngx-bootstrap/modal';
import { SaveToRepositoryComponent } from './save-to-repository.component';
import { cloneDeep } from 'lodash-es';
import { AlertService, AppStateService, OperationRealtimeService } from '@c8y/ngx-components';
import { RepositoryService } from '../repository.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './device-configuration.service';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from 'ngx-bootstrap/modal';
import * as ɵngcc4 from '@c8y/client';
import * as ɵngcc5 from '../repository.service';
import * as ɵngcc6 from '@angular/common';
import * as ɵngcc7 from './source-code-preview.component';
import * as ɵngcc8 from '@c8y/ngx-components/operations/single-operation-details';

function ConfigurationPreviewComponent_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵelementStart(1, "strong");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.configSnapshot.name);
} }
function ConfigurationPreviewComponent_ng_template_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0, " --- ");
} }
function ConfigurationPreviewComponent_small_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "small");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "c8yDate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, ctx_r3.configSnapshot.time), " ");
} }
function ConfigurationPreviewComponent_ng_template_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0, " --- ");
} }
function ConfigurationPreviewComponent_button_15_Template(rf, ctx) { if (rf & 1) {
    const _r11 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 11);
    ɵngcc0.ɵɵlistener("click", function ConfigurationPreviewComponent_button_15_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.createDeviceOperation(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelement(2, "i", 12);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 4, ctx_r6.actionButtonText));
    ɵngcc0.ɵɵproperty("disabled", ctx_r6.isCreateOperationDisabled());
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r6.actionButtonIcon);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 6, ctx_r6.actionButtonText), " ");
} }
function ConfigurationPreviewComponent_div_16_small_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "small", 14);
    ɵngcc0.ɵɵtext(1, "The file is not available.");
    ɵngcc0.ɵɵelementEnd();
} }
function ConfigurationPreviewComponent_div_16_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "small", 14);
    ɵngcc0.ɵɵtext(1, "The file is empty.");
    ɵngcc0.ɵɵelementEnd();
} }
function ConfigurationPreviewComponent_div_16_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵelement(1, "h1", 12);
    ɵngcc0.ɵɵelementStart(2, "p");
    ɵngcc0.ɵɵelementStart(3, "strong", 14);
    ɵngcc0.ɵɵtext(4, "No preview available.");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(5, "br");
    ɵngcc0.ɵɵtemplate(6, ConfigurationPreviewComponent_div_16_small_6_Template, 2, 0, "small", 15);
    ɵngcc0.ɵɵtemplate(7, ConfigurationPreviewComponent_div_16_ng_template_7_Template, 2, 0, "ng-template", null, 16, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r13 = ɵngcc0.ɵɵreference(8);
    const ctx_r7 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("c8yIcon", "file-image-o");
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngIf", (ctx_r7.configSnapshot == null ? null : ctx_r7.configSnapshot.binary) !== "")("ngIfElse", _r13);
} }
function ConfigurationPreviewComponent_div_17_div_2_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 23);
    ɵngcc0.ɵɵlistener("click", function ConfigurationPreviewComponent_div_17_div_2_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r18); const ctx_r17 = ɵngcc0.ɵɵnextContext(3); return ctx_r17.saveToRepository(); });
    ɵngcc0.ɵɵtext(1, " Save to repository ");
    ɵngcc0.ɵɵelementEnd();
} }
function ConfigurationPreviewComponent_div_17_div_2_Template(rf, ctx) { if (rf & 1) {
    const _r20 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 20);
    ɵngcc0.ɵɵelementStart(1, "button", 21);
    ɵngcc0.ɵɵlistener("click", function ConfigurationPreviewComponent_div_17_div_2_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r20); const ctx_r19 = ɵngcc0.ɵɵnextContext(2); return ctx_r19.download(); });
    ɵngcc0.ɵɵtext(2, " Download ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(3, ConfigurationPreviewComponent_div_17_div_2_button_3_Template, 2, 0, "button", 22);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r15.hasPermission());
} }
function ConfigurationPreviewComponent_div_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 17);
    ɵngcc0.ɵɵelement(1, "c8y-source-code-preview", 18);
    ɵngcc0.ɵɵtemplate(2, ConfigurationPreviewComponent_div_17_div_2_Template, 4, 1, "div", 19);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r8 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("text", ctx_r8.configSnapshot.binary)("isDisabled", true);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r8.canSaveSnapshot);
} }
function ConfigurationPreviewComponent_div_18_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelement(1, "c8y-single-operation", 24);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r9 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("operation", ctx_r9.operation);
} }
export class ConfigurationPreviewComponent {
    constructor(deviceConfigurationService, operationRealtime, bsModal, user, appState, repositoryService, operationService, alertService) {
        this.deviceConfigurationService = deviceConfigurationService;
        this.operationRealtime = operationRealtime;
        this.bsModal = bsModal;
        this.user = user;
        this.appState = appState;
        this.repositoryService = repositoryService;
        this.operationService = operationService;
        this.alertService = alertService;
        this.isLegacy = false;
        this.canCallAction = true;
        this.deviceConfigurationOperation = DeviceConfigurationOperation;
    }
    set configurationType(type) {
        this._configurationType = type;
        this.setOperation(type);
    }
    get configurationType() {
        return this._configurationType;
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            this.setCanCallAction();
            this.setOperation(this._configurationType);
            this.operationsSubscription = this.operationRealtime
                .onAll$(this.device.id)
                .pipe(map(({ data }) => data))
                .subscribe(operation => {
                this.updatePreview(operation);
            });
        });
    }
    setOperation(configType) {
        return __awaiter(this, void 0, void 0, function* () {
            const operationList = yield this.repositoryService.getConfigFileOperationList(this.device.id, this.operationToTrigger);
            const operation = this.isLegacy
                ? operationList.find(op => op[this.operationToTrigger] && !op[this.operationToTrigger].type)
                : operationList.find(op => op[this.operationToTrigger].type === configType);
            this.operation =
                operation && operation.status !== OperationStatus.SUCCESSFUL ? operation : undefined;
        });
    }
    setCanCallAction() {
        this.canCallAction = this.deviceConfigurationService.hasAnySupportedOperation(this.device, this.operationToTrigger);
    }
    createDeviceOperation() {
        return __awaiter(this, void 0, void 0, function* () {
            let operationCfg;
            if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {
                operationCfg = this.repositoryService.getDownloadConfigurationFileOperation(this.device, this._configurationType, this.configSnapshot, this.isLegacy);
            }
            if (this.operationToTrigger === DeviceConfigurationOperation.UPLOAD_CONFIG) {
                operationCfg = this.repositoryService.getUploadConfigurationFileOperation(this.device, this._configurationType, this.isLegacy);
            }
            try {
                this.operation = (yield this.operationService.create(operationCfg)).data;
            }
            catch (ex) {
                this.alertService.addServerFailure(ex);
            }
        });
    }
    showOperation() {
        if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {
            return !!this.operation;
        }
        return (this.operation &&
            [OperationStatus.PENDING, OperationStatus.EXECUTING, OperationStatus.FAILED].includes(this.operation.status));
    }
    showBinary() {
        if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {
            return true;
        }
        return !this.showOperation();
    }
    isCreateOperationDisabled() {
        return (this.operation &&
            [OperationStatus.PENDING, OperationStatus.EXECUTING].includes(this.operation.status));
    }
    updatePreview(operation) {
        if (operation &&
            operation[this.operationToTrigger] &&
            (this.isLegacy ||
                (operation[this.operationToTrigger].type &&
                    operation[this.operationToTrigger].type === this.configurationType))) {
            this.operation = operation;
            this.updateSnapshotsOnConfigUpload(operation);
        }
    }
    download() {
        const blob = new Blob([this.configSnapshot.binary], { type: this.configSnapshot.binaryType });
        let fileName = this.configSnapshot.name;
        switch (this.configSnapshot.binaryType) {
            case 'text/csv':
            case 'application/csv':
                fileName = fileName.concat('.csv');
                break;
            case 'text/yaml':
            case 'application/x-yaml':
                fileName = fileName.concat('.yaml');
                break;
            case 'application/json':
                fileName = fileName.concat('.json');
                break;
        }
        saveAs(blob, fileName);
    }
    saveToRepository() {
        return __awaiter(this, void 0, void 0, function* () {
            const initialState = {
                configSnapshot: cloneDeep(this.configSnapshot)
            };
            const modal = this.bsModal.show(SaveToRepositoryComponent, {
                class: 'modal-sm',
                initialState,
                ignoreBackdropClick: true
            }).content;
            try {
                yield modal.result;
                this.deviceConfigurationService.updateConfigurations(true);
                modal.close();
            }
            catch (ex) {
                // do nothing
            }
        });
    }
    hasPermission() {
        return this.user.hasAnyRole(this.appState.currentUser.value, [
            'ROLE_INVENTORY_ADMIN',
            'ROLE_INVENTORY_CREATE'
        ]);
    }
    ngOnDestroy() {
        if (this.operationsSubscription) {
            this.operationsSubscription.unsubscribe();
        }
    }
    updateSnapshotsOnConfigUpload(operation) {
        return __awaiter(this, void 0, void 0, function* () {
            if (operation[DeviceConfigurationOperation.UPLOAD_CONFIG] &&
                operation.status === OperationStatus.SUCCESSFUL) {
                this.deviceConfigurationService.updateConfigurations();
            }
        });
    }
}
ConfigurationPreviewComponent.ɵfac = function ConfigurationPreviewComponent_Factory(t) { return new (t || ConfigurationPreviewComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DeviceConfigurationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.OperationRealtimeService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.BsModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.UserService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AppStateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.RepositoryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.OperationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AlertService)); };
ConfigurationPreviewComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ConfigurationPreviewComponent, selectors: [["c8y-device-configuration-preview"]], inputs: { isLegacy: "isLegacy", configurationType: "configurationType", device: "device", configSnapshot: "configSnapshot", canSaveSnapshot: "canSaveSnapshot", actionButtonText: "actionButtonText", actionButtonIcon: "actionButtonIcon", operationToTrigger: "operationToTrigger" }, decls: 19, vars: 8, consts: [[1, "content-flex-55", "p-b-16"], [1, "col-7", "p-t-4"], ["translate", "", 1, "text-label-small", "text-uppercase", "m-r-4"], [4, "ngIf", "ngIfElse"], ["emptyText", ""], ["emptyDate", ""], [1, "col-5"], ["id", "action-btn", "class", "btn btn-default btn-sm pull-right", "type", "button", 3, "title", "disabled", "click", 4, "ngIf"], ["class", "c8y-empty-state text-left", 4, "ngIf"], ["class", "flex-grow d-flex d-col", 4, "ngIf"], [4, "ngIf"], ["id", "action-btn", "type", "button", 1, "btn", "btn-default", "btn-sm", "pull-right", 3, "title", "disabled", "click"], [3, "c8yIcon"], [1, "c8y-empty-state", "text-left"], ["translate", ""], ["translate", "", 4, "ngIf", "ngIfElse"], ["emptyFile", ""], [1, "flex-grow", "d-flex", "d-col"], [1, "d-contents", 3, "text", "isDisabled"], ["class", "p-t-16", 4, "ngIf"], [1, "p-t-16"], ["type", "button", "translate", "", 1, "btn", "btn-primary", "btn-sm", "pull-right", "m-l-8", 3, "click"], ["type", "button", "class", "btn btn-default btn-sm pull-right", "translate", "", 3, "click", 4, "ngIf"], ["type", "button", "translate", "", 1, "btn", "btn-default", "btn-sm", "pull-right", 3, "click"], [3, "operation"]], template: function ConfigurationPreviewComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "p");
        ɵngcc0.ɵɵelementStart(3, "span", 2);
        ɵngcc0.ɵɵtext(4, "Configuration");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, ConfigurationPreviewComponent_span_5_Template, 3, 1, "span", 3);
        ɵngcc0.ɵɵtemplate(6, ConfigurationPreviewComponent_ng_template_6_Template, 1, 0, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "p");
        ɵngcc0.ɵɵelementStart(9, "span", 2);
        ɵngcc0.ɵɵtext(10, "Last updated");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(11, ConfigurationPreviewComponent_small_11_Template, 3, 3, "small", 3);
        ɵngcc0.ɵɵtemplate(12, ConfigurationPreviewComponent_ng_template_12_Template, 1, 0, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "div", 6);
        ɵngcc0.ɵɵtemplate(15, ConfigurationPreviewComponent_button_15_Template, 5, 8, "button", 7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(16, ConfigurationPreviewComponent_div_16_Template, 9, 3, "div", 8);
        ɵngcc0.ɵɵtemplate(17, ConfigurationPreviewComponent_div_17_Template, 3, 3, "div", 9);
        ɵngcc0.ɵɵtemplate(18, ConfigurationPreviewComponent_div_18_Template, 2, 1, "div", 10);
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(7);
        const _r4 = ɵngcc0.ɵɵreference(13);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngIf", ctx.configSnapshot == null ? null : ctx.configSnapshot.name)("ngIfElse", _r1);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngIf", ctx.configSnapshot == null ? null : ctx.configSnapshot.time)("ngIfElse", _r4);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.canCallAction);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !(ctx.configSnapshot == null ? null : ctx.configSnapshot.binary) && ctx.showBinary());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.configSnapshot == null ? null : ctx.configSnapshot.binary) && ctx.showBinary());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showOperation());
    } }, directives: [ɵngcc2.C8yTranslateDirective, ɵngcc6.NgIf, ɵngcc2.IconDirective, ɵngcc7.SourceCodePreviewComponent, ɵngcc8.SingleOperationComponent], pipes: [ɵngcc2.DatePipe, ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
ConfigurationPreviewComponent.ctorParameters = () => [
    { type: DeviceConfigurationService },
    { type: OperationRealtimeService },
    { type: BsModalService },
    { type: UserService },
    { type: AppStateService },
    { type: RepositoryService },
    { type: OperationService },
    { type: AlertService }
];
ConfigurationPreviewComponent.propDecorators = {
    device: [{ type: Input }],
    configurationType: [{ type: Input }],
    configSnapshot: [{ type: Input }],
    canSaveSnapshot: [{ type: Input }],
    actionButtonText: [{ type: Input }],
    actionButtonIcon: [{ type: Input }],
    isLegacy: [{ type: Input }],
    operationToTrigger: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ConfigurationPreviewComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-device-configuration-preview',
                template: "<div class=\"content-flex-55 p-b-16\">\n  <div class=\"col-7 p-t-4\">\n    <p>\n      <span class=\"text-label-small text-uppercase m-r-4\" translate>Configuration</span>\n      <span *ngIf=\"configSnapshot?.name; else emptyText\">\n        <strong>{{ configSnapshot.name }}</strong>\n      </span>\n      <ng-template #emptyText> --- </ng-template>\n    </p>\n    <p>\n      <span class=\"text-label-small text-uppercase m-r-4\" translate>Last updated</span>\n      <small *ngIf=\"configSnapshot?.time; else emptyDate\">\n        {{ configSnapshot.time | c8yDate }}\n      </small>\n      <ng-template #emptyDate> --- </ng-template>\n    </p>\n  </div>\n  <div class=\"col-5\">\n    <button\n      id=\"action-btn\"\n      class=\"btn btn-default btn-sm pull-right\"\n      type=\"button\"\n      title=\"{{ actionButtonText | translate }}\"\n      (click)=\"createDeviceOperation()\"\n      [disabled]=\"isCreateOperationDisabled()\"\n      *ngIf=\"canCallAction\"\n    >\n      <i [c8yIcon]=\"actionButtonIcon\"></i> {{ actionButtonText | translate }}\n    </button>\n  </div>\n</div>\n<div class=\"c8y-empty-state text-left\" *ngIf=\"!configSnapshot?.binary && showBinary()\">\n  <h1 [c8yIcon]=\"'file-image-o'\"></h1>\n  <p>\n    <strong translate>No preview available.</strong><br />\n    <small *ngIf=\"configSnapshot?.binary !== ''; else emptyFile\" translate\n      >The file is not available.</small\n    >\n    <ng-template #emptyFile>\n      <small translate>The file is empty.</small>\n    </ng-template>\n  </p>\n</div>\n<div *ngIf=\"configSnapshot?.binary && showBinary()\" class=\"flex-grow d-flex d-col\">\n  <c8y-source-code-preview\n    [text]=\"configSnapshot.binary\"\n    [isDisabled]=\"true\"\n    class=\"d-contents\"\n  ></c8y-source-code-preview>\n  <div *ngIf=\"canSaveSnapshot\" class=\"p-t-16\">\n    <button\n      type=\"button\"\n      class=\"btn btn-primary btn-sm pull-right m-l-8\"\n      (click)=\"download()\"\n      translate\n    >\n      Download\n    </button>\n    <button\n      *ngIf=\"hasPermission()\"\n      type=\"button\"\n      class=\"btn btn-default btn-sm pull-right\"\n      (click)=\"saveToRepository()\"\n      translate\n    >\n      Save to repository\n    </button>\n  </div>\n</div>\n<div *ngIf=\"showOperation()\">\n  <c8y-single-operation [operation]=\"operation\"></c8y-single-operation>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.DeviceConfigurationService }, { type: ɵngcc2.OperationRealtimeService }, { type: ɵngcc3.BsModalService }, { type: ɵngcc4.UserService }, { type: ɵngcc2.AppStateService }, { type: ɵngcc5.RepositoryService }, { type: ɵngcc4.OperationService }, { type: ɵngcc2.AlertService }]; }, { isLegacy: [{
            type: Input
        }], configurationType: [{
            type: Input
        }], device: [{
            type: Input
        }], configSnapshot: [{
            type: Input
        }], canSaveSnapshot: [{
            type: Input
        }], actionButtonText: [{
            type: Input
        }], actionButtonIcon: [{
            type: Input
        }], operationToTrigger: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdGlvbi1wcmV2aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcmVwb3NpdG9yeS9jb25maWd1cmF0aW9uLWRldmljZS10YWIvY29uZmlndXJhdGlvbi1wcmV2aWV3LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ3BFLE9BQU8sRUFBeUIsNEJBQTRCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxRixPQUFPLEVBR0wsZ0JBQWdCLEVBQ2hCLGVBQWUsRUFDZixXQUFXLEVBQ1osTUFBTSxhQUFhLENBQUM7QUFDckIsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFNUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM5RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNMUQsTUFBTSxPQUFPLDZCQUE2QjtBQUFHLElBd0IzQyxZQUNVLDBCQUFzRCxFQUN0RCxpQkFBMkMsRUFDM0Ms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a0JBQzVDOzs7Ozs7OztVQUFxRCxjQUN0RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O21PQUNJO0FBQUM7QUFBdUQsWUFkcEQsMEJBQTBCO0FBQUksWUFPQyx3QkFBd0I7QUFBSSxZQUgzRCxjQUFjO0FBQUksWUFOekIsV0FBVztBQUNWLFlBUW9CLGVBQWU7QUFBSSxZQUNqQyxpQkFBaUI7QUFBSSxZQVo1QixnQkFBZ0I7QUFDaEIsWUFVTyxZQUFZO0FBQUc7QUFBRztBQUFpRCxxQkFRekUsS0FBSztBQUFLLGdDQUNWLEtBQUs7QUFBSyw2QkFPVixLQUFLO0FBQUssOEJBQ1YsS0FBSztBQUFLLCtCQUNWLEtBQUs7QUFBSywrQkFDVixLQUFLO0FBQUssdUJBQ1YsS0FBSztBQUFLLGlDQUNWLEtBQUs7QUFBSTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uU25hcHNob3QsIERldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24gfSBmcm9tICcuLi9yZXBvc2l0b3J5Lm1vZGVsJztcbmltcG9ydCB7XG4gIElNYW5hZ2VkT2JqZWN0LFxuICBJT3BlcmF0aW9uLFxuICBPcGVyYXRpb25TZXJ2aWNlLFxuICBPcGVyYXRpb25TdGF0dXMsXG4gIFVzZXJTZXJ2aWNlXG59IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7IERldmljZUNvbmZpZ3VyYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi9kZXZpY2UtY29uZmlndXJhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgc2F2ZUFzIH0gZnJvbSAnZmlsZS1zYXZlcic7XG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuaW1wb3J0IHsgU2F2ZVRvUmVwb3NpdG9yeUNvbXBvbmVudCB9IGZyb20gJy4vc2F2ZS10by1yZXBvc2l0b3J5LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlLCBBcHBTdGF0ZVNlcnZpY2UsIE9wZXJhdGlvblJlYWx0aW1lU2VydmljZSB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgUmVwb3NpdG9yeVNlcnZpY2UgfSBmcm9tICcuLi9yZXBvc2l0b3J5LnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktZGV2aWNlLWNvbmZpZ3VyYXRpb24tcHJldmlldycsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0aW9uLXByZXZpZXcuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIENvbmZpZ3VyYXRpb25QcmV2aWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0O1xuICBASW5wdXQoKSBzZXQgY29uZmlndXJhdGlvblR5cGUodHlwZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fY29uZmlndXJhdGlvblR5cGUgPSB0eXBlO1xuICAgIHRoaXMuc2V0T3BlcmF0aW9uKHR5cGUpO1xuICB9XG4gIGdldCBjb25maWd1cmF0aW9uVHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9jb25maWd1cmF0aW9uVHlwZTtcbiAgfVxuICBASW5wdXQoKSBjb25maWdTbmFwc2hvdDogQ29uZmlndXJhdGlvblNuYXBzaG90O1xuICBASW5wdXQoKSBjYW5TYXZlU25hcHNob3Q6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGFjdGlvbkJ1dHRvblRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgYWN0aW9uQnV0dG9uSWNvbjogc3RyaW5nO1xuICBASW5wdXQoKSBpc0xlZ2FjeTogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBvcGVyYXRpb25Ub1RyaWdnZXI6XG4gICAgfCBEZXZpY2VDb25maWd1cmF0aW9uT3BlcmF0aW9uLlVQTE9BRF9DT05GSUdcbiAgICB8IERldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24uRE9XTkxPQURfQ09ORklHO1xuXG4gIG9wZXJhdGlvbjogSU9wZXJhdGlvbjtcbiAgY2FuQ2FsbEFjdGlvbiA9IHRydWU7XG4gIGRldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24gPSBEZXZpY2VDb25maWd1cmF0aW9uT3BlcmF0aW9uO1xuICBwcml2YXRlIF9jb25maWd1cmF0aW9uVHlwZTogc3RyaW5nO1xuICBwcml2YXRlIG9wZXJhdGlvbnNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGRldmljZUNvbmZpZ3VyYXRpb25TZXJ2aWNlOiBEZXZpY2VDb25maWd1cmF0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIG9wZXJhdGlvblJlYWx0aW1lOiBPcGVyYXRpb25SZWFsdGltZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBic01vZGFsOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIHVzZXI6IFVzZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgYXBwU3RhdGU6IEFwcFN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIHJlcG9zaXRvcnlTZXJ2aWNlOiBSZXBvc2l0b3J5U2VydmljZSxcbiAgICBwcml2YXRlIG9wZXJhdGlvblNlcnZpY2U6IE9wZXJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhbGVydFNlcnZpY2U6IEFsZXJ0U2VydmljZVxuICApIHt9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zZXRDYW5DYWxsQWN0aW9uKCk7XG4gICAgdGhpcy5zZXRPcGVyYXRpb24odGhpcy5fY29uZmlndXJhdGlvblR5cGUpO1xuICAgIHRoaXMub3BlcmF0aW9uc1N1YnNjcmlwdGlvbiA9IHRoaXMub3BlcmF0aW9uUmVhbHRpbWVcbiAgICAgIC5vbkFsbCQodGhpcy5kZXZpY2UuaWQpXG4gICAgICAucGlwZShtYXAoKHsgZGF0YSB9KSA9PiBkYXRhIGFzIElPcGVyYXRpb24pKVxuICAgICAgLnN1YnNjcmliZShvcGVyYXRpb24gPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcob3BlcmF0aW9uKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc2V0T3BlcmF0aW9uKGNvbmZpZ1R5cGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBvcGVyYXRpb25MaXN0ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5U2VydmljZS5nZXRDb25maWdGaWxlT3BlcmF0aW9uTGlzdChcbiAgICAgIHRoaXMuZGV2aWNlLmlkLFxuICAgICAgdGhpcy5vcGVyYXRpb25Ub1RyaWdnZXJcbiAgICApO1xuXG4gICAgY29uc3Qgb3BlcmF0aW9uID0gdGhpcy5pc0xlZ2FjeVxuICAgICAgPyBvcGVyYXRpb25MaXN0LmZpbmQob3AgPT4gb3BbdGhpcy5vcGVyYXRpb25Ub1RyaWdnZXJdICYmICFvcFt0aGlzLm9wZXJhdGlvblRvVHJpZ2dlcl0udHlwZSlcbiAgICAgIDogb3BlcmF0aW9uTGlzdC5maW5kKG9wID0+IG9wW3RoaXMub3BlcmF0aW9uVG9UcmlnZ2VyXS50eXBlID09PSBjb25maWdUeXBlKTtcblxuICAgIHRoaXMub3BlcmF0aW9uID1cbiAgICAgIG9wZXJhdGlvbiAmJiBvcGVyYXRpb24uc3RhdHVzICE9PSBPcGVyYXRpb25TdGF0dXMuU1VDQ0VTU0ZVTCA/IG9wZXJhdGlvbiA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNldENhbkNhbGxBY3Rpb24oKTogdm9pZCB7XG4gICAgdGhpcy5jYW5DYWxsQWN0aW9uID0gdGhpcy5kZXZpY2VDb25maWd1cmF0aW9uU2VydmljZS5oYXNBbnlTdXBwb3J0ZWRPcGVyYXRpb24oXG4gICAgICB0aGlzLmRldmljZSxcbiAgICAgIHRoaXMub3BlcmF0aW9uVG9UcmlnZ2VyXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZURldmljZU9wZXJhdGlvbigpIHtcbiAgICBsZXQgb3BlcmF0aW9uQ2ZnO1xuICAgIGlmICh0aGlzLm9wZXJhdGlvblRvVHJpZ2dlciA9PT0gRGV2aWNlQ29uZmlndXJhdGlvbk9wZXJhdGlvbi5ET1dOTE9BRF9DT05GSUcpIHtcbiAgICAgIG9wZXJhdGlvbkNmZyA9IHRoaXMucmVwb3NpdG9yeVNlcnZpY2UuZ2V0RG93bmxvYWRDb25maWd1cmF0aW9uRmlsZU9wZXJhdGlvbihcbiAgICAgICAgdGhpcy5kZXZpY2UsXG4gICAgICAgIHRoaXMuX2NvbmZpZ3VyYXRpb25UeXBlLFxuICAgICAgICB0aGlzLmNvbmZpZ1NuYXBzaG90LFxuICAgICAgICB0aGlzLmlzTGVnYWN5XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcGVyYXRpb25Ub1RyaWdnZXIgPT09IERldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24uVVBMT0FEX0NPTkZJRykge1xuICAgICAgb3BlcmF0aW9uQ2ZnID0gdGhpcy5yZXBvc2l0b3J5U2VydmljZS5nZXRVcGxvYWRDb25maWd1cmF0aW9uRmlsZU9wZXJhdGlvbihcbiAgICAgICAgdGhpcy5kZXZpY2UsXG4gICAgICAgIHRoaXMuX2NvbmZpZ3VyYXRpb25UeXBlLFxuICAgICAgICB0aGlzLmlzTGVnYWN5XG4gICAgICApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgdGhpcy5vcGVyYXRpb24gPSAoYXdhaXQgdGhpcy5vcGVyYXRpb25TZXJ2aWNlLmNyZWF0ZShvcGVyYXRpb25DZmcpKS5kYXRhO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKGV4KTtcbiAgICB9XG4gIH1cblxuICBzaG93T3BlcmF0aW9uKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLm9wZXJhdGlvblRvVHJpZ2dlciA9PT0gRGV2aWNlQ29uZmlndXJhdGlvbk9wZXJhdGlvbi5ET1dOTE9BRF9DT05GSUcpIHtcbiAgICAgIHJldHVybiAhIXRoaXMub3BlcmF0aW9uO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5vcGVyYXRpb24gJiZcbiAgICAgIFtPcGVyYXRpb25TdGF0dXMuUEVORElORywgT3BlcmF0aW9uU3RhdHVzLkVYRUNVVElORywgT3BlcmF0aW9uU3RhdHVzLkZBSUxFRF0uaW5jbHVkZXMoXG4gICAgICAgIHRoaXMub3BlcmF0aW9uLnN0YXR1c1xuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBzaG93QmluYXJ5KCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLm9wZXJhdGlvblRvVHJpZ2dlciA9PT0gRGV2aWNlQ29uZmlndXJhdGlvbk9wZXJhdGlvbi5ET1dOTE9BRF9DT05GSUcpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gIXRoaXMuc2hvd09wZXJhdGlvbigpO1xuICB9XG5cbiAgaXNDcmVhdGVPcGVyYXRpb25EaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5vcGVyYXRpb24gJiZcbiAgICAgIFtPcGVyYXRpb25TdGF0dXMuUEVORElORywgT3BlcmF0aW9uU3RhdHVzLkVYRUNVVElOR10uaW5jbHVkZXModGhpcy5vcGVyYXRpb24uc3RhdHVzKVxuICAgICk7XG4gIH1cblxuICB1cGRhdGVQcmV2aWV3KG9wZXJhdGlvbjogSU9wZXJhdGlvbikge1xuICAgIGlmIChcbiAgICAgIG9wZXJhdGlvbiAmJlxuICAgICAgb3BlcmF0aW9uW3RoaXMub3BlcmF0aW9uVG9UcmlnZ2VyXSAmJlxuICAgICAgKHRoaXMuaXNMZWdhY3kgfHxcbiAgICAgICAgKG9wZXJhdGlvblt0aGlzLm9wZXJhdGlvblRvVHJpZ2dlcl0udHlwZSAmJlxuICAgICAgICAgIG9wZXJhdGlvblt0aGlzLm9wZXJhdGlvblRvVHJpZ2dlcl0udHlwZSA9PT0gdGhpcy5jb25maWd1cmF0aW9uVHlwZSkpXG4gICAgKSB7XG4gICAgICB0aGlzLm9wZXJhdGlvbiA9IG9wZXJhdGlvbjtcbiAgICAgIHRoaXMudXBkYXRlU25hcHNob3RzT25Db25maWdVcGxvYWQob3BlcmF0aW9uKTtcbiAgICB9XG4gIH1cblxuICBkb3dubG9hZCgpIHtcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3RoaXMuY29uZmlnU25hcHNob3QuYmluYXJ5XSwgeyB0eXBlOiB0aGlzLmNvbmZpZ1NuYXBzaG90LmJpbmFyeVR5cGUgfSk7XG4gICAgbGV0IGZpbGVOYW1lID0gdGhpcy5jb25maWdTbmFwc2hvdC5uYW1lO1xuICAgIHN3aXRjaCAodGhpcy5jb25maWdTbmFwc2hvdC5iaW5hcnlUeXBlKSB7XG4gICAgICBjYXNlICd0ZXh0L2Nzdic6XG4gICAgICBjYXNlICdhcHBsaWNhdGlvbi9jc3YnOlxuICAgICAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLmNvbmNhdCgnLmNzdicpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RleHQveWFtbCc6XG4gICAgICBjYXNlICdhcHBsaWNhdGlvbi94LXlhbWwnOlxuICAgICAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLmNvbmNhdCgnLnlhbWwnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdhcHBsaWNhdGlvbi9qc29uJzpcbiAgICAgICAgZmlsZU5hbWUgPSBmaWxlTmFtZS5jb25jYXQoJy5qc29uJyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBzYXZlQXMoYmxvYiwgZmlsZU5hbWUpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVRvUmVwb3NpdG9yeSgpIHtcbiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gICAgICBjb25maWdTbmFwc2hvdDogY2xvbmVEZWVwKHRoaXMuY29uZmlnU25hcHNob3QpXG4gICAgfTtcbiAgICBjb25zdCBtb2RhbCA9IHRoaXMuYnNNb2RhbC5zaG93KFNhdmVUb1JlcG9zaXRvcnlDb21wb25lbnQsIHtcbiAgICAgIGNsYXNzOiAnbW9kYWwtc20nLFxuICAgICAgaW5pdGlhbFN0YXRlLFxuICAgICAgaWdub3JlQmFja2Ryb3BDbGljazogdHJ1ZVxuICAgIH0pLmNvbnRlbnQgYXMgU2F2ZVRvUmVwb3NpdG9yeUNvbXBvbmVudDtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbW9kYWwucmVzdWx0O1xuICAgICAgdGhpcy5kZXZpY2VDb25maWd1cmF0aW9uU2VydmljZS51cGRhdGVDb25maWd1cmF0aW9ucyh0cnVlKTtcbiAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICB9XG4gIH1cblxuICBoYXNQZXJtaXNzaW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnVzZXIuaGFzQW55Um9sZSh0aGlzLmFwcFN0YXRlLmN1cnJlbnRVc2VyLnZhbHVlLCBbXG4gICAgICAnUk9MRV9JTlZFTlRPUllfQURNSU4nLFxuICAgICAgJ1JPTEVfSU5WRU5UT1JZX0NSRUFURSdcbiAgICBdKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLm9wZXJhdGlvbnNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMub3BlcmF0aW9uc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlU25hcHNob3RzT25Db25maWdVcGxvYWQob3BlcmF0aW9uKSB7XG4gICAgaWYgKFxuICAgICAgb3BlcmF0aW9uW0RldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24uVVBMT0FEX0NPTkZJR10gJiZcbiAgICAgIG9wZXJhdGlvbi5zdGF0dXMgPT09IE9wZXJhdGlvblN0YXR1cy5TVUNDRVNTRlVMXG4gICAgKSB7XG4gICAgICB0aGlzLmRldmljZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLnVwZGF0ZUNvbmZpZ3VyYXRpb25zKCk7XG4gICAgfVxuICB9XG59XG4iXX0=