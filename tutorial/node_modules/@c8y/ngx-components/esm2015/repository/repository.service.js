import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { EventBinaryService, EventService, InventoryBinaryService, InventoryService, OperationService, OperationStatus, QueriesUtil } from '@c8y/client';
import { AlertService, gettext, OperationRealtimeService } from '@c8y/ngx-components';
import { assign, cloneDeep, find, forEach, get, head, isNil, isString, isUndefined, map as _map, pick, remove, set } from 'lodash-es';
import { defer, from, merge, of, throwError } from 'rxjs';
import { filter, map, switchMap, take, takeWhile, withLatestFrom } from 'rxjs/operators';
import { RepositoryType, REPOSITORY_BINARY_TYPES } from './repository.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/client';
import * as ɵngcc2 from '@c8y/ngx-components';
export class RepositoryService {
    constructor(inventory, inventoryBinary, operation, alert, event, operationRealtime, eventBinary) {
        this.inventory = inventory;
        this.inventoryBinary = inventoryBinary;
        this.operation = operation;
        this.alert = alert;
        this.event = event;
        this.operationRealtime = operationRealtime;
        this.eventBinary = eventBinary;
        this.dateFrom = new Date(0);
        this.dateTo = new Date(Date.now() + 86400000); // 1 day in the future
        this.queriesUtil = new QueriesUtil();
    }
    /**
     * Lists repository entries of given type.
     * @param type The type of repository entries to list.
     * @param options Extra listing options.
     */
    listRepositoryEntries(type, options) {
        const defaultOrder = [{ name: 1 }];
        const defaultFilters = { type };
        const legacyFilters = { __has: `url` };
        let filters = {};
        let fullQuery = (options && options.query) || {};
        if (!options || (options && !options.skipDefaultOrder)) {
            fullQuery = this.queriesUtil.addOrderbys(fullQuery, defaultOrder, 'prepend');
        }
        fullQuery = this.queriesUtil.addAndFilter(fullQuery, defaultFilters);
        if (options && options.partialTextFilter) {
            const { partialText, properties } = options.partialTextFilter;
            const orFilter = { __or: properties.map(property => ({ [property]: `*${partialText}*` })) };
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, orFilter);
        }
        if (options && options.partialName) {
            // backwards compatibility if
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { name: `*${options.partialName}*` });
        }
        if (options && options.skipLegacy) {
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { __not: legacyFilters });
        }
        filters = Object.assign({ query: this.queriesUtil.buildQuery(fullQuery), pageSize: 50, withTotalPages: true }, ((options && options.params) || {}));
        return this.inventory.list(filters);
    }
    // TODO: merge with create()
    save(data, type, mo = {}) {
        return __awaiter(this, void 0, void 0, function* () {
            switch (type) {
                case RepositoryType.CONFIGURATION: {
                    Object.assign(mo, {
                        type: RepositoryType.CONFIGURATION,
                        configurationType: data.selected ? data.selected.configurationType : undefined,
                        name: data.version,
                        description: data.description,
                        deviceType: data.deviceType,
                        c8y_Global: {}
                    });
                    if (!data.deviceType && mo.id) {
                        mo.deviceType = null;
                    }
                    if (!data.selected && mo.id) {
                        mo.configurationType = null;
                    }
                    break;
                }
            }
            const existingUrl = mo.url;
            if (data.binary.url) {
                mo.url = data.binary.url;
            }
            else if (data.binary.file) {
                const response = yield this.inventoryBinary.create(data.binary.file, {
                    c8y_Global: {}
                });
                mo.url = response.data.self;
            }
            if (mo.id) {
                return this.updateEntry(mo, existingUrl);
            }
            return this.createEntry(mo);
        });
    }
    create(modal, type) {
        return __awaiter(this, void 0, void 0, function* () {
            switch (type) {
                case RepositoryType.FIRMWARE:
                case RepositoryType.SOFTWARE:
                    return this.createFirmwareOrSoftware(modal, type);
            }
        });
    }
    createFirmwareOrSoftware(modal, type) {
        return __awaiter(this, void 0, void 0, function* () {
            let binary;
            let binaryURL;
            let repositoryEntry;
            let repositoryBinary;
            const mos = [];
            const { selected: { id: selectedId }, binary: { file, url } } = modal;
            try {
                if (file) {
                    ({ data: binary } = yield this.saveBinary(file));
                    ({ self: binaryURL } = binary);
                    mos.push(binary);
                }
                else {
                    binaryURL = url;
                }
                ({ data: repositoryEntry } = yield this.createOrUpdateRepositoryEntry(modal, type));
                if (isNil(selectedId)) {
                    mos.push(repositoryEntry);
                }
                ({ data: repositoryBinary } = yield this.createRepositoryBinary(modal, binaryURL, type, repositoryEntry));
                mos.push(repositoryBinary);
                if (file) {
                    yield this.linkBinary(repositoryBinary, binary);
                }
                return repositoryEntry;
            }
            catch (error) {
                this.cleanUp(mos);
                this.errorMsg();
                // Propagate error
                throw error;
            }
        });
    }
    saveBinary(file) {
        return this.inventoryBinary.create(file, { c8y_Global: {} });
    }
    createOrUpdateRepositoryEntry(modal, type) {
        const { selected: { id, name }, description, deviceType } = modal;
        const mo = {
            id,
            name: id ? undefined : name,
            description,
            type: id ? undefined : type,
            c8y_Global: {}
        };
        if (deviceType) {
            set(mo, 'c8y_Filter.type', deviceType);
        }
        if (modal.softwareType) {
            set(mo, 'softwareType', modal.softwareType.softwareType);
        }
        return id
            ? this.inventory.update(mo)
            : this.inventory.create(mo);
    }
    createRepositoryBinary(modal, binaryURL, type, parent) {
        const mo = this.prepareRepositoryBinaryMO(modal, binaryURL, type);
        return this.inventory.childAdditionsCreate(mo, parent);
    }
    prepareRepositoryBinaryMO(modal, binaryURL, type) {
        const { version, patchVersion, dependency } = modal;
        const result = {
            type: REPOSITORY_BINARY_TYPES[type],
            [type]: {
                url: binaryURL
            },
            c8y_Global: {}
        };
        if (dependency) {
            set(result, [type, 'version'], patchVersion);
            assign(result, {
                c8y_Patch: {
                    dependency: dependency.c8y_Firmware.version
                }
            });
        }
        else {
            set(result, [type, 'version'], version);
        }
        return result;
    }
    linkBinary(repositoryBinary, binary) {
        return __awaiter(this, void 0, void 0, function* () {
            const { id: repositoryBinaryId } = repositoryBinary;
            if (binary) {
                const { id: binaryId } = binary;
                return this.inventory.childAdditionsAdd(binaryId, repositoryBinaryId);
            }
        });
    }
    cleanUp(mosToDelete) {
        mosToDelete.forEach(mo => {
            const { c8y_IsBinary } = mo;
            isUndefined(c8y_IsBinary) ? this.delete(mo) : this.inventoryBinary.delete(mo);
        });
    }
    delete(entity) {
        return this.inventory.delete(entity, { forceCascade: true });
    }
    errorMsg() {
        const msg = gettext('Failed to save');
        this.alert.danger(msg);
    }
    getBaseVersionsCount$(entry) {
        if (this.isLegacyEntry(entry)) {
            return of(1);
        }
        return from(this.listBaseVersions(entry, { pageSize: 1, withTotalPages: true })).pipe(map(({ paging }) => paging.totalPages));
    }
    getBaseVersionFromMO(mo) {
        return this.isPatch(mo) ? get(mo, 'c8y_Patch.dependency') : get(mo, 'c8y_Firmware.version');
    }
    isPatch(mo) {
        return !!get(mo, 'c8y_Patch.dependency');
    }
    getPatchVersionsCount$(entry, baseVersion) {
        if (this.isLegacyEntry(baseVersion)) {
            return of(0);
        }
        return from(this.listPatchVersions(entry, baseVersion, { pageSize: 1, withTotalPages: true })).pipe(map(({ paging }) => paging.totalPages));
    }
    isLegacyEntry(entry) {
        return Boolean(entry.url);
    }
    /**
     * Lists all versions (base and patch ones) of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    listAllVersions(entry, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        const VERSION_FILTER_ORDER = {
            __filter: {},
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, VERSION_FILTER_ORDER, params);
    }
    /**
     * Lists base versions of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    listBaseVersions(entry, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        const NO_PATCH_FILTER_ORDER = {
            __filter: {
                __not: { __has: 'c8y_Patch' }
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, NO_PATCH_FILTER_ORDER, params);
    }
    /**
     * Lists patch versions of given base version under the entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    listPatchVersions(entry, baseVersion, params = {}) {
        const version = isString(baseVersion) ? baseVersion : get(baseVersion, 'c8y_Firmware.version');
        const PATCH_FILTER_ORDER = {
            __filter: {
                'c8y_Patch.dependency': version
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    }
    /**
     * Lists patch versions of given base version under the entry including the base version.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * In terms of legacy base version the entry gets transformed to fit the needed data model.
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    listBaseVersionAndPatches(entry, baseVersion, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return Promise.resolve({
                data: [
                    Object.assign({
                        c8y_Firmware: {
                            version: entry.version,
                            url: entry.url
                        }
                    }, entry)
                ]
            });
        }
        const PATCH_FILTER_ORDER = {
            __filter: {
                __or: {
                    'c8y_Patch.dependency': baseVersion.c8y_Firmware.version,
                    'c8y_Firmware.version': baseVersion.c8y_Firmware.version
                }
            },
            __orderby: [{ 'c8y_Patch.dependency': 1 }, { 'c8y_Firmware.version': 1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    }
    listChildren(entry, filters = {}, params = {}) {
        const childrenFilters = { __bygroupid: entry.id };
        const query = this.queriesUtil.addAndFilter(filters, childrenFilters);
        // FIXME: needed because of issue in forOf directive (...)
        params.withTotalPages = true;
        return this.inventory.listQuery(query, params);
    }
    /**
     * Fetches all items from the list starting with the provided page.
     * @param firstPage The first page of the list to fetch all items for.
     */
    fetchAllItemsFromList(firstPage) {
        return __awaiter(this, void 0, void 0, function* () {
            let allItems;
            if (!firstPage.then) {
                allItems = [...firstPage];
            }
            else {
                let { paging, data: items } = yield firstPage;
                allItems = [...items];
                while (paging && paging.nextPage) {
                    ({ paging, data: items } = yield paging.next());
                    allItems = [...allItems, ...items];
                }
            }
            return allItems;
        });
    }
    /**
     * Gets top level repository entry managed object for base or patch version.
     * @param mo Base or patch version managed object with parents.
     */
    getRepositoryEntryMO$(mo) {
        if (!mo) {
            return of(undefined);
        }
        const [reference] = get(mo, 'additionParents.references');
        const id = get(reference, 'managedObject.id');
        return id
            ? from(this.inventory.detail(id, { withChildren: false })).pipe(map(({ data }) => data))
            : of(undefined);
    }
    /**
     * Gets base or patch version managed object.
     * @param deviceRepositoryFragment Device repository fragment.
     * @param type Top level repository entry type.
     * @param configuration Configuration object with options:
     * - **skipLegacy** - `boolean` - Exclude legacy entries.
     * - **filters** - `object` - Filter object.
     *
     * @deprecated as it doesn't support 'missing url' case
     */
    getRepositoryBinaryMoByVersion(deviceRepositoryFragment, type, { skipLegacy = false, filters = {} } = {}) {
        const { version, url, name } = deviceRepositoryFragment;
        const repositoryBinaryType = REPOSITORY_BINARY_TYPES[type];
        let query;
        const newModelBaseVersionQuery = {
            [`${type}.version`]: version,
            [`${type}.url`]: url,
            type: repositoryBinaryType
        };
        const legacyVersionQuery = { url, type, name };
        filters = Object.assign({ withChildren: false, withParents: true }, filters);
        if (skipLegacy) {
            query = {
                __and: Object.assign({}, newModelBaseVersionQuery)
            };
        }
        else {
            query = {
                __or: [{ __and: Object.assign({}, newModelBaseVersionQuery) }, { __and: Object.assign({}, legacyVersionQuery) }]
            };
        }
        return this.inventory.listQuery(query, filters).then(({ data }) => head(data));
    }
    getBinaryName$(binaryUrl) {
        if (!binaryUrl) {
            return of('---');
        }
        const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
        if (!binaryId) {
            return of(binaryUrl);
        }
        return defer(() => this.inventory.detail(binaryId).then(result => result.data)).pipe(map(mo => mo.name));
    }
    /**
     * Generates an inventory query object which can be used to find
     * repository entries of specified type matching the type of provided device.
     * @param repositoryType The type of repository entries which will be queried with the generated query.
     * @param device The device for which matching repository entries will be queried with the generated query.
     */
    getDeviceTypeQuery(repositoryType, device) {
        let result = { type: repositoryType };
        if (repositoryType === RepositoryType.CONFIGURATION) {
            if (device.type) {
                result = this.queriesUtil.addAndFilter(result, {
                    __or: [{ deviceType: device.type }, { __not: { __has: `deviceType` } }]
                });
            }
        }
        else {
            result = this.queriesUtil.addAndFilter(result, {
                __or: [
                    { 'c8y_Filter.type': device.type },
                    { 'c8y_Filter.type': '' },
                    { __not: { __has: `c8y_Filter.type` } }
                ]
            });
        }
        return result;
    }
    /**
     * Generates an inventory query object which can be used to find configuration repository entries
     * matching the type of provided device and specified configuration type.
     * @param device The device for which matching repository entries will be queried with the generated query.
     * @param configurationType Configuration type for which matching repository entries will be queried with the generated query.
     */
    getConfigurationTypeQuery(device, configurationType) {
        const query = this.getDeviceTypeQuery(RepositoryType.CONFIGURATION, device);
        return this.queriesUtil.addAndFilter(query, {
            __or: [
                { configurationType },
                { configurationType: '' },
                { __not: { __has: `configurationType` } }
            ]
        });
    }
    /**
     * Gets the list of software installed in the device in the uniform format.
     * Supports c8y_SoftwareList and c8y_Software fragments.
     * @param device The device whose software list should be returned.
     */
    getDeviceSoftwareList(device) {
        if (device.c8y_SoftwareList) {
            return cloneDeep(device.c8y_SoftwareList);
        }
        if (device.c8y_Software) {
            return _map(device.c8y_Software, (version, name) => ({ name, version }));
        }
        return [];
    }
    /**
     * Prepares a software update operation for given device and the list of changes, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param changes The list of software changes which should be applied.
     */
    createSoftwareUpdateOperation(device, changes) {
        return __awaiter(this, void 0, void 0, function* () {
            const operation = this.getSoftwareUpdateOperation(device, changes);
            return (yield this.operation.create(operation)).data;
        });
    }
    /**
     * Prepares a software update operation for given device and changes.
     * Returned operation type depends on device's supported operations.
     * Supports c8y_SoftwareUpdate, c8y_SoftwareList, and c8y_Software operations.
     * @param device The device for which operation should be prepared.
     * @param changes The list of software changes which should be applied.
     */
    getSoftwareUpdateOperation(device, changes) {
        const operation = {
            deviceId: device.id,
            description: `Apply software changes: ${changes
                .map(change => `${change.action} "${change.name}"${change.version ? ` (version: ${change.version})` : ''}`)
                .join(', ')}`
        };
        if (device.c8y_SupportedOperations.includes('c8y_SoftwareUpdate')) {
            operation.c8y_SoftwareUpdate = cloneDeep(changes);
        }
        else if (device.c8y_SupportedOperations.includes('c8y_SoftwareList')) {
            operation.c8y_SoftwareList = cloneDeep(device.c8y_SoftwareList) || [];
            changes.forEach(change => {
                const deviceSoftware = pick(change, ['name', 'version', 'url']);
                if (change.action === 'delete') {
                    remove(operation.c8y_SoftwareList, deviceSoftware);
                }
                if (change.action === 'install') {
                    operation.c8y_SoftwareList.push(deviceSoftware);
                }
            });
        }
        else if (device.c8y_SupportedOperations.includes('c8y_Software')) {
            operation.c8y_Software = cloneDeep(device.c8y_Software) || {};
            changes.forEach(change => {
                if (change.action === 'delete') {
                    delete operation.c8y_Software[change.name];
                }
                if (change.action === 'install') {
                    operation.c8y_Software[change.name] = change.version;
                }
            });
        }
        return operation;
    }
    /**
     * Extracts the list of device software changes from given operation in the context of given device.
     * @param operation The operation from which the list should be extracted.
     * @param device The target device of the operation.
     */
    getDeviceSoftwareChangesFromOperation(operation, device) {
        if (operation.c8y_SoftwareUpdate) {
            return cloneDeep(operation.c8y_SoftwareUpdate);
        }
        if (operation.c8y_SoftwareList) {
            return this.getDeviceSoftwareChangesFromSoftwareListOperation(operation, device);
        }
        if (operation.c8y_Software) {
            return this.getDeviceSoftwareChangesFromSoftwareOperation(operation, device);
        }
        return [];
    }
    /**
     * Prepares a firmware update operation for given device and the selected repository binary, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param selectedOption The selected repository binary option.
     */
    createFirmwareUpdateOperation(device, selectedOption) {
        return __awaiter(this, void 0, void 0, function* () {
            const operation = this.getFirmwareUpdateOperation(device, selectedOption);
            return (yield this.operation.create(operation)).data;
        });
    }
    /**
     * Prepares a firmware update operation for given device and selected version.
     * Supports c8y_Firmware operation.
     * @param device The device for which operation should be prepared.
     * @param selectedOption Selected firmware version.
     */
    getFirmwareUpdateOperation(device, selectedOption) {
        delete selectedOption.id;
        const operation = {
            deviceId: device.id,
            description: `Update firmware to: "${selectedOption.name}"${selectedOption.version ? ` (version: ${selectedOption.version})` : ''}`,
            c8y_Firmware: Object.assign({}, selectedOption)
        };
        return operation;
    }
    /**
     * Prepares a configuration file upload operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param isLegacy  A legacy operation is created without a configurationType.
     */
    getUploadConfigurationFileOperation(device, configurationType, isLegacy = false) {
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: `Retrieve configuration snapshot from device ${device.name}`,
                c8y_UploadConfigFile: {}
            };
        }
        return {
            deviceId: device.id,
            description: `Retrieve ${configurationType} configuration snapshot from device ${device.name}`,
            c8y_UploadConfigFile: {
                type: configurationType
            }
        };
    }
    /**
     * Prepares a configuration file download operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param binaryUrl The url of a binary to be downloaded.
     * @param isLegacy A legacy operation is created without a configurationType.
     */
    getDownloadConfigurationFileOperation(device, configurationType, configSnapshot, isLegacy = false) {
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: `Send configuration snapshot ${configSnapshot.name} to device ${device.name}`,
                c8y_DownloadConfigFile: {
                    url: configSnapshot.binaryUrl,
                    c8y_ConfigurationDump: {
                        id: configSnapshot.id
                    }
                }
            };
        }
        return {
            deviceId: device.id,
            description: `Send configuration snapshot ${configSnapshot.name} of configuration type ${configurationType} to device ${device.name}`,
            c8y_DownloadConfigFile: {
                url: configSnapshot.binaryUrl,
                type: configurationType
            }
        };
    }
    /**
     * Gets the last firmware update operation for given device.
     * Looks for c8y_Firmware operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastFirmwareUpdateOperation(deviceId) {
        return __awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getFirstMatchingOperation([Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_Firmware' })]);
        });
    }
    /**
     * Gets the last software update operation for given device.
     * Looks for c8y_SoftwareUpdate, c8y_SoftwareList, or c8y_Software operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastSoftwareUpdateOperation(deviceId) {
        return __awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getFirstMatchingOperation([
                Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_SoftwareUpdate' }),
                Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_SoftwareList' }),
                Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_Software' })
            ]);
        });
    }
    /**
     * Iterates over the list of filters and queries the operations.
     * If a query returns at least one operation, the first one will be returned.
     * Otherwise the next query will be performed.
     * If none of the queries returns any operation, null will be returned.
     * @param filtersList The list of filters for the queries.
     */
    getFirstMatchingOperation(filtersList) {
        return __awaiter(this, void 0, void 0, function* () {
            let matchingOperation = null;
            for (const filters of filtersList) {
                const operations = (yield this.operation.list(filters)).data;
                if (operations.length) {
                    matchingOperation = operations[0];
                    break;
                }
            }
            return matchingOperation;
        });
    }
    /**
     * Iterates over the list of filters and queries the operations.
     * It compares the operations retrieved by the queries by 'creationTime'
     * and return the latest one.
     * If none of the queries returns any operation, null will be returned.
     * @param filtersList The list of filters for the queries.
     */
    getLatestMatchingOperation(filtersList) {
        return __awaiter(this, void 0, void 0, function* () {
            let matchingOperation = null;
            for (const filters of filtersList) {
                const operations = (yield this.operation.list(filters)).data;
                if (operations.length) {
                    if (matchingOperation) {
                        matchingOperation =
                            new Date(matchingOperation.creationTime).getTime() <
                                new Date(operations[0].creationTime).getTime()
                                ? operations[0]
                                : matchingOperation;
                    }
                    else {
                        matchingOperation = operations[0];
                    }
                }
            }
            return matchingOperation;
        });
    }
    /**
     * Creates the operation and returns an observable to track its progress.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to create and track.
     */
    createObservedOperation(operation) {
        return from(this.operation.create(operation)).pipe(map(({ data }) => data), take(1), switchMap(createdOperation => this.observeOperation(createdOperation)));
    }
    /**
     * Returns an observable to track progress of given operation.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to be observed.
     */
    observeOperation(operation) {
        const observedOperation$ = of(operation);
        const operationUpdates$ = observedOperation$.pipe(switchMap(observedOperation => this.operationRealtime.onAll$(observedOperation.deviceId)), map(({ data }) => data), withLatestFrom(observedOperation$), filter(([operationUpdate, observedOperation]) => operationUpdate.id === observedOperation.id), switchMap(([operationUpdate]) => {
            if (operationUpdate.status === OperationStatus.FAILED) {
                return throwError(operationUpdate);
            }
            return of(operationUpdate);
        }), takeWhile(operationUpdate => operationUpdate.status !== OperationStatus.SUCCESSFUL, true));
        return merge(observedOperation$, operationUpdates$);
    }
    /**
     * Gets a single event with latest creationTime for the given device Id and event type.
     * @param deviceId The device Id for which the events should be queried.
     * @param type Event type.
     */
    getLatestConfigurationEvent(deviceId, type) {
        return __awaiter(this, void 0, void 0, function* () {
            const eventFilter = {
                source: deviceId,
                type,
                dateFrom: this.dateFrom.toISOString(),
                dateTo: this.dateTo.toISOString(),
                pageSize: 1
            };
            const { data } = yield this.event.list(eventFilter);
            return data[0];
        });
    }
    /**
     * Gets a list of operations for the given device Id, and operation type.
     * @param deviceId The device Id for which the operation should be queried.
     * @param operationType Operation type fragment.
     */
    getConfigFileOperationList(deviceId, operationType) {
        return __awaiter(this, void 0, void 0, function* () {
            const operationFilter = {
                deviceId,
                fragmentType: operationType,
                dateFrom: this.dateFrom.toISOString(),
                dateTo: this.dateTo.toISOString(),
                revert: true,
                pageSize: 2000
            };
            return (yield this.operation.list(operationFilter)).data;
        });
    }
    /**
     * Gets latest uploaded configuration snapshot for the given device, and configuration type.
     * @param device The device for which the configuration snapshot was uploaded.
     * @param configurationType Selected configuration type.
     */
    getConfigSnapshot(device, configurationType) {
        return __awaiter(this, void 0, void 0, function* () {
            const event = yield this.getLatestConfigurationEvent(device.id, configurationType);
            let configSnapshot;
            if (event) {
                configSnapshot = {
                    time: event.time,
                    name: event.text,
                    deviceType: device.type,
                    configurationType
                };
                try {
                    configSnapshot.binary = yield (yield this.eventBinary.download(event)).text();
                    if (event.c8y_IsBinary) {
                        configSnapshot.binaryType = event.c8y_IsBinary.type;
                    }
                }
                catch (ex) {
                    const msg = gettext('Could not get the binary.');
                    this.alert.danger(msg);
                }
            }
            return configSnapshot;
        });
    }
    getLegacyConfigSnapshot(deviceId) {
        return __awaiter(this, void 0, void 0, function* () {
            let configSnapshot;
            let mo;
            const device = (yield this.inventory.detail(deviceId, { withChildren: false })).data;
            const snapshotId = device.c8y_ConfigurationDump && device.c8y_ConfigurationDump.id;
            if (!snapshotId) {
                return;
            }
            try {
                mo = (yield this.inventory.detail(snapshotId)).data;
            }
            catch (ex) {
                // do nothing
            }
            if (mo) {
                configSnapshot = {
                    time: mo.creationTime,
                    name: mo.name
                };
                configSnapshot.binary = yield this.getBinaryText(mo.url, { allowExternal: false });
            }
            return configSnapshot;
        });
    }
    /**
     * Returns a binary object as text.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getBinaryText(binaryUrl, options) {
        return __awaiter(this, void 0, void 0, function* () {
            const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
            let res;
            if (!binaryId && options.allowExternal) {
                res = yield this.getExternalBinaryResponse(binaryUrl, options);
            }
            else {
                res = yield this.getInternalBinaryResponse(binaryId, options);
            }
            if (!res) {
                return null;
            }
            return res.text();
        });
    }
    /**
     * Returns a binary object as File.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     */
    getBinaryFile(binaryUrl, options) {
        return __awaiter(this, void 0, void 0, function* () {
            const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
            if (!binaryId && !options.allowExternal) {
                return null;
            }
            // @TODO: note that it doesn't solve issue with external binary here, such url won't have binaryId, so we won't know the name or contentType to use in File constructor, let's add a @FIXME comment for now?
            const { name, contentType } = (yield this.inventory.detail(binaryId)).data;
            const res = !!binaryId
                ? yield this.getInternalBinaryResponse(binaryId)
                : yield this.getExternalBinaryResponse(binaryUrl);
            const arrayBuffer = yield res.arrayBuffer();
            return new File([arrayBuffer], name, { type: contentType });
        });
    }
    /**
     * Gets the last configuration update operation for given device.
     * Looks for c8y_Configuration and c8y_SendConfiguration operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastConfigUpdateOperation(deviceId) {
        return __awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getLatestMatchingOperation([
                Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_Configuration' }),
                Object.assign(Object.assign({}, filters), { fragmentType: 'c8y_SendConfiguration' })
            ]);
        });
    }
    /**
     * Prepares a configuration download operation for given device and its current configuration.
     * Supports c8y_SendConfiguration operation.
     * @param device The device for which operation should be prepared.
     */
    createTextBasedConfigurationReloadOperation(device) {
        return {
            deviceId: device.id,
            description: gettext('Requested current configuration'),
            c8y_SendConfiguration: {}
        };
    }
    /**
     * Prepares a configuration update operation for the given device.
     * Supports c8y_Configuration operation.
     * @param device The device for which operation should be prepared.
     * @param config The configuration which will update the existing one.
     */
    createTextBasedConfigurationUpdateOperation(device, config) {
        return {
            deviceId: device.id,
            description: gettext('Configuration update'),
            c8y_Configuration: {
                config
            }
        };
    }
    getBinary(binaryId) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                return yield this.inventoryBinary.download(binaryId);
            }
            catch (ex) {
                const msg = gettext('Could not get the binary.');
                this.alert.danger(msg);
            }
        });
    }
    /**
     * Gets all available snapshots from the repository for the given device.
     * @param device The device for which the snapshots should be prepared.
     * @param configurationType Selected configuration type.
     */
    getSnapshotsFromRepository(device, configurationType) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = this.getConfigurationTypeQuery(device, configurationType);
            const res = yield this.listRepositoryEntries(RepositoryType.CONFIGURATION, {
                query: searchQuery,
                params: { pageSize: 100 }
            });
            return res.data;
        });
    }
    /**
     * Returns a binary object.
     * @param binaryId binary ID
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getInternalBinaryResponse(binaryId, options = {}) {
        return __awaiter(this, void 0, void 0, function* () {
            let res;
            try {
                res = yield this.inventoryBinary.download(binaryId);
            }
            catch (ex) {
                if (!options.noAlerts) {
                    const msg = gettext('Could not get the binary.');
                    this.alert.danger(msg);
                }
            }
            return res;
        });
    }
    /**
     * Returns a binary object.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getExternalBinaryResponse(binaryUrl, options = {}) {
        return __awaiter(this, void 0, void 0, function* () {
            let res;
            try {
                const fetchRes = yield fetch(binaryUrl);
                if (fetchRes.status >= 400) {
                    throw res;
                }
                res = fetchRes;
            }
            catch (_a) {
                if (!options.noAlerts) {
                    const msg = gettext('Could not get the external binary');
                    this.alert.danger(msg);
                }
            }
            return res;
        });
    }
    createEntry(mo) {
        return __awaiter(this, void 0, void 0, function* () {
            const binaryId = yield this.inventoryBinary.getIdFromUrl(mo.url);
            const newMo = yield this.inventory.create(mo);
            if (binaryId) {
                yield this.inventory.childAdditionsAdd(binaryId, newMo.data);
            }
            return newMo;
        });
    }
    updateEntry(mo, url) {
        return __awaiter(this, void 0, void 0, function* () {
            const existingBinaryId = yield this.inventoryBinary.getIdFromUrl(url);
            const newBinaryId = yield this.inventoryBinary.getIdFromUrl(mo.url);
            if (existingBinaryId && existingBinaryId !== newBinaryId) {
                const id = this.inventoryBinary.getIdFromUrl(url);
                yield this.inventoryBinary.delete(id);
            }
            if (newBinaryId) {
                yield this.inventory.childAdditionsAdd(newBinaryId, mo);
            }
            return this.inventory.update(mo);
        });
    }
    getBaseVersionResultListForLegacyEntry(entry) {
        return Promise.resolve({
            res: {},
            data: [
                Object.assign(Object.assign({}, entry), { [entry.type]: {
                        version: entry.version,
                        url: entry.url
                    } })
            ]
        });
    }
    getDeviceSoftwareChangesFromSoftwareListOperation(operation, device) {
        const changes = [];
        forEach(device.c8y_SoftwareList, deviceSoftware => {
            const operationSoftware = find(operation.c8y_SoftwareList, { name: deviceSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(Object.assign(Object.assign({}, deviceSoftware), { action: 'delete' }));
            }
        });
        forEach(operation.c8y_SoftwareList, operationSoftware => {
            const deviceSoftware = find(device.c8y_SoftwareList, { name: operationSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(Object.assign(Object.assign({}, operationSoftware), { action: 'install' }));
            }
        });
        return changes;
    }
    getDeviceSoftwareChangesFromSoftwareOperation(operation, device) {
        const changes = [];
        forEach(device.c8y_Software, (deviceSoftwareVersion, deviceSoftwareName) => {
            if (operation.c8y_Software[deviceSoftwareName] !== deviceSoftwareVersion) {
                changes.push({
                    name: deviceSoftwareName,
                    version: deviceSoftwareVersion,
                    action: 'delete'
                });
            }
        });
        forEach(operation.c8y_Software, (operationSoftwareVersion, operationSoftwareName) => {
            const deviceSoftwareVersion = device.c8y_Software && device.c8y_Software[operationSoftwareName];
            if (deviceSoftwareVersion !== operationSoftwareVersion) {
                changes.push({
                    name: operationSoftwareName,
                    version: operationSoftwareVersion,
                    action: 'install'
                });
            }
        });
        return changes;
    }
}
RepositoryService.ɵfac = function RepositoryService_Factory(t) { return new (t || RepositoryService)(ɵngcc0.ɵɵinject(ɵngcc1.InventoryService), ɵngcc0.ɵɵinject(ɵngcc1.InventoryBinaryService), ɵngcc0.ɵɵinject(ɵngcc1.OperationService), ɵngcc0.ɵɵinject(ɵngcc2.AlertService), ɵngcc0.ɵɵinject(ɵngcc1.EventService), ɵngcc0.ɵɵinject(ɵngcc2.OperationRealtimeService), ɵngcc0.ɵɵinject(ɵngcc1.EventBinaryService)); };
RepositoryService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: RepositoryService, factory: RepositoryService.ɵfac });
RepositoryService.ctorParameters = () => [
    { type: InventoryService },
    { type: InventoryBinaryService },
    { type: OperationService },
    { type: AlertService },
    { type: EventService },
    { type: OperationRealtimeService },
    { type: EventBinaryService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(RepositoryService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.InventoryService }, { type: ɵngcc1.InventoryBinaryService }, { type: ɵngcc1.OperationService }, { type: ɵngcc2.AlertService }, { type: ɵngcc1.EventService }, { type: ɵngcc2.OperationRealtimeService }, { type: ɵngcc1.EventBinaryService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9yZXBvc2l0b3J5L3JlcG9zaXRvcnkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFlBQVksRUFPWixzQkFBc0IsRUFDdEIsZ0JBQWdCLEVBSWhCLGdCQUFnQixFQUNoQixlQUFlLEVBQ2YsV0FBVyxFQUNaLE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEYsT0FBTyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBQ1QsSUFBSSxFQUNKLE9BQU8sRUFDUCxHQUFHLEVBQ0gsSUFBSSxFQUNKLEtBQUssRUFDTCxRQUFRLEVBQ1IsV0FBVyxFQUNYLEdBQUcsSUFBSSxJQUFJLEVBQ1gsSUFBSSxFQUNKLE1BQU0sRUFDTixHQUFHLEVBQ0osTUFBTSxXQUFXLENBQUM7QUFDbkIsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekYsT0FBTyxFQVVMLGNBQWMsRUFDZCx1QkFBdUIsRUFHeEIsTUFBTSxvQkFBb0IsQ0FBQzs7OztBQUc1QixNQUFNLE9BQU8saUJBQWlCO0FBQzlCLElBSUUsWUFDVSxTQUEyQixFQUMzQixlQUF1QyxFQUN2QyxTQUEyQixFQUMzQixLQUFtQixFQUNuQixLQUFtQixFQUNuQixpQkFBMkMsRUFDM0MsV0FBK0I7QUFDeEMsUUFQUyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtBQUFD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QUFVO2lJQUNUO0FBQUM7QUFDVSxZQTVDWCxnQkFBZ0I7QUFDaEIsWUFGQSxzQkFBc0I7QUFDdEIsWUFJQSxnQkFBZ0I7QUFDaEIsWUFHTyxZQUFZO0FBQUksWUFoQnZCLFlBQVk7QUFDWixZQWU4Qix3QkFBd0I7QUFBSSxZQWpCMUQsa0JBQWtCO0FBQ25COzs7MlNBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEV2ZW50QmluYXJ5U2VydmljZSxcbiAgRXZlbnRTZXJ2aWNlLFxuICBJZFJlZmVyZW5jZSxcbiAgSUV2ZW50LFxuICBJRmV0Y2hSZXNwb25zZSxcbiAgSUlkZW50aWZpZWQsXG4gIElNYW5hZ2VkT2JqZWN0LFxuICBJTWFuYWdlZE9iamVjdEJpbmFyeSxcbiAgSW52ZW50b3J5QmluYXJ5U2VydmljZSxcbiAgSW52ZW50b3J5U2VydmljZSxcbiAgSU9wZXJhdGlvbixcbiAgSVJlc3VsdCxcbiAgSVJlc3VsdExpc3QsXG4gIE9wZXJhdGlvblNlcnZpY2UsXG4gIE9wZXJhdGlvblN0YXR1cyxcbiAgUXVlcmllc1V0aWxcbn0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlLCBnZXR0ZXh0LCBPcGVyYXRpb25SZWFsdGltZVNlcnZpY2UgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7XG4gIGFzc2lnbixcbiAgY2xvbmVEZWVwLFxuICBmaW5kLFxuICBmb3JFYWNoLFxuICBnZXQsXG4gIGhlYWQsXG4gIGlzTmlsLFxuICBpc1N0cmluZyxcbiAgaXNVbmRlZmluZWQsXG4gIG1hcCBhcyBfbWFwLFxuICBwaWNrLFxuICByZW1vdmUsXG4gIHNldFxufSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgZGVmZXIsIGZyb20sIG1lcmdlLCBPYnNlcnZhYmxlLCBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZSwgdGFrZVdoaWxlLCB3aXRoTGF0ZXN0RnJvbSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIENvbmZpZ3VyYXRpb25TbmFwc2hvdCxcbiAgRGV2aWNlRmlybXdhcmUsXG4gIERldmljZVNvZnR3YXJlLFxuICBEZXZpY2VTb2Z0d2FyZUNoYW5nZSxcbiAgRmlybXdhcmVCaW5hcnksXG4gIEZpcm13YXJlUGF0Y2hCaW5hcnksXG4gIE1vZGFsTW9kZWwsXG4gIFJlcG9zaXRvcnlCaW5hcnksXG4gIFJlcG9zaXRvcnlDYXRlZ29yeSxcbiAgUmVwb3NpdG9yeVR5cGUsXG4gIFJFUE9TSVRPUllfQklOQVJZX1RZUEVTLFxuICBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnksXG4gIFNvZnR3YXJlQmluYXJ5XG59IGZyb20gJy4vcmVwb3NpdG9yeS5tb2RlbCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5U2VydmljZSB7XG4gIHJlYWRvbmx5IGRhdGVGcm9tID0gbmV3IERhdGUoMCk7XG4gIHJlYWRvbmx5IGRhdGVUbyA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA4NjQwMDAwMCk7IC8vIDEgZGF5IGluIHRoZSBmdXR1cmVcbiAgcHJpdmF0ZSBxdWVyaWVzVXRpbDogUXVlcmllc1V0aWw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnk6IEludmVudG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnlCaW5hcnk6IEludmVudG9yeUJpbmFyeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBvcGVyYXRpb246IE9wZXJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhbGVydDogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgZXZlbnQ6IEV2ZW50U2VydmljZSxcbiAgICBwcml2YXRlIG9wZXJhdGlvblJlYWx0aW1lOiBPcGVyYXRpb25SZWFsdGltZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBldmVudEJpbmFyeTogRXZlbnRCaW5hcnlTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMucXVlcmllc1V0aWwgPSBuZXcgUXVlcmllc1V0aWwoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyByZXBvc2l0b3J5IGVudHJpZXMgb2YgZ2l2ZW4gdHlwZS5cbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgcmVwb3NpdG9yeSBlbnRyaWVzIHRvIGxpc3QuXG4gICAqIEBwYXJhbSBvcHRpb25zIEV4dHJhIGxpc3Rpbmcgb3B0aW9ucy5cbiAgICovXG4gIGxpc3RSZXBvc2l0b3J5RW50cmllcyhcbiAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZSxcbiAgICBvcHRpb25zPzoge1xuICAgICAgLyoqIEFkZGl0aW9uYWwgcXVlcnkuICovXG4gICAgICBxdWVyeT86IGFueTtcbiAgICAgIC8qKiAoZGVwcmVjYXRlZCAtIHRvIGJlIHJlbW92ZWQpIE9ubHkgaW5jbHVkZSBlbnRyaWVzIHdpdGggbWF0Y2hpbmcgcGFydGlhbCBuYW1lcy4gKi9cbiAgICAgIHBhcnRpYWxOYW1lPzogc3RyaW5nO1xuICAgICAgLyoqIEluY2x1ZGUgZW50cmllcyB3aXRoIG1hdGNoaW5nIHBhcnRpYWwgdGV4dCBpbiB0aGUgc3BlY2lmaWVkIHByb3BlcnRpZXMuICovXG4gICAgICBwYXJ0aWFsVGV4dEZpbHRlcj86IHsgcGFydGlhbFRleHQ6IHN0cmluZzsgcHJvcGVydGllczogc3RyaW5nW10gfTtcbiAgICAgIC8qKiBFeGNsdWRlIGxlZ2FjeSBlbnRyaWVzLiAqL1xuICAgICAgc2tpcExlZ2FjeT86IGJvb2xlYW47XG4gICAgICAvKiogRXhjbHVkZSBkZWZhdWx0IG9yZGVyaW5nLiAqL1xuICAgICAgc2tpcERlZmF1bHRPcmRlcj86IGJvb2xlYW47XG4gICAgICAvKiogT3RoZXIgcmVxdWVzdCBwYXJhbXMuICovXG4gICAgICBwYXJhbXM/OiBhbnk7XG4gICAgfVxuICApIHtcbiAgICBjb25zdCBkZWZhdWx0T3JkZXIgPSBbeyBuYW1lOiAxIH1dO1xuICAgIGNvbnN0IGRlZmF1bHRGaWx0ZXJzID0geyB0eXBlIH07XG4gICAgY29uc3QgbGVnYWN5RmlsdGVycyA9IHsgX19oYXM6IGB1cmxgIH07XG4gICAgbGV0IGZpbHRlcnMgPSB7fTtcblxuICAgIGxldCBmdWxsUXVlcnkgPSAob3B0aW9ucyAmJiBvcHRpb25zLnF1ZXJ5KSB8fCB7fTtcbiAgICBpZiAoIW9wdGlvbnMgfHwgKG9wdGlvbnMgJiYgIW9wdGlvbnMuc2tpcERlZmF1bHRPcmRlcikpIHtcbiAgICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkT3JkZXJieXMoZnVsbFF1ZXJ5LCBkZWZhdWx0T3JkZXIsICdwcmVwZW5kJyk7XG4gICAgfVxuXG4gICAgZnVsbFF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIoZnVsbFF1ZXJ5LCBkZWZhdWx0RmlsdGVycyk7XG5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnBhcnRpYWxUZXh0RmlsdGVyKSB7XG4gICAgICBjb25zdCB7IHBhcnRpYWxUZXh0LCBwcm9wZXJ0aWVzIH0gPSBvcHRpb25zLnBhcnRpYWxUZXh0RmlsdGVyO1xuICAgICAgY29uc3Qgb3JGaWx0ZXIgPSB7IF9fb3I6IHByb3BlcnRpZXMubWFwKHByb3BlcnR5ID0+ICh7IFtwcm9wZXJ0eV06IGAqJHtwYXJ0aWFsVGV4dH0qYCB9KSkgfTtcbiAgICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKGZ1bGxRdWVyeSwgb3JGaWx0ZXIpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucGFydGlhbE5hbWUpIHtcbiAgICAgIC8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGlmXG4gICAgICBmdWxsUXVlcnkgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihmdWxsUXVlcnksIHsgbmFtZTogYCoke29wdGlvbnMucGFydGlhbE5hbWV9KmAgfSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5za2lwTGVnYWN5KSB7XG4gICAgICBmdWxsUXVlcnkgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihmdWxsUXVlcnksIHsgX19ub3Q6IGxlZ2FjeUZpbHRlcnMgfSk7XG4gICAgfVxuXG4gICAgZmlsdGVycyA9IHtcbiAgICAgIHF1ZXJ5OiB0aGlzLnF1ZXJpZXNVdGlsLmJ1aWxkUXVlcnkoZnVsbFF1ZXJ5KSxcbiAgICAgIHBhZ2VTaXplOiA1MCxcbiAgICAgIHdpdGhUb3RhbFBhZ2VzOiB0cnVlLFxuICAgICAgLi4uKChvcHRpb25zICYmIG9wdGlvbnMucGFyYW1zKSB8fCB7fSlcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5saXN0KGZpbHRlcnMpO1xuICB9XG5cbiAgLy8gVE9ETzogbWVyZ2Ugd2l0aCBjcmVhdGUoKVxuICBhc3luYyBzYXZlKGRhdGE6IE1vZGFsTW9kZWwsIHR5cGU6IFJlcG9zaXRvcnlUeXBlLCBtbzogUGFydGlhbDxJTWFuYWdlZE9iamVjdD4gPSB7fSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OOiB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24obW8sIHtcbiAgICAgICAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OLFxuICAgICAgICAgIGNvbmZpZ3VyYXRpb25UeXBlOiBkYXRhLnNlbGVjdGVkID8gZGF0YS5zZWxlY3RlZC5jb25maWd1cmF0aW9uVHlwZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBuYW1lOiBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgZGV2aWNlVHlwZTogZGF0YS5kZXZpY2VUeXBlLFxuICAgICAgICAgIGM4eV9HbG9iYWw6IHt9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWRhdGEuZGV2aWNlVHlwZSAmJiBtby5pZCkge1xuICAgICAgICAgIG1vLmRldmljZVR5cGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YS5zZWxlY3RlZCAmJiBtby5pZCkge1xuICAgICAgICAgIG1vLmNvbmZpZ3VyYXRpb25UeXBlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBleGlzdGluZ1VybCA9IG1vLnVybDtcbiAgICBpZiAoZGF0YS5iaW5hcnkudXJsKSB7XG4gICAgICBtby51cmwgPSBkYXRhLmJpbmFyeS51cmw7XG4gICAgfSBlbHNlIGlmIChkYXRhLmJpbmFyeS5maWxlKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmNyZWF0ZShkYXRhLmJpbmFyeS5maWxlLCB7XG4gICAgICAgIGM4eV9HbG9iYWw6IHt9XG4gICAgICB9IGFzIFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+KTtcbiAgICAgIG1vLnVybCA9IHJlc3BvbnNlLmRhdGEuc2VsZjtcbiAgICB9XG5cbiAgICBpZiAobW8uaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUVudHJ5KG1vLCBleGlzdGluZ1VybCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNyZWF0ZUVudHJ5KG1vKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZShtb2RhbDogTW9kYWxNb2RlbCwgdHlwZTogUmVwb3NpdG9yeVR5cGUpIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgUmVwb3NpdG9yeVR5cGUuRklSTVdBUkU6XG4gICAgICBjYXNlIFJlcG9zaXRvcnlUeXBlLlNPRlRXQVJFOlxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVGaXJtd2FyZU9yU29mdHdhcmUobW9kYWwsIHR5cGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUZpcm13YXJlT3JTb2Z0d2FyZShcbiAgICBtb2RhbDogTW9kYWxNb2RlbCxcbiAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZVxuICApOiBQcm9taXNlPFJlcG9zaXRvcnlDYXRlZ29yeT4ge1xuICAgIGxldCBiaW5hcnk6IElNYW5hZ2VkT2JqZWN0QmluYXJ5O1xuICAgIGxldCBiaW5hcnlVUkw6IHN0cmluZztcbiAgICBsZXQgcmVwb3NpdG9yeUVudHJ5OiBSZXBvc2l0b3J5Q2F0ZWdvcnk7XG4gICAgbGV0IHJlcG9zaXRvcnlCaW5hcnk6IEZpcm13YXJlQmluYXJ5IHwgU29mdHdhcmVCaW5hcnk7XG4gICAgY29uc3QgbW9zID0gW107XG4gICAgY29uc3Qge1xuICAgICAgc2VsZWN0ZWQ6IHsgaWQ6IHNlbGVjdGVkSWQgfSxcbiAgICAgIGJpbmFyeTogeyBmaWxlLCB1cmwgfVxuICAgIH0gPSBtb2RhbDtcbiAgICB0cnkge1xuICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgKHsgZGF0YTogYmluYXJ5IH0gPSBhd2FpdCB0aGlzLnNhdmVCaW5hcnkoZmlsZSkpO1xuICAgICAgICAoeyBzZWxmOiBiaW5hcnlVUkwgfSA9IGJpbmFyeSk7XG4gICAgICAgIG1vcy5wdXNoKGJpbmFyeSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiaW5hcnlVUkwgPSB1cmw7XG4gICAgICB9XG5cbiAgICAgICh7IGRhdGE6IHJlcG9zaXRvcnlFbnRyeSB9ID0gYXdhaXQgdGhpcy5jcmVhdGVPclVwZGF0ZVJlcG9zaXRvcnlFbnRyeShtb2RhbCwgdHlwZSkpO1xuICAgICAgaWYgKGlzTmlsKHNlbGVjdGVkSWQpKSB7XG4gICAgICAgIG1vcy5wdXNoKHJlcG9zaXRvcnlFbnRyeSk7XG4gICAgICB9XG5cbiAgICAgICh7IGRhdGE6IHJlcG9zaXRvcnlCaW5hcnkgfSA9IGF3YWl0IHRoaXMuY3JlYXRlUmVwb3NpdG9yeUJpbmFyeShcbiAgICAgICAgbW9kYWwsXG4gICAgICAgIGJpbmFyeVVSTCxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgcmVwb3NpdG9yeUVudHJ5XG4gICAgICApKTtcbiAgICAgIG1vcy5wdXNoKHJlcG9zaXRvcnlCaW5hcnkpO1xuXG4gICAgICBpZiAoZmlsZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmxpbmtCaW5hcnkocmVwb3NpdG9yeUJpbmFyeSwgYmluYXJ5KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcG9zaXRvcnlFbnRyeTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5jbGVhblVwKG1vcyk7XG4gICAgICB0aGlzLmVycm9yTXNnKCk7XG5cbiAgICAgIC8vIFByb3BhZ2F0ZSBlcnJvclxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgc2F2ZUJpbmFyeShmaWxlOiBGaWxlKTogUHJvbWlzZTxJUmVzdWx0PElNYW5hZ2VkT2JqZWN0QmluYXJ5Pj4ge1xuICAgIHJldHVybiB0aGlzLmludmVudG9yeUJpbmFyeS5jcmVhdGUoZmlsZSwgeyBjOHlfR2xvYmFsOiB7fSB9IGFzIFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+KTtcbiAgfVxuXG4gIGNyZWF0ZU9yVXBkYXRlUmVwb3NpdG9yeUVudHJ5KFxuICAgIG1vZGFsOiBNb2RhbE1vZGVsLFxuICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlXG4gICk6IFByb21pc2U8SVJlc3VsdDxSZXBvc2l0b3J5Q2F0ZWdvcnk+PiB7XG4gICAgY29uc3Qge1xuICAgICAgc2VsZWN0ZWQ6IHsgaWQsIG5hbWUgfSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgZGV2aWNlVHlwZVxuICAgIH0gPSBtb2RhbDtcblxuICAgIGNvbnN0IG1vID0ge1xuICAgICAgaWQsXG4gICAgICBuYW1lOiBpZCA/IHVuZGVmaW5lZCA6IG5hbWUsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHR5cGU6IGlkID8gdW5kZWZpbmVkIDogdHlwZSxcbiAgICAgIGM4eV9HbG9iYWw6IHt9XG4gICAgfTtcblxuICAgIGlmIChkZXZpY2VUeXBlKSB7XG4gICAgICBzZXQobW8sICdjOHlfRmlsdGVyLnR5cGUnLCBkZXZpY2VUeXBlKTtcbiAgICB9XG5cbiAgICBpZiAobW9kYWwuc29mdHdhcmVUeXBlKSB7XG4gICAgICBzZXQobW8sICdzb2Z0d2FyZVR5cGUnLCBtb2RhbC5zb2Z0d2FyZVR5cGUuc29mdHdhcmVUeXBlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaWRcbiAgICAgID8gKHRoaXMuaW52ZW50b3J5LnVwZGF0ZShtbykgYXMgUHJvbWlzZTxJUmVzdWx0PFJlcG9zaXRvcnlDYXRlZ29yeT4+KVxuICAgICAgOiAodGhpcy5pbnZlbnRvcnkuY3JlYXRlKG1vKSBhcyBQcm9taXNlPElSZXN1bHQ8UmVwb3NpdG9yeUNhdGVnb3J5Pj4pO1xuICB9XG5cbiAgY3JlYXRlUmVwb3NpdG9yeUJpbmFyeShcbiAgICBtb2RhbDogTW9kYWxNb2RlbCxcbiAgICBiaW5hcnlVUkw6IHN0cmluZyxcbiAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZSxcbiAgICBwYXJlbnQ6IFJlcG9zaXRvcnlDYXRlZ29yeVxuICApOiBQcm9taXNlPElSZXN1bHQ8RmlybXdhcmVCaW5hcnkgfCBTb2Z0d2FyZUJpbmFyeSB8IEZpcm13YXJlUGF0Y2hCaW5hcnk+PiB7XG4gICAgY29uc3QgbW8gPSB0aGlzLnByZXBhcmVSZXBvc2l0b3J5QmluYXJ5TU8obW9kYWwsIGJpbmFyeVVSTCwgdHlwZSk7XG5cbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkuY2hpbGRBZGRpdGlvbnNDcmVhdGUobW8sIHBhcmVudCkgYXMgUHJvbWlzZTxcbiAgICAgIElSZXN1bHQ8RmlybXdhcmVCaW5hcnkgfCBTb2Z0d2FyZUJpbmFyeSB8IEZpcm13YXJlUGF0Y2hCaW5hcnk+XG4gICAgPjtcbiAgfVxuXG4gIHByZXBhcmVSZXBvc2l0b3J5QmluYXJ5TU8obW9kYWw6IE1vZGFsTW9kZWwsIGJpbmFyeVVSTDogc3RyaW5nLCB0eXBlOiBSZXBvc2l0b3J5VHlwZSkge1xuICAgIGNvbnN0IHsgdmVyc2lvbiwgcGF0Y2hWZXJzaW9uLCBkZXBlbmRlbmN5IH0gPSBtb2RhbDtcbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICB0eXBlOiBSRVBPU0lUT1JZX0JJTkFSWV9UWVBFU1t0eXBlXSxcbiAgICAgIFt0eXBlXToge1xuICAgICAgICB1cmw6IGJpbmFyeVVSTFxuICAgICAgfSxcbiAgICAgIGM4eV9HbG9iYWw6IHt9XG4gICAgfTtcblxuICAgIGlmIChkZXBlbmRlbmN5KSB7XG4gICAgICBzZXQocmVzdWx0LCBbdHlwZSwgJ3ZlcnNpb24nXSwgcGF0Y2hWZXJzaW9uKTtcbiAgICAgIGFzc2lnbihyZXN1bHQsIHtcbiAgICAgICAgYzh5X1BhdGNoOiB7XG4gICAgICAgICAgZGVwZW5kZW5jeTogZGVwZW5kZW5jeS5jOHlfRmlybXdhcmUudmVyc2lvblxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0KHJlc3VsdCwgW3R5cGUsICd2ZXJzaW9uJ10sIHZlcnNpb24pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgYXN5bmMgbGlua0JpbmFyeShcbiAgICByZXBvc2l0b3J5QmluYXJ5OiBGaXJtd2FyZUJpbmFyeSB8IFNvZnR3YXJlQmluYXJ5LFxuICAgIGJpbmFyeTogSU1hbmFnZWRPYmplY3RCaW5hcnlcbiAgKSB7XG4gICAgY29uc3QgeyBpZDogcmVwb3NpdG9yeUJpbmFyeUlkIH0gPSByZXBvc2l0b3J5QmluYXJ5O1xuICAgIGlmIChiaW5hcnkpIHtcbiAgICAgIGNvbnN0IHsgaWQ6IGJpbmFyeUlkIH0gPSBiaW5hcnk7XG4gICAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkuY2hpbGRBZGRpdGlvbnNBZGQoYmluYXJ5SWQsIHJlcG9zaXRvcnlCaW5hcnlJZCk7XG4gICAgfVxuICB9XG5cbiAgY2xlYW5VcChtb3NUb0RlbGV0ZTogSUlkZW50aWZpZWRbXSkge1xuICAgIG1vc1RvRGVsZXRlLmZvckVhY2gobW8gPT4ge1xuICAgICAgY29uc3QgeyBjOHlfSXNCaW5hcnkgfSA9IG1vO1xuICAgICAgaXNVbmRlZmluZWQoYzh5X0lzQmluYXJ5KSA/IHRoaXMuZGVsZXRlKG1vKSA6IHRoaXMuaW52ZW50b3J5QmluYXJ5LmRlbGV0ZShtbyk7XG4gICAgfSk7XG4gIH1cblxuICBkZWxldGUoZW50aXR5OiBJSWRlbnRpZmllZCk6IFByb21pc2U8SVJlc3VsdDxudWxsPj4ge1xuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5kZWxldGUoZW50aXR5LCB7IGZvcmNlQ2FzY2FkZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIGVycm9yTXNnKCkge1xuICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0ZhaWxlZCB0byBzYXZlJyk7XG4gICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgfVxuXG4gIGdldEJhc2VWZXJzaW9uc0NvdW50JChlbnRyeTogSU1hbmFnZWRPYmplY3QpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGlmICh0aGlzLmlzTGVnYWN5RW50cnkoZW50cnkpKSB7XG4gICAgICByZXR1cm4gb2YoMSk7XG4gICAgfVxuICAgIHJldHVybiBmcm9tKHRoaXMubGlzdEJhc2VWZXJzaW9ucyhlbnRyeSwgeyBwYWdlU2l6ZTogMSwgd2l0aFRvdGFsUGFnZXM6IHRydWUgfSkpLnBpcGUoXG4gICAgICBtYXAoKHsgcGFnaW5nIH0pID0+IHBhZ2luZy50b3RhbFBhZ2VzKVxuICAgICk7XG4gIH1cblxuICBnZXRCYXNlVmVyc2lvbkZyb21NTyhtbzogUmVwb3NpdG9yeUJpbmFyeSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaXNQYXRjaChtbykgPyBnZXQobW8sICdjOHlfUGF0Y2guZGVwZW5kZW5jeScpIDogZ2V0KG1vLCAnYzh5X0Zpcm13YXJlLnZlcnNpb24nKTtcbiAgfVxuXG4gIGlzUGF0Y2gobW86IFJlcG9zaXRvcnlCaW5hcnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISFnZXQobW8sICdjOHlfUGF0Y2guZGVwZW5kZW5jeScpO1xuICB9XG5cbiAgZ2V0UGF0Y2hWZXJzaW9uc0NvdW50JChlbnRyeTogSU1hbmFnZWRPYmplY3QsIGJhc2VWZXJzaW9uOiBGaXJtd2FyZUJpbmFyeSk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgaWYgKHRoaXMuaXNMZWdhY3lFbnRyeShiYXNlVmVyc2lvbikpIHtcbiAgICAgIHJldHVybiBvZigwKTtcbiAgICB9XG4gICAgcmV0dXJuIGZyb20oXG4gICAgICB0aGlzLmxpc3RQYXRjaFZlcnNpb25zKGVudHJ5LCBiYXNlVmVyc2lvbiwgeyBwYWdlU2l6ZTogMSwgd2l0aFRvdGFsUGFnZXM6IHRydWUgfSlcbiAgICApLnBpcGUobWFwKCh7IHBhZ2luZyB9KSA9PiBwYWdpbmcudG90YWxQYWdlcykpO1xuICB9XG5cbiAgaXNMZWdhY3lFbnRyeShlbnRyeTogUGFydGlhbDxJTWFuYWdlZE9iamVjdD4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbihlbnRyeS51cmwpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIGFsbCB2ZXJzaW9ucyAoYmFzZSBhbmQgcGF0Y2ggb25lcykgb2YgZ2l2ZW4gdG9wIGxldmVsIGVudHJ5LlxuICAgKiBWZXJzaW9ucyBhcmUgb3JkZXJlZCBieSBjcmVhdGlvbiB0aW1lIChhc3N1bWluZyB0aGUgZWFybGllciBjcmVhdGVkLCB0aGUgb2xkZXIgdGhlIHZlcnNpb24pLlxuICAgKiBAcGFyYW0gZW50cnkgVG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkuXG4gICAqIEBwYXJhbSBwYXJhbXMgQWRkaXRpb25hbCBxdWVyeSBwYXJhbXMuXG4gICAqL1xuICBsaXN0QWxsVmVyc2lvbnMoZW50cnk6IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+LCBwYXJhbXMgPSB7fSkge1xuICAgIGlmICh0aGlzLmlzTGVnYWN5RW50cnkoZW50cnkpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRCYXNlVmVyc2lvblJlc3VsdExpc3RGb3JMZWdhY3lFbnRyeShlbnRyeSk7XG4gICAgfVxuXG4gICAgY29uc3QgVkVSU0lPTl9GSUxURVJfT1JERVIgPSB7XG4gICAgICBfX2ZpbHRlcjoge30sXG4gICAgICBfX29yZGVyYnk6IFt7ICdjcmVhdGlvblRpbWUuZGF0ZSc6IC0xIH0sIHsgY3JlYXRpb25UaW1lOiAtMSB9XVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMubGlzdENoaWxkcmVuKGVudHJ5LCBWRVJTSU9OX0ZJTFRFUl9PUkRFUiwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyBiYXNlIHZlcnNpb25zIG9mIGdpdmVuIHRvcCBsZXZlbCBlbnRyeS5cbiAgICogVmVyc2lvbnMgYXJlIG9yZGVyZWQgYnkgY3JlYXRpb24gdGltZSAoYXNzdW1pbmcgdGhlIGVhcmxpZXIgY3JlYXRlZCwgdGhlIG9sZGVyIHRoZSB2ZXJzaW9uKS5cbiAgICogQHBhcmFtIGVudHJ5IFRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5LlxuICAgKiBAcGFyYW0gcGFyYW1zIEFkZGl0aW9uYWwgcXVlcnkgcGFyYW1zLlxuICAgKi9cbiAgbGlzdEJhc2VWZXJzaW9ucyhlbnRyeTogUGFydGlhbDxJTWFuYWdlZE9iamVjdD4sIHBhcmFtcyA9IHt9KSB7XG4gICAgaWYgKHRoaXMuaXNMZWdhY3lFbnRyeShlbnRyeSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEJhc2VWZXJzaW9uUmVzdWx0TGlzdEZvckxlZ2FjeUVudHJ5KGVudHJ5KTtcbiAgICB9XG5cbiAgICBjb25zdCBOT19QQVRDSF9GSUxURVJfT1JERVIgPSB7XG4gICAgICBfX2ZpbHRlcjoge1xuICAgICAgICBfX25vdDogeyBfX2hhczogJ2M4eV9QYXRjaCcgfVxuICAgICAgfSxcbiAgICAgIF9fb3JkZXJieTogW3sgJ2NyZWF0aW9uVGltZS5kYXRlJzogLTEgfSwgeyBjcmVhdGlvblRpbWU6IC0xIH1dXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5saXN0Q2hpbGRyZW4oZW50cnksIE5PX1BBVENIX0ZJTFRFUl9PUkRFUiwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyBwYXRjaCB2ZXJzaW9ucyBvZiBnaXZlbiBiYXNlIHZlcnNpb24gdW5kZXIgdGhlIGVudHJ5LlxuICAgKiBWZXJzaW9ucyBhcmUgb3JkZXJlZCBieSBjcmVhdGlvbiB0aW1lIChhc3N1bWluZyB0aGUgZWFybGllciBjcmVhdGVkLCB0aGUgb2xkZXIgdGhlIHZlcnNpb24pLlxuICAgKiBAcGFyYW0gZW50cnkgVG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkuXG4gICAqIEBwYXJhbSBiYXNlVmVyc2lvbiBCYXNlIHZlcnNpb24uXG4gICAqIEBwYXJhbSBwYXJhbXMgQWRkaXRpb25hbCBxdWVyeSBwYXJhbXMuXG4gICAqL1xuICBsaXN0UGF0Y2hWZXJzaW9ucyhlbnRyeTogSU1hbmFnZWRPYmplY3QsIGJhc2VWZXJzaW9uOiBGaXJtd2FyZUJpbmFyeSB8IHN0cmluZywgcGFyYW1zID0ge30pIHtcbiAgICBjb25zdCB2ZXJzaW9uID0gaXNTdHJpbmcoYmFzZVZlcnNpb24pID8gYmFzZVZlcnNpb24gOiBnZXQoYmFzZVZlcnNpb24sICdjOHlfRmlybXdhcmUudmVyc2lvbicpO1xuICAgIGNvbnN0IFBBVENIX0ZJTFRFUl9PUkRFUiA9IHtcbiAgICAgIF9fZmlsdGVyOiB7XG4gICAgICAgICdjOHlfUGF0Y2guZGVwZW5kZW5jeSc6IHZlcnNpb25cbiAgICAgIH0sXG4gICAgICBfX29yZGVyYnk6IFt7ICdjcmVhdGlvblRpbWUuZGF0ZSc6IC0xIH0sIHsgY3JlYXRpb25UaW1lOiAtMSB9XVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMubGlzdENoaWxkcmVuKGVudHJ5LCBQQVRDSF9GSUxURVJfT1JERVIsIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgcGF0Y2ggdmVyc2lvbnMgb2YgZ2l2ZW4gYmFzZSB2ZXJzaW9uIHVuZGVyIHRoZSBlbnRyeSBpbmNsdWRpbmcgdGhlIGJhc2UgdmVyc2lvbi5cbiAgICogVmVyc2lvbnMgYXJlIG9yZGVyZWQgYnkgY3JlYXRpb24gdGltZSAoYXNzdW1pbmcgdGhlIGVhcmxpZXIgY3JlYXRlZCwgdGhlIG9sZGVyIHRoZSB2ZXJzaW9uKS5cbiAgICogSW4gdGVybXMgb2YgbGVnYWN5IGJhc2UgdmVyc2lvbiB0aGUgZW50cnkgZ2V0cyB0cmFuc2Zvcm1lZCB0byBmaXQgdGhlIG5lZWRlZCBkYXRhIG1vZGVsLlxuICAgKiBAcGFyYW0gZW50cnkgVG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkuXG4gICAqIEBwYXJhbSBiYXNlVmVyc2lvbiBCYXNlIHZlcnNpb24uXG4gICAqIEBwYXJhbSBwYXJhbXMgQWRkaXRpb25hbCBxdWVyeSBwYXJhbXMuXG4gICAqL1xuICBsaXN0QmFzZVZlcnNpb25BbmRQYXRjaGVzKGVudHJ5OiBJTWFuYWdlZE9iamVjdCwgYmFzZVZlcnNpb246IElNYW5hZ2VkT2JqZWN0LCBwYXJhbXMgPSB7fSkge1xuICAgIGlmICh0aGlzLmlzTGVnYWN5RW50cnkoZW50cnkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgZGF0YTogW1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGM4eV9GaXJtd2FyZToge1xuICAgICAgICAgICAgICAgIHZlcnNpb246IGVudHJ5LnZlcnNpb24sXG4gICAgICAgICAgICAgICAgdXJsOiBlbnRyeS51cmxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVudHJ5XG4gICAgICAgICAgKVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBQQVRDSF9GSUxURVJfT1JERVIgPSB7XG4gICAgICBfX2ZpbHRlcjoge1xuICAgICAgICBfX29yOiB7XG4gICAgICAgICAgJ2M4eV9QYXRjaC5kZXBlbmRlbmN5JzogYmFzZVZlcnNpb24uYzh5X0Zpcm13YXJlLnZlcnNpb24sXG4gICAgICAgICAgJ2M4eV9GaXJtd2FyZS52ZXJzaW9uJzogYmFzZVZlcnNpb24uYzh5X0Zpcm13YXJlLnZlcnNpb25cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIF9fb3JkZXJieTogW3sgJ2M4eV9QYXRjaC5kZXBlbmRlbmN5JzogMSB9LCB7ICdjOHlfRmlybXdhcmUudmVyc2lvbic6IDEgfV1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmxpc3RDaGlsZHJlbihlbnRyeSwgUEFUQ0hfRklMVEVSX09SREVSLCBwYXJhbXMpO1xuICB9XG5cbiAgbGlzdENoaWxkcmVuKGVudHJ5OiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiwgZmlsdGVycyA9IHt9LCBwYXJhbXM6IGFueSA9IHt9KSB7XG4gICAgY29uc3QgY2hpbGRyZW5GaWx0ZXJzID0geyBfX2J5Z3JvdXBpZDogZW50cnkuaWQgfTtcbiAgICBjb25zdCBxdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKGZpbHRlcnMsIGNoaWxkcmVuRmlsdGVycyk7XG4gICAgLy8gRklYTUU6IG5lZWRlZCBiZWNhdXNlIG9mIGlzc3VlIGluIGZvck9mIGRpcmVjdGl2ZSAoLi4uKVxuICAgIHBhcmFtcy53aXRoVG90YWxQYWdlcyA9IHRydWU7XG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5Lmxpc3RRdWVyeShxdWVyeSwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaGVzIGFsbCBpdGVtcyBmcm9tIHRoZSBsaXN0IHN0YXJ0aW5nIHdpdGggdGhlIHByb3ZpZGVkIHBhZ2UuXG4gICAqIEBwYXJhbSBmaXJzdFBhZ2UgVGhlIGZpcnN0IHBhZ2Ugb2YgdGhlIGxpc3QgdG8gZmV0Y2ggYWxsIGl0ZW1zIGZvci5cbiAgICovXG4gIGFzeW5jIGZldGNoQWxsSXRlbXNGcm9tTGlzdChmaXJzdFBhZ2UpIHtcbiAgICBsZXQgYWxsSXRlbXM7XG5cbiAgICBpZiAoIWZpcnN0UGFnZS50aGVuKSB7XG4gICAgICBhbGxJdGVtcyA9IFsuLi5maXJzdFBhZ2VdO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgeyBwYWdpbmcsIGRhdGE6IGl0ZW1zIH0gPSBhd2FpdCBmaXJzdFBhZ2U7XG4gICAgICBhbGxJdGVtcyA9IFsuLi5pdGVtc107XG5cbiAgICAgIHdoaWxlIChwYWdpbmcgJiYgcGFnaW5nLm5leHRQYWdlKSB7XG4gICAgICAgICh7IHBhZ2luZywgZGF0YTogaXRlbXMgfSA9IGF3YWl0IHBhZ2luZy5uZXh0KCkpO1xuICAgICAgICBhbGxJdGVtcyA9IFsuLi5hbGxJdGVtcywgLi4uaXRlbXNdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhbGxJdGVtcztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5IG1hbmFnZWQgb2JqZWN0IGZvciBiYXNlIG9yIHBhdGNoIHZlcnNpb24uXG4gICAqIEBwYXJhbSBtbyBCYXNlIG9yIHBhdGNoIHZlcnNpb24gbWFuYWdlZCBvYmplY3Qgd2l0aCBwYXJlbnRzLlxuICAgKi9cbiAgZ2V0UmVwb3NpdG9yeUVudHJ5TU8kKG1vOiBJTWFuYWdlZE9iamVjdCk6IE9ic2VydmFibGU8SU1hbmFnZWRPYmplY3QgfCB1bmRlZmluZWQ+IHtcbiAgICBpZiAoIW1vKSB7XG4gICAgICByZXR1cm4gb2YodW5kZWZpbmVkKTtcbiAgICB9XG4gICAgY29uc3QgW3JlZmVyZW5jZV0gPSBnZXQobW8sICdhZGRpdGlvblBhcmVudHMucmVmZXJlbmNlcycpO1xuICAgIGNvbnN0IGlkID0gZ2V0KHJlZmVyZW5jZSwgJ21hbmFnZWRPYmplY3QuaWQnKTtcbiAgICByZXR1cm4gaWRcbiAgICAgID8gZnJvbSh0aGlzLmludmVudG9yeS5kZXRhaWwoaWQsIHsgd2l0aENoaWxkcmVuOiBmYWxzZSB9KSkucGlwZShtYXAoKHsgZGF0YSB9KSA9PiBkYXRhKSlcbiAgICAgIDogb2YodW5kZWZpbmVkKTtcbiAgfVxuICAvKipcbiAgICogR2V0cyBiYXNlIG9yIHBhdGNoIHZlcnNpb24gbWFuYWdlZCBvYmplY3QuXG4gICAqIEBwYXJhbSBkZXZpY2VSZXBvc2l0b3J5RnJhZ21lbnQgRGV2aWNlIHJlcG9zaXRvcnkgZnJhZ21lbnQuXG4gICAqIEBwYXJhbSB0eXBlIFRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5IHR5cGUuXG4gICAqIEBwYXJhbSBjb25maWd1cmF0aW9uIENvbmZpZ3VyYXRpb24gb2JqZWN0IHdpdGggb3B0aW9uczpcbiAgICogLSAqKnNraXBMZWdhY3kqKiAtIGBib29sZWFuYCAtIEV4Y2x1ZGUgbGVnYWN5IGVudHJpZXMuXG4gICAqIC0gKipmaWx0ZXJzKiogLSBgb2JqZWN0YCAtIEZpbHRlciBvYmplY3QuXG4gICAqXG4gICAqIEBkZXByZWNhdGVkIGFzIGl0IGRvZXNuJ3Qgc3VwcG9ydCAnbWlzc2luZyB1cmwnIGNhc2VcbiAgICovXG4gIGdldFJlcG9zaXRvcnlCaW5hcnlNb0J5VmVyc2lvbihcbiAgICBkZXZpY2VSZXBvc2l0b3J5RnJhZ21lbnQ6IERldmljZUZpcm13YXJlIHwgRGV2aWNlU29mdHdhcmUsXG4gICAgdHlwZTogUmVwb3NpdG9yeVR5cGUsXG4gICAgeyBza2lwTGVnYWN5ID0gZmFsc2UsIGZpbHRlcnMgPSB7fSB9OiB7IHNraXBMZWdhY3k/OiBib29sZWFuOyBmaWx0ZXJzPzogb2JqZWN0IH0gPSB7fVxuICApOiBQcm9taXNlPElNYW5hZ2VkT2JqZWN0PiB7XG4gICAgY29uc3QgeyB2ZXJzaW9uLCB1cmwsIG5hbWUgfSA9IGRldmljZVJlcG9zaXRvcnlGcmFnbWVudDtcbiAgICBjb25zdCByZXBvc2l0b3J5QmluYXJ5VHlwZSA9IFJFUE9TSVRPUllfQklOQVJZX1RZUEVTW3R5cGVdO1xuICAgIGxldCBxdWVyeTtcbiAgICBjb25zdCBuZXdNb2RlbEJhc2VWZXJzaW9uUXVlcnkgPSB7XG4gICAgICBbYCR7dHlwZX0udmVyc2lvbmBdOiB2ZXJzaW9uLFxuICAgICAgW2Ake3R5cGV9LnVybGBdOiB1cmwsXG4gICAgICB0eXBlOiByZXBvc2l0b3J5QmluYXJ5VHlwZVxuICAgIH07XG4gICAgY29uc3QgbGVnYWN5VmVyc2lvblF1ZXJ5ID0geyB1cmwsIHR5cGUsIG5hbWUgfTtcbiAgICBmaWx0ZXJzID0geyB3aXRoQ2hpbGRyZW46IGZhbHNlLCB3aXRoUGFyZW50czogdHJ1ZSwgLi4uZmlsdGVycyB9O1xuXG4gICAgaWYgKHNraXBMZWdhY3kpIHtcbiAgICAgIHF1ZXJ5ID0ge1xuICAgICAgICBfX2FuZDoge1xuICAgICAgICAgIC4uLm5ld01vZGVsQmFzZVZlcnNpb25RdWVyeVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBxdWVyeSA9IHtcbiAgICAgICAgX19vcjogW3sgX19hbmQ6IHsgLi4ubmV3TW9kZWxCYXNlVmVyc2lvblF1ZXJ5IH0gfSwgeyBfX2FuZDogeyAuLi5sZWdhY3lWZXJzaW9uUXVlcnkgfSB9XVxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkubGlzdFF1ZXJ5KHF1ZXJ5LCBmaWx0ZXJzKS50aGVuKCh7IGRhdGEgfSkgPT4gaGVhZChkYXRhKSk7XG4gIH1cblxuICBnZXRCaW5hcnlOYW1lJChiaW5hcnlVcmw6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgaWYgKCFiaW5hcnlVcmwpIHtcbiAgICAgIHJldHVybiBvZignLS0tJyk7XG4gICAgfVxuXG4gICAgY29uc3QgYmluYXJ5SWQgPSB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwoYmluYXJ5VXJsKTtcbiAgICBpZiAoIWJpbmFyeUlkKSB7XG4gICAgICByZXR1cm4gb2YoYmluYXJ5VXJsKTtcbiAgICB9XG4gICAgcmV0dXJuIGRlZmVyKCgpID0+IHRoaXMuaW52ZW50b3J5LmRldGFpbChiaW5hcnlJZCkudGhlbihyZXN1bHQgPT4gcmVzdWx0LmRhdGEpKS5waXBlKFxuICAgICAgbWFwKG1vID0+IG1vLm5hbWUpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgYW4gaW52ZW50b3J5IHF1ZXJ5IG9iamVjdCB3aGljaCBjYW4gYmUgdXNlZCB0byBmaW5kXG4gICAqIHJlcG9zaXRvcnkgZW50cmllcyBvZiBzcGVjaWZpZWQgdHlwZSBtYXRjaGluZyB0aGUgdHlwZSBvZiBwcm92aWRlZCBkZXZpY2UuXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5VHlwZSBUaGUgdHlwZSBvZiByZXBvc2l0b3J5IGVudHJpZXMgd2hpY2ggd2lsbCBiZSBxdWVyaWVkIHdpdGggdGhlIGdlbmVyYXRlZCBxdWVyeS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBtYXRjaGluZyByZXBvc2l0b3J5IGVudHJpZXMgd2lsbCBiZSBxdWVyaWVkIHdpdGggdGhlIGdlbmVyYXRlZCBxdWVyeS5cbiAgICovXG5cbiAgZ2V0RGV2aWNlVHlwZVF1ZXJ5KHJlcG9zaXRvcnlUeXBlOiBSZXBvc2l0b3J5VHlwZSwgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCk6IG9iamVjdCB7XG4gICAgbGV0IHJlc3VsdCA9IHsgdHlwZTogcmVwb3NpdG9yeVR5cGUgfTtcbiAgICBpZiAocmVwb3NpdG9yeVR5cGUgPT09IFJlcG9zaXRvcnlUeXBlLkNPTkZJR1VSQVRJT04pIHtcbiAgICAgIGlmIChkZXZpY2UudHlwZSkge1xuICAgICAgICByZXN1bHQgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihyZXN1bHQsIHtcbiAgICAgICAgICBfX29yOiBbeyBkZXZpY2VUeXBlOiBkZXZpY2UudHlwZSB9LCB7IF9fbm90OiB7IF9faGFzOiBgZGV2aWNlVHlwZWAgfSB9XVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIocmVzdWx0LCB7XG4gICAgICAgIF9fb3I6IFtcbiAgICAgICAgICB7ICdjOHlfRmlsdGVyLnR5cGUnOiBkZXZpY2UudHlwZSB9LFxuICAgICAgICAgIHsgJ2M4eV9GaWx0ZXIudHlwZSc6ICcnIH0sXG4gICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYGM4eV9GaWx0ZXIudHlwZWAgfSB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBhbiBpbnZlbnRvcnkgcXVlcnkgb2JqZWN0IHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZpbmQgY29uZmlndXJhdGlvbiByZXBvc2l0b3J5IGVudHJpZXNcbiAgICogbWF0Y2hpbmcgdGhlIHR5cGUgb2YgcHJvdmlkZWQgZGV2aWNlIGFuZCBzcGVjaWZpZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG1hdGNoaW5nIHJlcG9zaXRvcnkgZW50cmllcyB3aWxsIGJlIHF1ZXJpZWQgd2l0aCB0aGUgZ2VuZXJhdGVkIHF1ZXJ5LlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgQ29uZmlndXJhdGlvbiB0eXBlIGZvciB3aGljaCBtYXRjaGluZyByZXBvc2l0b3J5IGVudHJpZXMgd2lsbCBiZSBxdWVyaWVkIHdpdGggdGhlIGdlbmVyYXRlZCBxdWVyeS5cbiAgICovXG4gIGdldENvbmZpZ3VyYXRpb25UeXBlUXVlcnkoZGV2aWNlOiBJTWFuYWdlZE9iamVjdCwgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZyk6IG9iamVjdCB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLmdldERldmljZVR5cGVRdWVyeShSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OLCBkZXZpY2UpO1xuICAgIHJldHVybiB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihxdWVyeSwge1xuICAgICAgX19vcjogW1xuICAgICAgICB7IGNvbmZpZ3VyYXRpb25UeXBlIH0sXG4gICAgICAgIHsgY29uZmlndXJhdGlvblR5cGU6ICcnIH0sXG4gICAgICAgIHsgX19ub3Q6IHsgX19oYXM6IGBjb25maWd1cmF0aW9uVHlwZWAgfSB9XG4gICAgICBdXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGlzdCBvZiBzb2Z0d2FyZSBpbnN0YWxsZWQgaW4gdGhlIGRldmljZSBpbiB0aGUgdW5pZm9ybSBmb3JtYXQuXG4gICAqIFN1cHBvcnRzIGM4eV9Tb2Z0d2FyZUxpc3QgYW5kIGM4eV9Tb2Z0d2FyZSBmcmFnbWVudHMuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSB3aG9zZSBzb2Z0d2FyZSBsaXN0IHNob3VsZCBiZSByZXR1cm5lZC5cbiAgICovXG4gIGdldERldmljZVNvZnR3YXJlTGlzdChkZXZpY2U6IElNYW5hZ2VkT2JqZWN0KTogRGV2aWNlU29mdHdhcmVbXSB7XG4gICAgaWYgKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KSB7XG4gICAgICByZXR1cm4gY2xvbmVEZWVwKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KTtcbiAgICB9XG4gICAgaWYgKGRldmljZS5jOHlfU29mdHdhcmUpIHtcbiAgICAgIHJldHVybiBfbWFwKGRldmljZS5jOHlfU29mdHdhcmUsICh2ZXJzaW9uLCBuYW1lKSA9PiAoeyBuYW1lLCB2ZXJzaW9uIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgc29mdHdhcmUgdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCB0aGUgbGlzdCBvZiBjaGFuZ2VzLCBhbmQgc2VuZHMgaXQgdG8gdGhlIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIHdoaWNoIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkIGZvciBhbmQgc2VudCB0by5cbiAgICogQHBhcmFtIGNoYW5nZXMgVGhlIGxpc3Qgb2Ygc29mdHdhcmUgY2hhbmdlcyB3aGljaCBzaG91bGQgYmUgYXBwbGllZC5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY2hhbmdlczogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXVxuICApOiBQcm9taXNlPElPcGVyYXRpb24+IHtcbiAgICBjb25zdCBvcGVyYXRpb24gPSB0aGlzLmdldFNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKGRldmljZSwgY2hhbmdlcyk7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLm9wZXJhdGlvbi5jcmVhdGUob3BlcmF0aW9uKSkuZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIHNvZnR3YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgY2hhbmdlcy5cbiAgICogUmV0dXJuZWQgb3BlcmF0aW9uIHR5cGUgZGVwZW5kcyBvbiBkZXZpY2UncyBzdXBwb3J0ZWQgb3BlcmF0aW9ucy5cbiAgICogU3VwcG9ydHMgYzh5X1NvZnR3YXJlVXBkYXRlLCBjOHlfU29mdHdhcmVMaXN0LCBhbmQgYzh5X1NvZnR3YXJlIG9wZXJhdGlvbnMuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNoYW5nZXMgVGhlIGxpc3Qgb2Ygc29mdHdhcmUgY2hhbmdlcyB3aGljaCBzaG91bGQgYmUgYXBwbGllZC5cbiAgICovXG4gIGdldFNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKGRldmljZTogSU1hbmFnZWRPYmplY3QsIGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10pOiBJT3BlcmF0aW9uIHtcbiAgICBjb25zdCBvcGVyYXRpb246IElPcGVyYXRpb24gPSB7XG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgZGVzY3JpcHRpb246IGBBcHBseSBzb2Z0d2FyZSBjaGFuZ2VzOiAke2NoYW5nZXNcbiAgICAgICAgLm1hcChcbiAgICAgICAgICBjaGFuZ2UgPT5cbiAgICAgICAgICAgIGAke2NoYW5nZS5hY3Rpb259IFwiJHtjaGFuZ2UubmFtZX1cIiR7XG4gICAgICAgICAgICAgIGNoYW5nZS52ZXJzaW9uID8gYCAodmVyc2lvbjogJHtjaGFuZ2UudmVyc2lvbn0pYCA6ICcnXG4gICAgICAgICAgICB9YFxuICAgICAgICApXG4gICAgICAgIC5qb2luKCcsICcpfWBcbiAgICB9O1xuICAgIGlmIChkZXZpY2UuYzh5X1N1cHBvcnRlZE9wZXJhdGlvbnMuaW5jbHVkZXMoJ2M4eV9Tb2Z0d2FyZVVwZGF0ZScpKSB7XG4gICAgICBvcGVyYXRpb24uYzh5X1NvZnR3YXJlVXBkYXRlID0gY2xvbmVEZWVwKGNoYW5nZXMpO1xuICAgIH0gZWxzZSBpZiAoZGV2aWNlLmM4eV9TdXBwb3J0ZWRPcGVyYXRpb25zLmluY2x1ZGVzKCdjOHlfU29mdHdhcmVMaXN0JykpIHtcbiAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0ID0gY2xvbmVEZWVwKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KSB8fCBbXTtcbiAgICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4ge1xuICAgICAgICBjb25zdCBkZXZpY2VTb2Z0d2FyZTogRGV2aWNlU29mdHdhcmUgPSBwaWNrKGNoYW5nZSwgWyduYW1lJywgJ3ZlcnNpb24nLCAndXJsJ10pO1xuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICByZW1vdmUob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QsIGRldmljZVNvZnR3YXJlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2luc3RhbGwnKSB7XG4gICAgICAgICAgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QucHVzaChkZXZpY2VTb2Z0d2FyZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZGV2aWNlLmM4eV9TdXBwb3J0ZWRPcGVyYXRpb25zLmluY2x1ZGVzKCdjOHlfU29mdHdhcmUnKSkge1xuICAgICAgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZSA9IGNsb25lRGVlcChkZXZpY2UuYzh5X1NvZnR3YXJlKSB8fCB7fTtcbiAgICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4ge1xuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICBkZWxldGUgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVtjaGFuZ2UubmFtZV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZS5hY3Rpb24gPT09ICdpbnN0YWxsJykge1xuICAgICAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVbY2hhbmdlLm5hbWVdID0gY2hhbmdlLnZlcnNpb247XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gb3BlcmF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHRoZSBsaXN0IG9mIGRldmljZSBzb2Z0d2FyZSBjaGFuZ2VzIGZyb20gZ2l2ZW4gb3BlcmF0aW9uIGluIHRoZSBjb250ZXh0IG9mIGdpdmVuIGRldmljZS5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIGZyb20gd2hpY2ggdGhlIGxpc3Qgc2hvdWxkIGJlIGV4dHJhY3RlZC5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgdGFyZ2V0IGRldmljZSBvZiB0aGUgb3BlcmF0aW9uLlxuICAgKi9cbiAgZ2V0RGV2aWNlU29mdHdhcmVDaGFuZ2VzRnJvbU9wZXJhdGlvbihcbiAgICBvcGVyYXRpb246IElPcGVyYXRpb24sXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdFxuICApOiBEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdIHtcbiAgICBpZiAob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVVwZGF0ZSkge1xuICAgICAgcmV0dXJuIGNsb25lRGVlcChvcGVyYXRpb24uYzh5X1NvZnR3YXJlVXBkYXRlKTtcbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0KSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVMaXN0T3BlcmF0aW9uKG9wZXJhdGlvbiwgZGV2aWNlKTtcbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmUpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldERldmljZVNvZnR3YXJlQ2hhbmdlc0Zyb21Tb2Z0d2FyZU9wZXJhdGlvbihvcGVyYXRpb24sIGRldmljZSk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGZpcm13YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgdGhlIHNlbGVjdGVkIHJlcG9zaXRvcnkgYmluYXJ5LCBhbmQgc2VuZHMgaXQgdG8gdGhlIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIHdoaWNoIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkIGZvciBhbmQgc2VudCB0by5cbiAgICogQHBhcmFtIHNlbGVjdGVkT3B0aW9uIFRoZSBzZWxlY3RlZCByZXBvc2l0b3J5IGJpbmFyeSBvcHRpb24uXG4gICAqL1xuICBhc3luYyBjcmVhdGVGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LFxuICAgIHNlbGVjdGVkT3B0aW9uOiBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnlcbiAgKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gdGhpcy5nZXRGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2UsIHNlbGVjdGVkT3B0aW9uKTtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMub3BlcmF0aW9uLmNyZWF0ZShvcGVyYXRpb24pKS5kYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgZmlybXdhcmUgdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBzZWxlY3RlZCB2ZXJzaW9uLlxuICAgKiBTdXBwb3J0cyBjOHlfRmlybXdhcmUgb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqIEBwYXJhbSBzZWxlY3RlZE9wdGlvbiBTZWxlY3RlZCBmaXJtd2FyZSB2ZXJzaW9uLlxuICAgKi9cbiAgZ2V0RmlybXdhcmVVcGRhdGVPcGVyYXRpb24oXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCxcbiAgICBzZWxlY3RlZE9wdGlvbjogU2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5XG4gICk6IElPcGVyYXRpb24ge1xuICAgIGRlbGV0ZSBzZWxlY3RlZE9wdGlvbi5pZDtcblxuICAgIGNvbnN0IG9wZXJhdGlvbjogSU9wZXJhdGlvbiA9IHtcbiAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICBkZXNjcmlwdGlvbjogYFVwZGF0ZSBmaXJtd2FyZSB0bzogXCIke3NlbGVjdGVkT3B0aW9uLm5hbWV9XCIke1xuICAgICAgICBzZWxlY3RlZE9wdGlvbi52ZXJzaW9uID8gYCAodmVyc2lvbjogJHtzZWxlY3RlZE9wdGlvbi52ZXJzaW9ufSlgIDogJydcbiAgICAgIH1gLFxuICAgICAgYzh5X0Zpcm13YXJlOiB7IC4uLnNlbGVjdGVkT3B0aW9uIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIG9wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGNvbmZpZ3VyYXRpb24gZmlsZSB1cGxvYWQgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgU2VsZWN0ZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gaXNMZWdhY3kgIEEgbGVnYWN5IG9wZXJhdGlvbiBpcyBjcmVhdGVkIHdpdGhvdXQgYSBjb25maWd1cmF0aW9uVHlwZS5cbiAgICovXG4gIGdldFVwbG9hZENvbmZpZ3VyYXRpb25GaWxlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZyxcbiAgICBpc0xlZ2FjeTogYm9vbGVhbiA9IGZhbHNlXG4gICk6IElPcGVyYXRpb24ge1xuICAgIGlmIChpc0xlZ2FjeSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBSZXRyaWV2ZSBjb25maWd1cmF0aW9uIHNuYXBzaG90IGZyb20gZGV2aWNlICR7ZGV2aWNlLm5hbWV9YCxcbiAgICAgICAgYzh5X1VwbG9hZENvbmZpZ0ZpbGU6IHt9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUmV0cmlldmUgJHtjb25maWd1cmF0aW9uVHlwZX0gY29uZmlndXJhdGlvbiBzbmFwc2hvdCBmcm9tIGRldmljZSAke2RldmljZS5uYW1lfWAsXG4gICAgICBjOHlfVXBsb2FkQ29uZmlnRmlsZToge1xuICAgICAgICB0eXBlOiBjb25maWd1cmF0aW9uVHlwZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBjb25maWd1cmF0aW9uIGZpbGUgZG93bmxvYWQgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgU2VsZWN0ZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gYmluYXJ5VXJsIFRoZSB1cmwgb2YgYSBiaW5hcnkgdG8gYmUgZG93bmxvYWRlZC5cbiAgICogQHBhcmFtIGlzTGVnYWN5IEEgbGVnYWN5IG9wZXJhdGlvbiBpcyBjcmVhdGVkIHdpdGhvdXQgYSBjb25maWd1cmF0aW9uVHlwZS5cbiAgICovXG4gIGdldERvd25sb2FkQ29uZmlndXJhdGlvbkZpbGVPcGVyYXRpb24oXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCxcbiAgICBjb25maWd1cmF0aW9uVHlwZTogc3RyaW5nLFxuICAgIGNvbmZpZ1NuYXBzaG90OiBDb25maWd1cmF0aW9uU25hcHNob3QsXG4gICAgaXNMZWdhY3k6IGJvb2xlYW4gPSBmYWxzZVxuICApOiBJT3BlcmF0aW9uIHtcbiAgICBpZiAoaXNMZWdhY3kpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgU2VuZCBjb25maWd1cmF0aW9uIHNuYXBzaG90ICR7Y29uZmlnU25hcHNob3QubmFtZX0gdG8gZGV2aWNlICR7ZGV2aWNlLm5hbWV9YCxcbiAgICAgICAgYzh5X0Rvd25sb2FkQ29uZmlnRmlsZToge1xuICAgICAgICAgIHVybDogY29uZmlnU25hcHNob3QuYmluYXJ5VXJsLFxuICAgICAgICAgIGM4eV9Db25maWd1cmF0aW9uRHVtcDoge1xuICAgICAgICAgICAgaWQ6IGNvbmZpZ1NuYXBzaG90LmlkXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgU2VuZCBjb25maWd1cmF0aW9uIHNuYXBzaG90ICR7Y29uZmlnU25hcHNob3QubmFtZX0gb2YgY29uZmlndXJhdGlvbiB0eXBlICR7Y29uZmlndXJhdGlvblR5cGV9IHRvIGRldmljZSAke2RldmljZS5uYW1lfWAsXG4gICAgICBjOHlfRG93bmxvYWRDb25maWdGaWxlOiB7XG4gICAgICAgIHVybDogY29uZmlnU25hcHNob3QuYmluYXJ5VXJsLFxuICAgICAgICB0eXBlOiBjb25maWd1cmF0aW9uVHlwZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGFzdCBmaXJtd2FyZSB1cGRhdGUgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UuXG4gICAqIExvb2tzIGZvciBjOHlfRmlybXdhcmUgb3BlcmF0aW9ucy5cbiAgICogQHBhcmFtIGRldmljZUlkIFRoZSBJRCBvZiB0aGUgZGV2aWNlIHRvIGZpbmQgYW4gb3BlcmF0aW9uIGZvci5cbiAgICovXG4gIGFzeW5jIGdldExhc3RGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgIGRldmljZUlkLFxuICAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IG5ldyBEYXRlKERhdGUubm93KCkpLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0Rmlyc3RNYXRjaGluZ09wZXJhdGlvbihbeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfRmlybXdhcmUnIH1dKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBsYXN0IHNvZnR3YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZS5cbiAgICogTG9va3MgZm9yIGM4eV9Tb2Z0d2FyZVVwZGF0ZSwgYzh5X1NvZnR3YXJlTGlzdCwgb3IgYzh5X1NvZnR3YXJlIG9wZXJhdGlvbnMuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgSUQgb2YgdGhlIGRldmljZSB0byBmaW5kIGFuIG9wZXJhdGlvbiBmb3IuXG4gICAqL1xuICBhc3luYyBnZXRMYXN0U29mdHdhcmVVcGRhdGVPcGVyYXRpb24oZGV2aWNlSWQ6IHN0cmluZyB8IG51bWJlcik6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGRhdGVGcm9tOiBuZXcgRGF0ZSgwKS50b0lTT1N0cmluZygpLFxuICAgICAgZGF0ZVRvOiBuZXcgRGF0ZShEYXRlLm5vdygpKS50b0lTT1N0cmluZygpLFxuICAgICAgcmV2ZXJ0OiB0cnVlLFxuICAgICAgcGFnZVNpemU6IDFcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZpcnN0TWF0Y2hpbmdPcGVyYXRpb24oW1xuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfU29mdHdhcmVVcGRhdGUnIH0sXG4gICAgICB7IC4uLmZpbHRlcnMsIGZyYWdtZW50VHlwZTogJ2M4eV9Tb2Z0d2FyZUxpc3QnIH0sXG4gICAgICB7IC4uLmZpbHRlcnMsIGZyYWdtZW50VHlwZTogJ2M4eV9Tb2Z0d2FyZScgfVxuICAgIF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEl0ZXJhdGVzIG92ZXIgdGhlIGxpc3Qgb2YgZmlsdGVycyBhbmQgcXVlcmllcyB0aGUgb3BlcmF0aW9ucy5cbiAgICogSWYgYSBxdWVyeSByZXR1cm5zIGF0IGxlYXN0IG9uZSBvcGVyYXRpb24sIHRoZSBmaXJzdCBvbmUgd2lsbCBiZSByZXR1cm5lZC5cbiAgICogT3RoZXJ3aXNlIHRoZSBuZXh0IHF1ZXJ5IHdpbGwgYmUgcGVyZm9ybWVkLlxuICAgKiBJZiBub25lIG9mIHRoZSBxdWVyaWVzIHJldHVybnMgYW55IG9wZXJhdGlvbiwgbnVsbCB3aWxsIGJlIHJldHVybmVkLlxuICAgKiBAcGFyYW0gZmlsdGVyc0xpc3QgVGhlIGxpc3Qgb2YgZmlsdGVycyBmb3IgdGhlIHF1ZXJpZXMuXG4gICAqL1xuICBhc3luYyBnZXRGaXJzdE1hdGNoaW5nT3BlcmF0aW9uKGZpbHRlcnNMaXN0OiBhbnlbXSk6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGxldCBtYXRjaGluZ09wZXJhdGlvbiA9IG51bGw7XG5cbiAgICBmb3IgKGNvbnN0IGZpbHRlcnMgb2YgZmlsdGVyc0xpc3QpIHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSAoYXdhaXQgdGhpcy5vcGVyYXRpb24ubGlzdChmaWx0ZXJzKSkuZGF0YTtcbiAgICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCkge1xuICAgICAgICBtYXRjaGluZ09wZXJhdGlvbiA9IG9wZXJhdGlvbnNbMF07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYXRjaGluZ09wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdGVyYXRlcyBvdmVyIHRoZSBsaXN0IG9mIGZpbHRlcnMgYW5kIHF1ZXJpZXMgdGhlIG9wZXJhdGlvbnMuXG4gICAqIEl0IGNvbXBhcmVzIHRoZSBvcGVyYXRpb25zIHJldHJpZXZlZCBieSB0aGUgcXVlcmllcyBieSAnY3JlYXRpb25UaW1lJ1xuICAgKiBhbmQgcmV0dXJuIHRoZSBsYXRlc3Qgb25lLlxuICAgKiBJZiBub25lIG9mIHRoZSBxdWVyaWVzIHJldHVybnMgYW55IG9wZXJhdGlvbiwgbnVsbCB3aWxsIGJlIHJldHVybmVkLlxuICAgKiBAcGFyYW0gZmlsdGVyc0xpc3QgVGhlIGxpc3Qgb2YgZmlsdGVycyBmb3IgdGhlIHF1ZXJpZXMuXG4gICAqL1xuICBhc3luYyBnZXRMYXRlc3RNYXRjaGluZ09wZXJhdGlvbihmaWx0ZXJzTGlzdDogYW55W10pOiBQcm9taXNlPElPcGVyYXRpb24+IHtcbiAgICBsZXQgbWF0Y2hpbmdPcGVyYXRpb246IElPcGVyYXRpb24gPSBudWxsO1xuXG4gICAgZm9yIChjb25zdCBmaWx0ZXJzIG9mIGZpbHRlcnNMaXN0KSB7XG4gICAgICBjb25zdCBvcGVyYXRpb25zOiBJT3BlcmF0aW9uW10gPSAoYXdhaXQgdGhpcy5vcGVyYXRpb24ubGlzdChmaWx0ZXJzKSkuZGF0YTtcbiAgICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCkge1xuICAgICAgICBpZiAobWF0Y2hpbmdPcGVyYXRpb24pIHtcbiAgICAgICAgICBtYXRjaGluZ09wZXJhdGlvbiA9XG4gICAgICAgICAgICBuZXcgRGF0ZShtYXRjaGluZ09wZXJhdGlvbi5jcmVhdGlvblRpbWUpLmdldFRpbWUoKSA8XG4gICAgICAgICAgICBuZXcgRGF0ZShvcGVyYXRpb25zWzBdLmNyZWF0aW9uVGltZSkuZ2V0VGltZSgpXG4gICAgICAgICAgICAgID8gb3BlcmF0aW9uc1swXVxuICAgICAgICAgICAgICA6IG1hdGNoaW5nT3BlcmF0aW9uO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hdGNoaW5nT3BlcmF0aW9uID0gb3BlcmF0aW9uc1swXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYXRjaGluZ09wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRoZSBvcGVyYXRpb24gYW5kIHJldHVybnMgYW4gb2JzZXJ2YWJsZSB0byB0cmFjayBpdHMgcHJvZ3Jlc3MuXG4gICAqIEZhaWxzIHRoZSBvYnNlcnZhYmxlIHdoZW4gdGhlIG9wZXJhdGlvbiByZXR1cm5zIEZBSUxFRCBzdGF0dXMuXG4gICAqIENvbXBsZXRlcyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBTVUNDRVNTRlVMIHN0YXR1cy5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIHRvIGNyZWF0ZSBhbmQgdHJhY2suXG4gICAqL1xuICBjcmVhdGVPYnNlcnZlZE9wZXJhdGlvbihvcGVyYXRpb246IElPcGVyYXRpb24pOiBPYnNlcnZhYmxlPElPcGVyYXRpb24+IHtcbiAgICByZXR1cm4gZnJvbSh0aGlzLm9wZXJhdGlvbi5jcmVhdGUob3BlcmF0aW9uKSkucGlwZShcbiAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpLFxuICAgICAgdGFrZSgxKSxcbiAgICAgIHN3aXRjaE1hcChjcmVhdGVkT3BlcmF0aW9uID0+IHRoaXMub2JzZXJ2ZU9wZXJhdGlvbihjcmVhdGVkT3BlcmF0aW9uKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSB0byB0cmFjayBwcm9ncmVzcyBvZiBnaXZlbiBvcGVyYXRpb24uXG4gICAqIEZhaWxzIHRoZSBvYnNlcnZhYmxlIHdoZW4gdGhlIG9wZXJhdGlvbiByZXR1cm5zIEZBSUxFRCBzdGF0dXMuXG4gICAqIENvbXBsZXRlcyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBTVUNDRVNTRlVMIHN0YXR1cy5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIHRvIGJlIG9ic2VydmVkLlxuICAgKi9cbiAgb2JzZXJ2ZU9wZXJhdGlvbihvcGVyYXRpb246IElPcGVyYXRpb24pOiBPYnNlcnZhYmxlPElPcGVyYXRpb24+IHtcbiAgICBjb25zdCBvYnNlcnZlZE9wZXJhdGlvbiQgPSBvZihvcGVyYXRpb24pO1xuICAgIGNvbnN0IG9wZXJhdGlvblVwZGF0ZXMkID0gb2JzZXJ2ZWRPcGVyYXRpb24kLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAob2JzZXJ2ZWRPcGVyYXRpb24gPT4gdGhpcy5vcGVyYXRpb25SZWFsdGltZS5vbkFsbCQob2JzZXJ2ZWRPcGVyYXRpb24uZGV2aWNlSWQpKSxcbiAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEgYXMgSU9wZXJhdGlvbiksXG4gICAgICB3aXRoTGF0ZXN0RnJvbShvYnNlcnZlZE9wZXJhdGlvbiQpLFxuICAgICAgZmlsdGVyKChbb3BlcmF0aW9uVXBkYXRlLCBvYnNlcnZlZE9wZXJhdGlvbl0pID0+IG9wZXJhdGlvblVwZGF0ZS5pZCA9PT0gb2JzZXJ2ZWRPcGVyYXRpb24uaWQpLFxuICAgICAgc3dpdGNoTWFwKChbb3BlcmF0aW9uVXBkYXRlXSkgPT4ge1xuICAgICAgICBpZiAob3BlcmF0aW9uVXBkYXRlLnN0YXR1cyA9PT0gT3BlcmF0aW9uU3RhdHVzLkZBSUxFRCkge1xuICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKG9wZXJhdGlvblVwZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9mKG9wZXJhdGlvblVwZGF0ZSk7XG4gICAgICB9KSxcbiAgICAgIHRha2VXaGlsZShvcGVyYXRpb25VcGRhdGUgPT4gb3BlcmF0aW9uVXBkYXRlLnN0YXR1cyAhPT0gT3BlcmF0aW9uU3RhdHVzLlNVQ0NFU1NGVUwsIHRydWUpXG4gICAgKTtcbiAgICByZXR1cm4gbWVyZ2Uob2JzZXJ2ZWRPcGVyYXRpb24kLCBvcGVyYXRpb25VcGRhdGVzJCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhIHNpbmdsZSBldmVudCB3aXRoIGxhdGVzdCBjcmVhdGlvblRpbWUgZm9yIHRoZSBnaXZlbiBkZXZpY2UgSWQgYW5kIGV2ZW50IHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgZGV2aWNlIElkIGZvciB3aGljaCB0aGUgZXZlbnRzIHNob3VsZCBiZSBxdWVyaWVkLlxuICAgKiBAcGFyYW0gdHlwZSBFdmVudCB0eXBlLlxuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0Q29uZmlndXJhdGlvbkV2ZW50KFxuICAgIGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgdHlwZTogc3RyaW5nXG4gICk6IFByb21pc2U8SUV2ZW50IHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgZXZlbnRGaWx0ZXI6IG9iamVjdCA9IHtcbiAgICAgIHNvdXJjZTogZGV2aWNlSWQsXG4gICAgICB0eXBlLFxuICAgICAgZGF0ZUZyb206IHRoaXMuZGF0ZUZyb20udG9JU09TdHJpbmcoKSxcbiAgICAgIGRhdGVUbzogdGhpcy5kYXRlVG8udG9JU09TdHJpbmcoKSxcbiAgICAgIHBhZ2VTaXplOiAxXG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5ldmVudC5saXN0KGV2ZW50RmlsdGVyKTtcbiAgICByZXR1cm4gZGF0YVswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGEgbGlzdCBvZiBvcGVyYXRpb25zIGZvciB0aGUgZ2l2ZW4gZGV2aWNlIElkLCBhbmQgb3BlcmF0aW9uIHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgZGV2aWNlIElkIGZvciB3aGljaCB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBxdWVyaWVkLlxuICAgKiBAcGFyYW0gb3BlcmF0aW9uVHlwZSBPcGVyYXRpb24gdHlwZSBmcmFnbWVudC5cbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ0ZpbGVPcGVyYXRpb25MaXN0KFxuICAgIGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgb3BlcmF0aW9uVHlwZTogc3RyaW5nXG4gICk6IFByb21pc2U8SU9wZXJhdGlvbltdPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uRmlsdGVyOiBvYmplY3QgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGZyYWdtZW50VHlwZTogb3BlcmF0aW9uVHlwZSxcbiAgICAgIGRhdGVGcm9tOiB0aGlzLmRhdGVGcm9tLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IHRoaXMuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMjAwMFxuICAgIH07XG5cbiAgICByZXR1cm4gKGF3YWl0IHRoaXMub3BlcmF0aW9uLmxpc3Qob3BlcmF0aW9uRmlsdGVyKSkuZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGxhdGVzdCB1cGxvYWRlZCBjb25maWd1cmF0aW9uIHNuYXBzaG90IGZvciB0aGUgZ2l2ZW4gZGV2aWNlLCBhbmQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIHRoZSBjb25maWd1cmF0aW9uIHNuYXBzaG90IHdhcyB1cGxvYWRlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ1NuYXBzaG90KFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZ1xuICApOiBQcm9taXNlPENvbmZpZ3VyYXRpb25TbmFwc2hvdCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IGV2ZW50OiBJRXZlbnQgPSBhd2FpdCB0aGlzLmdldExhdGVzdENvbmZpZ3VyYXRpb25FdmVudChkZXZpY2UuaWQsIGNvbmZpZ3VyYXRpb25UeXBlKTtcbiAgICBsZXQgY29uZmlnU25hcHNob3Q6IENvbmZpZ3VyYXRpb25TbmFwc2hvdDtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGNvbmZpZ1NuYXBzaG90ID0ge1xuICAgICAgICB0aW1lOiBldmVudC50aW1lLFxuICAgICAgICBuYW1lOiBldmVudC50ZXh0LFxuICAgICAgICBkZXZpY2VUeXBlOiBkZXZpY2UudHlwZSxcbiAgICAgICAgY29uZmlndXJhdGlvblR5cGVcbiAgICAgIH07XG4gICAgICB0cnkge1xuICAgICAgICBjb25maWdTbmFwc2hvdC5iaW5hcnkgPSBhd2FpdCAoYXdhaXQgdGhpcy5ldmVudEJpbmFyeS5kb3dubG9hZChldmVudCkpLnRleHQoKTtcbiAgICAgICAgaWYgKGV2ZW50LmM4eV9Jc0JpbmFyeSkge1xuICAgICAgICAgIGNvbmZpZ1NuYXBzaG90LmJpbmFyeVR5cGUgPSBldmVudC5jOHlfSXNCaW5hcnkudHlwZTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgYmluYXJ5LicpO1xuICAgICAgICB0aGlzLmFsZXJ0LmRhbmdlcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29uZmlnU25hcHNob3Q7XG4gIH1cblxuICBhc3luYyBnZXRMZWdhY3lDb25maWdTbmFwc2hvdChkZXZpY2VJZCkge1xuICAgIGxldCBjb25maWdTbmFwc2hvdDogQ29uZmlndXJhdGlvblNuYXBzaG90O1xuICAgIGxldCBtbztcbiAgICBjb25zdCBkZXZpY2UgPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKGRldmljZUlkLCB7IHdpdGhDaGlsZHJlbjogZmFsc2UgfSkpLmRhdGE7XG4gICAgY29uc3Qgc25hcHNob3RJZCA9IGRldmljZS5jOHlfQ29uZmlndXJhdGlvbkR1bXAgJiYgZGV2aWNlLmM4eV9Db25maWd1cmF0aW9uRHVtcC5pZDtcbiAgICBpZiAoIXNuYXBzaG90SWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgbW8gPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKHNuYXBzaG90SWQpKS5kYXRhO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAvLyBkbyBub3RoaW5nXG4gICAgfVxuICAgIGlmIChtbykge1xuICAgICAgY29uZmlnU25hcHNob3QgPSB7XG4gICAgICAgIHRpbWU6IG1vLmNyZWF0aW9uVGltZSxcbiAgICAgICAgbmFtZTogbW8ubmFtZVxuICAgICAgfTtcbiAgICAgIGNvbmZpZ1NuYXBzaG90LmJpbmFyeSA9IGF3YWl0IHRoaXMuZ2V0QmluYXJ5VGV4dChtby51cmwsIHsgYWxsb3dFeHRlcm5hbDogZmFsc2UgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb25maWdTbmFwc2hvdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYmluYXJ5IG9iamVjdCBhcyB0ZXh0LlxuICAgKiBAcGFyYW0gYmluYXJ5VXJsIFRoZSBVUkwgdG8gZmluZCBiaW5hcnlcbiAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgb3B0aW9uczpcbiAgICogLSAqKmFsbG93RXh0ZXJuYWwqKiAtIGBib29sZWFuYCAtIGFsbG93cyBkb3dubG9hZGluZyBleHRlcm5hbCBiaW5hcnkgZmlsZVxuICAgKiAtICoqbm9BbGVydHMqKiAtIGBib29sZWFuYCAtIGRvIG5vdCBkaXNwbGF5IGFuIGFsZXJ0IG1lc3NhZ2U7IGRlZmF1bHRzIHRvIGBmYWxzZWBcbiAgICovXG4gIGFzeW5jIGdldEJpbmFyeVRleHQoXG4gICAgYmluYXJ5VXJsOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBhbGxvd0V4dGVybmFsOiBib29sZWFuOyBub0FsZXJ0cz86IGJvb2xlYW4gfVxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGJpbmFyeUlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKGJpbmFyeVVybCk7XG4gICAgbGV0IHJlcztcbiAgICBpZiAoIWJpbmFyeUlkICYmIG9wdGlvbnMuYWxsb3dFeHRlcm5hbCkge1xuICAgICAgcmVzID0gYXdhaXQgdGhpcy5nZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKGJpbmFyeVVybCwgb3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuZ2V0SW50ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlJZCwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmICghcmVzKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy50ZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJpbmFyeSBvYmplY3QgYXMgRmlsZS5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgVVJMIHRvIGZpbmQgYmluYXJ5XG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKiphbGxvd0V4dGVybmFsKiogLSBgYm9vbGVhbmAgLSBhbGxvd3MgZG93bmxvYWRpbmcgZXh0ZXJuYWwgYmluYXJ5IGZpbGVcbiAgICovXG4gIGFzeW5jIGdldEJpbmFyeUZpbGUoYmluYXJ5VXJsOiBzdHJpbmcsIG9wdGlvbnM6IHsgYWxsb3dFeHRlcm5hbDogYm9vbGVhbiB9KTogUHJvbWlzZTxGaWxlPiB7XG4gICAgY29uc3QgYmluYXJ5SWQgPSB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwoYmluYXJ5VXJsKTtcbiAgICBpZiAoIWJpbmFyeUlkICYmICFvcHRpb25zLmFsbG93RXh0ZXJuYWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBAVE9ETzogbm90ZSB0aGF0IGl0IGRvZXNuJ3Qgc29sdmUgaXNzdWUgd2l0aCBleHRlcm5hbCBiaW5hcnkgaGVyZSwgc3VjaCB1cmwgd29uJ3QgaGF2ZSBiaW5hcnlJZCwgc28gd2Ugd29uJ3Qga25vdyB0aGUgbmFtZSBvciBjb250ZW50VHlwZSB0byB1c2UgaW4gRmlsZSBjb25zdHJ1Y3RvciwgbGV0J3MgYWRkIGEgQEZJWE1FIGNvbW1lbnQgZm9yIG5vdz9cbiAgICBjb25zdCB7IG5hbWUsIGNvbnRlbnRUeXBlIH0gPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKGJpbmFyeUlkKSkuZGF0YTtcbiAgICBjb25zdCByZXMgPSAhIWJpbmFyeUlkXG4gICAgICA/IGF3YWl0IHRoaXMuZ2V0SW50ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlJZClcbiAgICAgIDogYXdhaXQgdGhpcy5nZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKGJpbmFyeVVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXMuYXJyYXlCdWZmZXIoKTtcbiAgICByZXR1cm4gbmV3IEZpbGUoW2FycmF5QnVmZmVyXSwgbmFtZSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBsYXN0IGNvbmZpZ3VyYXRpb24gdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlLlxuICAgKiBMb29rcyBmb3IgYzh5X0NvbmZpZ3VyYXRpb24gYW5kIGM4eV9TZW5kQ29uZmlndXJhdGlvbiBvcGVyYXRpb25zLlxuICAgKiBAcGFyYW0gZGV2aWNlSWQgVGhlIElEIG9mIHRoZSBkZXZpY2UgdG8gZmluZCBhbiBvcGVyYXRpb24gZm9yLlxuICAgKi9cbiAgYXN5bmMgZ2V0TGFzdENvbmZpZ1VwZGF0ZU9wZXJhdGlvbihkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgIGRldmljZUlkLFxuICAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IG5ldyBEYXRlKERhdGUubm93KCkpLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0TGF0ZXN0TWF0Y2hpbmdPcGVyYXRpb24oW1xuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfQ29uZmlndXJhdGlvbicgfSxcbiAgICAgIHsgLi4uZmlsdGVycywgZnJhZ21lbnRUeXBlOiAnYzh5X1NlbmRDb25maWd1cmF0aW9uJyB9XG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBjb25maWd1cmF0aW9uIGRvd25sb2FkIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBpdHMgY3VycmVudCBjb25maWd1cmF0aW9uLlxuICAgKiBTdXBwb3J0cyBjOHlfU2VuZENvbmZpZ3VyYXRpb24gb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqL1xuICBjcmVhdGVUZXh0QmFzZWRDb25maWd1cmF0aW9uUmVsb2FkT3BlcmF0aW9uKGRldmljZTogSU1hbmFnZWRPYmplY3QpOiBJT3BlcmF0aW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBnZXR0ZXh0KCdSZXF1ZXN0ZWQgY3VycmVudCBjb25maWd1cmF0aW9uJyksXG4gICAgICBjOHlfU2VuZENvbmZpZ3VyYXRpb246IHt9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGNvbmZpZ3VyYXRpb24gdXBkYXRlIG9wZXJhdGlvbiBmb3IgdGhlIGdpdmVuIGRldmljZS5cbiAgICogU3VwcG9ydHMgYzh5X0NvbmZpZ3VyYXRpb24gb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqIEBwYXJhbSBjb25maWcgVGhlIGNvbmZpZ3VyYXRpb24gd2hpY2ggd2lsbCB1cGRhdGUgdGhlIGV4aXN0aW5nIG9uZS5cbiAgICovXG4gIGNyZWF0ZVRleHRCYXNlZENvbmZpZ3VyYXRpb25VcGRhdGVPcGVyYXRpb24oZGV2aWNlOiBJTWFuYWdlZE9iamVjdCwgY29uZmlnOiBzdHJpbmcpOiBJT3BlcmF0aW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBnZXR0ZXh0KCdDb25maWd1cmF0aW9uIHVwZGF0ZScpLFxuICAgICAgYzh5X0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgY29uZmlnXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldEJpbmFyeShiaW5hcnlJZDogSWRSZWZlcmVuY2UpOiBQcm9taXNlPElGZXRjaFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5kb3dubG9hZChiaW5hcnlJZCk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0NvdWxkIG5vdCBnZXQgdGhlIGJpbmFyeS4nKTtcbiAgICAgIHRoaXMuYWxlcnQuZGFuZ2VyKG1zZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGF2YWlsYWJsZSBzbmFwc2hvdHMgZnJvbSB0aGUgcmVwb3NpdG9yeSBmb3IgdGhlIGdpdmVuIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCB0aGUgc25hcHNob3RzIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90c0Zyb21SZXBvc2l0b3J5KGRldmljZSwgY29uZmlndXJhdGlvblR5cGUpIHtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuZ2V0Q29uZmlndXJhdGlvblR5cGVRdWVyeShkZXZpY2UsIGNvbmZpZ3VyYXRpb25UeXBlKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmxpc3RSZXBvc2l0b3J5RW50cmllcyhSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OLCB7XG4gICAgICBxdWVyeTogc2VhcmNoUXVlcnksXG4gICAgICBwYXJhbXM6IHsgcGFnZVNpemU6IDEwMCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcy5kYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBiaW5hcnkgb2JqZWN0LlxuICAgKiBAcGFyYW0gYmluYXJ5SWQgYmluYXJ5IElEXG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKipub0FsZXJ0cyoqIC0gYGJvb2xlYW5gIC0gZG8gbm90IGRpc3BsYXkgYW4gYWxlcnQgbWVzc2FnZTsgZGVmYXVsdHMgdG8gYGZhbHNlYFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRJbnRlcm5hbEJpbmFyeVJlc3BvbnNlKFxuICAgIGJpbmFyeUlkOiBJZFJlZmVyZW5jZSxcbiAgICBvcHRpb25zOiB7IG5vQWxlcnRzPzogYm9vbGVhbiB9ID0ge31cbiAgKTogUHJvbWlzZTxJRmV0Y2hSZXNwb25zZT4ge1xuICAgIGxldCByZXM7XG4gICAgdHJ5IHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmRvd25sb2FkKGJpbmFyeUlkKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgaWYgKCFvcHRpb25zLm5vQWxlcnRzKSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0NvdWxkIG5vdCBnZXQgdGhlIGJpbmFyeS4nKTtcbiAgICAgICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYmluYXJ5IG9iamVjdC5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgVVJMIHRvIGZpbmQgYmluYXJ5XG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKipub0FsZXJ0cyoqIC0gYGJvb2xlYW5gIC0gZG8gbm90IGRpc3BsYXkgYW4gYWxlcnQgbWVzc2FnZTsgZGVmYXVsdHMgdG8gYGZhbHNlYFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKFxuICAgIGJpbmFyeVVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHsgbm9BbGVydHM/OiBib29sZWFuIH0gPSB7fVxuICApOiBQcm9taXNlPElGZXRjaFJlc3BvbnNlPiB7XG4gICAgbGV0IHJlcztcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmV0Y2hSZXMgPSBhd2FpdCBmZXRjaChiaW5hcnlVcmwpO1xuICAgICAgaWYgKGZldGNoUmVzLnN0YXR1cyA+PSA0MDApIHtcbiAgICAgICAgdGhyb3cgcmVzO1xuICAgICAgfVxuICAgICAgcmVzID0gZmV0Y2hSZXM7XG4gICAgfSBjYXRjaCB7XG4gICAgICBpZiAoIW9wdGlvbnMubm9BbGVydHMpIHtcbiAgICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgZXh0ZXJuYWwgYmluYXJ5Jyk7XG4gICAgICAgIHRoaXMuYWxlcnQuZGFuZ2VyKG1zZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUVudHJ5KG1vOiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0Pikge1xuICAgIGNvbnN0IGJpbmFyeUlkID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKG1vLnVybCk7XG4gICAgY29uc3QgbmV3TW8gPSBhd2FpdCB0aGlzLmludmVudG9yeS5jcmVhdGUobW8pO1xuICAgIGlmIChiaW5hcnlJZCkge1xuICAgICAgYXdhaXQgdGhpcy5pbnZlbnRvcnkuY2hpbGRBZGRpdGlvbnNBZGQoYmluYXJ5SWQsIG5ld01vLmRhdGEpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3TW87XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUVudHJ5KG1vOiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiwgdXJsKSB7XG4gICAgY29uc3QgZXhpc3RpbmdCaW5hcnlJZCA9IGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmdldElkRnJvbVVybCh1cmwpO1xuICAgIGNvbnN0IG5ld0JpbmFyeUlkID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKG1vLnVybCk7XG4gICAgaWYgKGV4aXN0aW5nQmluYXJ5SWQgJiYgZXhpc3RpbmdCaW5hcnlJZCAhPT0gbmV3QmluYXJ5SWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKHVybCk7XG4gICAgICBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5kZWxldGUoaWQpO1xuICAgIH1cbiAgICBpZiAobmV3QmluYXJ5SWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuaW52ZW50b3J5LmNoaWxkQWRkaXRpb25zQWRkKG5ld0JpbmFyeUlkLCBtbyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmludmVudG9yeS51cGRhdGUobW8pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRCYXNlVmVyc2lvblJlc3VsdExpc3RGb3JMZWdhY3lFbnRyeShlbnRyeSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgcmVzOiB7fSBhcyBJRmV0Y2hSZXNwb25zZSxcbiAgICAgIGRhdGE6IFtcbiAgICAgICAge1xuICAgICAgICAgIC4uLmVudHJ5LFxuICAgICAgICAgIFtlbnRyeS50eXBlXToge1xuICAgICAgICAgICAgdmVyc2lvbjogZW50cnkudmVyc2lvbixcbiAgICAgICAgICAgIHVybDogZW50cnkudXJsXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSBhcyBJUmVzdWx0TGlzdDxJTWFuYWdlZE9iamVjdD4pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVMaXN0T3BlcmF0aW9uKFxuICAgIG9wZXJhdGlvbjogSU9wZXJhdGlvbixcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0XG4gICk6IERldmljZVNvZnR3YXJlQ2hhbmdlW10ge1xuICAgIGNvbnN0IGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10gPSBbXTtcbiAgICBmb3JFYWNoKGRldmljZS5jOHlfU29mdHdhcmVMaXN0LCBkZXZpY2VTb2Z0d2FyZSA9PiB7XG4gICAgICBjb25zdCBvcGVyYXRpb25Tb2Z0d2FyZSA9IGZpbmQob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QsIHsgbmFtZTogZGV2aWNlU29mdHdhcmUubmFtZSB9KTtcbiAgICAgIGlmIChcbiAgICAgICAgKG9wZXJhdGlvblNvZnR3YXJlICYmIG9wZXJhdGlvblNvZnR3YXJlLnZlcnNpb24pICE9PVxuICAgICAgICAoZGV2aWNlU29mdHdhcmUgJiYgZGV2aWNlU29mdHdhcmUudmVyc2lvbilcbiAgICAgICkge1xuICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgIC4uLmRldmljZVNvZnR3YXJlLFxuICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZSdcbiAgICAgICAgfSBhcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZm9yRWFjaChvcGVyYXRpb24uYzh5X1NvZnR3YXJlTGlzdCwgb3BlcmF0aW9uU29mdHdhcmUgPT4ge1xuICAgICAgY29uc3QgZGV2aWNlU29mdHdhcmUgPSBmaW5kKGRldmljZS5jOHlfU29mdHdhcmVMaXN0LCB7IG5hbWU6IG9wZXJhdGlvblNvZnR3YXJlLm5hbWUgfSk7XG4gICAgICBpZiAoXG4gICAgICAgIChvcGVyYXRpb25Tb2Z0d2FyZSAmJiBvcGVyYXRpb25Tb2Z0d2FyZS52ZXJzaW9uKSAhPT1cbiAgICAgICAgKGRldmljZVNvZnR3YXJlICYmIGRldmljZVNvZnR3YXJlLnZlcnNpb24pXG4gICAgICApIHtcbiAgICAgICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgICAgICAuLi5vcGVyYXRpb25Tb2Z0d2FyZSxcbiAgICAgICAgICBhY3Rpb246ICdpbnN0YWxsJ1xuICAgICAgICB9IGFzIERldmljZVNvZnR3YXJlQ2hhbmdlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGV2aWNlU29mdHdhcmVDaGFuZ2VzRnJvbVNvZnR3YXJlT3BlcmF0aW9uKFxuICAgIG9wZXJhdGlvbjogSU9wZXJhdGlvbixcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0XG4gICk6IERldmljZVNvZnR3YXJlQ2hhbmdlW10ge1xuICAgIGNvbnN0IGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10gPSBbXTtcbiAgICBmb3JFYWNoKGRldmljZS5jOHlfU29mdHdhcmUsIChkZXZpY2VTb2Z0d2FyZVZlcnNpb24sIGRldmljZVNvZnR3YXJlTmFtZSkgPT4ge1xuICAgICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVbZGV2aWNlU29mdHdhcmVOYW1lXSAhPT0gZGV2aWNlU29mdHdhcmVWZXJzaW9uKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICAgICAgbmFtZTogZGV2aWNlU29mdHdhcmVOYW1lLFxuICAgICAgICAgIHZlcnNpb246IGRldmljZVNvZnR3YXJlVmVyc2lvbixcbiAgICAgICAgICBhY3Rpb246ICdkZWxldGUnXG4gICAgICAgIH0gYXMgRGV2aWNlU29mdHdhcmVDaGFuZ2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGZvckVhY2gob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZSwgKG9wZXJhdGlvblNvZnR3YXJlVmVyc2lvbiwgb3BlcmF0aW9uU29mdHdhcmVOYW1lKSA9PiB7XG4gICAgICBjb25zdCBkZXZpY2VTb2Z0d2FyZVZlcnNpb24gPVxuICAgICAgICBkZXZpY2UuYzh5X1NvZnR3YXJlICYmIGRldmljZS5jOHlfU29mdHdhcmVbb3BlcmF0aW9uU29mdHdhcmVOYW1lXTtcbiAgICAgIGlmIChkZXZpY2VTb2Z0d2FyZVZlcnNpb24gIT09IG9wZXJhdGlvblNvZnR3YXJlVmVyc2lvbikge1xuICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IG9wZXJhdGlvblNvZnR3YXJlTmFtZSxcbiAgICAgICAgICB2ZXJzaW9uOiBvcGVyYXRpb25Tb2Z0d2FyZVZlcnNpb24sXG4gICAgICAgICAgYWN0aW9uOiAnaW5zdGFsbCdcbiAgICAgICAgfSBhcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNoYW5nZXM7XG4gIH1cbn1cbiJdfQ==