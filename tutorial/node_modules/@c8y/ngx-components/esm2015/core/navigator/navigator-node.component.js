// tslint:disable-next-line:max-line-length
import { Component, ComponentFactoryResolver, Input, ViewChild, ViewChildren, ViewContainerRef, Output, EventEmitter } from '@angular/core';
import { RouterLinkActive } from '@angular/router';
import { NavigatorIconComponent } from './navigator-icon.component';
import { NavigatorService } from './navigator.service';
import { PopoverConfirmComponent } from '../modal/popover-confirm.component';
/**
 * Navigator node renderer.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './navigator.service';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@angular/router';
import * as ɵngcc4 from 'ngx-bootstrap/collapse';
import * as ɵngcc5 from '../modal/popover-confirm.component';
import * as ɵngcc6 from '../common/icon.directive';
import * as ɵngcc7 from '../i18n/c8y-translate.pipe';

const _c0 = ["icon"];
function NavigatorNodeComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function NavigatorNodeComponent_div_5_c8y_navigator_node_display_1_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-navigator-node-display", 7);
    ɵngcc0.ɵɵlistener("nodeClick", function NavigatorNodeComponent_div_5_c8y_navigator_node_display_1_Template_c8y_navigator_node_display_nodeClick_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r6 = ɵngcc0.ɵɵnextContext(2); return ctx_r6.nodeClick.emit($event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const childNode_r5 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("node", childNode_r5);
} }
function NavigatorNodeComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 5);
    ɵngcc0.ɵɵtemplate(1, NavigatorNodeComponent_div_5_c8y_navigator_node_display_1_Template, 1, 1, "c8y-navigator-node-display", 6);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("collapse", !ctx_r1.node.open)("isAnimated", true);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.node.children);
} }
function NavigatorNodeComponent_ng_template_6_i_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "i", 12);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("c8yIcon", "circle-o-notch");
} }
function NavigatorNodeComponent_ng_template_6_i_7_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "i", 13);
    ɵngcc0.ɵɵlistener("click", function NavigatorNodeComponent_ng_template_6_i_7_Template_i_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.click("expander", $event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r10 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ctx_r10.expandTitle);
    ɵngcc0.ɵɵproperty("c8yIcon", "chevron-down");
} }
function NavigatorNodeComponent_ng_template_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, NavigatorNodeComponent_ng_template_6_i_0_Template, 1, 1, "i", 8);
    ɵngcc0.ɵɵelementStart(1, "div");
    ɵngcc0.ɵɵelementContainer(2, null, 9);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "span");
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(7, NavigatorNodeComponent_ng_template_6_i_7_Template, 1, 2, "i", 10);
    ɵngcc0.ɵɵelement(8, "c8y-popover-confirm", 11);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.node.loading && !ctx_r3.isRoot);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(6, 3, ctx_r3.node.label));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.node.hasChildren);
} }
const _c1 = function (a0, a1) { return { dragged: a0, disabled: a1 }; };
const _c2 = function (a0) { return { exact: a0 }; };
const _c3 = function (a0, a1, a2, a3) { return { "root-link": a0, open: a1, parent: a2, "dragged-hover": a3 }; };
export class NavigatorNodeComponent {
    constructor(componentFactoryResolver, navigator) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.navigator = navigator;
        /**
         * Event emitter responsible for broadcasting one of the following events: "icon", "expander" or "link" as string value.
         *
         * The type of event depends on where you click on the navigator node:
         * * clicking the icon will broadcast the event "icon",
         * * clicking the expander will broadcast the event "expander",
         * * clicking the label will broadcast the event "link".
         */
        this.nodeClick = new EventEmitter();
    }
    /**
     * @ignore
     */
    ngAfterViewInit() {
        this.childrenNodes.forEach(n => (n.parentNode = this));
        this.viewInitTimeout = setTimeout(() => {
            this.updateIcon();
            this.openOnFirstUrl();
            this.expandParentIfActive();
            this.node.confirm = this.confirm;
        });
    }
    /**
     * Expands the navigator node when the URL matches the path provided in the node.
     */
    openOnFirstUrl() {
        if (this.navigator.openOnFirstUrl(this.node) && !this.node.open) {
            this.expandCollapse(true);
        }
    }
    /**
     * Returns the expander title.
     */
    get expandTitle() {
        return !this.node.open ? 'Expand' : 'Collapse';
    }
    /**
     * Click event handler.
     *
     * @param {string} from Source of the click event.
     * @param event DOM event.
     */
    click(from = 'link', $event) {
        let open;
        switch (from) {
            case "expander" /* EXPANDER */:
                if ($event) {
                    $event.preventDefault();
                    $event.stopPropagation();
                }
                open = !this.node.open;
                break;
            case "icon" /* ICON */:
            case "link" /* LINK */:
                open = this.routerLinkActive && this.routerLinkActive.isActive ? true : !this.node.open;
                break;
        }
        this.handleExpandCollapse(open, from, $event);
        this.nodeClick.emit(from);
    }
    /**
     * Expands or collapses the navigator node and its children recursively.
     *
     * @param {boolean} open Open or close the node.
     * @param {boolean} recursive Open or close the children.
     * @param {ClickOptions} forNode Click options.
     */
    expandCollapse(open, recursive, forNode = {}) {
        this.node.open = open;
        if (recursive) {
            this.childrenNodes.forEach(n => n.expandCollapse(open, recursive));
        }
        forNode.open = open;
        this.node.click(forNode);
    }
    /**
     * @ignore
     */
    ngOnDestroy() {
        clearTimeout(this.viewInitTimeout);
        if (this.node) {
            this.node.destroy();
        }
    }
    handleExpandCollapse(open, from, $event) {
        if (open === this.node.open ||
            (this.node.path && !open && from !== "expander" /* EXPANDER */)) {
            return;
        }
        this.expandCollapse(open, false, { [from]: true, $event });
    }
    expandParentIfActive() {
        if (this.routerLinkActive && this.routerLinkActive.isActive && this.parentNode) {
            this.parentNode.expandCollapse(true);
        }
    }
    updateIcon() {
        if (this.node.iconTemplate) {
            this.updateIconTemplate();
        }
        else {
            this.updateIconComponent();
        }
    }
    updateIconComponent() {
        let componentType = NavigatorIconComponent;
        if (this.node && this.node.iconComponent) {
            componentType = this.node.iconComponent;
        }
        this.iconSlot.clear();
        const iconComponentFactory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        const componentRef = this.iconSlot.createComponent(iconComponentFactory);
        componentRef.instance.node = this.node;
    }
    updateIconTemplate() {
        this.iconSlot.clear();
        this.iconSlot.createEmbeddedView(this.node.iconTemplate);
    }
}
NavigatorNodeComponent.ɵfac = function NavigatorNodeComponent_Factory(t) { return new (t || NavigatorNodeComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.NavigatorService)); };
NavigatorNodeComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: NavigatorNodeComponent, selectors: [["c8y-navigator-node-display"]], viewQuery: function NavigatorNodeComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 5, ViewContainerRef);
        ɵngcc0.ɵɵviewQuery(RouterLinkActive, 5);
        ɵngcc0.ɵɵviewQuery(PopoverConfirmComponent, 5);
        ɵngcc0.ɵɵviewQuery(NavigatorNodeComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.iconSlot = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.routerLinkActive = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.confirm = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.childrenNodes = _t);
    } }, inputs: { node: "node", isRoot: "isRoot" }, outputs: { nodeClick: "nodeClick" }, decls: 8, vars: 23, consts: [[1, "slot", 3, "hidden", "draggable", "ngClass", "dragstart", "dragend", "drop"], ["draggable", "false", 1, "link", 3, "title", "routerLink", "routerLinkActive", "routerLinkActiveOptions", "ngClass", "dragover", "dragenter", "dragleave", "click"], [4, "ngTemplateOutlet"], ["class", "children panel-expand expand", 3, "collapse", "isAnimated", 4, "ngIf"], ["inner", ""], [1, "children", "panel-expand", "expand", 3, "collapse", "isAnimated"], [3, "node", "nodeClick", 4, "ngFor", "ngForOf"], [3, "node", "nodeClick"], ["class", "icon-spin loadingIndicator", 3, "c8yIcon", 4, "ngIf"], ["icon", ""], ["class", "expander", 3, "c8yIcon", "title", "click", 4, "ngIf"], ["outsideClick", "true", "containerClass", "navigator-popover"], [1, "icon-spin", "loadingIndicator", 3, "c8yIcon"], [1, "expander", 3, "c8yIcon", "title", "click"]], template: function NavigatorNodeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵlistener("dragstart", function NavigatorNodeComponent_Template_div_dragstart_0_listener($event) { return ctx.node.dragStart($event); })("dragend", function NavigatorNodeComponent_Template_div_dragend_0_listener($event) { return ctx.node.dragEnd($event); })("drop", function NavigatorNodeComponent_Template_div_drop_0_listener($event) { return ctx.node.drop($event); });
        ɵngcc0.ɵɵelementContainerStart(1);
        ɵngcc0.ɵɵelementStart(2, "a", 1);
        ɵngcc0.ɵɵlistener("dragover", function NavigatorNodeComponent_Template_a_dragover_2_listener($event) { return ctx.node.canDrop && $event.preventDefault(); })("dragenter", function NavigatorNodeComponent_Template_a_dragenter_2_listener($event) { return ctx.node.canDrop && ctx.node.dragEnter($event); })("dragleave", function NavigatorNodeComponent_Template_a_dragleave_2_listener($event) { return ctx.node.canDrop && ctx.node.dragLeave($event); })("click", function NavigatorNodeComponent_Template_a_click_2_listener($event) { return ctx.click(ctx.node.canNavigate ? "link" : "expander", $event); });
        ɵngcc0.ɵɵpipe(3, "translate");
        ɵngcc0.ɵɵtemplate(4, NavigatorNodeComponent_ng_container_4_Template, 1, 0, "ng-container", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵtemplate(5, NavigatorNodeComponent_div_5_Template, 2, 3, "div", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(6, NavigatorNodeComponent_ng_template_6_Template, 9, 5, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r2 = ɵngcc0.ɵɵreference(7);
        ɵngcc0.ɵɵproperty("hidden", ctx.node.hidden)("draggable", ctx.node.draggable)("ngClass", ɵngcc0.ɵɵpureFunction2(13, _c1, ctx.node.dragged, ctx.node.loading));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(3, 11, ctx.node.label));
        ɵngcc0.ɵɵproperty("routerLink", ctx.node.canNavigate ? ctx.node.path : undefined)("routerLinkActive", ctx.node.canNavigate ? "active" : "")("routerLinkActiveOptions", ɵngcc0.ɵɵpureFunction1(16, _c2, ctx.node.routerLinkExact))("ngClass", ɵngcc0.ɵɵpureFunction4(18, _c3, ctx.isRoot, ctx.node.open && ctx.node.hasChildren, ctx.node.hasChildren, ctx.node.draggedHover && !ctx.node.dragged));
        ɵngcc0.ɵɵattribute("id", ctx.isRoot ? ctx.node.id : undefined);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r2);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.node.children.length);
    } }, directives: [ɵngcc2.NgClass, ɵngcc3.RouterLinkWithHref, ɵngcc3.RouterLinkActive, ɵngcc2.NgTemplateOutlet, ɵngcc2.NgIf, ɵngcc4.CollapseDirective, ɵngcc2.NgForOf, NavigatorNodeComponent, ɵngcc5.PopoverConfirmComponent, ɵngcc6.IconDirective], pipes: [ɵngcc7.C8yTranslatePipe], encapsulation: 2 });
NavigatorNodeComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: NavigatorService }
];
NavigatorNodeComponent.propDecorators = {
    iconSlot: [{ type: ViewChild, args: ['icon', { read: ViewContainerRef, static: false },] }],
    node: [{ type: Input }],
    isRoot: [{ type: Input }],
    routerLinkActive: [{ type: ViewChild, args: [RouterLinkActive, { static: false },] }],
    childrenNodes: [{ type: ViewChildren, args: [NavigatorNodeComponent,] }],
    nodeClick: [{ type: Output }],
    confirm: [{ type: ViewChild, args: [PopoverConfirmComponent, { static: false },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NavigatorNodeComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-navigator-node-display',
                template: "<div\n  class=\"slot\"\n  [hidden]=\"node.hidden\"\n  (dragstart)=\"node.dragStart($event)\"\n  (dragend)=\"node.dragEnd($event)\"\n  (drop)=\"node.drop($event)\"\n  [draggable]=\"node.draggable\"\n  [ngClass]=\"{ dragged: node.dragged, disabled: node.loading }\"\n>\n  <ng-container>\n    <a\n      class=\"link\"\n      draggable=\"false\"\n      (dragover)=\"node.canDrop && $event.preventDefault()\"\n      (dragenter)=\"node.canDrop && node.dragEnter($event)\"\n      (dragleave)=\"node.canDrop && node.dragLeave($event)\"\n      title=\"{{node.label | translate}}\"\n      [attr.id]=\"isRoot ? node.id : undefined\"\n      [routerLink]=\"node.canNavigate ? node.path : undefined\"\n      [routerLinkActive]=\"node.canNavigate ? 'active' : ''\"\n      [routerLinkActiveOptions]=\"{exact:node.routerLinkExact}\"\n      (click)=\"click(node.canNavigate ? 'link' : 'expander', $event)\"\n      [ngClass]=\"{'root-link':isRoot, open: node.open && node.hasChildren, parent: node.hasChildren, 'dragged-hover': node.draggedHover && !node.dragged}\"\n    >\n      <ng-container *ngTemplateOutlet=\"inner\"></ng-container>\n    </a>\n  </ng-container>\n\n  <div\n    class=\"children panel-expand expand\"\n    *ngIf=\"node.children.length\"\n    [collapse]=\"!node.open\"\n    [isAnimated]=\"true\"\n  >\n    <c8y-navigator-node-display\n      *ngFor=\"let childNode of node.children\"\n      [node]=\"childNode\"\n      (nodeClick)=\"nodeClick.emit($event)\"\n    >\n    </c8y-navigator-node-display>\n  </div>\n</div>\n\n<ng-template #inner>\n  <!-- loader -->\n  <i\n    class=\"icon-spin loadingIndicator\"\n    [c8yIcon]=\"'circle-o-notch'\"\n    *ngIf=\"node.loading && !isRoot\"\n  >\n  </i>\n\n  <!-- icon -->\n  <div>\n    <ng-container #icon></ng-container>\n  </div>\n\n  <!--title  -->\n  <span>{{node.label | translate}}</span>\n\n  <i\n    class=\"expander\"\n    [c8yIcon]=\"'chevron-down'\"\n    *ngIf=\"node.hasChildren\"\n    (click)=\"click('expander', $event)\"\n    title=\"{{expandTitle}}\"\n  >\n  </i>\n\n  <c8y-popover-confirm\n    outsideClick=\"true\"\n    containerClass=\"navigator-popover\"\n  ></c8y-popover-confirm>\n</ng-template>\n"
            }]
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc1.NavigatorService }]; }, { nodeClick: [{
            type: Output
        }], iconSlot: [{
            type: ViewChild,
            args: ['icon', { read: ViewContainerRef, static: false }]
        }], node: [{
            type: Input
        }], isRoot: [{
            type: Input
        }], routerLinkActive: [{
            type: ViewChild,
            args: [RouterLinkActive, { static: false }]
        }], childrenNodes: [{
            type: ViewChildren,
            args: [NavigatorNodeComponent]
        }], confirm: [{
            type: ViewChild,
            args: [PopoverConfirmComponent, { static: false }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdG9yLW5vZGUuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL25hdmlnYXRvci9uYXZpZ2F0b3Itbm9kZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMkNBQTJDO0FBQzNDLE9BQU8sRUFDTCxTQUFTLEVBQ1Qsd0JBQXdCLEVBQ3hCLEtBQUssRUFFTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLGdCQUFnQixFQUNoQixNQUFNLEVBQ04sWUFBWSxFQUViLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRXBFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBUTdFO0FBQ0E7QUFDQSxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0gsTUFBTSxPQUFPLHNCQUFzQjtBQUFHLElBZ0RwQyxZQUNVLHdCQUFrRCxFQUNsRCxTQUEyQjtBQUNwQyxRQUZTLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7QUFBQyxRQUNuRCxjQUFTLEdBQVQsU0FBUyxDQUFrQjtBQUN2QyxRQXpCRTtBQUNGO0FBRUM7QUFBVztBQUNNO0FBQ007QUFDTTtBQUVBLFdBRHpCO0FBQ0wsUUFBWSxjQUFTLEdBQXlCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDakUsSUFnQkssQ0FBQztBQUNOLElBQ0U7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLGVBQWU7QUFDakIsUUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUs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QVUxQyxNQUFNO0FBQUssc0JBS1gsU0FBUyxTQUFDLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTtBQUFNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgSW5wdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW4sXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXJMaW5rQWN0aXZlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE5hdmlnYXRvckljb25Db21wb25lbnQgfSBmcm9tICcuL25hdmlnYXRvci1pY29uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOYXZpZ2F0b3JOb2RlLCBDbGlja09wdGlvbnMgfSBmcm9tICcuL25hdmlnYXRvci1ub2RlJztcbmltcG9ydCB7IE5hdmlnYXRvclNlcnZpY2UgfSBmcm9tICcuL25hdmlnYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IFBvcG92ZXJDb25maXJtQ29tcG9uZW50IH0gZnJvbSAnLi4vbW9kYWwvcG9wb3Zlci1jb25maXJtLmNvbXBvbmVudCc7XG5cbmV4cG9ydCBjb25zdCBlbnVtIENsaWNrRXZlbnRTb3VyY2Uge1xuICBJQ09OID0gJ2ljb24nLFxuICBFWFBBTkRFUiA9ICdleHBhbmRlcicsXG4gIExJTksgPSAnbGluaydcbn1cblxuLyoqXG4gKiBOYXZpZ2F0b3Igbm9kZSByZW5kZXJlci5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LW5hdmlnYXRvci1ub2RlLWRpc3BsYXknLFxuICB0ZW1wbGF0ZVVybDogJy4vbmF2aWdhdG9yLW5vZGUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIE5hdmlnYXRvck5vZGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgQFZpZXdDaGlsZCgnaWNvbicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiwgc3RhdGljOiBmYWxzZSB9KSBpY29uU2xvdDogVmlld0NvbnRhaW5lclJlZjtcblxuICAvKipcbiAgICogTmF2aWdhdG9yIG5vZGUuXG4gICAqL1xuICBASW5wdXQoKSBub2RlOiBOYXZpZ2F0b3JOb2RlO1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIG5hdmlnYXRvciBub2RlIGlzIGEgcm9vdCBub2RlICh0b3Agbm9kZSBpbiB0aGUgaGllcmFyY2h5KS5cbiAgICovXG4gIEBJbnB1dCgpIGlzUm9vdDogYm9vbGVhbjtcblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgQFZpZXdDaGlsZChSb3V0ZXJMaW5rQWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSkgcm91dGVyTGlua0FjdGl2ZTogUm91dGVyTGlua0FjdGl2ZTtcblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgQFZpZXdDaGlsZHJlbihOYXZpZ2F0b3JOb2RlQ29tcG9uZW50KSBjaGlsZHJlbk5vZGVzOiBRdWVyeUxpc3Q8TmF2aWdhdG9yTm9kZUNvbXBvbmVudD47XG5cbiAgLyoqXG4gICAqIEV2ZW50IGVtaXR0ZXIgcmVzcG9uc2libGUgZm9yIGJyb2FkY2FzdGluZyBvbmUgb2YgdGhlIGZvbGxvd2luZyBldmVudHM6IFwiaWNvblwiLCBcImV4cGFuZGVyXCIgb3IgXCJsaW5rXCIgYXMgc3RyaW5nIHZhbHVlLlxuICAgKlxuICAgKiBUaGUgdHlwZSBvZiBldmVudCBkZXBlbmRzIG9uIHdoZXJlIHlvdSBjbGljayBvbiB0aGUgbmF2aWdhdG9yIG5vZGU6XG4gICAqICogY2xpY2tpbmcgdGhlIGljb24gd2lsbCBicm9hZGNhc3QgdGhlIGV2ZW50IFwiaWNvblwiLFxuICAgKiAqIGNsaWNraW5nIHRoZSBleHBhbmRlciB3aWxsIGJyb2FkY2FzdCB0aGUgZXZlbnQgXCJleHBhbmRlclwiLFxuICAgKiAqIGNsaWNraW5nIHRoZSBsYWJlbCB3aWxsIGJyb2FkY2FzdCB0aGUgZXZlbnQgXCJsaW5rXCIuXG4gICAqL1xuICBAT3V0cHV0KCkgbm9kZUNsaWNrOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgQFZpZXdDaGlsZChQb3BvdmVyQ29uZmlybUNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pIGNvbmZpcm06IFBvcG92ZXJDb25maXJtQ29tcG9uZW50O1xuXG4gIC8qKlxuICAgKiBQYXJlbnQgbm9kZSByZW5kZXJlci5cbiAgICovXG4gIHBhcmVudE5vZGU6IE5hdmlnYXRvck5vZGVDb21wb25lbnQ7XG5cbiAgcHJpdmF0ZSB2aWV3SW5pdFRpbWVvdXQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIG5hdmlnYXRvcjogTmF2aWdhdG9yU2VydmljZVxuICApIHt9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmNoaWxkcmVuTm9kZXMuZm9yRWFjaChuID0+IChuLnBhcmVudE5vZGUgPSB0aGlzKSk7XG4gICAgdGhpcy52aWV3SW5pdFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlSWNvbigpO1xuICAgICAgdGhpcy5vcGVuT25GaXJzdFVybCgpO1xuICAgICAgdGhpcy5leHBhbmRQYXJlbnRJZkFjdGl2ZSgpO1xuICAgICAgdGhpcy5ub2RlLmNvbmZpcm0gPSB0aGlzLmNvbmZpcm07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRXhwYW5kcyB0aGUgbmF2aWdhdG9yIG5vZGUgd2hlbiB0aGUgVVJMIG1hdGNoZXMgdGhlIHBhdGggcHJvdmlkZWQgaW4gdGhlIG5vZGUuXG4gICAqL1xuICBvcGVuT25GaXJzdFVybCgpIHtcbiAgICBpZiAodGhpcy5uYXZpZ2F0b3Iub3Blbk9uRmlyc3RVcmwodGhpcy5ub2RlKSAmJiAhdGhpcy5ub2RlLm9wZW4pIHtcbiAgICAgIHRoaXMuZXhwYW5kQ29sbGFwc2UodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGV4cGFuZGVyIHRpdGxlLlxuICAgKi9cbiAgZ2V0IGV4cGFuZFRpdGxlKCkge1xuICAgIHJldHVybiAhdGhpcy5ub2RlLm9wZW4gPyAnRXhwYW5kJyA6ICdDb2xsYXBzZSc7XG4gIH1cblxuICAvKipcbiAgICogQ2xpY2sgZXZlbnQgaGFuZGxlci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZyb20gU291cmNlIG9mIHRoZSBjbGljayBldmVudC5cbiAgICogQHBhcmFtIGV2ZW50IERPTSBldmVudC5cbiAgICovXG4gIGNsaWNrKGZyb206ICdpY29uJyB8ICdleHBhbmRlcicgfCAnbGluaycgPSAnbGluaycsICRldmVudD86IE1vdXNlRXZlbnQpIHtcbiAgICBsZXQgb3BlbjogYm9vbGVhbjtcblxuICAgIHN3aXRjaCAoZnJvbSkge1xuICAgICAgY2FzZSBDbGlja0V2ZW50U291cmNlLkVYUEFOREVSOlxuICAgICAgICBpZiAoJGV2ZW50KSB7XG4gICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIG9wZW4gPSAhdGhpcy5ub2RlLm9wZW47XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDbGlja0V2ZW50U291cmNlLklDT046XG4gICAgICBjYXNlIENsaWNrRXZlbnRTb3VyY2UuTElOSzpcbiAgICAgICAgb3BlbiA9IHRoaXMucm91dGVyTGlua0FjdGl2ZSAmJiB0aGlzLnJvdXRlckxpbmtBY3RpdmUuaXNBY3RpdmUgPyB0cnVlIDogIXRoaXMubm9kZS5vcGVuO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgdGhpcy5oYW5kbGVFeHBhbmRDb2xsYXBzZShvcGVuLCBmcm9tLCAkZXZlbnQpO1xuICAgIHRoaXMubm9kZUNsaWNrLmVtaXQoZnJvbSk7XG4gIH1cblxuICAvKipcbiAgICogRXhwYW5kcyBvciBjb2xsYXBzZXMgdGhlIG5hdmlnYXRvciBub2RlIGFuZCBpdHMgY2hpbGRyZW4gcmVjdXJzaXZlbHkuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3BlbiBPcGVuIG9yIGNsb3NlIHRoZSBub2RlLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlY3Vyc2l2ZSBPcGVuIG9yIGNsb3NlIHRoZSBjaGlsZHJlbi5cbiAgICogQHBhcmFtIHtDbGlja09wdGlvbnN9IGZvck5vZGUgQ2xpY2sgb3B0aW9ucy5cbiAgICovXG4gIGV4cGFuZENvbGxhcHNlKG9wZW4sIHJlY3Vyc2l2ZT8sIGZvck5vZGU6IENsaWNrT3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5ub2RlLm9wZW4gPSBvcGVuO1xuICAgIGlmIChyZWN1cnNpdmUpIHtcbiAgICAgIHRoaXMuY2hpbGRyZW5Ob2Rlcy5mb3JFYWNoKG4gPT4gbi5leHBhbmRDb2xsYXBzZShvcGVuLCByZWN1cnNpdmUpKTtcbiAgICB9XG4gICAgZm9yTm9kZS5vcGVuID0gb3BlbjtcbiAgICB0aGlzLm5vZGUuY2xpY2soZm9yTm9kZSk7XG4gIH1cblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudmlld0luaXRUaW1lb3V0KTtcblxuICAgIGlmICh0aGlzLm5vZGUpIHtcbiAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFeHBhbmRDb2xsYXBzZShvcGVuLCBmcm9tLCAkZXZlbnQpIHtcbiAgICBpZiAoXG4gICAgICBvcGVuID09PSB0aGlzLm5vZGUub3BlbiB8fFxuICAgICAgKHRoaXMubm9kZS5wYXRoICYmICFvcGVuICYmIGZyb20gIT09IENsaWNrRXZlbnRTb3VyY2UuRVhQQU5ERVIpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZXhwYW5kQ29sbGFwc2Uob3BlbiwgZmFsc2UsIHsgW2Zyb21dOiB0cnVlLCAkZXZlbnQgfSk7XG4gIH1cblxuICBwcml2YXRlIGV4cGFuZFBhcmVudElmQWN0aXZlKCkge1xuICAgIGlmICh0aGlzLnJvdXRlckxpbmtBY3RpdmUgJiYgdGhpcy5yb3V0ZXJMaW5rQWN0aXZlLmlzQWN0aXZlICYmIHRoaXMucGFyZW50Tm9kZSkge1xuICAgICAgdGhpcy5wYXJlbnROb2RlLmV4cGFuZENvbGxhcHNlKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlSWNvbigpIHtcbiAgICBpZiAodGhpcy5ub2RlLmljb25UZW1wbGF0ZSkge1xuICAgICAgdGhpcy51cGRhdGVJY29uVGVtcGxhdGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cGRhdGVJY29uQ29tcG9uZW50KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVJY29uQ29tcG9uZW50KCkge1xuICAgIGxldCBjb21wb25lbnRUeXBlID0gTmF2aWdhdG9ySWNvbkNvbXBvbmVudDtcbiAgICBpZiAodGhpcy5ub2RlICYmIHRoaXMubm9kZS5pY29uQ29tcG9uZW50KSB7XG4gICAgICBjb21wb25lbnRUeXBlID0gdGhpcy5ub2RlLmljb25Db21wb25lbnQ7XG4gICAgfVxuICAgIHRoaXMuaWNvblNsb3QuY2xlYXIoKTtcbiAgICBjb25zdCBpY29uQ29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFxuICAgICAgY29tcG9uZW50VHlwZVxuICAgICk7XG4gICAgY29uc3QgY29tcG9uZW50UmVmID0gdGhpcy5pY29uU2xvdC5jcmVhdGVDb21wb25lbnQoaWNvbkNvbXBvbmVudEZhY3RvcnkpO1xuICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5ub2RlID0gdGhpcy5ub2RlO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVJY29uVGVtcGxhdGUoKSB7XG4gICAgdGhpcy5pY29uU2xvdC5jbGVhcigpO1xuICAgIHRoaXMuaWNvblNsb3QuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMubm9kZS5pY29uVGVtcGxhdGUpO1xuICB9XG59XG4iXX0=