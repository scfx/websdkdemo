import { __awaiter } from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { UserService, TenantLoginOptionsService, TenantService } from '@c8y/client';
import { clone } from 'lodash-es';
import { AppStateService } from '../common/ui-state.service';
import { TranslateService } from '../i18n/translate.service';
import { BsModalService } from 'ngx-bootstrap/modal';
import { PasswordService } from '../authentication/password.service';
import { UserTotpSetupComponent } from './user-totp-setup.component';
import { AlertService } from '../alert/alert.service';
import { ModalService } from '../modal/modal.service';
import { UserPreferencesService } from '../common/user-preferences/user-preferences.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../common/ui-state.service';
import * as ɵngcc2 from '../i18n/translate.service';
import * as ɵngcc3 from '../authentication/password.service';
import * as ɵngcc4 from '../modal/modal.service';
import * as ɵngcc5 from 'ngx-bootstrap/modal';
import * as ɵngcc6 from '../alert/alert.service';
import * as ɵngcc7 from '@c8y/client';
import * as ɵngcc8 from '../common/user-preferences/user-preferences.service';
import * as ɵngcc9 from '@angular/forms';
import * as ɵngcc10 from '@angular/common';
import * as ɵngcc11 from '../forms/form-group.component';
import * as ɵngcc12 from '../i18n/c8y-translate.directive';
import * as ɵngcc13 from '../forms/required-input-placeholder.directive';
import * as ɵngcc14 from '../forms/default-validation.directive';
import * as ɵngcc15 from '../forms/phone-validation.directive';
import * as ɵngcc16 from '../authentication/new-password.component';
import * as ɵngcc17 from '../i18n/c8y-translate.pipe';

function UserEditComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 29);
    ɵngcc0.ɵɵtext(1, " Some of the user settings are not editable here because they are managed via your authorization server. ");
    ɵngcc0.ɵɵelementEnd();
} }
function UserEditComponent_option_40_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "option", 30);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const lang_r7 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("value", lang_r7);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r3.translate.getNativeLanguage(lang_r7));
} }
function UserEditComponent_c8y_form_group_42_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(1, "strong", 32);
    ɵngcc0.ɵɵtext(2, "Product experience");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "label", 33);
    ɵngcc0.ɵɵelementStart(4, "input", 34);
    ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_c8y_form_group_42_Template_input_ngModelChange_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(); return ctx_r8.isUsageTrackingEnabled = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(5, "span");
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r4.isUsageTrackingEnabled);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(7, 2, "Enable anonymous tracking to enhance the product experience"), " ");
} }
function UserEditComponent_div_43_button_5_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 27);
    ɵngcc0.ɵɵlistener("click", function UserEditComponent_div_43_button_5_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.setupTotp(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, "Set up two-factor authentication"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, "Set up two-factor authentication"), " ");
} }
function UserEditComponent_div_43_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 35);
    ɵngcc0.ɵɵelementStart(1, "label", 36);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "c8y-new-password", 37);
    ɵngcc0.ɵɵlistener("password", function UserEditComponent_div_43_Template_c8y_new_password_password_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.onNewPasswordChanged($event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(5, UserEditComponent_div_43_button_5_Template, 4, 6, "button", 38);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 2, "Login options"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.userCanSetupTotp && !ctx_r5.userHasActiveTotp && ctx_r5.isTfaEnabled);
} }
function UserEditComponent_c8y_form_group_44_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(1, "label", 32);
    ɵngcc0.ɵɵtext(2, "Newsletter");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "label", 39);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementStart(5, "input", 40);
    ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_c8y_form_group_44_Template_input_ngModelChange_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.user.newsletter = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(6, "span");
    ɵngcc0.ɵɵelementStart(7, "span");
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(4, 4, "Send me information about outages, maintenance or updates."));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r6.user.newsletter)("disabled", ctx_r6.userIsExternal);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 6, "Send me information about outages, maintenance or updates."), " ");
} }
export class UserEditComponent {
    constructor(state, translate, passwordService, modalConfirmService, bsModalService, alert, userService, tenantLoginOptionsService, tenantService, userPreferencesService) {
        this.state = state;
        this.translate = translate;
        this.passwordService = passwordService;
        this.modalConfirmService = modalConfirmService;
        this.bsModalService = bsModalService;
        this.alert = alert;
        this.userService = userService;
        this.tenantLoginOptionsService = tenantLoginOptionsService;
        this.tenantService = tenantService;
        this.userPreferencesService = userPreferencesService;
        this.loading = false;
        this.showProductUsageSetting = false;
        this.isUsageTrackingEnabled = true;
        this.onUser = new EventEmitter();
        this.onLanguage = new EventEmitter();
        this.onProductExperience = new EventEmitter();
        this.onCancel = new EventEmitter();
        this.userHasActiveTotp = false;
        this.userCanSetupTotp = false;
        this.isPhoneRequired = false;
    }
    set user(u) {
        if (u) {
            this._user = clone(u);
            this.userIsExternal = u.customProperties.userOrigin === 'OAUTH2';
            this.isPhoneRequired = this.isPhoneRequired && u.twoFactorAuthenticationEnabled;
        }
    }
    get user() {
        return this._user;
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            const currentTenant = (yield this.tenantService.current()).data;
            const { enabledOnSystemLevel, enabledOnTenantLevel } = yield this.tenantService.getTfaSettings(currentTenant);
            this.isTfaEnabled = enabledOnSystemLevel || enabledOnTenantLevel;
            yield this.initializeTotpSettings();
            if (this.user.twoFactorAuthenticationEnabled && !this.userCanSetupTotp) {
                this.isPhoneRequired = true;
            }
        });
    }
    get langs() {
        return this.state.state.langs;
    }
    setupTotp() {
        this.bsModalService.show(UserTotpSetupComponent, { class: 'modal-sm' });
        this.cancel(); // to close the user edit modal and prevent console errors on logout
    }
    cancel() {
        this.onCancel.emit();
    }
    save() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.loading) {
                return;
            }
            if (this.showProductUsageSetting) {
                this.onProductExperience.emit(this.isUsageTrackingEnabled);
                this.userPreferencesService.set('gainsightEnabled', this.isUsageTrackingEnabled);
            }
            this._user.password ? this.saveAfterPasswordConfirmation() : this.onUser.emit(this._user);
        });
    }
    onNewPasswordChanged(newPassword) {
        this._user.password = newPassword.password;
    }
    initializeTotpSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                this.userCanSetupTotp = yield this.canUserSetupTotp();
                if (this.userCanSetupTotp) {
                    const { data: totpActivity } = yield this.userService.getActivityTotp();
                    this.userHasActiveTotp = totpActivity.isActive;
                }
            }
            catch (ex) {
                this.alert.removeLastDanger();
            }
        });
    }
    canUserSetupTotp() {
        return __awaiter(this, void 0, void 0, function* () {
            // we don't check for tenant options here due to permission restrictions on that end-point
            const loginOptions = (yield this.tenantLoginOptionsService.listForCurrentTenant()).data;
            return loginOptions.some(({ tfaStrategy = '' }) => tfaStrategy.toLowerCase() === 'totp');
        });
    }
    saveAfterPasswordConfirmation() {
        this.passwordService.confirmPassword().subscribe(confirmed => {
            if (confirmed) {
                this.onUser.emit(this._user);
            }
        });
    }
}
UserEditComponent.ɵfac = function UserEditComponent_Factory(t) { return new (t || UserEditComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AppStateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.PasswordService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.BsModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc6.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc7.UserService), ɵngcc0.ɵɵdirectiveInject(ɵngcc7.TenantLoginOptionsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc7.TenantService), ɵngcc0.ɵɵdirectiveInject(ɵngcc8.UserPreferencesService)); };
UserEditComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: UserEditComponent, selectors: [["c8y-user-edit"]], inputs: { loading: "loading", showProductUsageSetting: "showProductUsageSetting", isUsageTrackingEnabled: "isUsageTrackingEnabled", user: "user", lang: "lang" }, outputs: { onUser: "onUser", onLanguage: "onLanguage", onProductExperience: "onProductExperience", onCancel: "onCancel" }, decls: 55, vars: 49, consts: [[3, "ngSubmit"], ["userForm", "ngForm"], ["class", "alert alert-warning", "role", "alert", "translate", "", 4, "ngIf"], ["translate", "", "for", "userName"], ["id", "userName", "name", "userName", "autocomplete", "off", "required", "", "maxlength", "254", "c8yDefaultValidation", "user", 1, "form-control", 3, "ngModel", "placeholder", "disabled", "ngModelChange"], ["translate", "", "for", "displayName"], ["id", "displayName", "name", "displayName", "autocomplete", "off", "maxlength", "254", "c8yDefaultValidation", "loginAlias", 1, "form-control", 3, "ngModel", "placeholder", "disabled", "ngModelChange"], [3, "hasWarning"], ["translate", "", "for", "userEmail"], ["id", "userEmail", "type", "email", "name", "email", "autocomplete", "off", "email", "", 1, "form-control", 3, "maxlength", "placeholder", "ngModel", "required", "disabled", "ngModelChange"], [1, "row", 2, "margin-left", "-15px", "margin-right", "-15px"], [1, "col-sm-6"], ["translate", "", "for", "userFirstName"], ["id", "userFirstName", "autocomplete", "off", "maxlength", "50", "name", "firstName", 1, "form-control", 3, "ngModel", "disabled", "ngModelChange"], ["translate", "", "for", "userLastName"], ["id", "userLastName", "autocomplete", "off", "maxlength", "50", "name", "lastName", 1, "form-control", 3, "ngModel", "disabled", "ngModelChange"], ["translate", "", "for", "userTelephone"], ["id", "userTelephone", "autocomplete", "off", "name", "phone", "maxlength", "254", "c8yPhoneValidation", "", "c8yDefaultValidation", "phoneNumber", 1, "form-control", 3, "ngModel", "placeholder", "required", "disabled", "ngModelChange"], ["translate", "", "for", "userLang"], [1, "c8y-select-wrapper"], ["id", "userLang", "name", "lang", 1, "form-control", 3, "ngModel", "ngModelChange", "change"], ["selectLang", ""], [3, "value", 4, "ngFor", "ngForOf"], ["class", "p-t-8 p-b-8 separator-top", 4, "ngIf"], ["class", "form-group", 4, "ngIf"], [4, "ngIf"], [1, "modal-footer"], ["type", "button", 1, "btn", "btn-default", 3, "title", "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "title", "disabled"], ["role", "alert", "translate", "", 1, "alert", "alert-warning"], [3, "value"], [1, "p-t-8", "p-b-8", "separator-top"], ["translate", ""], ["for", "productUsageTracking", 1, "c8y-switch"], ["id", "productUsageTracking", "name", "productUsageTracking", "type", "checkbox", 3, "ngModel", "ngModelChange"], [1, "form-group"], [1, "control-label"], [3, "password"], ["class", "btn btn-default", "type", "button", 3, "title", "click", 4, "ngIf"], [1, "c8y-checkbox", 3, "title"], ["type", "checkbox", "name", "newsletter", 3, "ngModel", "disabled", "ngModelChange"]], template: function UserEditComponent_Template(rf, ctx) { if (rf & 1) {
        const _r17 = ɵngcc0.ɵɵgetCurrentView();
        ɵngcc0.ɵɵelementStart(0, "form", 0, 1);
        ɵngcc0.ɵɵlistener("ngSubmit", function UserEditComponent_Template_form_ngSubmit_0_listener() { ɵngcc0.ɵɵrestoreView(_r17); const _r0 = ɵngcc0.ɵɵreference(1); return _r0.form.valid && ctx.save(); });
        ɵngcc0.ɵɵtemplate(2, UserEditComponent_div_2_Template, 2, 0, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(4, "label", 3);
        ɵngcc0.ɵɵtext(5, "Username (e.g. email)");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "input", 4);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_6_listener($event) { return ctx.user.userName = $event; });
        ɵngcc0.ɵɵpipe(7, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(9, "label", 5);
        ɵngcc0.ɵɵtext(10, "Login alias");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "input", 6);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_11_listener($event) { return ctx.user.displayName = $event; });
        ɵngcc0.ɵɵpipe(12, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(13, "c8y-form-group", 7);
        ɵngcc0.ɵɵelementStart(14, "label", 8);
        ɵngcc0.ɵɵtext(15, "Email");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(16, "input", 9);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_16_listener($event) { return ctx.user.email = $event; });
        ɵngcc0.ɵɵpipe(17, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(18, "div", 10);
        ɵngcc0.ɵɵelementStart(19, "div", 11);
        ɵngcc0.ɵɵelementStart(20, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(21, "label", 12);
        ɵngcc0.ɵɵtext(22, "First name");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(23, "input", 13);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_23_listener($event) { return ctx.user.firstName = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(24, "div", 11);
        ɵngcc0.ɵɵelementStart(25, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(26, "label", 14);
        ɵngcc0.ɵɵtext(27, "Last name");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(28, "input", 15);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_28_listener($event) { return ctx.user.lastName = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(29, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(30, "label", 16);
        ɵngcc0.ɵɵtext(31, "Telephone");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(32, "input", 17);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_input_ngModelChange_32_listener($event) { return ctx.user.phone = $event; });
        ɵngcc0.ɵɵpipe(33, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(34, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(35, "label", 18);
        ɵngcc0.ɵɵtext(36, "Language");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(37, "div", 19);
        ɵngcc0.ɵɵelementStart(38, "select", 20, 21);
        ɵngcc0.ɵɵlistener("ngModelChange", function UserEditComponent_Template_select_ngModelChange_38_listener($event) { return ctx.lang = $event; })("change", function UserEditComponent_Template_select_change_38_listener() { ɵngcc0.ɵɵrestoreView(_r17); const _r2 = ɵngcc0.ɵɵreference(39); return ctx.onLanguage.emit(_r2.value); });
        ɵngcc0.ɵɵtemplate(40, UserEditComponent_option_40_Template, 2, 2, "option", 22);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(41, "span");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(42, UserEditComponent_c8y_form_group_42_Template, 8, 4, "c8y-form-group", 23);
        ɵngcc0.ɵɵtemplate(43, UserEditComponent_div_43_Template, 6, 4, "div", 24);
        ɵngcc0.ɵɵtemplate(44, UserEditComponent_c8y_form_group_44_Template, 10, 8, "c8y-form-group", 25);
        ɵngcc0.ɵɵpipe(45, "async");
        ɵngcc0.ɵɵelementStart(46, "div", 26);
        ɵngcc0.ɵɵelementStart(47, "button", 27);
        ɵngcc0.ɵɵlistener("click", function UserEditComponent_Template_button_click_47_listener() { return ctx.cancel(); });
        ɵngcc0.ɵɵpipe(48, "translate");
        ɵngcc0.ɵɵtext(49);
        ɵngcc0.ɵɵpipe(50, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(51, "button", 28);
        ɵngcc0.ɵɵpipe(52, "translate");
        ɵngcc0.ɵɵtext(53);
        ɵngcc0.ɵɵpipe(54, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        const _r0 = ɵngcc0.ɵɵreference(1);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(7, 31, "e.g. joe.doe@example.com`LOCALIZE`"));
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.userName)("disabled", ctx.user.id);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(12, 33, "e.g. joe.doe`LOCALIZE`"));
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.displayName)("disabled", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("hasWarning", !ctx.user.email);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(17, 35, "e.g. joe.doe@example.com`LOCALIZE`"));
        ɵngcc0.ɵɵproperty("maxlength", 254)("ngModel", ctx.user.email)("required", true)("disabled", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.firstName)("disabled", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.lastName)("disabled", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(33, 37, "e.g. +49 9 876 543 210`LOCALIZE`"));
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.phone)("required", ctx.isPhoneRequired)("disabled", ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngModel", ctx.lang);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.langs);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showProductUsageSetting);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.userIsExternal);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !!ɵngcc0.ɵɵpipeBind1(45, 39, ctx.state.state$).newsletter);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(48, 41, "Cancel"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(50, 43, "Cancel"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(52, 45, "Save"));
        ɵngcc0.ɵɵproperty("disabled", !_r0.form.valid || _r0.form.pristine || ctx.loading);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(54, 47, "Save"), " ");
    } }, directives: [ɵngcc9.ɵNgNoValidate, ɵngcc9.NgControlStatusGroup, ɵngcc9.NgForm, ɵngcc10.NgIf, ɵngcc11.FormGroupComponent, ɵngcc12.C8yTranslateDirective, ɵngcc13.RequiredInputPlaceholderDirective, ɵngcc9.DefaultValueAccessor, ɵngcc9.RequiredValidator, ɵngcc9.MaxLengthValidator, ɵngcc14.DefaultValidationDirective, ɵngcc9.NgControlStatus, ɵngcc9.NgModel, ɵngcc9.EmailValidator, ɵngcc15.PhoneValidationDirective, ɵngcc9.SelectControlValueAccessor, ɵngcc10.NgForOf, ɵngcc9.NgSelectOption, ɵngcc9.ɵNgSelectMultipleOption, ɵngcc9.CheckboxControlValueAccessor, ɵngcc16.NewPasswordComponent], pipes: [ɵngcc17.C8yTranslatePipe, ɵngcc10.AsyncPipe], encapsulation: 2 });
UserEditComponent.ctorParameters = () => [
    { type: AppStateService },
    { type: TranslateService },
    { type: PasswordService },
    { type: ModalService },
    { type: BsModalService },
    { type: AlertService },
    { type: UserService },
    { type: TenantLoginOptionsService },
    { type: TenantService },
    { type: UserPreferencesService }
];
UserEditComponent.propDecorators = {
    lang: [{ type: Input }],
    loading: [{ type: Input }],
    user: [{ type: Input }],
    showProductUsageSetting: [{ type: Input }],
    isUsageTrackingEnabled: [{ type: Input }],
    onUser: [{ type: Output }],
    onLanguage: [{ type: Output }],
    onProductExperience: [{ type: Output }],
    onCancel: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(UserEditComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-user-edit',
                template: "<form #userForm=\"ngForm\" (ngSubmit)=\"userForm.form.valid && save()\">\n  <div class=\"alert alert-warning\" role=\"alert\" *ngIf=\"userIsExternal\" translate>\n    Some of the user settings are not editable here because they are managed via your authorization\n    server.\n  </div>\n  <c8y-form-group>\n    <label translate for=\"userName\">Username (e.g. email)</label>\n    <input\n      id=\"userName\"\n      class=\"form-control\"\n      [(ngModel)]=\"user.userName\"\n      name=\"userName\"\n      autocomplete=\"off\"\n      required\n      maxlength=\"254\"\n      placeholder=\"{{ 'e.g. joe.doe@example.com`LOCALIZE`' | translate }}\"\n      [disabled]=\"user.id\"\n      c8yDefaultValidation=\"user\"\n    />\n  </c8y-form-group>\n\n  <c8y-form-group>\n    <label translate for=\"displayName\">Login alias</label>\n    <input\n      id=\"displayName\"\n      class=\"form-control\"\n      [(ngModel)]=\"user.displayName\"\n      name=\"displayName\"\n      autocomplete=\"off\"\n      maxlength=\"254\"\n      placeholder=\"{{ 'e.g. joe.doe`LOCALIZE`' | translate }}\"\n      [disabled]=\"userIsExternal\"\n      c8yDefaultValidation=\"loginAlias\"\n    />\n  </c8y-form-group>\n\n  <c8y-form-group [hasWarning]=\"!user.email\">\n    <label translate for=\"userEmail\">Email</label>\n    <input\n      id=\"userEmail\"\n      class=\"form-control\"\n      type=\"email\"\n      name=\"email\"\n      [maxlength]=\"254\"\n      autocomplete=\"off\"\n      placeholder=\"{{ 'e.g. joe.doe@example.com`LOCALIZE`' | translate }}\"\n      [(ngModel)]=\"user.email\"\n      email\n      [required]=\"true\"\n      [disabled]=\"userIsExternal\"\n    />\n  </c8y-form-group>\n\n  <div class=\"row\" style=\"margin-left:-15px; margin-right:-15px\">\n    <div class=\"col-sm-6\">\n      <c8y-form-group>\n        <label translate for=\"userFirstName\">First name</label>\n        <input\n          id=\"userFirstName\"\n          class=\"form-control\"\n          autocomplete=\"off\"\n          maxlength=\"50\"\n          name=\"firstName\"\n          [(ngModel)]=\"user.firstName\"\n          [disabled]=\"userIsExternal\"\n        />\n      </c8y-form-group>\n    </div>\n    <div class=\"col-sm-6\">\n      <c8y-form-group>\n        <label translate for=\"userLastName\">Last name</label>\n        <input\n          id=\"userLastName\"\n          class=\"form-control\"\n          autocomplete=\"off\"\n          maxlength=\"50\"\n          name=\"lastName\"\n          [(ngModel)]=\"user.lastName\"\n          [disabled]=\"userIsExternal\"\n        />\n      </c8y-form-group>\n    </div>\n  </div>\n\n  <c8y-form-group>\n    <label translate for=\"userTelephone\">Telephone</label>\n    <input\n      id=\"userTelephone\"\n      class=\"form-control\"\n      autocomplete=\"off\"\n      name=\"phone\"\n      maxlength=\"254\"\n      [(ngModel)]=\"user.phone\"\n      placeholder=\"{{ 'e.g. +49 9 876 543 210`LOCALIZE`' | translate }}\"\n      c8yPhoneValidation\n      c8yDefaultValidation=\"phoneNumber\"\n      [required]=\"isPhoneRequired\"\n      [disabled]=\"userIsExternal\"\n    />\n  </c8y-form-group>\n\n  <c8y-form-group>\n    <label translate for=\"userLang\">Language</label>\n    <div class=\"c8y-select-wrapper\">\n      <select\n        id=\"userLang\"\n        class=\"form-control\"\n        #selectLang\n        name=\"lang\"\n        [(ngModel)]=\"lang\"\n        (change)=\"onLanguage.emit(selectLang.value)\"\n      >\n        <option *ngFor=\"let lang of langs\" [value]=\"lang\">{{\n          translate.getNativeLanguage(lang)\n        }}</option>\n      </select>\n      <span></span>\n    </div>\n  </c8y-form-group>\n\n  <c8y-form-group class=\"p-t-8 p-b-8 separator-top\" *ngIf=\"showProductUsageSetting\">\n    <strong translate>Product experience</strong>\n    <label class=\"c8y-switch\" for=\"productUsageTracking\">\n      <input\n        id=\"productUsageTracking\"\n        name=\"productUsageTracking\"\n        type=\"checkbox\"\n        [(ngModel)]=\"isUsageTrackingEnabled\"\n      />\n      <span></span>\n      {{ 'Enable anonymous tracking to enhance the product experience' | translate }}\n    </label>\n  </c8y-form-group>\n\n  <div class=\"form-group\" *ngIf=\"!userIsExternal\">\n    <label class=\"control-label\">{{ 'Login options' | translate }}</label>\n    <c8y-new-password (password)=\"onNewPasswordChanged($event)\"></c8y-new-password>\n    <button\n      title=\"{{ 'Set up two-factor authentication' | translate }}\"\n      class=\"btn btn-default\"\n      type=\"button\"\n      (click)=\"setupTotp()\"\n      *ngIf=\"userCanSetupTotp && !userHasActiveTotp && isTfaEnabled\"\n    >\n      {{ 'Set up two-factor authentication' | translate }}\n    </button>\n  </div>\n\n  <c8y-form-group *ngIf=\"!!(state.state$ | async).newsletter\">\n    <label translate>Newsletter</label>\n    <label\n      title=\"{{ 'Send me information about outages, maintenance or updates.' | translate }}\"\n      class=\"c8y-checkbox\"\n    >\n      <input\n        type=\"checkbox\"\n        name=\"newsletter\"\n        [(ngModel)]=\"user.newsletter\"\n        [disabled]=\"userIsExternal\"\n      />\n      <span></span>\n      <span>\n        {{ 'Send me information about outages, maintenance or updates.' | translate }}\n      </span>\n    </label>\n  </c8y-form-group>\n\n  <div class=\"modal-footer\">\n    <button\n      title=\"{{ 'Cancel' | translate }}\"\n      class=\"btn btn-default\"\n      type=\"button\"\n      (click)=\"cancel()\"\n    >\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Save' | translate }}\"\n      class=\"btn btn-primary\"\n      type=\"submit\"\n      [disabled]=\"!userForm.form.valid || userForm.form.pristine || loading\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n"
            }]
    }], function () { return [{ type: ɵngcc1.AppStateService }, { type: ɵngcc2.TranslateService }, { type: ɵngcc3.PasswordService }, { type: ɵngcc4.ModalService }, { type: ɵngcc5.BsModalService }, { type: ɵngcc6.AlertService }, { type: ɵngcc7.UserService }, { type: ɵngcc7.TenantLoginOptionsService }, { type: ɵngcc7.TenantService }, { type: ɵngcc8.UserPreferencesService }]; }, { loading: [{
            type: Input
        }], showProductUsageSetting: [{
            type: Input
        }], isUsageTrackingEnabled: [{
            type: Input
        }], onUser: [{
            type: Output
        }], onLanguage: [{
            type: Output
        }], onProductExperience: [{
            type: Output
        }], onCancel: [{
            type: Output
        }], user: [{
            type: Input
        }], lang: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1lZGl0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS91c2VyL3VzZXItZWRpdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBRWIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFTLFdBQVcsRUFBRSx5QkFBeUIsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDM0YsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNsQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFN0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFZN0YsTUFBTSxPQUFPLGlCQUFpQjtBQUFHLElBMkIvQixZQUNTLEtBQXNCLEVBQ3RCLFNBQTJCLEVBQzNCLGVBQWdDLEVBQ2hDLG1CQUFpQyxFQUNoQyxjQUE4QixFQUM5QixLQUFtQixFQUNuQixXQUF3QixFQUN4Qix5QkFBb0QsRUFDcEQsYUFBNEIsRUFDNUIsc0JBQThDO0FBQ3ZELFFBVlEsVUFBSyxHQUFMLEtBQUssQ0FBaUI7QUFBQyxRQUN2QixjQUFTLEdBQVQsU0FBUyxDQUFrQjtBQUFDLFFBQzVCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtBQUFDLFFBQ2pDLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBYztBQUFDLFFBQ2pDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtBQUFDLFFBQy9CLFVBQUssR0FBTCxLQUFLLENBQWM7QUFBQyxRQUNwQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtBQUFDLFFBQ3pCLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7QUFBQyxRQUNyRCxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtBQUFDLFFBQzdCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7QUFDMUQsUUFwQ1csWUFBTyxHQUFZLEtBQUssQ0FBQztBQUNwQyxRQVVXLDRCQUF1QixHQUFZLEtBQUssQ0FBQztBQUNwRCxRQUFXLDJCQUFzQixHQUFZLElBQUksQ0FBQztBQUNsRCxRQUFZLFdBQU0sR0FBdUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUM1RCxRQUFZLGVBQVUsR0FBeUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUNsRSxRQUFZLHdCQUFtQixHQUEwQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQzVFLFFBQVksYUFBUSxHQUF1QixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQzlELFFBQUUsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO0FBQzVCLFFBQUUscUJBQWdCLEdBQUcsS0FBSyxDQUFDO0FBQzNCLFFBQUUsb0JBQWUsR0FBRyxLQUFLLENBQUM7QUFDMUIsSUFnQkssQ0FBQztBQUNOLElBcENFLElBQWEsSUFBSSxDQUFDLENBQU87QUFDM0IsUUFBSSxJQUFJLENBQUMsRUFBRTtBQUNYLFlBQU0sSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDNUIsWUFBTSxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEtBQUssUUFBUSxDQUFDO0FBQ3ZFLFlBQU0sSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxJQUFJLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQztBQUN0RixTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0gsSUFBRSxJQUFJLElBQUk7QUFDVixRQUFJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztBQUN0QixJQUFFLENBQUM7QUFDSCxJQTJCUSxRQUFRO0FBQ2hCO0FBQThELFlBQTFELE1BQU0sYUFBYSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ3BFLFlBQUksTUFBTSxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FDNUYsYUFBYSxDQUNkLENBQUM7QUFDTixZQUFJLElBQUksQ0FBQyxZQUFZLEdBQUcsb0JBQW9CLElBQUksb0JBQW9CLENBQUM7QUFDckUsWUFDSSxNQUFNLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0FBQ3hDLFlBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLDhCQUE4QixJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFO0FBQzVFLGdCQUFNLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO0FBQ2xDLGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDRSxJQUFJLEtBQUs7QUFDWCxRQUFJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO0FBQ2xDLElBQUUsQ0FBQztBQUNILElBQ0UsU0FBUztBQUNYLFFBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztBQUM1RSxRQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLG9FQUFvRTtBQUN2RixJQUFFLENBQUM7QUFDSCxJQUNFLE1BQU07QUFDUixRQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDekIsSUFBRSxDQUFDO0FBQ0gsSUFDUSxJQUFJO0FBQ1o7QUFJaUIsWUFKYixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7QUFDdEIsZ0JBQU0sT0FBTztBQUNiLGFBQUs7QUFDTCxZQUNJLElBQUksSUFBSSxDQUFDLHVCQUF1QixFQUFFO0FBQ3RDLGdCQUFNLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDakUsZ0JBQU0sSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUN2RixhQUFLO0FBQ0wsWUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLDZCQUE2QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM5RixRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDRSxvQkFBb0IsQ0FBQyxXQUF3QjtBQUMvQyxRQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUM7QUFDL0MsSUFBRSxDQUFDO0FBQ0gsSUFDZ0Isc0JBQXNCO0FBQ3RDO0FBQ29ELFlBRGhELElBQUk7QUFDUixnQkFBTSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztBQUM1RCxnQkFBTSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtBQUNqQyxvQkFBUSxNQUFNLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUNoRixvQkFBUSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQztBQUN2RCxpQkFBTztBQUNQLGFBQUs7QUFBQyxZQUFBLE9BQU8sRUFBRSxFQUFFO0FBQ2pCLGdCQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztBQUNwQyxhQUFLO0FBQ0wsUUFBRSxDQUFDO0FBRUYsS0FGRTtBQUNILElBQ2dCLGdCQUFnQjtBQUNoQztBQUE4RCxZQUExRCwwRkFBMEY7QUFDOUYsWUFBSSxNQUFNLFlBQVksR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDNUYsWUFBSSxPQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLFdBQVcsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxLQUFLLE1BQU0sQ0FBQyxDQUFDO0FBQzdGLFFBQUUsQ0FBQztBQUVGLEtBRkU7QUFDSCxJQUNVLDZCQUE2QjtBQUN2QyxRQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsZUFBZSxFQUFFLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFO0FBQ2pFLFlBQU0sSUFBSSxTQUFTLEVBQUU7QUFDckIsZ0JBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3JDLGFBQU87QUFDUCxRQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ1AsSUFBRSxDQUFDO0FBQ0g7NkNBL0dDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsZUFBZSxrQkFDekI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7a0RBQXlDLGNBQzFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0cEJBQ0k7QUFBQztBQUEyQyxZQXBCeEMsZUFBZTtBQUFJLFlBQ25CLGdCQUFnQjtBQUFJLFlBR3BCLGVBQWU7QUFBSSxZQUduQixZQUFZO0FBQUksWUFKaEIsY0FBYztBQUFJLFlBR2xCLFlBQVk7QUFBSSxZQVJULFdBQVc7QUFBSSxZQUFGLHlCQUF5QjtBQUFJLFlBQUYsYUFBYTtBQUFJLFlBVWhFLHNCQUFzQjtBQUFHO0FBQUc7QUFBcUMsbUJBYXZFLEtBQUs7QUFBSyxzQkFDVixLQUFLO0FBQUssbUJBQ1YsS0FBSztBQUFLLHNDQVVWLEtBQUs7QUFBSyxxQ0FDVixLQUFLO0FBQUsscUJBQ1YsTUFBTTtBQUFLLHlCQUNYLE1BQU07QUFBSyxrQ0FDWCxNQUFNO0FBQUssdUJBQ1gsTUFBTTtBQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT25Jbml0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSVVzZXIsIFVzZXJTZXJ2aWNlLCBUZW5hbnRMb2dpbk9wdGlvbnNTZXJ2aWNlLCBUZW5hbnRTZXJ2aWNlIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgY2xvbmUgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQXBwU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3VpLXN0YXRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJy4uL2kxOG4vdHJhbnNsYXRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmV3UGFzc3dvcmQgfSBmcm9tICcuLi9hdXRoZW50aWNhdGlvbi9wYXNzd29yZC5tb2RlbCc7XG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuaW1wb3J0IHsgUGFzc3dvcmRTZXJ2aWNlIH0gZnJvbSAnLi4vYXV0aGVudGljYXRpb24vcGFzc3dvcmQuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyVG90cFNldHVwQ29tcG9uZW50IH0gZnJvbSAnLi91c2VyLXRvdHAtc2V0dXAuY29tcG9uZW50JztcbmltcG9ydCB7IEFsZXJ0U2VydmljZSB9IGZyb20gJy4uL2FsZXJ0L2FsZXJ0LnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9kYWxTZXJ2aWNlIH0gZnJvbSAnLi4vbW9kYWwvbW9kYWwuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3VzZXItcHJlZmVyZW5jZXMvdXNlci1wcmVmZXJlbmNlcy5zZXJ2aWNlJztcblxuZXhwb3J0IGludGVyZmFjZSBVc2VyIGV4dGVuZHMgSVVzZXIge1xuICBwaG9uZTogc3RyaW5nO1xuICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBib29sZWFuO1xuICBuZXdzbGV0dGVyPzogYm9vbGVhbjtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXVzZXItZWRpdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi91c2VyLWVkaXQuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgbGFuZzogc3RyaW5nO1xuICBASW5wdXQoKSBsb2FkaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIHNldCB1c2VyKHU6IFVzZXIpIHtcbiAgICBpZiAodSkge1xuICAgICAgdGhpcy5fdXNlciA9IGNsb25lKHUpO1xuICAgICAgdGhpcy51c2VySXNFeHRlcm5hbCA9IHUuY3VzdG9tUHJvcGVydGllcy51c2VyT3JpZ2luID09PSAnT0FVVEgyJztcbiAgICAgIHRoaXMuaXNQaG9uZVJlcXVpcmVkID0gdGhpcy5pc1Bob25lUmVxdWlyZWQgJiYgdS50d29GYWN0b3JBdXRoZW50aWNhdGlvbkVuYWJsZWQ7XG4gICAgfVxuICB9XG4gIGdldCB1c2VyKCkge1xuICAgIHJldHVybiB0aGlzLl91c2VyO1xuICB9XG4gIEBJbnB1dCgpIHNob3dQcm9kdWN0VXNhZ2VTZXR0aW5nOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIGlzVXNhZ2VUcmFja2luZ0VuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBAT3V0cHV0KCkgb25Vc2VyOiBFdmVudEVtaXR0ZXI8VXNlcj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBvbkxhbmd1YWdlOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIG9uUHJvZHVjdEV4cGVyaWVuY2U6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIG9uQ2FuY2VsOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHVzZXJIYXNBY3RpdmVUb3RwID0gZmFsc2U7XG4gIHVzZXJDYW5TZXR1cFRvdHAgPSBmYWxzZTtcbiAgaXNQaG9uZVJlcXVpcmVkID0gZmFsc2U7XG4gIHVzZXJJc0V4dGVybmFsOiBib29sZWFuO1xuICBpc1RmYUVuYWJsZWQ6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBfdXNlcjogVXNlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgc3RhdGU6IEFwcFN0YXRlU2VydmljZSxcbiAgICBwdWJsaWMgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIHB1YmxpYyBwYXNzd29yZFNlcnZpY2U6IFBhc3N3b3JkU2VydmljZSxcbiAgICBwdWJsaWMgbW9kYWxDb25maXJtU2VydmljZTogTW9kYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgYnNNb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgYWxlcnQ6IEFsZXJ0U2VydmljZSxcbiAgICBwcml2YXRlIHVzZXJTZXJ2aWNlOiBVc2VyU2VydmljZSxcbiAgICBwcml2YXRlIHRlbmFudExvZ2luT3B0aW9uc1NlcnZpY2U6IFRlbmFudExvZ2luT3B0aW9uc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSB0ZW5hbnRTZXJ2aWNlOiBUZW5hbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgdXNlclByZWZlcmVuY2VzU2VydmljZTogVXNlclByZWZlcmVuY2VzU2VydmljZVxuICApIHt9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgY29uc3QgY3VycmVudFRlbmFudCA9IChhd2FpdCB0aGlzLnRlbmFudFNlcnZpY2UuY3VycmVudCgpKS5kYXRhO1xuICAgIGNvbnN0IHsgZW5hYmxlZE9uU3lzdGVtTGV2ZWwsIGVuYWJsZWRPblRlbmFudExldmVsIH0gPSBhd2FpdCB0aGlzLnRlbmFudFNlcnZpY2UuZ2V0VGZhU2V0dGluZ3MoXG4gICAgICBjdXJyZW50VGVuYW50XG4gICAgKTtcbiAgICB0aGlzLmlzVGZhRW5hYmxlZCA9IGVuYWJsZWRPblN5c3RlbUxldmVsIHx8IGVuYWJsZWRPblRlbmFudExldmVsO1xuXG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplVG90cFNldHRpbmdzKCk7XG4gICAgaWYgKHRoaXMudXNlci50d29GYWN0b3JBdXRoZW50aWNhdGlvbkVuYWJsZWQgJiYgIXRoaXMudXNlckNhblNldHVwVG90cCkge1xuICAgICAgdGhpcy5pc1Bob25lUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBsYW5ncygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdGF0ZS5sYW5ncztcbiAgfVxuXG4gIHNldHVwVG90cCgpIHtcbiAgICB0aGlzLmJzTW9kYWxTZXJ2aWNlLnNob3coVXNlclRvdHBTZXR1cENvbXBvbmVudCwgeyBjbGFzczogJ21vZGFsLXNtJyB9KTtcbiAgICB0aGlzLmNhbmNlbCgpOyAvLyB0byBjbG9zZSB0aGUgdXNlciBlZGl0IG1vZGFsIGFuZCBwcmV2ZW50IGNvbnNvbGUgZXJyb3JzIG9uIGxvZ291dFxuICB9XG5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMub25DYW5jZWwuZW1pdCgpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZSgpIHtcbiAgICBpZiAodGhpcy5sb2FkaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2hvd1Byb2R1Y3RVc2FnZVNldHRpbmcpIHtcbiAgICAgIHRoaXMub25Qcm9kdWN0RXhwZXJpZW5jZS5lbWl0KHRoaXMuaXNVc2FnZVRyYWNraW5nRW5hYmxlZCk7XG4gICAgICB0aGlzLnVzZXJQcmVmZXJlbmNlc1NlcnZpY2Uuc2V0KCdnYWluc2lnaHRFbmFibGVkJywgdGhpcy5pc1VzYWdlVHJhY2tpbmdFbmFibGVkKTtcbiAgICB9XG4gICAgdGhpcy5fdXNlci5wYXNzd29yZCA/IHRoaXMuc2F2ZUFmdGVyUGFzc3dvcmRDb25maXJtYXRpb24oKSA6IHRoaXMub25Vc2VyLmVtaXQodGhpcy5fdXNlcik7XG4gIH1cblxuICBvbk5ld1Bhc3N3b3JkQ2hhbmdlZChuZXdQYXNzd29yZDogTmV3UGFzc3dvcmQpIHtcbiAgICB0aGlzLl91c2VyLnBhc3N3b3JkID0gbmV3UGFzc3dvcmQucGFzc3dvcmQ7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVUb3RwU2V0dGluZ3MoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMudXNlckNhblNldHVwVG90cCA9IGF3YWl0IHRoaXMuY2FuVXNlclNldHVwVG90cCgpO1xuICAgICAgaWYgKHRoaXMudXNlckNhblNldHVwVG90cCkge1xuICAgICAgICBjb25zdCB7IGRhdGE6IHRvdHBBY3Rpdml0eSB9ID0gYXdhaXQgdGhpcy51c2VyU2VydmljZS5nZXRBY3Rpdml0eVRvdHAoKTtcbiAgICAgICAgdGhpcy51c2VySGFzQWN0aXZlVG90cCA9IHRvdHBBY3Rpdml0eS5pc0FjdGl2ZTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgdGhpcy5hbGVydC5yZW1vdmVMYXN0RGFuZ2VyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYW5Vc2VyU2V0dXBUb3RwKCkge1xuICAgIC8vIHdlIGRvbid0IGNoZWNrIGZvciB0ZW5hbnQgb3B0aW9ucyBoZXJlIGR1ZSB0byBwZXJtaXNzaW9uIHJlc3RyaWN0aW9ucyBvbiB0aGF0IGVuZC1wb2ludFxuICAgIGNvbnN0IGxvZ2luT3B0aW9ucyA9IChhd2FpdCB0aGlzLnRlbmFudExvZ2luT3B0aW9uc1NlcnZpY2UubGlzdEZvckN1cnJlbnRUZW5hbnQoKSkuZGF0YTtcbiAgICByZXR1cm4gbG9naW5PcHRpb25zLnNvbWUoKHsgdGZhU3RyYXRlZ3kgPSAnJyB9KSA9PiB0ZmFTdHJhdGVneS50b0xvd2VyQ2FzZSgpID09PSAndG90cCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBzYXZlQWZ0ZXJQYXNzd29yZENvbmZpcm1hdGlvbigpIHtcbiAgICB0aGlzLnBhc3N3b3JkU2VydmljZS5jb25maXJtUGFzc3dvcmQoKS5zdWJzY3JpYmUoY29uZmlybWVkID0+IHtcbiAgICAgIGlmIChjb25maXJtZWQpIHtcbiAgICAgICAgdGhpcy5vblVzZXIuZW1pdCh0aGlzLl91c2VyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19