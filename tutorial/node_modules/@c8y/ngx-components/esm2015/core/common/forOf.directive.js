import { coerceNumberProperty } from '@angular/cdk/coercion';
import { ComponentFactoryResolver, Directive, EventEmitter, Input, Output, TemplateRef, ViewContainerRef } from '@angular/core';
import { assign, get } from 'lodash-es';
import { combineLatest, isObservable, of, pipe, Subject } from 'rxjs';
import { filter, map, takeUntil, tap } from 'rxjs/operators';
import { LoadMoreComponent } from './load-more.component';
import { VirtualScrollerWrapperComponent } from './virtual-scroll/virtual-scroller-wrapper.component';
/**
 * A directive to iterate over IResultList<T> data from @c8y/client.
 * Depending on the [c8yForLoadMore] a load more button is:
 *  - auto: Tries to automatically load more data (default maximum 10 iterations; can be
 *          change with maxIterations settings).
 *  - show: Shows a load more button for the user to decide
 *  - none: Doesn't perform any load more action.
 *  - hidden: Loads more data automatically but with no visible button for the user.
 *
 * Additional, any rxjs operator pipe can be applied to the [c8yForPipe] input, e.g. to
 * filter the data displayed currently as well as the data loaded by subsequent requests.
 *
 * Example:
 * ```html
 * <div *c8yFor="let device of devices; loadMore: 'auto'; let i = index; pipe: filterPipe;">
 *  {{ i + 1 }}. {{device.name}}
 * </div>
 * ```
 * The above example will list all entities that are applied to `devices`:
 * ```typescript
 * this.devices = this.inventoryService.list({ pageSize: 10, fragmentType: 'c8y_IsDevice' })
 * ```
 * It will display the first 10 items, if there is more space left on the screen, and there are more
 * than 10 devices, it will automatically load up to 10 pages more. If it still can't fit the screen
 * it will stop and switch to `show` mode.
 *
 * A pipe can be applied e.g. for filtering or grouping. This pipe is attached to every follow up
 * request done by the load more component:
 * ```typescript
 * this.filterPipe = pipe(
 *    map((data: []) => {
 *     return data.filter(
 *      (mo: any) => mo.name && mo.name.toLowerCase().indexOf(value.toLowerCase()) > -1
 *    );
 *  })
 * );
 * ```
 * The pipe must be an rxjs pipe and can take any operator.
 *
 * Example with realtime support and items count output (e.g. for handling empty state and header):
 *
 * ```html
 * <c8y-list-group>
 *   <div class="c8y-empty-state" *ngIf="count === 0">
 *     (...)
 *   </div>
 *
 *   <div class="page-sticky-header hidden-xs c8y-list__item c8y-list--timeline" *ngIf="count > 0">
 *     (...)
 *   </div>
 *
 *   <ng-template
 *     c8yFor
 *     let-operation
 *     [c8yForOf]="items$"
 *     [c8yForPipe]="filterPipe"
 *     [c8yForRealtime]="realtime"
 *     [c8yForRealtimeOptions]="realtimeOptions"
 *     (c8yForCount)="count = $event"
 *   >
 *     <c8y-li-timeline>
 *       (...)
 *     </c8y-li-timeline>
 *   </ng-template>
 * </c8y-list-group>
 * ```
 *
 * ```typescript
 * @Component({
 *   (...)
 * })
 * export class ExampleComponent {
 *   @Input() deviceId: IIdentified;
 *   items$ = this.operationService.list({
 *     deviceId: this.deviceId,
 *     fragmentType: 'c8y_MyOperation',
 *     dateFrom: new Date(0).toISOString(),
 *     dateTo: new Date(Date.now()).toISOString(),
 *     revert: true,
 *     withTotalPages: true
 *   });
 *   filterPipe = pipe(map((ops: IOperation[]) => ops.filter(op => op.c8y_MyOperation)));
 *   realtimeOptions: ForOfRealtimeOptions = {
 *     entityOrId: this.deviceId,
 *     removeOnUpdate: true,
 *     insertOnUpdate: true
 *   } as ForOfRealtimeOptions;
 *   count: number;
 *
 *   constructor(
 *     private operationService: OperationService,
 *     public realtime: OperationRealtimeService
 *   ) {}
 * }
 * ```
 */
import * as ɵngcc0 from '@angular/core';
export class ForOfDirective {
    constructor(tpl, vcr, componentFactoryResolver) {
        this.tpl = tpl;
        this.vcr = vcr;
        this.componentFactoryResolver = componentFactoryResolver;
        this.cachedData = [];
        this.loadMoreMode = 'auto';
        this.dataPipe = pipe(tap());
        this.itemDataPipe = pipe(map(item => [item]), src => this.dataPipe(src), map(([item]) => item));
        this.maxIterations = 10;
        this.realtimeOptions = {};
        this.unsubscribe$ = new Subject();
        /**
         * Enable virtual scroll rendering method.
         */
        this.c8yForEnableVirtualScroll = false;
        /**
         * Sets mode of virtual scroller instance.
         * window is used for case when whole viewport is scrolled.
         * fixed can be used on inner-scroll containers.
         */
        this.c8yForVirtualScrollStrategy = 'window';
        /**
         * The number of items currently loaded in the list.
         */
        this.c8yForCount = new EventEmitter();
        this.count = 0;
    }
    get shouldUseLoadMoreButton() {
        return (this.loadMoreMode === 'auto' || this.loadMoreMode === 'show' || this.loadMoreMode === 'hidden');
    }
    get hasMoreData() {
        return this.loadMore && this.loadMore.hasMore;
    }
    get length() {
        return this.cachedData.length;
    }
    /**
     * The data setter. Must be a response from @c8y/data or an observable.
     * You can pass an observable with null to explicitly clear the list.
     */
    set c8yForOf(fetchData) {
        if (fetchData) {
            this.obs$ = (isObservable(fetchData) ? fetchData : of(fetchData)).pipe(map(result => {
                if (result === null) {
                    this.paging = null;
                    return [];
                }
                const { paging, data } = result;
                this.paging = paging;
                return data;
            }));
        }
    }
    /**
     * The mode setter:
     *  - auto: Tries to automatically load more data (default maximum 10 iterations; can be
     *          change with maxIterations settings).
     *  - show: Shows a load more button for the user to decide
     *  - none: Doesn't perform any load more action.
     *  - hidden: Loads more data automatically but with no visible button for the user.
     */
    set c8yForLoadMore(type) {
        this.loadMoreMode = type;
    }
    /**
     * The pipe setter to attach any rxjs pipe to the current and more loaded data.
     */
    set c8yForPipe(dataPipe) {
        if (dataPipe) {
            this.dataPipe = dataPipe;
        }
    }
    /**
     * A template to use if no data is found at all (e.g. if you apply a filter pipe).
     */
    set c8yForNotFound(notFoundTemplate) {
        this.notFoundTemplate = notFoundTemplate;
        if (this.loadMore) {
            this.loadMore.noMoreDataHint = notFoundTemplate;
        }
    }
    /**
     * The maximum numbers of iterations to call data from the api.
     */
    set c8yForMaxIterations(maxIterations) {
        this.maxIterations = maxIterations;
    }
    /**
     * A custom loading component.
     */
    set c8yForLoadingTemplate(loadingTemplate) {
        this.loadingTemplate = loadingTemplate;
    }
    /**
     * Load next text label.
     */
    set c8yForLoadNextLabel(loadNextLabel) {
        this.loadNextLabel = loadNextLabel;
    }
    /**
     * A RealtimeService instance.
     */
    set c8yForRealtime(source) {
        this.realtime = source;
    }
    /**
     * Realtime options.
     */
    set c8yForRealtimeOptions(realtimeOptions) {
        this.realtimeOptions = realtimeOptions;
    }
    /**
     * A comparator function for comparing list items. Used to determine
     * the position at which a new element should be added to the list.
     */
    set c8yForComparator(comparator) {
        this.comparator = comparator;
    }
    ngOnInit() {
        this.handleRealtime();
    }
    ngOnChanges(changes) {
        if (this.obs$ && (changes.c8yForPipe || changes.c8yForOf)) {
            this.unsubscribePaging();
            if (this.virtualScrollInstance) {
                this.virtualScrollInstance.filterPipe = this.dataPipe;
                window.scrollTo({ top: 0 });
            }
            // only re-rendering  on filtering if all data is already loaded
            // from the backend
            const reRender = !this.hasMoreData && !!changes.c8yForPipe && !changes.c8yForOf;
            if (reRender) {
                this.obs$ = of(this.cachedData);
            }
            this.pagingSub = this.obs$
                .pipe(tap(data => {
                if (!reRender) {
                    this.cachedData = data;
                }
            }))
                .pipe(src => this.dataPipe(src))
                .subscribe((data) => {
                this.updateCount(data.length);
                this.render(data, reRender);
            });
        }
    }
    ngOnDestroy() {
        this.unsubscribePaging();
        this.unsubscribe$.next();
        this.unsubscribe$.complete();
    }
    handleRealtime() {
        if (this.realtime) {
            this.handleRealtimeCreate();
            this.handleRealtimeUpdate();
            this.handleRealtimeDelete();
        }
    }
    /**
     * On create notification:
     * - if item passes data pipe, then insert it.
     * @private
     */
    handleRealtimeCreate() {
        const { entityOrId } = this.realtimeOptions;
        this.realtime
            .onCreate$(entityOrId)
            .pipe(item$ => this.itemDataPipe(item$), filter(item => item), takeUntil(this.unsubscribe$))
            .subscribe(item => this.insert(item));
    }
    /**
     * On update notification:
     * - if item is displayed and passes data pipe, then update it,
     * - if item is displayed and doesn't pass data pipe, then remove it (if `removeOnUpdate` is true),
     * - if item is not displayed and passes data pipe, then insert it (if `insertOnUpdate` is true),
     * - if item is not displayed and doesn't pass data pipe, then ignore it.
     * @private
     */
    handleRealtimeUpdate() {
        const { entityOrId } = this.realtimeOptions;
        this.realtime
            .onUpdate$(entityOrId)
            .pipe(item$ => combineLatest([
            item$,
            item$.pipe(src => this.itemDataPipe(src), map(item => item !== undefined))
        ]), takeUntil(this.unsubscribe$))
            .subscribe(([item, passesDataPipe]) => {
            const { insertOnUpdate, removeOnUpdate } = this.realtimeOptions;
            const displayed = this.isDisplayed(coerceNumberProperty(item.id));
            if (displayed) {
                if (passesDataPipe) {
                    this.update(item);
                }
                else if (removeOnUpdate) {
                    this.remove(coerceNumberProperty(item.id));
                }
            }
            else if (passesDataPipe && insertOnUpdate) {
                this.insert(item);
            }
        });
    }
    /**
     * On delete notification:
     * - remove item from the list (if not there, it will be just ignored).
     * @private
     */
    handleRealtimeDelete() {
        const { entityOrId } = this.realtimeOptions;
        this.realtime
            .onDelete$(entityOrId)
            .pipe(takeUntil(this.unsubscribe$))
            .subscribe(id => this.remove(coerceNumberProperty(id)));
    }
    render(data, reRender = false) {
        if (this.c8yForEnableVirtualScroll) {
            if (!this.virtualScrollInstance) {
                this.virtualScrollInstance = this.createVirtualScrollWrapperComponent();
                if (this.shouldUseLoadMoreButton) {
                    this.loadMore = this.createLoadMoreButtonComponent(false);
                }
            }
            this.setVirtualScrollContents(data);
            return;
        }
        this.vcr.clear();
        data.forEach((item, index) => {
            const context = {
                $implicit: item,
                index,
                length: this.length,
                hasMore: this.hasMoreData,
                loadMoreComponent: this.loadMore
            };
            this.vcr.createEmbeddedView(this.tpl, context);
        });
        if (this.shouldUseLoadMoreButton) {
            this.loadMore = this.createLoadMoreButtonComponent(reRender);
        }
    }
    append(data) {
        if (this.c8yForEnableVirtualScroll) {
            this.appendVirtualScrollContent(data);
            return;
        }
        data.forEach(item => {
            const index = this.shouldUseLoadMoreButton ? this.vcr.length - 1 : this.vcr.length;
            const context = {
                $implicit: item,
                index,
                length: this.length,
                hasMore: this.hasMoreData,
                loadMoreComponent: this.loadMore
            };
            this.vcr.createEmbeddedView(this.tpl, context, index);
        });
    }
    loadMoreData(data) {
        if (data.length > 0) {
            this.updateCount(data.length);
            this.append(data);
        }
    }
    createLoadMoreButtonComponent(reRender) {
        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(LoadMoreComponent);
        const componentRef = this.vcr.createComponent(componentFactory);
        const instance = componentRef.instance;
        instance.paging = this.paging;
        instance.useIntersection = this.loadMoreMode === 'auto' || this.loadMoreMode === 'hidden';
        instance.hidden = this.loadMoreMode === 'hidden';
        instance.maxIterations = this.maxIterations;
        instance.noMoreDataHint = this.notFoundTemplate;
        instance.loadingTemplate = this.loadingTemplate;
        instance.loadNextLabel = this.loadNextLabel;
        this.pagingSub = instance.onLoad
            .pipe(map((data) => this.checkForDuplicates(data)), tap((data) => {
            this.cachedData = this.cachedData.concat(data);
        }))
            .pipe(src => this.dataPipe(src))
            .subscribe(data => this.loadMoreData(data));
        if (reRender) {
            assign(instance, this.loadMore);
        }
        return instance;
    }
    createVirtualScrollWrapperComponent() {
        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(VirtualScrollerWrapperComponent);
        const componentRef = this.vcr.createComponent(componentFactory);
        const instance = componentRef.instance;
        instance.items = this.cachedData;
        instance.itemHeight = this.c8yForVirtualScrollElementSize;
        instance.template = this.tpl;
        instance.strategy = this.c8yForVirtualScrollStrategy;
        instance.containerHeight = this.c8yForVirtualScrollContainerHeight;
        return instance;
    }
    insert(item) {
        let index = 0;
        if (this.comparator && this.cachedData.length) {
            let comparisionResult;
            do {
                const view = this.vcr.get(index);
                const itemB = get(view, 'context.$implicit');
                comparisionResult = item && itemB ? this.comparator(item, itemB) : 0;
                if (comparisionResult <= 0) {
                    index++;
                }
            } while (comparisionResult <= 0 && index < this.cachedData.length);
        }
        // Do not append elements after the last one currently loaded,
        // as it may belong further down there on the list and will
        // be eventually loaded with one of the next pages.
        if (index < this.cachedData.length || this.cachedData.length === 0) {
            const context = {
                $implicit: item,
                index,
                length: this.length,
                hasMore: this.hasMoreData
            };
            this.cachedData.splice(index, 0, item);
            const viewRef = this.tpl.createEmbeddedView(context);
            this.vcr.insert(viewRef, index);
            this.updateCount(1);
        }
    }
    update(updatedItem) {
        this.forMatchingEmbeddedViewRef((item) => item && updatedItem && item.id === updatedItem.id, (view) => {
            view.context.$implicit = updatedItem;
            view.markForCheck();
        });
    }
    remove(idToRemove) {
        if (this.isDisplayed(idToRemove)) {
            this.updateCount(-1);
        }
        this.forMatchingEmbeddedViewRef((item) => item && coerceNumberProperty(item.id, NaN) === idToRemove, (view) => view.destroy());
    }
    updateCount(countChange) {
        this.count += countChange;
        this.c8yForCount.emit(this.count);
    }
    isDisplayed(idToCheck) {
        let displayed = false;
        this.forMatchingEmbeddedViewRef((item) => item && coerceNumberProperty(item.id, NaN) === idToCheck, () => { displayed = true; });
        return displayed;
    }
    forMatchingEmbeddedViewRef(filterFn, callbackFn) {
        for (let i = 0; i < this.vcr.length; i++) {
            const view = this.vcr.get(i);
            const item = get(view, 'context.$implicit');
            if (filterFn(item)) {
                callbackFn(view);
            }
        }
    }
    checkForDuplicates(data) {
        return this.realtime
            ? data.filter(item => !this.cachedData.some(cached => cached.id === item.id))
            : data;
    }
    unsubscribePaging() {
        if (this.pagingSub) {
            this.pagingSub.unsubscribe();
        }
    }
    setVirtualScrollContents(items) {
        if (this.c8yForEnableVirtualScroll && this.virtualScrollInstance) {
            this.virtualScrollInstance.items = items;
            this.virtualScrollInstance.apply();
        }
    }
    appendVirtualScrollContent(items) {
        if (this.c8yForEnableVirtualScroll && this.virtualScrollInstance) {
            this.virtualScrollInstance.items = this.virtualScrollInstance.items.concat(items);
            this.virtualScrollInstance.apply();
        }
    }
}
ForOfDirective.ɵfac = function ForOfDirective_Factory(t) { return new (t || ForOfDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver)); };
ForOfDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: ForOfDirective, selectors: [["", "c8yFor", ""]], inputs: { c8yForEnableVirtualScroll: "c8yForEnableVirtualScroll", c8yForVirtualScrollStrategy: "c8yForVirtualScrollStrategy", c8yForOf: "c8yForOf", c8yForLoadMore: "c8yForLoadMore", c8yForPipe: "c8yForPipe", c8yForNotFound: "c8yForNotFound", c8yForMaxIterations: "c8yForMaxIterations", c8yForLoadingTemplate: "c8yForLoadingTemplate", c8yForLoadNextLabel: "c8yForLoadNextLabel", c8yForRealtime: "c8yForRealtime", c8yForRealtimeOptions: "c8yForRealtimeOptions", c8yForComparator: "c8yForComparator", c8yForVirtualScrollElementSize: "c8yForVirtualScrollElementSize", c8yForVirtualScrollContainerHeight: "c8yForVirtualScrollContainerHeight" }, outputs: { c8yForCount: "c8yForCount" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
ForOfDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: ComponentFactoryResolver }
];
ForOfDirective.propDecorators = {
    c8yForOf: [{ type: Input }],
    c8yForLoadMore: [{ type: Input }],
    c8yForPipe: [{ type: Input }],
    c8yForNotFound: [{ type: Input }],
    c8yForMaxIterations: [{ type: Input }],
    c8yForLoadingTemplate: [{ type: Input }],
    c8yForLoadNextLabel: [{ type: Input }],
    c8yForRealtime: [{ type: Input }],
    c8yForRealtimeOptions: [{ type: Input }],
    c8yForComparator: [{ type: Input }],
    c8yForEnableVirtualScroll: [{ type: Input }],
    c8yForVirtualScrollElementSize: [{ type: Input }],
    c8yForVirtualScrollStrategy: [{ type: Input }],
    c8yForVirtualScrollContainerHeight: [{ type: Input }],
    c8yForCount: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ForOfDirective, [{
        type: Directive,
        args: [{
                selector: '[c8yFor]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }, { type: ɵngcc0.ViewContainerRef }, { type: ɵngcc0.ComponentFactoryResolver }]; }, { c8yForEnableVirtualScroll: [{
            type: Input
        }], c8yForVirtualScrollStrategy: [{
            type: Input
        }], c8yForCount: [{
            type: Output
        }], c8yForOf: [{
            type: Input
        }], c8yForLoadMore: [{
            type: Input
        }], c8yForPipe: [{
            type: Input
        }], c8yForNotFound: [{
            type: Input
        }], c8yForMaxIterations: [{
            type: Input
        }], c8yForLoadingTemplate: [{
            type: Input
        }], c8yForLoadNextLabel: [{
            type: Input
        }], c8yForRealtime: [{
            type: Input
        }], c8yForRealtimeOptions: [{
            type: Input
        }], c8yForComparator: [{
            type: Input
        }], c8yForVirtualScrollElementSize: [{
            type: Input
        }], c8yForVirtualScrollContainerHeight: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yT2YuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL2NvbW1vbi9mb3JPZi5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0QsT0FBTyxFQUVMLHdCQUF3QixFQUN4QixTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBRU4sV0FBVyxFQUNYLGdCQUFnQixFQUVqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN4QyxPQUFPLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBYyxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDaEcsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRTVELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRzFELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRXRHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUs7QUFDTix5QkFPQyxLQUFLO0FBQ04sNkJBU0MsS0FBSztBQUNOLGtDQVVDLEtBQUs7QUFDTixvQ0FPQyxLQUFLO0FBQ04sa0NBT0MsS0FBSztBQUNOLDZCQU9DLEtBQUs7QUFDTixvQ0FPQyxLQUFLO0FBQ04sK0JBUUMsS0FBSztBQUNOLHdDQU9DLEtBQUs7QUFDTiw2Q0FLQyxLQUFLO0FBQ04sMENBT0MsS0FBSztBQUNOLGlEQUtDLEtBQUs7QUFDTiwwQkFLQyxNQUFNO0FBQ1I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29lcmNlTnVtYmVyUHJvcGVydHkgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50RmFjdG9yeSxcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBEaXJlY3RpdmUsXG4gIEVtYmVkZGVkVmlld1JlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgVmlld1JlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElJZGVudGlmaWVkLCBJUmVzdWx0TGlzdCwgUGFnaW5nIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgYXNzaWduLCBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgaXNPYnNlcnZhYmxlLCBPYnNlcnZhYmxlLCBvZiwgcGlwZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgdGFrZVVudGlsLCB0YXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFJlYWx0aW1lU2VydmljZSB9IGZyb20gJy4uL3JlYWx0aW1lL3JlYWx0aW1lLnNlcnZpY2UnO1xuaW1wb3J0IHsgTG9hZE1vcmVDb21wb25lbnQgfSBmcm9tICcuL2xvYWQtbW9yZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTG9hZE1vcmVNb2RlIH0gZnJvbSAnLi9sb2FkLW1vcmUubW9kZWwnO1xuaW1wb3J0IHsgRm9yT2ZSZWFsdGltZU9wdGlvbnMgfSBmcm9tICcuL2Zvck9mLm1vZGVsJztcbmltcG9ydCB7IFZpcnR1YWxTY3JvbGxlcldyYXBwZXJDb21wb25lbnQgfSBmcm9tICcuL3ZpcnR1YWwtc2Nyb2xsL3ZpcnR1YWwtc2Nyb2xsZXItd3JhcHBlci5jb21wb25lbnQnO1xuXG4vKipcbiAqIEEgZGlyZWN0aXZlIHRvIGl0ZXJhdGUgb3ZlciBJUmVzdWx0TGlzdDxUPiBkYXRhIGZyb20gQGM4eS9jbGllbnQuXG4gKiBEZXBlbmRpbmcgb24gdGhlIFtjOHlGb3JMb2FkTW9yZV0gYSBsb2FkIG1vcmUgYnV0dG9uIGlzOlxuICogIC0gYXV0bzogVHJpZXMgdG8gYXV0b21hdGljYWxseSBsb2FkIG1vcmUgZGF0YSAoZGVmYXVsdCBtYXhpbXVtIDEwIGl0ZXJhdGlvbnM7IGNhbiBiZVxuICogICAgICAgICAgY2hhbmdlIHdpdGggbWF4SXRlcmF0aW9ucyBzZXR0aW5ncykuXG4gKiAgLSBzaG93OiBTaG93cyBhIGxvYWQgbW9yZSBidXR0b24gZm9yIHRoZSB1c2VyIHRvIGRlY2lkZVxuICogIC0gbm9uZTogRG9lc24ndCBwZXJmb3JtIGFueSBsb2FkIG1vcmUgYWN0aW9uLlxuICogIC0gaGlkZGVuOiBMb2FkcyBtb3JlIGRhdGEgYXV0b21hdGljYWxseSBidXQgd2l0aCBubyB2aXNpYmxlIGJ1dHRvbiBmb3IgdGhlIHVzZXIuXG4gKlxuICogQWRkaXRpb25hbCwgYW55IHJ4anMgb3BlcmF0b3IgcGlwZSBjYW4gYmUgYXBwbGllZCB0byB0aGUgW2M4eUZvclBpcGVdIGlucHV0LCBlLmcuIHRvXG4gKiBmaWx0ZXIgdGhlIGRhdGEgZGlzcGxheWVkIGN1cnJlbnRseSBhcyB3ZWxsIGFzIHRoZSBkYXRhIGxvYWRlZCBieSBzdWJzZXF1ZW50IHJlcXVlc3RzLlxuICpcbiAqIEV4YW1wbGU6XG4gKiBgYGBodG1sXG4gKiA8ZGl2ICpjOHlGb3I9XCJsZXQgZGV2aWNlIG9mIGRldmljZXM7IGxvYWRNb3JlOiAnYXV0byc7IGxldCBpID0gaW5kZXg7IHBpcGU6IGZpbHRlclBpcGU7XCI+XG4gKiAge3sgaSArIDEgfX0uIHt7ZGV2aWNlLm5hbWV9fVxuICogPC9kaXY+XG4gKiBgYGBcbiAqIFRoZSBhYm92ZSBleGFtcGxlIHdpbGwgbGlzdCBhbGwgZW50aXRpZXMgdGhhdCBhcmUgYXBwbGllZCB0byBgZGV2aWNlc2A6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiB0aGlzLmRldmljZXMgPSB0aGlzLmludmVudG9yeVNlcnZpY2UubGlzdCh7IHBhZ2VTaXplOiAxMCwgZnJhZ21lbnRUeXBlOiAnYzh5X0lzRGV2aWNlJyB9KVxuICogYGBgXG4gKiBJdCB3aWxsIGRpc3BsYXkgdGhlIGZpcnN0IDEwIGl0ZW1zLCBpZiB0aGVyZSBpcyBtb3JlIHNwYWNlIGxlZnQgb24gdGhlIHNjcmVlbiwgYW5kIHRoZXJlIGFyZSBtb3JlXG4gKiB0aGFuIDEwIGRldmljZXMsIGl0IHdpbGwgYXV0b21hdGljYWxseSBsb2FkIHVwIHRvIDEwIHBhZ2VzIG1vcmUuIElmIGl0IHN0aWxsIGNhbid0IGZpdCB0aGUgc2NyZWVuXG4gKiBpdCB3aWxsIHN0b3AgYW5kIHN3aXRjaCB0byBgc2hvd2AgbW9kZS5cbiAqXG4gKiBBIHBpcGUgY2FuIGJlIGFwcGxpZWQgZS5nLiBmb3IgZmlsdGVyaW5nIG9yIGdyb3VwaW5nLiBUaGlzIHBpcGUgaXMgYXR0YWNoZWQgdG8gZXZlcnkgZm9sbG93IHVwXG4gKiByZXF1ZXN0IGRvbmUgYnkgdGhlIGxvYWQgbW9yZSBjb21wb25lbnQ6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiB0aGlzLmZpbHRlclBpcGUgPSBwaXBlKFxuICogICAgbWFwKChkYXRhOiBbXSkgPT4ge1xuICogICAgIHJldHVybiBkYXRhLmZpbHRlcihcbiAqICAgICAgKG1vOiBhbnkpID0+IG1vLm5hbWUgJiYgbW8ubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsdWUudG9Mb3dlckNhc2UoKSkgPiAtMVxuICogICAgKTtcbiAqICB9KVxuICogKTtcbiAqIGBgYFxuICogVGhlIHBpcGUgbXVzdCBiZSBhbiByeGpzIHBpcGUgYW5kIGNhbiB0YWtlIGFueSBvcGVyYXRvci5cbiAqXG4gKiBFeGFtcGxlIHdpdGggcmVhbHRpbWUgc3VwcG9ydCBhbmQgaXRlbXMgY291bnQgb3V0cHV0IChlLmcuIGZvciBoYW5kbGluZyBlbXB0eSBzdGF0ZSBhbmQgaGVhZGVyKTpcbiAqXG4gKiBgYGBodG1sXG4gKiA8Yzh5LWxpc3QtZ3JvdXA+XG4gKiAgIDxkaXYgY2xhc3M9XCJjOHktZW1wdHktc3RhdGVcIiAqbmdJZj1cImNvdW50ID09PSAwXCI+XG4gKiAgICAgKC4uLilcbiAqICAgPC9kaXY+XG4gKlxuICogICA8ZGl2IGNsYXNzPVwicGFnZS1zdGlja3ktaGVhZGVyIGhpZGRlbi14cyBjOHktbGlzdF9faXRlbSBjOHktbGlzdC0tdGltZWxpbmVcIiAqbmdJZj1cImNvdW50ID4gMFwiPlxuICogICAgICguLi4pXG4gKiAgIDwvZGl2PlxuICpcbiAqICAgPG5nLXRlbXBsYXRlXG4gKiAgICAgYzh5Rm9yXG4gKiAgICAgbGV0LW9wZXJhdGlvblxuICogICAgIFtjOHlGb3JPZl09XCJpdGVtcyRcIlxuICogICAgIFtjOHlGb3JQaXBlXT1cImZpbHRlclBpcGVcIlxuICogICAgIFtjOHlGb3JSZWFsdGltZV09XCJyZWFsdGltZVwiXG4gKiAgICAgW2M4eUZvclJlYWx0aW1lT3B0aW9uc109XCJyZWFsdGltZU9wdGlvbnNcIlxuICogICAgIChjOHlGb3JDb3VudCk9XCJjb3VudCA9ICRldmVudFwiXG4gKiAgID5cbiAqICAgICA8Yzh5LWxpLXRpbWVsaW5lPlxuICogICAgICAgKC4uLilcbiAqICAgICA8L2M4eS1saS10aW1lbGluZT5cbiAqICAgPC9uZy10ZW1wbGF0ZT5cbiAqIDwvYzh5LWxpc3QtZ3JvdXA+XG4gKiBgYGBcbiAqXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBAQ29tcG9uZW50KHtcbiAqICAgKC4uLilcbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgRXhhbXBsZUNvbXBvbmVudCB7XG4gKiAgIEBJbnB1dCgpIGRldmljZUlkOiBJSWRlbnRpZmllZDtcbiAqICAgaXRlbXMkID0gdGhpcy5vcGVyYXRpb25TZXJ2aWNlLmxpc3Qoe1xuICogICAgIGRldmljZUlkOiB0aGlzLmRldmljZUlkLFxuICogICAgIGZyYWdtZW50VHlwZTogJ2M4eV9NeU9wZXJhdGlvbicsXG4gKiAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gKiAgICAgZGF0ZVRvOiBuZXcgRGF0ZShEYXRlLm5vdygpKS50b0lTT1N0cmluZygpLFxuICogICAgIHJldmVydDogdHJ1ZSxcbiAqICAgICB3aXRoVG90YWxQYWdlczogdHJ1ZVxuICogICB9KTtcbiAqICAgZmlsdGVyUGlwZSA9IHBpcGUobWFwKChvcHM6IElPcGVyYXRpb25bXSkgPT4gb3BzLmZpbHRlcihvcCA9PiBvcC5jOHlfTXlPcGVyYXRpb24pKSk7XG4gKiAgIHJlYWx0aW1lT3B0aW9uczogRm9yT2ZSZWFsdGltZU9wdGlvbnMgPSB7XG4gKiAgICAgZW50aXR5T3JJZDogdGhpcy5kZXZpY2VJZCxcbiAqICAgICByZW1vdmVPblVwZGF0ZTogdHJ1ZSxcbiAqICAgICBpbnNlcnRPblVwZGF0ZTogdHJ1ZVxuICogICB9IGFzIEZvck9mUmVhbHRpbWVPcHRpb25zO1xuICogICBjb3VudDogbnVtYmVyO1xuICpcbiAqICAgY29uc3RydWN0b3IoXG4gKiAgICAgcHJpdmF0ZSBvcGVyYXRpb25TZXJ2aWNlOiBPcGVyYXRpb25TZXJ2aWNlLFxuICogICAgIHB1YmxpYyByZWFsdGltZTogT3BlcmF0aW9uUmVhbHRpbWVTZXJ2aWNlXG4gKiAgICkge31cbiAqIH1cbiAqIGBgYFxuICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYzh5Rm9yXSdcbn0pXG5leHBvcnQgY2xhc3MgRm9yT2ZEaXJlY3RpdmUge1xuICBwcml2YXRlIGNhY2hlZERhdGE6IElJZGVudGlmaWVkW10gPSBbXTtcbiAgcHJpdmF0ZSBwYWdpbmc6IFBhZ2luZzxJSWRlbnRpZmllZD47XG4gIHByaXZhdGUgbG9hZE1vcmVNb2RlOiBMb2FkTW9yZU1vZGUgPSAnYXV0byc7XG4gIHByaXZhdGUgZGF0YVBpcGUgPSBwaXBlKHRhcCgpKTtcbiAgcHJpdmF0ZSBpdGVtRGF0YVBpcGUgPSBwaXBlKFxuICAgIG1hcChpdGVtID0+IFtpdGVtXSksXG4gICAgc3JjID0+IHRoaXMuZGF0YVBpcGUoc3JjKSxcbiAgICBtYXAoKFtpdGVtXSkgPT4gaXRlbSlcbiAgKTtcbiAgcHJpdmF0ZSBwYWdpbmdTdWI6IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBvYnMkOiBPYnNlcnZhYmxlPElJZGVudGlmaWVkW10+O1xuICBwcml2YXRlIGxvYWRNb3JlOiBMb2FkTW9yZUNvbXBvbmVudDtcbiAgcHJpdmF0ZSBsb2FkaW5nVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIHByaXZhdGUgbWF4SXRlcmF0aW9ucyA9IDEwO1xuICBwcml2YXRlIG5vdEZvdW5kVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIHByaXZhdGUgbG9hZE5leHRMYWJlbDogc3RyaW5nO1xuICBwcml2YXRlIHJlYWx0aW1lOiBSZWFsdGltZVNlcnZpY2U8YW55PjtcbiAgcHJpdmF0ZSByZWFsdGltZU9wdGlvbnM6IEZvck9mUmVhbHRpbWVPcHRpb25zID0ge30gYXMgRm9yT2ZSZWFsdGltZU9wdGlvbnM7XG4gIHByaXZhdGUgY29tcGFyYXRvcjogKGl0ZW1BOiBvYmplY3QsIGl0ZW1COiBvYmplY3QpID0+IG51bWJlcjtcbiAgcHJpdmF0ZSB1bnN1YnNjcmliZSQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuICBwcml2YXRlIHZpcnR1YWxTY3JvbGxJbnN0YW5jZTogVmlydHVhbFNjcm9sbGVyV3JhcHBlckNvbXBvbmVudDtcblxuICBwcml2YXRlIGdldCBzaG91bGRVc2VMb2FkTW9yZUJ1dHRvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5sb2FkTW9yZU1vZGUgPT09ICdhdXRvJyB8fCB0aGlzLmxvYWRNb3JlTW9kZSA9PT0gJ3Nob3cnIHx8IHRoaXMubG9hZE1vcmVNb2RlID09PSAnaGlkZGVuJ1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCBoYXNNb3JlRGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5sb2FkTW9yZSAmJiB0aGlzLmxvYWRNb3JlLmhhc01vcmU7XG4gIH1cblxuICBwcml2YXRlIGdldCBsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FjaGVkRGF0YS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGRhdGEgc2V0dGVyLiBNdXN0IGJlIGEgcmVzcG9uc2UgZnJvbSBAYzh5L2RhdGEgb3IgYW4gb2JzZXJ2YWJsZS5cbiAgICogWW91IGNhbiBwYXNzIGFuIG9ic2VydmFibGUgd2l0aCBudWxsIHRvIGV4cGxpY2l0bHkgY2xlYXIgdGhlIGxpc3QuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYzh5Rm9yT2YoZmV0Y2hEYXRhOiBJUmVzdWx0TGlzdDxJSWRlbnRpZmllZD4gfCBPYnNlcnZhYmxlPElSZXN1bHRMaXN0PElJZGVudGlmaWVkPj4pIHtcbiAgICBpZiAoZmV0Y2hEYXRhKSB7XG4gICAgICB0aGlzLm9icyQgPSAoaXNPYnNlcnZhYmxlKGZldGNoRGF0YSkgPyBmZXRjaERhdGEgOiBvZihmZXRjaERhdGEpKS5waXBlKFxuICAgICAgICBtYXAocmVzdWx0ID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2luZyA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgcGFnaW5nLCBkYXRhIH0gPSByZXN1bHQ7XG4gICAgICAgICAgdGhpcy5wYWdpbmcgPSBwYWdpbmc7XG4gICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbW9kZSBzZXR0ZXI6XG4gICAqICAtIGF1dG86IFRyaWVzIHRvIGF1dG9tYXRpY2FsbHkgbG9hZCBtb3JlIGRhdGEgKGRlZmF1bHQgbWF4aW11bSAxMCBpdGVyYXRpb25zOyBjYW4gYmVcbiAgICogICAgICAgICAgY2hhbmdlIHdpdGggbWF4SXRlcmF0aW9ucyBzZXR0aW5ncykuXG4gICAqICAtIHNob3c6IFNob3dzIGEgbG9hZCBtb3JlIGJ1dHRvbiBmb3IgdGhlIHVzZXIgdG8gZGVjaWRlXG4gICAqICAtIG5vbmU6IERvZXNuJ3QgcGVyZm9ybSBhbnkgbG9hZCBtb3JlIGFjdGlvbi5cbiAgICogIC0gaGlkZGVuOiBMb2FkcyBtb3JlIGRhdGEgYXV0b21hdGljYWxseSBidXQgd2l0aCBubyB2aXNpYmxlIGJ1dHRvbiBmb3IgdGhlIHVzZXIuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYzh5Rm9yTG9hZE1vcmUodHlwZTogTG9hZE1vcmVNb2RlKSB7XG4gICAgdGhpcy5sb2FkTW9yZU1vZGUgPSB0eXBlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBwaXBlIHNldHRlciB0byBhdHRhY2ggYW55IHJ4anMgcGlwZSB0byB0aGUgY3VycmVudCBhbmQgbW9yZSBsb2FkZWQgZGF0YS5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCBjOHlGb3JQaXBlKGRhdGFQaXBlKSB7XG4gICAgaWYgKGRhdGFQaXBlKSB7XG4gICAgICB0aGlzLmRhdGFQaXBlID0gZGF0YVBpcGU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEEgdGVtcGxhdGUgdG8gdXNlIGlmIG5vIGRhdGEgaXMgZm91bmQgYXQgYWxsIChlLmcuIGlmIHlvdSBhcHBseSBhIGZpbHRlciBwaXBlKS5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCBjOHlGb3JOb3RGb3VuZChub3RGb3VuZFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+KSB7XG4gICAgdGhpcy5ub3RGb3VuZFRlbXBsYXRlID0gbm90Rm91bmRUZW1wbGF0ZTtcbiAgICBpZiAodGhpcy5sb2FkTW9yZSkge1xuICAgICAgdGhpcy5sb2FkTW9yZS5ub01vcmVEYXRhSGludCA9IG5vdEZvdW5kVGVtcGxhdGU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIG51bWJlcnMgb2YgaXRlcmF0aW9ucyB0byBjYWxsIGRhdGEgZnJvbSB0aGUgYXBpLlxuICAgKi9cbiAgQElucHV0KClcbiAgc2V0IGM4eUZvck1heEl0ZXJhdGlvbnMobWF4SXRlcmF0aW9uczogbnVtYmVyKSB7XG4gICAgdGhpcy5tYXhJdGVyYXRpb25zID0gbWF4SXRlcmF0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGN1c3RvbSBsb2FkaW5nIGNvbXBvbmVudC5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCBjOHlGb3JMb2FkaW5nVGVtcGxhdGUobG9hZGluZ1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+KSB7XG4gICAgdGhpcy5sb2FkaW5nVGVtcGxhdGUgPSBsb2FkaW5nVGVtcGxhdGU7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBuZXh0IHRleHQgbGFiZWwuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYzh5Rm9yTG9hZE5leHRMYWJlbChsb2FkTmV4dExhYmVsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxvYWROZXh0TGFiZWwgPSBsb2FkTmV4dExhYmVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgUmVhbHRpbWVTZXJ2aWNlIGluc3RhbmNlLlxuICAgKi9cbiAgQElucHV0KClcbiAgc2V0IGM4eUZvclJlYWx0aW1lKHNvdXJjZTogUmVhbHRpbWVTZXJ2aWNlPGFueT4pIHtcbiAgICB0aGlzLnJlYWx0aW1lID0gc291cmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlYWx0aW1lIG9wdGlvbnMuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYzh5Rm9yUmVhbHRpbWVPcHRpb25zKHJlYWx0aW1lT3B0aW9uczogRm9yT2ZSZWFsdGltZU9wdGlvbnMpIHtcbiAgICB0aGlzLnJlYWx0aW1lT3B0aW9ucyA9IHJlYWx0aW1lT3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGNvbXBhcmF0b3IgZnVuY3Rpb24gZm9yIGNvbXBhcmluZyBsaXN0IGl0ZW1zLiBVc2VkIHRvIGRldGVybWluZVxuICAgKiB0aGUgcG9zaXRpb24gYXQgd2hpY2ggYSBuZXcgZWxlbWVudCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGxpc3QuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYzh5Rm9yQ29tcGFyYXRvcihjb21wYXJhdG9yOiAoaXRlbUE6IG9iamVjdCwgaXRlbUI6IG9iamVjdCkgPT4gbnVtYmVyKSB7XG4gICAgdGhpcy5jb21wYXJhdG9yID0gY29tcGFyYXRvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUgdmlydHVhbCBzY3JvbGwgcmVuZGVyaW5nIG1ldGhvZC5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHByaXZhdGUgYzh5Rm9yRW5hYmxlVmlydHVhbFNjcm9sbCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBmaXhlZCBpdGVtIHNpemUgZm9yIHZpcnR1YWwgc2Nyb2xsIHdpbmRvdyBzdHJhdGVneS5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHByaXZhdGUgYzh5Rm9yVmlydHVhbFNjcm9sbEVsZW1lbnRTaXplO1xuXG4gIC8qKlxuICAgKiBTZXRzIG1vZGUgb2YgdmlydHVhbCBzY3JvbGxlciBpbnN0YW5jZS5cbiAgICogd2luZG93IGlzIHVzZWQgZm9yIGNhc2Ugd2hlbiB3aG9sZSB2aWV3cG9ydCBpcyBzY3JvbGxlZC5cbiAgICogZml4ZWQgY2FuIGJlIHVzZWQgb24gaW5uZXItc2Nyb2xsIGNvbnRhaW5lcnMuXG4gICAqL1xuICBASW5wdXQoKVxuICBwcml2YXRlIGM4eUZvclZpcnR1YWxTY3JvbGxTdHJhdGVneTogJ2ZpeGVkJyB8ICd3aW5kb3cnID0gJ3dpbmRvdyc7XG5cbiAgLyoqXG4gICAqIFdoZW4gdXNlZCBmaXhlZCBzdHJhdGVneSwgdGhlcmUgbmVlZHMgdG8gYmUgZml4ZWQgaGVpZ2h0IHNldCBvbiBzY3JvbGxpbmcgY29udGFpbmVyLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHJpdmF0ZSBjOHlGb3JWaXJ0dWFsU2Nyb2xsQ29udGFpbmVySGVpZ2h0OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBudW1iZXIgb2YgaXRlbXMgY3VycmVudGx5IGxvYWRlZCBpbiB0aGUgbGlzdC5cbiAgICovXG4gIEBPdXRwdXQoKVxuICBwcml2YXRlIGM4eUZvckNvdW50ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG4gIHByaXZhdGUgY291bnQgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdHBsOiBUZW1wbGF0ZVJlZjxhbnk+LFxuICAgIHByaXZhdGUgdmNyOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaGFuZGxlUmVhbHRpbWUoKTtcbiAgfVxuXG4gIHByaXZhdGUgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICh0aGlzLm9icyQgJiYgKGNoYW5nZXMuYzh5Rm9yUGlwZSB8fCBjaGFuZ2VzLmM4eUZvck9mKSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZVBhZ2luZygpO1xuXG4gICAgICBpZiAodGhpcy52aXJ0dWFsU2Nyb2xsSW5zdGFuY2UpIHtcbiAgICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsSW5zdGFuY2UuZmlsdGVyUGlwZSA9IHRoaXMuZGF0YVBpcGU7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7dG9wOiAwfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIG9ubHkgcmUtcmVuZGVyaW5nICBvbiBmaWx0ZXJpbmcgaWYgYWxsIGRhdGEgaXMgYWxyZWFkeSBsb2FkZWRcbiAgICAgIC8vIGZyb20gdGhlIGJhY2tlbmRcbiAgICAgIGNvbnN0IHJlUmVuZGVyID0gIXRoaXMuaGFzTW9yZURhdGEgJiYgISFjaGFuZ2VzLmM4eUZvclBpcGUgJiYgIWNoYW5nZXMuYzh5Rm9yT2Y7XG5cbiAgICAgIGlmIChyZVJlbmRlcikge1xuICAgICAgICB0aGlzLm9icyQgPSBvZih0aGlzLmNhY2hlZERhdGEpO1xuICAgICAgfVxuICAgICAgdGhpcy5wYWdpbmdTdWIgPSB0aGlzLm9icyRcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGFwKGRhdGEgPT4ge1xuICAgICAgICAgICAgaWYgKCFyZVJlbmRlcikge1xuICAgICAgICAgICAgICB0aGlzLmNhY2hlZERhdGEgPSBkYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoc3JjID0+IHRoaXMuZGF0YVBpcGUoc3JjKSlcbiAgICAgICAgLnN1YnNjcmliZSgoZGF0YTogW10pID0+IHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUNvdW50KGRhdGEubGVuZ3RoKTtcbiAgICAgICAgICB0aGlzLnJlbmRlcihkYXRhLCByZVJlbmRlcik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy51bnN1YnNjcmliZVBhZ2luZygpO1xuICAgIHRoaXMudW5zdWJzY3JpYmUkLm5leHQoKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVSZWFsdGltZSgpIHtcbiAgICBpZiAodGhpcy5yZWFsdGltZSkge1xuICAgICAgdGhpcy5oYW5kbGVSZWFsdGltZUNyZWF0ZSgpO1xuICAgICAgdGhpcy5oYW5kbGVSZWFsdGltZVVwZGF0ZSgpO1xuICAgICAgdGhpcy5oYW5kbGVSZWFsdGltZURlbGV0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPbiBjcmVhdGUgbm90aWZpY2F0aW9uOlxuICAgKiAtIGlmIGl0ZW0gcGFzc2VzIGRhdGEgcGlwZSwgdGhlbiBpbnNlcnQgaXQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVJlYWx0aW1lQ3JlYXRlKCkge1xuICAgIGNvbnN0IHsgZW50aXR5T3JJZCB9ID0gdGhpcy5yZWFsdGltZU9wdGlvbnM7XG4gICAgdGhpcy5yZWFsdGltZVxuICAgICAgLm9uQ3JlYXRlJChlbnRpdHlPcklkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGl0ZW0kID0+IHRoaXMuaXRlbURhdGFQaXBlKGl0ZW0kKSxcbiAgICAgICAgZmlsdGVyKGl0ZW0gPT4gaXRlbSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLnVuc3Vic2NyaWJlJClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoaXRlbSA9PiB0aGlzLmluc2VydChpdGVtKSk7XG4gIH1cblxuICAvKipcbiAgICogT24gdXBkYXRlIG5vdGlmaWNhdGlvbjpcbiAgICogLSBpZiBpdGVtIGlzIGRpc3BsYXllZCBhbmQgcGFzc2VzIGRhdGEgcGlwZSwgdGhlbiB1cGRhdGUgaXQsXG4gICAqIC0gaWYgaXRlbSBpcyBkaXNwbGF5ZWQgYW5kIGRvZXNuJ3QgcGFzcyBkYXRhIHBpcGUsIHRoZW4gcmVtb3ZlIGl0IChpZiBgcmVtb3ZlT25VcGRhdGVgIGlzIHRydWUpLFxuICAgKiAtIGlmIGl0ZW0gaXMgbm90IGRpc3BsYXllZCBhbmQgcGFzc2VzIGRhdGEgcGlwZSwgdGhlbiBpbnNlcnQgaXQgKGlmIGBpbnNlcnRPblVwZGF0ZWAgaXMgdHJ1ZSksXG4gICAqIC0gaWYgaXRlbSBpcyBub3QgZGlzcGxheWVkIGFuZCBkb2Vzbid0IHBhc3MgZGF0YSBwaXBlLCB0aGVuIGlnbm9yZSBpdC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgaGFuZGxlUmVhbHRpbWVVcGRhdGUoKSB7XG4gICAgY29uc3QgeyBlbnRpdHlPcklkIH0gPSB0aGlzLnJlYWx0aW1lT3B0aW9ucztcbiAgICB0aGlzLnJlYWx0aW1lXG4gICAgICAub25VcGRhdGUkKGVudGl0eU9ySWQpXG4gICAgICAucGlwZShcbiAgICAgICAgaXRlbSQgPT4gY29tYmluZUxhdGVzdChbXG4gICAgICAgICAgaXRlbSQsXG4gICAgICAgICAgaXRlbSQucGlwZShcbiAgICAgICAgICAgIHNyYyA9PiB0aGlzLml0ZW1EYXRhUGlwZShzcmMpLFxuICAgICAgICAgICAgbWFwKGl0ZW0gPT4gaXRlbSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgIClcbiAgICAgICAgXSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLnVuc3Vic2NyaWJlJClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKFsgaXRlbSwgcGFzc2VzRGF0YVBpcGUgXSkgPT4ge1xuICAgICAgICBjb25zdCB7IGluc2VydE9uVXBkYXRlLCByZW1vdmVPblVwZGF0ZSB9ID0gdGhpcy5yZWFsdGltZU9wdGlvbnM7XG4gICAgICAgIGNvbnN0IGRpc3BsYXllZCA9IHRoaXMuaXNEaXNwbGF5ZWQoY29lcmNlTnVtYmVyUHJvcGVydHkoaXRlbS5pZCkpO1xuICAgICAgICBpZiAoZGlzcGxheWVkKSB7XG4gICAgICAgICAgaWYgKHBhc3Nlc0RhdGFQaXBlKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZShpdGVtKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlbW92ZU9uVXBkYXRlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZShjb2VyY2VOdW1iZXJQcm9wZXJ0eShpdGVtLmlkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBhc3Nlc0RhdGFQaXBlICYmIGluc2VydE9uVXBkYXRlKSB7XG4gICAgICAgICAgdGhpcy5pbnNlcnQoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIGRlbGV0ZSBub3RpZmljYXRpb246XG4gICAqIC0gcmVtb3ZlIGl0ZW0gZnJvbSB0aGUgbGlzdCAoaWYgbm90IHRoZXJlLCBpdCB3aWxsIGJlIGp1c3QgaWdub3JlZCkuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVJlYWx0aW1lRGVsZXRlKCkge1xuICAgIGNvbnN0IHsgZW50aXR5T3JJZCB9ID0gdGhpcy5yZWFsdGltZU9wdGlvbnM7XG4gICAgdGhpcy5yZWFsdGltZVxuICAgICAgLm9uRGVsZXRlJChlbnRpdHlPcklkKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMudW5zdWJzY3JpYmUkKSlcbiAgICAgIC5zdWJzY3JpYmUoaWQgPT4gdGhpcy5yZW1vdmUoY29lcmNlTnVtYmVyUHJvcGVydHkoaWQpKSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlcihkYXRhLCByZVJlbmRlciA9IGZhbHNlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuYzh5Rm9yRW5hYmxlVmlydHVhbFNjcm9sbCkge1xuICAgICAgaWYgKCF0aGlzLnZpcnR1YWxTY3JvbGxJbnN0YW5jZSkge1xuICAgICAgICB0aGlzLnZpcnR1YWxTY3JvbGxJbnN0YW5jZSA9IHRoaXMuY3JlYXRlVmlydHVhbFNjcm9sbFdyYXBwZXJDb21wb25lbnQoKTtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkVXNlTG9hZE1vcmVCdXR0b24pIHtcbiAgICAgICAgICB0aGlzLmxvYWRNb3JlID0gdGhpcy5jcmVhdGVMb2FkTW9yZUJ1dHRvbkNvbXBvbmVudChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRWaXJ0dWFsU2Nyb2xsQ29udGVudHMoZGF0YSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy52Y3IuY2xlYXIoKTtcblxuICAgIGRhdGEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICAgICRpbXBsaWNpdDogaXRlbSxcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIGxlbmd0aDogdGhpcy5sZW5ndGgsXG4gICAgICAgIGhhc01vcmU6IHRoaXMuaGFzTW9yZURhdGEsXG4gICAgICAgIGxvYWRNb3JlQ29tcG9uZW50OiB0aGlzLmxvYWRNb3JlXG4gICAgICB9O1xuICAgICAgdGhpcy52Y3IuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudHBsLCBjb250ZXh0KTtcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLnNob3VsZFVzZUxvYWRNb3JlQnV0dG9uKSB7XG4gICAgICB0aGlzLmxvYWRNb3JlID0gdGhpcy5jcmVhdGVMb2FkTW9yZUJ1dHRvbkNvbXBvbmVudChyZVJlbmRlcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhcHBlbmQoZGF0YSkge1xuICAgIGlmICh0aGlzLmM4eUZvckVuYWJsZVZpcnR1YWxTY3JvbGwpIHtcbiAgICAgIHRoaXMuYXBwZW5kVmlydHVhbFNjcm9sbENvbnRlbnQoZGF0YSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNob3VsZFVzZUxvYWRNb3JlQnV0dG9uID8gdGhpcy52Y3IubGVuZ3RoIC0gMSA6IHRoaXMudmNyLmxlbmd0aDtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICAgICRpbXBsaWNpdDogaXRlbSxcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIGxlbmd0aDogdGhpcy5sZW5ndGgsXG4gICAgICAgIGhhc01vcmU6IHRoaXMuaGFzTW9yZURhdGEsXG4gICAgICAgIGxvYWRNb3JlQ29tcG9uZW50OiB0aGlzLmxvYWRNb3JlXG4gICAgICB9O1xuICAgICAgdGhpcy52Y3IuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudHBsLCBjb250ZXh0LCBpbmRleCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxvYWRNb3JlRGF0YShkYXRhKSB7XG4gICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy51cGRhdGVDb3VudChkYXRhLmxlbmd0aCk7XG4gICAgICB0aGlzLmFwcGVuZChkYXRhKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUxvYWRNb3JlQnV0dG9uQ29tcG9uZW50KHJlUmVuZGVyKSB7XG4gICAgY29uc3QgY29tcG9uZW50RmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxcbiAgICAgIGFueVxuICAgID4gPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShMb2FkTW9yZUNvbXBvbmVudCk7XG4gICAgY29uc3QgY29tcG9uZW50UmVmID0gdGhpcy52Y3IuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnkpO1xuICAgIGNvbnN0IGluc3RhbmNlID0gY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIExvYWRNb3JlQ29tcG9uZW50O1xuICAgIGluc3RhbmNlLnBhZ2luZyA9IHRoaXMucGFnaW5nO1xuICAgIGluc3RhbmNlLnVzZUludGVyc2VjdGlvbiA9IHRoaXMubG9hZE1vcmVNb2RlID09PSAnYXV0bycgfHwgdGhpcy5sb2FkTW9yZU1vZGUgPT09ICdoaWRkZW4nO1xuICAgIGluc3RhbmNlLmhpZGRlbiA9IHRoaXMubG9hZE1vcmVNb2RlID09PSAnaGlkZGVuJztcbiAgICBpbnN0YW5jZS5tYXhJdGVyYXRpb25zID0gdGhpcy5tYXhJdGVyYXRpb25zO1xuICAgIGluc3RhbmNlLm5vTW9yZURhdGFIaW50ID0gdGhpcy5ub3RGb3VuZFRlbXBsYXRlO1xuICAgIGluc3RhbmNlLmxvYWRpbmdUZW1wbGF0ZSA9IHRoaXMubG9hZGluZ1RlbXBsYXRlO1xuICAgIGluc3RhbmNlLmxvYWROZXh0TGFiZWwgPSB0aGlzLmxvYWROZXh0TGFiZWw7XG4gICAgdGhpcy5wYWdpbmdTdWIgPSBpbnN0YW5jZS5vbkxvYWRcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGRhdGE6IFtdKSA9PiB0aGlzLmNoZWNrRm9yRHVwbGljYXRlcyhkYXRhKSksXG4gICAgICAgIHRhcCgoZGF0YTogW10pID0+IHtcbiAgICAgICAgICB0aGlzLmNhY2hlZERhdGEgPSB0aGlzLmNhY2hlZERhdGEuY29uY2F0KGRhdGEpO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnBpcGUoc3JjID0+IHRoaXMuZGF0YVBpcGUoc3JjKSlcbiAgICAgIC5zdWJzY3JpYmUoZGF0YSA9PiB0aGlzLmxvYWRNb3JlRGF0YShkYXRhKSk7XG4gICAgaWYgKHJlUmVuZGVyKSB7XG4gICAgICBhc3NpZ24oaW5zdGFuY2UsIHRoaXMubG9hZE1vcmUpO1xuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVZpcnR1YWxTY3JvbGxXcmFwcGVyQ29tcG9uZW50KCkge1xuICAgIGNvbnN0IGNvbXBvbmVudEZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8YW55PlxuICAgICAgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShWaXJ0dWFsU2Nyb2xsZXJXcmFwcGVyQ29tcG9uZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLnZjci5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgY29uc3QgaW5zdGFuY2UgPSBjb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVmlydHVhbFNjcm9sbGVyV3JhcHBlckNvbXBvbmVudDtcbiAgICBpbnN0YW5jZS5pdGVtcyA9IHRoaXMuY2FjaGVkRGF0YTtcbiAgICBpbnN0YW5jZS5pdGVtSGVpZ2h0ID0gdGhpcy5jOHlGb3JWaXJ0dWFsU2Nyb2xsRWxlbWVudFNpemU7XG4gICAgaW5zdGFuY2UudGVtcGxhdGUgPSB0aGlzLnRwbDtcbiAgICBpbnN0YW5jZS5zdHJhdGVneSA9IHRoaXMuYzh5Rm9yVmlydHVhbFNjcm9sbFN0cmF0ZWd5O1xuICAgIGluc3RhbmNlLmNvbnRhaW5lckhlaWdodCA9IHRoaXMuYzh5Rm9yVmlydHVhbFNjcm9sbENvbnRhaW5lckhlaWdodDtcblxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0KGl0ZW0pIHtcbiAgICBsZXQgaW5kZXg6IG51bWJlciA9IDA7XG5cbiAgICBpZiAodGhpcy5jb21wYXJhdG9yICYmIHRoaXMuY2FjaGVkRGF0YS5sZW5ndGgpIHtcbiAgICAgIGxldCBjb21wYXJpc2lvblJlc3VsdDogbnVtYmVyO1xuICAgICAgZG8ge1xuICAgICAgICBjb25zdCB2aWV3OiBFbWJlZGRlZFZpZXdSZWY8YW55PiA9IHRoaXMudmNyLmdldChpbmRleCkgYXMgRW1iZWRkZWRWaWV3UmVmPGFueT47XG4gICAgICAgIGNvbnN0IGl0ZW1CID0gZ2V0KHZpZXcsICdjb250ZXh0LiRpbXBsaWNpdCcpO1xuICAgICAgICBjb21wYXJpc2lvblJlc3VsdCA9IGl0ZW0gJiYgaXRlbUIgPyB0aGlzLmNvbXBhcmF0b3IoaXRlbSwgaXRlbUIpIDogMDtcbiAgICAgICAgaWYgKGNvbXBhcmlzaW9uUmVzdWx0IDw9IDApIHtcbiAgICAgICAgICBpbmRleCsrO1xuICAgICAgICB9XG4gICAgICB9IHdoaWxlIChjb21wYXJpc2lvblJlc3VsdCA8PSAwICYmIGluZGV4IDwgdGhpcy5jYWNoZWREYXRhLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgLy8gRG8gbm90IGFwcGVuZCBlbGVtZW50cyBhZnRlciB0aGUgbGFzdCBvbmUgY3VycmVudGx5IGxvYWRlZCxcbiAgICAvLyBhcyBpdCBtYXkgYmVsb25nIGZ1cnRoZXIgZG93biB0aGVyZSBvbiB0aGUgbGlzdCBhbmQgd2lsbFxuICAgIC8vIGJlIGV2ZW50dWFsbHkgbG9hZGVkIHdpdGggb25lIG9mIHRoZSBuZXh0IHBhZ2VzLlxuICAgIGlmIChpbmRleCA8IHRoaXMuY2FjaGVkRGF0YS5sZW5ndGggfHwgdGhpcy5jYWNoZWREYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgICAgJGltcGxpY2l0OiBpdGVtLFxuICAgICAgICBpbmRleCxcbiAgICAgICAgbGVuZ3RoOiB0aGlzLmxlbmd0aCxcbiAgICAgICAgaGFzTW9yZTogdGhpcy5oYXNNb3JlRGF0YVxuICAgICAgfTtcblxuICAgICAgdGhpcy5jYWNoZWREYXRhLnNwbGljZShpbmRleCwgMCwgaXRlbSk7XG4gICAgICBjb25zdCB2aWV3UmVmOiBWaWV3UmVmID0gdGhpcy50cGwuY3JlYXRlRW1iZWRkZWRWaWV3KGNvbnRleHQpO1xuICAgICAgdGhpcy52Y3IuaW5zZXJ0KHZpZXdSZWYsIGluZGV4KTtcbiAgICAgIHRoaXMudXBkYXRlQ291bnQoMSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGUodXBkYXRlZEl0ZW0pIHtcbiAgICB0aGlzLmZvck1hdGNoaW5nRW1iZWRkZWRWaWV3UmVmKFxuICAgICAgKGl0ZW06IElJZGVudGlmaWVkKSA9PiBpdGVtICYmIHVwZGF0ZWRJdGVtICYmIGl0ZW0uaWQgPT09IHVwZGF0ZWRJdGVtLmlkLFxuICAgICAgKHZpZXc6IEVtYmVkZGVkVmlld1JlZjxhbnk+KSA9PiB7XG4gICAgICAgIHZpZXcuY29udGV4dC4kaW1wbGljaXQgPSB1cGRhdGVkSXRlbTtcbiAgICAgICAgdmlldy5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmUoaWRUb1JlbW92ZSkge1xuICAgIGlmICh0aGlzLmlzRGlzcGxheWVkKGlkVG9SZW1vdmUpKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNvdW50KC0xKTtcbiAgICB9XG4gICAgdGhpcy5mb3JNYXRjaGluZ0VtYmVkZGVkVmlld1JlZihcbiAgICAgIChpdGVtOiBJSWRlbnRpZmllZCkgPT4gaXRlbSAmJiBjb2VyY2VOdW1iZXJQcm9wZXJ0eShpdGVtLmlkLCBOYU4pID09PSBpZFRvUmVtb3ZlLFxuICAgICAgKHZpZXc6IEVtYmVkZGVkVmlld1JlZjxhbnk+KSA9PiB2aWV3LmRlc3Ryb3koKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUNvdW50KGNvdW50Q2hhbmdlOiBudW1iZXIpIHtcbiAgICB0aGlzLmNvdW50ICs9IGNvdW50Q2hhbmdlO1xuICAgIHRoaXMuYzh5Rm9yQ291bnQuZW1pdCh0aGlzLmNvdW50KTtcbiAgfVxuXG4gIHByaXZhdGUgaXNEaXNwbGF5ZWQoaWRUb0NoZWNrKSB7XG4gICAgbGV0IGRpc3BsYXllZCA9IGZhbHNlO1xuICAgIHRoaXMuZm9yTWF0Y2hpbmdFbWJlZGRlZFZpZXdSZWYoXG4gICAgICAoaXRlbTogSUlkZW50aWZpZWQpID0+IGl0ZW0gJiYgY29lcmNlTnVtYmVyUHJvcGVydHkoaXRlbS5pZCwgTmFOKSA9PT0gaWRUb0NoZWNrLFxuICAgICAgKCkgPT4geyBkaXNwbGF5ZWQgPSB0cnVlOyB9XG4gICAgKTtcbiAgICByZXR1cm4gZGlzcGxheWVkO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JNYXRjaGluZ0VtYmVkZGVkVmlld1JlZihcbiAgICBmaWx0ZXJGbjogKGl0ZW06IElJZGVudGlmaWVkKSA9PiBib29sZWFuLFxuICAgIGNhbGxiYWNrRm46ICh2aWV3OiBFbWJlZGRlZFZpZXdSZWY8YW55PikgPT4gdm9pZFxuICApIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmNyLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB2aWV3OiBFbWJlZGRlZFZpZXdSZWY8YW55PiA9IHRoaXMudmNyLmdldChpKSBhcyBFbWJlZGRlZFZpZXdSZWY8YW55PjtcbiAgICAgIGNvbnN0IGl0ZW06IElJZGVudGlmaWVkID0gZ2V0KHZpZXcsICdjb250ZXh0LiRpbXBsaWNpdCcpO1xuICAgICAgaWYgKGZpbHRlckZuKGl0ZW0pKSB7XG4gICAgICAgIGNhbGxiYWNrRm4odmlldyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0ZvckR1cGxpY2F0ZXMoZGF0YTogSUlkZW50aWZpZWRbXSk6IElJZGVudGlmaWVkW10ge1xuICAgIHJldHVybiB0aGlzLnJlYWx0aW1lXG4gICAgICA/IGRhdGEuZmlsdGVyKGl0ZW0gPT4gIXRoaXMuY2FjaGVkRGF0YS5zb21lKGNhY2hlZCA9PiBjYWNoZWQuaWQgPT09IGl0ZW0uaWQpKVxuICAgICAgOiBkYXRhO1xuICB9XG5cbiAgcHJpdmF0ZSB1bnN1YnNjcmliZVBhZ2luZygpIHtcbiAgICBpZiAodGhpcy5wYWdpbmdTdWIpIHtcbiAgICAgIHRoaXMucGFnaW5nU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaXJ0dWFsU2Nyb2xsQ29udGVudHMoaXRlbXMpIHtcbiAgICBpZiAodGhpcy5jOHlGb3JFbmFibGVWaXJ0dWFsU2Nyb2xsICYmIHRoaXMudmlydHVhbFNjcm9sbEluc3RhbmNlKSB7XG4gICAgICB0aGlzLnZpcnR1YWxTY3JvbGxJbnN0YW5jZS5pdGVtcyA9IGl0ZW1zO1xuICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsSW5zdGFuY2UuYXBwbHkoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFwcGVuZFZpcnR1YWxTY3JvbGxDb250ZW50KGl0ZW1zKSB7XG4gICAgaWYgKHRoaXMuYzh5Rm9yRW5hYmxlVmlydHVhbFNjcm9sbCAmJiB0aGlzLnZpcnR1YWxTY3JvbGxJbnN0YW5jZSkge1xuICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsSW5zdGFuY2UuaXRlbXMgPSB0aGlzLnZpcnR1YWxTY3JvbGxJbnN0YW5jZS5pdGVtcy5jb25jYXQoaXRlbXMpO1xuICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsSW5zdGFuY2UuYXBwbHkoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==