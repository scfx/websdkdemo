import { __awaiter } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { Status } from '../../../common/status.model';
import { gettext } from '../../../i18n/gettext';
import { CookieBannerService } from '../cookie-banner.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../cookie-banner.service';
import * as ɵngcc2 from '../../../modal/modal-confirm.component';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/forms';
import * as ɵngcc5 from '../../../common/humanize.pipe';
import * as ɵngcc6 from '../../../i18n/c8y-translate.pipe';

const _c0 = ["modalRef"];
function CookieBannerPreferencesModalComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵelementStart(1, "div", 4);
    ɵngcc0.ɵɵelementStart(2, "div", 5);
    ɵngcc0.ɵɵelementStart(3, "label", 6);
    ɵngcc0.ɵɵelementStart(4, "input", 7);
    ɵngcc0.ɵɵlistener("ngModelChange", function CookieBannerPreferencesModalComponent_div_2_Template_input_ngModelChange_4_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r4); const item_r2 = restoredCtx.$implicit; return item_r2.value = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(5, "span");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 8);
    ɵngcc0.ɵɵelementStart(7, "h4", 9);
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "humanize");
    ɵngcc0.ɵɵpipe(10, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(11, "p");
    ɵngcc0.ɵɵtext(12);
    ɵngcc0.ɵɵpipe(13, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r2 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵpropertyInterpolate("name", item_r2.name);
    ɵngcc0.ɵɵproperty("ngModel", item_r2.value)("disabled", item_r2.isReadonly);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 5, ɵngcc0.ɵɵpipeBind1(10, 7, item_r2.name)), " ");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 9, ctx_r1.getCookieDescription(item_r2.name)), " ");
} }
export class CookieBannerPreferencesModalComponent {
    constructor(cookieBannerService) {
        this.cookieBannerService = cookieBannerService;
        this.closeSubject = new Subject();
        this.title = gettext('Cookie preferences');
        this.labels = { ok: gettext('Save settings'), cancel: gettext('Cancel') };
        this.status = Status.INFO;
    }
    ngOnInit() {
        this.configCookiePreferencesList = this.cookieBannerService.transformCookiePreferencesToList(this.configCookiePreferences);
    }
    ngAfterViewInit() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.modalRef.result;
                this.onClose();
            }
            catch (error) {
                this.onDismiss();
            }
        });
    }
    onClose() {
        const cookiePref = this.cookieBannerService.transformCookiePreferencesListToCookiePreferences(this.configCookiePreferencesList);
        this.closeSubject.next(cookiePref);
        this.closeSubject.complete();
    }
    onDismiss() {
        this.closeSubject.next(undefined);
        this.closeSubject.complete();
    }
    getCookieDescription(cookieType) {
        return this.cookieBannerService.getCookieDescription(cookieType);
    }
}
CookieBannerPreferencesModalComponent.ɵfac = function CookieBannerPreferencesModalComponent_Factory(t) { return new (t || CookieBannerPreferencesModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.CookieBannerService)); };
CookieBannerPreferencesModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CookieBannerPreferencesModalComponent, selectors: [["c8y-cookie-banner-preferences-modal"]], viewQuery: function CookieBannerPreferencesModalComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.modalRef = _t.first);
    } }, decls: 3, vars: 4, consts: [[3, "title", "status", "labels"], ["modalRef", ""], ["class", "row p-t-8 p-b-8 separator-top", 4, "ngFor", "ngForOf"], [1, "row", "p-t-8", "p-b-8", "separator-top"], [1, "col-xs-2"], [1, "text-center"], [1, "c8y-switch"], ["type", "checkbox", 3, "name", "ngModel", "disabled", "ngModelChange"], [1, "col-xs-10"], [1, "text-medium"]], template: function CookieBannerPreferencesModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-confirm-modal", 0, 1);
        ɵngcc0.ɵɵtemplate(2, CookieBannerPreferencesModalComponent_div_2_Template, 14, 11, "div", 2);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("title", ctx.title)("status", ctx.status)("labels", ctx.labels);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.configCookiePreferencesList);
    } }, directives: [ɵngcc2.ConfirmModalComponent, ɵngcc3.NgForOf, ɵngcc4.CheckboxControlValueAccessor, ɵngcc4.NgControlStatus, ɵngcc4.NgModel], pipes: [ɵngcc5.HumanizePipe, ɵngcc6.C8yTranslatePipe], encapsulation: 2 });
CookieBannerPreferencesModalComponent.ctorParameters = () => [
    { type: CookieBannerService }
];
CookieBannerPreferencesModalComponent.propDecorators = {
    modalRef: [{ type: ViewChild, args: ['modalRef', { static: false },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CookieBannerPreferencesModalComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-cookie-banner-preferences-modal',
                template: "<c8y-confirm-modal [title]=\"title\" [status]=\"status\" [labels]=\"labels\" #modalRef>\n\n  <div *ngFor=\"let item of configCookiePreferencesList\" class=\"row p-t-8 p-b-8 separator-top\">\n    <div class=\"col-xs-2\">\n      <div class=\"text-center\">\n        <label class=\"c8y-switch\">\n          <input\n            name=\"{{ item.name }}\"\n            type=\"checkbox\"\n            [(ngModel)]=\"item.value\"\n            [disabled]=\"item.isReadonly\"\n          />\n          <span></span>\n        </label>\n      </div>\n    </div>\n    <div class=\"col-xs-10\">\n      <h4 class=\"text-medium\">\n        {{ item.name | translate | humanize }}\n      </h4>\n      <p>\n        {{ getCookieDescription(item.name) | translate }}\n      </p>\n    </div>\n  </div>\n</c8y-confirm-modal>\n"
            }]
    }], function () { return [{ type: ɵngcc1.CookieBannerService }]; }, { modalRef: [{
            type: ViewChild,
            args: ['modalRef', { static: false }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLWJhbm5lci1wcmVmZXJlbmNlcy1tb2RhbC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2NvcmUvYm9vdHN0cmFwL2Nvb2tpZS1iYW5uZXIvY29va2llLWJhbm5lci1wcmVmZXJlbmNlcy1tb2RhbC9jb29raWUtYmFubmVyLXByZWZlcmVuY2VzLW1vZGFsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFjLE1BQU0sOEJBQThCLENBQUM7QUFDbEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBSWhELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTS9ELE1BQU0sT0FBTyxxQ0FBcUM7QUFDbEQsSUFRRSxZQUFvQixtQkFBd0M7QUFBSSxRQUE1Qyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO0FBQUMsUUFQN0QsaUJBQVksR0FBK0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUMzRCxRQUFFLFVBQUssR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUN4QyxRQUFFLFdBQU0sR0FBZ0IsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztBQUNwRixRQUFFLFdBQU0sR0FBZSxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ25DLElBR2lFLENBQUM7QUFDbEUsSUFDRSxRQUFRO0FBQ1YsUUFBSSxJQUFJLENBQUMsMkJBQTJCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGdDQUFnQyxDQUMxRixJQUFJLENBQUMsdUJBQXVCLENBQzdCLENBQUM7QUFDTixJQUFFLENBQUM7QUFDSCxJQUNRLGVBQWU7QUFDdkI7QUFFa0IsWUFGZCxJQUFJO0FBQ1IsZ0JBQU0sTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztBQUNqQyxnQkFBTSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDckIsYUFBSztBQUFDLFlBQUEsT0FBTyxLQUFLLEVBQUU7QUFDcEIsZ0JBQU0sSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0FBQ3ZCLGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDRSxPQUFPO0FBQ1QsUUFBSSxNQUFNLFVBQVUsR0FBc0IsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGlEQUFpRCxDQUM5RyxJQUFJLENBQUMsMkJBQTJCLENBQ2pDLENBQUM7QUFDTixRQUNJLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3ZDLFFBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUNqQyxJQUFFLENBQUM7QUFDSCxJQUNFLFNBQVM7QUFDWCxRQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3RDLFFBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUNqQyxJQUFFLENBQUM7QUFDSCxJQUNFLG9CQUFvQixDQUFDLFVBQW1EO0FBQUksUUFDMUUsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDckUsSUFBRSxDQUFDO0FBQ0g7aUVBL0NDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUscUNBQXFDLGtCQUMvQzs7Ozs7O3NVQUErRCxjQUNoRTs7Ozs7Ozs7Nk5BQ0k7QUFBQztBQUNVLFlBUFAsbUJBQW1CO0FBQUc7QUFBRztBQUdyQix1QkFJVixTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTtBQUFNOzs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgU3RhdHVzLCBTdGF0dXNUeXBlIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL3N0YXR1cy5tb2RlbCc7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnLi4vLi4vLi4vaTE4bi9nZXR0ZXh0JztcbmltcG9ydCB7IENvbmZpcm1Nb2RhbENvbXBvbmVudCB9IGZyb20gJy4uLy4uLy4uL21vZGFsL21vZGFsLWNvbmZpcm0uY29tcG9uZW50JztcbmltcG9ydCB7IE1vZGFsTGFiZWxzIH0gZnJvbSAnLi4vLi4vLi4vc2VsZWN0LW1vZGFsL3NlbGVjdC1tb2RhbC5tb2RlbCc7XG5pbXBvcnQgeyBDb29raWUsIENvb2tpZVByZWZlcmVuY2VzIH0gZnJvbSAnLi4vY29va2llLWJhbm5lci5tb2RlbCc7XG5pbXBvcnQgeyBDb29raWVCYW5uZXJTZXJ2aWNlIH0gZnJvbSAnLi4vY29va2llLWJhbm5lci5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWNvb2tpZS1iYW5uZXItcHJlZmVyZW5jZXMtbW9kYWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vY29va2llLWJhbm5lci1wcmVmZXJlbmNlcy1tb2RhbC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQ29va2llQmFubmVyUHJlZmVyZW5jZXNNb2RhbENvbXBvbmVudCB7XG4gIEBWaWV3Q2hpbGQoJ21vZGFsUmVmJywgeyBzdGF0aWM6IGZhbHNlIH0pIG1vZGFsUmVmOiBDb25maXJtTW9kYWxDb21wb25lbnQ7XG4gIGNsb3NlU3ViamVjdDogU3ViamVjdDxDb29raWVQcmVmZXJlbmNlcz4gPSBuZXcgU3ViamVjdCgpO1xuICB0aXRsZSA9IGdldHRleHQoJ0Nvb2tpZSBwcmVmZXJlbmNlcycpO1xuICBsYWJlbHM6IE1vZGFsTGFiZWxzID0geyBvazogZ2V0dGV4dCgnU2F2ZSBzZXR0aW5ncycpLCBjYW5jZWw6IGdldHRleHQoJ0NhbmNlbCcpIH07XG4gIHN0YXR1czogU3RhdHVzVHlwZSA9IFN0YXR1cy5JTkZPO1xuICBjb25maWdDb29raWVQcmVmZXJlbmNlczogQ29va2llUHJlZmVyZW5jZXM7XG4gIGNvbmZpZ0Nvb2tpZVByZWZlcmVuY2VzTGlzdDogQ29va2llW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb29raWVCYW5uZXJTZXJ2aWNlOiBDb29raWVCYW5uZXJTZXJ2aWNlKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY29uZmlnQ29va2llUHJlZmVyZW5jZXNMaXN0ID0gdGhpcy5jb29raWVCYW5uZXJTZXJ2aWNlLnRyYW5zZm9ybUNvb2tpZVByZWZlcmVuY2VzVG9MaXN0KFxuICAgICAgdGhpcy5jb25maWdDb29raWVQcmVmZXJlbmNlc1xuICAgICk7XG4gIH1cblxuICBhc3luYyBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubW9kYWxSZWYucmVzdWx0O1xuICAgICAgdGhpcy5vbkNsb3NlKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMub25EaXNtaXNzKCk7XG4gICAgfVxuICB9XG5cbiAgb25DbG9zZSgpIHtcbiAgICBjb25zdCBjb29raWVQcmVmOiBDb29raWVQcmVmZXJlbmNlcyA9IHRoaXMuY29va2llQmFubmVyU2VydmljZS50cmFuc2Zvcm1Db29raWVQcmVmZXJlbmNlc0xpc3RUb0Nvb2tpZVByZWZlcmVuY2VzKFxuICAgICAgdGhpcy5jb25maWdDb29raWVQcmVmZXJlbmNlc0xpc3RcbiAgICApO1xuXG4gICAgdGhpcy5jbG9zZVN1YmplY3QubmV4dChjb29raWVQcmVmKTtcbiAgICB0aGlzLmNsb3NlU3ViamVjdC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgb25EaXNtaXNzKCkge1xuICAgIHRoaXMuY2xvc2VTdWJqZWN0Lm5leHQodW5kZWZpbmVkKTtcbiAgICB0aGlzLmNsb3NlU3ViamVjdC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgZ2V0Q29va2llRGVzY3JpcHRpb24oY29va2llVHlwZTogJ3JlcXVpcmVkJyB8ICdmdW5jdGlvbmFsJyB8ICdtYXJrZXRpbmcnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jb29raWVCYW5uZXJTZXJ2aWNlLmdldENvb2tpZURlc2NyaXB0aW9uKGNvb2tpZVR5cGUpO1xuICB9XG59XG4iXX0=