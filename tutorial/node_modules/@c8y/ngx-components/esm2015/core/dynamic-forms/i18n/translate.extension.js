import { combineLatest, isObservable, of } from 'rxjs';
import { map } from 'rxjs/operators';
import { gettext } from '../../i18n';
export class TranslateExtension {
    constructor(translate, parser) {
        this.translate = translate;
        this.parser = parser;
    }
    prePopulate(field) {
        const to = field.templateOptions || {};
        if (!to.label || to._translated) {
            return;
        }
        to._translated = true;
        field.expressionProperties = Object.assign(Object.assign({}, (field.expressionProperties || {})), { 'templateOptions.label': to.label ? this.translate.stream(to.label) : to.label, 'templateOptions.description': to.description
                ? this.translate.stream(to.description)
                : to.description, 'templateOptions.placeholder': to.placeholder
                ? combineLatest([
                    this.translate.stream(to.placeholder),
                    this.translate.stream(gettext('e.g. {{ example }}'))
                ]).pipe(map(([placeholder, expression]) => this.parser.interpolate(expression, { example: placeholder })))
                : to.placeholder, 'templateOptions.options': (isObservable(to.options) ? to.options : of(to.options)).pipe(map((options) => (options || []).map(option => (Object.assign(Object.assign({}, option), { label: this.translate.instant(option.label) }))))) });
    }
}
export function registerTranslateExtension(translate, parser) {
    return {
        extensions: [
            {
                name: 'translate',
                extension: new TranslateExtension(translate, parser)
            }
        ]
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRlLmV4dGVuc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvcmUvZHluYW1pYy1mb3Jtcy9pMThuL3RyYW5zbGF0ZS5leHRlbnNpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRXJDLE1BQU0sT0FBTyxrQkFBa0I7SUFDN0IsWUFBb0IsU0FBMkIsRUFBVSxNQUF1QjtRQUE1RCxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQWlCO0lBQUcsQ0FBQztJQUNwRixXQUFXLENBQUMsS0FBd0I7UUFDbEMsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLGVBQWUsSUFBSSxFQUFFLENBQUM7UUFDdkMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUMvQixPQUFPO1NBQ1I7UUFFRCxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN0QixLQUFLLENBQUMsb0JBQW9CLG1DQUNyQixDQUFDLEtBQUssQ0FBQyxvQkFBb0IsSUFBSSxFQUFFLENBQUMsS0FDckMsdUJBQXVCLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUM5RSw2QkFBNkIsRUFBRSxFQUFFLENBQUMsV0FBVztnQkFDM0MsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUM7Z0JBQ3ZDLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUNsQiw2QkFBNkIsRUFBRSxFQUFFLENBQUMsV0FBVztnQkFDM0MsQ0FBQyxDQUFDLGFBQWEsQ0FBQztvQkFDWixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDO29CQUNyQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztpQkFDckQsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FDbEc7Z0JBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQ2xCLHlCQUF5QixFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDdEYsR0FBRyxDQUFDLENBQUMsT0FBaUMsRUFBRSxFQUFFLENBQ3hDLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLGlDQUN6QixNQUFNLEtBQ1QsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFDM0MsQ0FBQyxDQUNKLENBQ0YsR0FDRixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBRUQsTUFBTSxVQUFVLDBCQUEwQixDQUFDLFNBQTJCLEVBQUUsTUFBdUI7SUFDN0YsT0FBTztRQUNMLFVBQVUsRUFBRTtZQUNWO2dCQUNFLElBQUksRUFBRSxXQUFXO2dCQUNqQixTQUFTLEVBQUUsSUFBSSxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDO2FBQ3JEO1NBQ0Y7S0FDRixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVQYXJzZXIsIFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIGlzT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICcuLi8uLi9pMThuJztcblxuZXhwb3J0IGNsYXNzIFRyYW5zbGF0ZUV4dGVuc2lvbiB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLCBwcml2YXRlIHBhcnNlcjogVHJhbnNsYXRlUGFyc2VyKSB7fVxuICBwcmVQb3B1bGF0ZShmaWVsZDogRm9ybWx5RmllbGRDb25maWcpIHtcbiAgICBjb25zdCB0byA9IGZpZWxkLnRlbXBsYXRlT3B0aW9ucyB8fCB7fTtcbiAgICBpZiAoIXRvLmxhYmVsIHx8IHRvLl90cmFuc2xhdGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdG8uX3RyYW5zbGF0ZWQgPSB0cnVlO1xuICAgIGZpZWxkLmV4cHJlc3Npb25Qcm9wZXJ0aWVzID0ge1xuICAgICAgLi4uKGZpZWxkLmV4cHJlc3Npb25Qcm9wZXJ0aWVzIHx8IHt9KSxcbiAgICAgICd0ZW1wbGF0ZU9wdGlvbnMubGFiZWwnOiB0by5sYWJlbCA/IHRoaXMudHJhbnNsYXRlLnN0cmVhbSh0by5sYWJlbCkgOiB0by5sYWJlbCxcbiAgICAgICd0ZW1wbGF0ZU9wdGlvbnMuZGVzY3JpcHRpb24nOiB0by5kZXNjcmlwdGlvblxuICAgICAgICA/IHRoaXMudHJhbnNsYXRlLnN0cmVhbSh0by5kZXNjcmlwdGlvbilcbiAgICAgICAgOiB0by5kZXNjcmlwdGlvbixcbiAgICAgICd0ZW1wbGF0ZU9wdGlvbnMucGxhY2Vob2xkZXInOiB0by5wbGFjZWhvbGRlclxuICAgICAgICA/IGNvbWJpbmVMYXRlc3QoW1xuICAgICAgICAgICAgdGhpcy50cmFuc2xhdGUuc3RyZWFtKHRvLnBsYWNlaG9sZGVyKSxcbiAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlLnN0cmVhbShnZXR0ZXh0KCdlLmcuIHt7IGV4YW1wbGUgfX0nKSlcbiAgICAgICAgICBdKS5waXBlKFxuICAgICAgICAgICAgbWFwKChbcGxhY2Vob2xkZXIsIGV4cHJlc3Npb25dKSA9PiB0aGlzLnBhcnNlci5pbnRlcnBvbGF0ZShleHByZXNzaW9uLCB7IGV4YW1wbGU6IHBsYWNlaG9sZGVyIH0pKVxuICAgICAgICAgIClcbiAgICAgICAgOiB0by5wbGFjZWhvbGRlcixcbiAgICAgICd0ZW1wbGF0ZU9wdGlvbnMub3B0aW9ucyc6IChpc09ic2VydmFibGUodG8ub3B0aW9ucykgPyB0by5vcHRpb25zIDogb2YodG8ub3B0aW9ucykpLnBpcGUoXG4gICAgICAgIG1hcCgob3B0aW9uczogQXJyYXk8eyBsYWJlbDogc3RyaW5nIH0+KSA9PlxuICAgICAgICAgIChvcHRpb25zIHx8IFtdKS5tYXAob3B0aW9uID0+ICh7XG4gICAgICAgICAgICAuLi5vcHRpb24sXG4gICAgICAgICAgICBsYWJlbDogdGhpcy50cmFuc2xhdGUuaW5zdGFudChvcHRpb24ubGFiZWwpXG4gICAgICAgICAgfSkpXG4gICAgICAgIClcbiAgICAgIClcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclRyYW5zbGF0ZUV4dGVuc2lvbih0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsIHBhcnNlcjogVHJhbnNsYXRlUGFyc2VyKSB7XG4gIHJldHVybiB7XG4gICAgZXh0ZW5zaW9uczogW1xuICAgICAge1xuICAgICAgICBuYW1lOiAndHJhbnNsYXRlJyxcbiAgICAgICAgZXh0ZW5zaW9uOiBuZXcgVHJhbnNsYXRlRXh0ZW5zaW9uKHRyYW5zbGF0ZSwgcGFyc2VyKVxuICAgICAgfVxuICAgIF1cbiAgfTtcbn1cbiJdfQ==