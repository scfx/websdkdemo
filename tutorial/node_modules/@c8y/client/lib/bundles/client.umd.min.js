!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.cumulocity={})}(this,function(t){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var i,r=n(function(t,e){t.exports=function(){var t={isString:function(t){return void 0!==t&&null!==t&&("string"==typeof t||t instanceof String)},isArray:function(t){return void 0!==t&&null!==t&&t instanceof Array},inArray:function(t,e){for(var n=0;n<e.length;++n)if(t===e[n])return n;return-1}},e=function(){var e,n,i;this.registered=function(t,i){e=t,n=i},this.unregistered=function(){e=null,n=null},this._debug=function(){n._debug.apply(n,arguments)},this._mixin=function(){return n._mixin.apply(n,arguments)},this.getConfiguration=function(){return n.getConfiguration()},this.getAdvice=function(){return n.getAdvice()},this.setTimeout=function(t,e){return n.setTimeout(t,e)},this.clearTimeout=function(t){n.clearTimeout(t)},this.convertToMessages=function(e){if(t.isString(e))try{return JSON.parse(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(t.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(t,e,n){throw"Abstract"},this.getType=function(){return e},this.getURL=function(){return i},this.setURL=function(t){i=t},this.send=function(t,e){throw"Abstract"},this.reset=function(t){this._debug("Transport",e,"reset",t?"initial":"retry")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}};e.derive=function(t){function e(){}return e.prototype=t,new e};var n=function(){var n=new e,i=e.derive(n),r=0,s=null,o=[],a=[];function c(t,e){if(this.transportSend(t,e),e.expired=!1,!t.sync){var n=this.getConfiguration().maxNetworkDelay,i=n;!0===e.metaConnect&&(i+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",i,"ms for the response, maxNetworkDelay",n);var r=this;e.timeout=this.setTimeout(function(){e.expired=!0;var n="Request "+e.id+" of transport "+r.getType()+" exceeded "+i+" ms max network delay",s={reason:n},o=e.xhr;s.httpCode=r.xhrStatus(o),r.abortXHR(o),r._debug(n),r.complete(e,!1,e.metaConnect),t.onFailure(o,t.messages,s)},i)}}function u(t){var e=++r,n={id:e,metaConnect:!1,envelope:t};o.length<this.getConfiguration().maxConnections-1?(o.push(n),c.call(this,t,n)):(this._debug("Transport",this.getType(),"queueing request",e,"envelope",t),a.push([t,n]))}function l(e,n){var i=t.inArray(e,o);if(i>=0&&o.splice(i,1),a.length>0){var r=a.shift(),s=r[0],c=r[1];if(this._debug("Transport dequeued request",c.id),n)this.getConfiguration().autoBatch&&function(t){for(;a.length>0;){var e=a[0],n=e[0],i=e[1];if(n.url!==t.url||n.sync!==t.sync)break;a.shift(),t.messages=t.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",i.id)}}.call(this,s),u.call(this,s),this._debug("Transport completed request",e.id,s);else{var l=this;this.setTimeout(function(){l.complete(c,!1,c.metaConnect);var t={reason:"Previous request failed"},e=c.xhr;t.httpCode=l.xhrStatus(e),s.onFailure(e,s.messages,t)},0)}}}return i.complete=function(t,e,n){n?function(t){var e=t.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",e),null!==s&&s.id!==e)throw"/meta/connect request mismatch, completing request "+e;s=null}.call(this,t):l.call(this,t,e)},i.transportSend=function(t,e){throw"Abstract"},i.transportSuccess=function(t,e,n){e.expired||(this.clearTimeout(e.timeout),this.complete(e,!0,e.metaConnect),n&&n.length>0?t.onSuccess(n):t.onFailure(e.xhr,t.messages,{httpCode:204}))},i.transportFailure=function(t,e,n){e.expired||(this.clearTimeout(e.timeout),this.complete(e,!1,e.metaConnect),t.onFailure(e.xhr,t.messages,n))},i.send=function(t,e){e?function(t){if(null!==s)throw"Concurrent /meta/connect requests not allowed, request id="+s.id+" not yet completed";var e=++r;this._debug("Transport",this.getType(),"/meta/connect send, request",e,"envelope",t);var n={id:e,metaConnect:!0,envelope:t};c.call(this,t,n),s=n}.call(this,t):u.call(this,t)},i.abort=function(){n.abort();for(var t=0;t<o.length;++t){var e=o[t];e&&(this._debug("Aborting request",e),this.abortXHR(e.xhr)||this.transportFailure(e.envelope,e,{reason:"abort"}))}var i=s;i&&(this._debug("Aborting /meta/connect request",i),this.abortXHR(i.xhr)||this.transportFailure(i.envelope,i,{reason:"abort"})),this.reset(!0)},i.reset=function(t){n.reset(t),s=null,o=[],a=[]},i.abortXHR=function(t){if(t)try{var e=t.readyState;return t.abort(),e!==window.XMLHttpRequest.UNSENT}catch(t){this._debug(t)}return!1},i.xhrStatus=function(t){if(t)try{return t.status}catch(t){this._debug(t)}return-1},i},i=function(){var t=new n,i=e.derive(t),r=!0;return i.accept=function(t,e,n){return r||!e},i.newXMLHttpRequest=function(){return new window.XMLHttpRequest},i.xhrSend=function(t){var e=i.newXMLHttpRequest();!function(t){try{t.context=i.context}catch(t){this._debug("Could not copy transport context into XHR",t)}}(e),e.withCredentials=!0,e.open("POST",t.url,!0!==t.sync);var n=t.headers;if(n)for(var r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r]);return e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.onload=function(){200===e.status?t.onSuccess(e.responseText):t.onError(e.statusText)},e.onabort=e.onerror=function(){t.onError(e.statusText)},e.send(t.body),e},i.transportSend=function(t,e){this._debug("Transport",this.getType(),"sending request",e.id,"envelope",t);var n=this;try{var i=!0;e.xhr=this.xhrSend({transport:this,url:t.url,sync:t.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(t.messages),onSuccess:function(i){n._debug("Transport",n.getType(),"received response",i);var s=!1;try{var o=n.convertToMessages(i);0===o.length?(r=!1,n.transportFailure(t,e,{httpCode:204})):(s=!0,n.transportSuccess(t,e,o))}catch(i){if(n._debug(i),!s){r=!1;var a={exception:i};a.httpCode=n.xhrStatus(e.xhr),n.transportFailure(t,e,a)}}},onError:function(s,o){n._debug("Transport",n.getType(),"received error",s,o),r=!1;var a={reason:s,exception:o};a.httpCode=n.xhrStatus(e.xhr),i?n.setTimeout(function(){n.transportFailure(t,e,a)},0):n.transportFailure(t,e,a)}}),i=!1}catch(i){r=!1,this.setTimeout(function(){n.transportFailure(t,e,{exception:i})},0)}},i.reset=function(e){t.reset(e),r=!0},i},r=function(){var t=new n,i=e.derive(t),r=0;function s(t,e,n){var i=this;return function(){i.transportFailure(t,e,"error",n)}}return i.accept=function(t,e,n){return!0},i.jsonpSend=function(t){var e=document.getElementsByTagName("head")[0],n=document.createElement("script"),i="_cometd_jsonp_"+r++;window[i]=function(r){e.removeChild(n),delete window[i],t.onSuccess(r)};var s=t.url;s+=s.indexOf("?")<0?"?":"&",s+="jsonp="+i,s+="&message="+encodeURIComponent(t.body),n.src=s,n.async=!0!==t.sync,n.type="application/javascript",n.onerror=function(e){t.onError("jsonp "+e.type)},e.appendChild(n)},i.transportSend=function(t,e){for(var n=this,i=0,r=t.messages.length,o=[];r>0;){var a=JSON.stringify(t.messages.slice(i,i+r)),c=t.url.length+encodeURI(a).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===r){var l="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(s.call(this,t,e,l),0)}--r}else o.push(r),i+=r,r=t.messages.length-i}var d=t;if(o.length>1){var h=0,p=o[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",o.join(" + ")),(d=this._mixin(!1,{},t)).messages=t.messages.slice(h,p),d.onSuccess=t.onSuccess,d.onFailure=t.onFailure;for(var f=1;f<o.length;++f){var v=this._mixin(!1,{},t);h=p,p+=o[f],v.messages=t.messages.slice(h,p),v.onSuccess=t.onSuccess,v.onFailure=t.onFailure,this.send(v,e.metaConnect)}}this._debug("Transport",this.getType(),"sending request",e.id,"envelope",d);try{var g=!0;this.jsonpSend({transport:this,url:d.url,sync:d.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(d.messages),onSuccess:function(t){var i=!1;try{var r=n.convertToMessages(t);0===r.length?n.transportFailure(d,e,{httpCode:204}):(i=!0,n.transportSuccess(d,e,r))}catch(t){n._debug(t),i||n.transportFailure(d,e,{exception:t})}},onError:function(t,i){var r={reason:t,exception:i};g?n.setTimeout(function(){n.transportFailure(d,e,r)},0):n.transportFailure(d,e,r)}}),g=!1}catch(t){this.setTimeout(function(){n.transportFailure(d,e,{exception:t})},0)}},i},s=function(){var n,i=new e,r=e.derive(i),s=!0,o=!1,a=!0,c=null,u=null,l=!1,d=null;function h(t,e){t&&(this.webSocketClose(t,e.code,e.reason),this.onClose(t,e))}function p(t){return t===u||t===c}function f(t,e,n){for(var i=[],r=0;r<e.messages.length;++r){var s=e.messages[r];s.id&&i.push(s.id)}t.envelopes[i.join(",")]=[e,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",t.envelopes)}function v(t,e,i){var r=JSON.stringify(e.messages);t.webSocket.send(r),this._debug("Transport",this.getType(),"sent",e,"/meta/connect =",i);var s=this.getConfiguration().maxNetworkDelay,o=s;i&&(o+=this.getAdvice().timeout,l=!0);for(var a=this,c=[],u=0;u<e.messages.length;++u)!function(){var i=e.messages[u];i.id&&(c.push(i.id),t.timeouts[i.id]=a.setTimeout(function(){n._debug("Transport",a.getType(),"timing out message",i.id,"after",o,"on",t),h.call(a,t,{code:1e3,reason:"Message Timeout"})},o))}();this._debug("Transport",this.getType(),"waiting at most",o,"ms for messages",c,"maxNetworkDelay",s,", timeouts:",t.timeouts)}function g(t,e,i){try{null===t?(t=u||{envelopes:{},timeouts:{}},f.call(this,t,e,i),function(t){if(!u){var e=n.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var i=n.getConfiguration().protocol;t.webSocket=i?new window.WebSocket(e,i):new window.WebSocket(e),u=t}catch(t){throw s=!1,this._debug("Exception while creating WebSocket object",t),t}a=!1!==n.getConfiguration().stickyReconnect;var r=this,l=n.getConfiguration().connectTimeout;l>0&&(t.connectTimer=this.setTimeout(function(){n._debug("Transport",r.getType(),"timed out while connecting to URL",e,":",l,"ms"),h.call(r,t,{code:1e3,reason:"Connect Timeout"})},l));var d=function(e){e=e||{code:1e3},n._debug("WebSocket onclose",t,e,"connecting",u,"current",c),t.connectTimer&&r.clearTimeout(t.connectTimer),r.onClose(t,e)};t.webSocket.onopen=function(){n._debug("WebSocket onopen",t),t.connectTimer&&r.clearTimeout(t.connectTimer),p(t)?(u=null,c=t,o=!0,r.onOpen(t)):(n._warn("Closing extra WebSocket connection",this,"active connection",c),h.call(r,t,{code:1e3,reason:"Extra Connection"}))},t.webSocket.onclose=d,t.webSocket.onerror=function(){d({code:1e3,reason:"Error"})},t.webSocket.onmessage=function(e){n._debug("WebSocket onmessage",e,t),r.onMessage(t,e)},this._debug("Transport",this.getType(),"configured callbacks on",t)}}.call(this,t)):(f.call(this,t,e,i),v.call(this,t,e,i))}catch(e){var r=this;this.setTimeout(function(){h.call(r,t,{code:1e3,reason:"Exception",exception:e})},0)}}return r.reset=function(t){i.reset(t),s=!0,t&&(o=!1),a=!0,c=null,u=null,l=!1},r._notifySuccess=function(t,e){t.call(this,e)},r._notifyFailure=function(t,e,n,i){t.call(this,e,n,i)},r.onOpen=function(t){var e=t.envelopes;for(var n in this._debug("Transport",this.getType(),"opened",t,"pending messages",e),e)if(e.hasOwnProperty(n)){var i=e[n],r=i[0],s=i[1];d=r.onSuccess,v.call(this,t,r,s)}},r.onMessage=function(e,n){this._debug("Transport",this.getType(),"received websocket message",n,e);for(var i=!1,r=this.convertToMessages(n.data),s=[],o=0;o<r.length;++o){var a=r[o];if((/^\/meta\//.test(a.channel)||void 0===a.data)&&a.id){s.push(a.id);var c=e.timeouts[a.id];c&&(this.clearTimeout(c),delete e.timeouts[a.id],this._debug("Transport",this.getType(),"removed timeout for message",a.id,", timeouts",e.timeouts))}"/meta/connect"===a.channel&&(l=!1),"/meta/disconnect"!==a.channel||l||(i=!0)}for(var u=!1,h=e.envelopes,p=0;p<s.length;++p){var f=s[p];for(var v in h)if(h.hasOwnProperty(v)){var g=v.split(","),y=t.inArray(f,g);if(y>=0){u=!0,g.splice(y,1);var m=h[v][0],b=h[v][1];delete h[v],g.length>0&&(h[g.join(",")]=[m,b]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",h),this._notifySuccess(d,r),i&&this.webSocketClose(e,1e3,"Disconnect")},r.onClose=function(t,e){this._debug("Transport",this.getType(),"closed",t,e),p(t)&&(s=a&&o,u=null,c=null);var n=t.timeouts;for(var i in t.timeouts={},n)n.hasOwnProperty(i)&&this.clearTimeout(n[i]);var r=t.envelopes;for(var d in t.envelopes={},r)if(r.hasOwnProperty(d)){var h=r[d][0],f=r[d][1];f&&(l=!1);var v={websocketCode:e.code,reason:e.reason};e.exception&&(v.exception=e.exception),this._notifyFailure(h.onFailure,t,h.messages,v)}},r.registered=function(t,e){i.registered(t,e),n=e},r.accept=function(t,e,i){return this._debug("Transport",this.getType(),"accept, supported:",s),s&&!!window.WebSocket&&!1!==n.websocketEnabled},r.send=function(t,e){this._debug("Transport",this.getType(),"sending",t,"/meta/connect =",e),g.call(this,c,t,e)},r.webSocketClose=function(t,e,n){try{t.webSocket&&t.webSocket.close(e,n)}catch(t){this._debug(t)}},r.abort=function(){i.abort(),h.call(this,c,{code:1e3,reason:"Abort"}),this.reset(!0)},r},o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],a=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(e){var n,o,a,c,u,l=new function(){var t=0,e={};this.register=function(n){var i=++t;return e[i]=n,i},this.unregister=function(t){var n=e[t];return delete e[t],n},this.setTimeout=function(t,e){return window.setTimeout(t,e)},this.clearTimeout=function(t){window.clearTimeout(t)}},d=this,h=e||"default",p=!1,f=new function(){var t=[],e={};this.getTransportTypes=function(){return t.slice(0)},this.findTransportTypes=function(n,i,r){for(var s=[],o=0;o<t.length;++o){var a=t[o];!0===e[a].accept(n,i,r)&&s.push(a)}return s},this.negotiateTransport=function(n,i,r,s){for(var o=0;o<t.length;++o)for(var a=t[o],c=0;c<n.length;++c)if(a===n[c]){var u=e[a];if(!0===u.accept(i,r,s))return u}return null},this.add=function(n,i,r){for(var s=!1,o=0;o<t.length;++o)if(t[o]===n){s=!0;break}return s||("number"!=typeof r?t.push(n):t.splice(r,0,n),e[n]=i),!s},this.find=function(n){for(var i=0;i<t.length;++i)if(t[i]===n)return e[n];return null},this.remove=function(n){for(var i=0;i<t.length;++i)if(t[i]===n){t.splice(i,1);var r=e[n];return delete e[n],r}return null},this.clear=function(){t=[],e={}},this.reset=function(n){for(var i=0;i<t.length;++i)e[t[i]].reset(n)}},v="disconnected",g=0,y=null,m=0,b=[],T=!1,w=0,O={},E=0,S=null,U=[],C={},_={},R={},j=!1,x=!1,A=0,I=0,P=null,k={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function N(t,e){try{return t[e]}catch(t){return}}function D(e){return t.isString(e)}function L(t){return void 0!==t&&null!==t&&"function"==typeof t}function F(t,e){for(var n="";--e>0&&!(t>=Math.pow(10,e));)n+="0";return n+=t}function B(t,e){if(window.console){var n=window.console[t];if(L(n)){var i=new Date;[].splice.call(e,0,0,F(i.getHours(),2)+":"+F(i.getMinutes(),2)+":"+F(i.getSeconds(),2)+"."+F(i.getMilliseconds(),3)),n.apply(window.console,e)}}}function $(t){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(t)}function M(t){d._debug("Configuring cometd object with",t),D(t)&&(t={url:t}),t||(t={}),k=d._mixin(!1,k,t);var e=d.getURL();if(!e)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var n=$(e),i=n[2],r=n[8],s=n[9];if(p=d._isCrossDomain(i),k.appendMessageTypeToURL)if(void 0!==s&&s.length>0)d._info("Appending message type to URI "+r+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),k.appendMessageTypeToURL=!1;else{var o=r.split("/"),a=o.length-1;r.match(/\/$/)&&(a-=1),o[a].indexOf(".")>=0&&(d._info("Appending message type to URI "+r+" is not supported, disabling 'appendMessageTypeToURL' configuration"),k.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&k.useWorkerScheduler){var c=function(){var t={};self.onmessage=function(e){var n=e.data,i=t[n.id];switch(n.type){case"setTimeout":t[n.id]=self.setTimeout(function(){delete t[n.id],self.postMessage({id:n.id})},n.delay);break;case"clearTimeout":delete t[n.id],i&&self.clearTimeout(i);break;default:throw"Unknown command "+n.type}}}.toString();c=c.substring(c.indexOf("{")+1,c.lastIndexOf("}"));var u=new window.Blob([c],{type:"application/json"}),h=window.URL.createObjectURL(u),f=new window.Worker(h);l.setTimeout=function(t,e){var n=l.register(t);return f.postMessage({id:n,type:"setTimeout",delay:e}),n},l.clearTimeout=function(t){l.unregister(t),f.postMessage({id:t,type:"clearTimeout"})},f.onmessage=function(t){var e=t.data.id,n=l.unregister(e);n&&n()}}}function G(t){if(t){var e=O[t.channel];e&&e[t.id]&&(delete e[t.id],d._debug("Removed",t.listener?"listener":"subscription",t))}}function H(t){t&&!t.listener&&G(t)}function q(){for(var t in O)if(O.hasOwnProperty(t)){var e=O[t];if(e)for(var n in e)e.hasOwnProperty(n)&&H(e[n])}}function V(t){v!==t&&(d._debug("Status",v,"->",t),v=t)}function X(){return"disconnecting"===v||"disconnected"===v}function W(){var t=++g;return""+t}function J(t,e,n,i,r){try{return e.call(t,i)}catch(t){var s=d.onExtensionException;if(L(s)){d._debug("Invoking extension exception handler",n,t);try{s.call(d,t,n,r,i)}catch(t){d._info("Exception during execution of extension exception handler",n,t)}}else d._info("Exception during execution of extension",n,t);return i}}function Y(t){for(var e=U.length-1;e>=0&&void 0!==t&&null!==t;--e){var n=U[e],i=n.extension.outgoing;if(L(i)){var r=J(n.extension,i,n.name,t,!0);t=void 0===r?t:r}}return t}function Q(t,e){var n=O[t];if(n)for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if(r)try{r.callback.call(r.scope,e)}catch(t){var s=d.onListenerException;if(L(s)){d._debug("Invoking listener exception handler",r,t);try{s.call(d,t,r,r.listener,e)}catch(t){d._info("Exception during execution of listener exception handler",r,t)}}else d._info("Exception during execution of listener",r,e,t)}}}function K(t,e){Q(t,e);for(var n=t.split("/"),i=n.length-1,r=i;r>0;--r){var s=n.slice(0,r).join("/")+"/*";r===i&&Q(s,e),Q(s+="*",e)}}function z(){null!==S&&d.clearTimeout(S),S=null}function Z(t,e){z();var n=C.interval+e;d._debug("Function scheduled in",n,"ms, interval =",C.interval,"backoff =",E,t),S=d.setTimeout(t,n)}function tt(t,e,i){for(var r=0;r<t.length;++r){var s=t[r],o=s.id;y&&(s.clientId=y),void 0!==(s=Y(s))&&null!==s?(s.id=o,t[r]=s):(delete _[o],t.splice(r--,1))}if(0!==t.length){e&&(P=t[0]);var a=d.getURL();k.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),i&&(a+=i));var l={url:a,sync:!1,messages:t,onSuccess:function(t){try{c.call(d,t)}catch(t){d._info("Exception during handling of messages",t)}},onFailure:function(t,e,n){try{var i=d.getTransport();n.connectionType=i?i.getType():"unknown",u.call(d,t,e,n)}catch(t){d._info("Exception during handling of failure",t)}}};d._debug("Send",l),n.send(l,e)}}function et(t){m>0||!0===T?b.push(t):tt([t],!1)}function nt(){E=0}function it(){var t=b;b=[],t.length>0&&tt(t,!1)}function rt(t){V("connecting"),Z(function(){!function(){if(!X()){var t={id:W(),channel:"/meta/connect",connectionType:n.getType()};x||(t.advice={timeout:0}),V("connecting"),d._debug("Connect sent",t),tt([t],!0,"connect"),V("connected")}}()},t)}function st(t){t&&(C=d._mixin(!1,{},k.advice,t),d._debug("New advice",C))}function ot(t){if(z(),t&&n&&n.abort(),p=!1,n=null,V("disconnected"),y=null,m=0,nt(),j=!1,x=!1,A=0,P=null,b.length>0){var e=b;b=[],u.call(d,void 0,e,{reason:"Disconnected"})}}function at(t,e,n){var i=d.onTransportException;if(L(i)){d._debug("Invoking transport exception handler",t,e,n);try{i.call(d,n,t,e)}catch(t){d._info("Exception during execution of transport exception handler",t)}}}function ct(t,e){L(t)&&(e=t,t=void 0),y=null,q(),X()&&f.reset(!0),st({}),m=0,T=!0,o=t,a=e;var i=d.getURL(),r=f.findTransportTypes("1.0",p,i),s={id:W(),version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:C.timeout,interval:C.interval}},c=d._mixin(!1,{},o,s);if(d._putCallback(c.id,e),!n&&!(n=f.negotiateTransport(r,"1.0",p,i))){var u="Could not find initial transport among: "+f.getTransportTypes();throw d._warn(u),u}d._debug("Initial transport is",n.getType()),V("handshaking"),d._debug("Handshake sent",c),tt([c],!1,"handshake")}function ut(t,e){try{t.call(d,e)}catch(t){var n=d.onCallbackException;if(L(n)){d._debug("Invoking callback exception handler",t);try{n.call(d,t,e)}catch(t){d._info("Exception during execution of callback exception handler",t)}}else d._info("Exception during execution of message callback",t)}}function lt(t){var e=d._getCallback([t.id]);L(e)&&(delete _[t.id],ut(e,t))}function dt(t){var e=R[t.id];if(delete R[t.id],e){d._debug("Handling remote call response for",t,"with context",e);var n=e.timeout;n&&d.clearTimeout(n);var i=e.callback;if(L(i))return ut(i,t),!0}return!1}function ht(t){d._debug("Transport failure handling",t),t.transport&&(n=t.transport),t.url&&n.setURL(t.url);var e=t.action,i=t.delay||0;switch(e){case"handshake":!function(t){V("handshaking"),T=!0,Z(function(){ct(o,a)},t)}(i);break;case"retry":rt(i);break;case"none":ot(!0);break;default:throw"Unknown action "+e}}function pt(t,e){lt(t),K("/meta/handshake",t),K("/meta/unsuccessful",t),X()&&(e.action="none"),d.onTransportFailure.call(d,t,e,ht)}function ft(t){pt(t,{cause:"failure",action:"handshake",transport:null})}function vt(t){return"disconnected"===v||!(!P||P.id!==t.id)&&(P=null,!0)}function gt(t,e){K("/meta/connect",t),K("/meta/unsuccessful",t),X()&&(e.action="none"),d.onTransportFailure.call(d,t,e,ht)}function yt(t){vt(t)?(x=!1,gt(t,{cause:"failure",action:"retry",transport:null})):d._debug("Mismatched /meta/connect failure",t)}function mt(t){ot(!0),lt(t),K("/meta/disconnect",t),K("/meta/unsuccessful",t)}function bt(t){mt(t)}function Tt(t){var e=O[t.subscription];if(e)for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i&&!i.listener&&(delete e[n],d._debug("Removed failed subscription",i))}lt(t),K("/meta/subscribe",t),K("/meta/unsuccessful",t)}function wt(t){Tt(t)}function Ot(t){lt(t),K("/meta/unsubscribe",t),K("/meta/unsuccessful",t)}function Et(t){Ot(t)}function St(t){dt(t)||(lt(t),K("/meta/publish",t),K("/meta/unsuccessful",t))}function Ut(t){St(t)}function Ct(t){if(A=0,void 0!==(t=function(t){for(var e=0;e<U.length&&void 0!==t&&null!==t;++e){var n=U[e],i=n.extension.incoming;if(L(i)){var r=J(n.extension,i,n.name,t,!1);t=void 0===r?t:r}}return t}(t))&&null!==t){st(t.advice);var e=t.channel;switch(e){case"/meta/handshake":!function(t){var e=d.getURL();if(t.successful){var i=d._isCrossDomain($(e)[2]),r=f.negotiateTransport(t.supportedConnectionTypes,t.version,i,e);if(null===r)return t.successful=!1,void pt(t,{cause:"negotiation",action:"none",transport:null});n!==r&&(d._debug("Transport",n.getType(),"->",r.getType()),n=r),y=t.clientId,T=!1,it(),t.reestablish=j,j=!0,lt(t),K("/meta/handshake",t),I=t["x-messages"]||0;var s=X()?"none":C.reconnect||"retry";switch(s){case"retry":nt(),0===I?rt(0):d._debug("Processing",I,"handshake-delivered messages");break;case"none":ot(!0);break;default:throw"Unrecognized advice action "+s}}else pt(t,{cause:"unsuccessful",action:C.reconnect||"handshake",transport:n})}(t);break;case"/meta/connect":!function(t){if(vt(t))if(x=t.successful){K("/meta/connect",t);var e=X()?"none":C.reconnect||"retry";switch(e){case"retry":nt(),rt(E);break;case"none":ot(!1);break;default:throw"Unrecognized advice action "+e}}else gt(t,{cause:"unsuccessful",action:C.reconnect||"retry",transport:n});else d._debug("Mismatched /meta/connect reply",t)}(t);break;case"/meta/disconnect":!function(t){t.successful?(ot(!1),lt(t),K("/meta/disconnect",t)):mt(t)}(t);break;case"/meta/subscribe":!function(t){t.successful?(lt(t),K("/meta/subscribe",t)):Tt(t)}(t);break;case"/meta/unsubscribe":!function(t){t.successful?(lt(t),K("/meta/unsubscribe",t)):Ot(t)}(t);break;default:!function(t){void 0!==t.data?dt(t)||(K(t.channel,t),I>0&&0==--I&&(d._debug("Processed last handshake-delivered message"),rt(0))):void 0===t.successful?d._warn("Unknown Bayeux Message",t):t.successful?(lt(t),K("/meta/publish",t)):St(t)}(t)}}}function _t(t){var e=O[t];if(e)for(var n in e)if(e.hasOwnProperty(n)&&e[n])return!0;return!1}function Rt(t,e){var n={scope:t,method:e};if(L(t))n.scope=void 0,n.method=t;else if(D(e)){if(!t)throw"Invalid scope "+t;if(n.method=t[e],!L(n.method))throw"Invalid callback "+e+" for scope "+t}else if(!L(e))throw"Invalid callback "+e;return n}function jt(t,e,n,i){var r=Rt(e,n);d._debug("Adding",i?"listener":"subscription","on",t,"with scope",r.scope,"and callback",r.method);var s=++w,o={id:s,channel:t,scope:r.scope,callback:r.method,listener:i},a=O[t];return a||(a={},O[t]=a),a[s]=o,d._debug("Added",i?"listener":"subscription",o),o}this._mixin=function(t,e,n){for(var i=e||{},r=2;r<arguments.length;++r){var s=arguments[r];if(void 0!==s&&null!==s)for(var o in s)if(s.hasOwnProperty(o)){var a=N(s,o),c=N(i,o);if(a===e)continue;if(void 0===a)continue;if(t&&"object"==typeof a&&null!==a)if(a instanceof Array)i[o]=this._mixin(t,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;i[o]=this._mixin(t,u,a)}else i[o]=a}}return i},this._warn=function(){B("warn",arguments)},this._info=function(){"warn"!==k.logLevel&&B("info",arguments)},this._debug=function(){"debug"===k.logLevel&&B("debug",arguments)},this._isCrossDomain=function(t){return!!(window.location&&window.location.host&&t)&&t!==window.location.host},this.send=et,this._getCallback=function(t){return _[t]},this._putCallback=function(t,e){var n=this._getCallback(t);return L(e)&&(_[t]=e),n},this.onTransportFailure=function(t,e,i){this._debug("Transport failure",e,"for",t);var r=this.getTransportRegistry(),s=this.getURL(),o=this._isCrossDomain($(s)[2]),a=r.findTransportTypes("1.0",o,s);if("none"===e.action){if("/meta/handshake"===t.channel&&!e.transport){var c="Could not negotiate transport, client=["+a+"], server=["+t.supportedConnectionTypes+"]";this._warn(c),at(n.getType(),null,{reason:c,connectionType:n.getType(),transport:n})}}else if(e.delay=this.getBackoffPeriod(),"/meta/handshake"===t.channel){if(!e.transport){var u=n?n.getType():null,l=r.negotiateTransport(a,"1.0",o,s);if(l){var h=l.getType();this._debug("Transport",u,"->",h),at(u,h,t.failure),e.action="handshake",e.transport=l}else this._warn("Could not negotiate transport, client=["+a+"]"),at(u,null,t.failure),e.action="none"}"none"!==e.action&&this.increaseBackoffPeriod()}else{var p=(new Date).getTime();if(0===A&&(A=p),"retry"===e.action){e.delay=this.increaseBackoffPeriod();var f=C.maxInterval;if(f>0){var v=C.timeout+C.interval+f,g=p-A;g+E>v&&(e.action="handshake")}}"handshake"===e.action&&(e.delay=0,r.reset(!1),this.resetBackoffPeriod())}i.call(d,e)},this.receive=Ct,c=function(t){d._debug("Received",t);for(var e=0;e<t.length;++e){var n=t[e];Ct(n)}},u=function(t,e,n){d._debug("handleFailure",t,e,n),n.transport=t;for(var i=0;i<e.length;++i){var r=e[i],s={id:r.id,successful:!1,channel:r.channel,failure:n};switch(n.message=r,r.channel){case"/meta/handshake":ft(s);break;case"/meta/connect":yt(s);break;case"/meta/disconnect":bt(s);break;case"/meta/subscribe":s.subscription=r.subscription,wt(s);break;case"/meta/unsubscribe":s.subscription=r.subscription,Et(s);break;default:Ut(s)}}},this.registerTransport=function(t,e,n){var i=f.add(t,e,n);return i&&(this._debug("Registered transport",t),L(e.registered)&&e.registered(t,this)),i},this.unregisterTransport=function(t){var e=f.remove(t);return null!==e&&(this._debug("Unregistered transport",t),L(e.unregistered)&&e.unregistered()),e},this.unregisterTransports=function(){f.clear()},this.getTransportTypes=function(){return f.getTransportTypes()},this.findTransport=function(t){return f.find(t)},this.getTransportRegistry=function(){return f},this.configure=function(t){M.call(this,t)},this.init=function(t,e){this.configure(t),this.handshake(e)},this.handshake=function(t,e){if("disconnected"!==v)throw"Illegal state: handshaken";ct(t,e)},this.disconnect=function(t,e){if(!X()){L(t)&&(e=t,t=void 0);var n={id:W(),channel:"/meta/disconnect"},i=this._mixin(!1,{},t,n);d._putCallback(i.id,e),V("disconnecting"),tt([i],!1,"disconnect")}},this.startBatch=function(){++m,d._debug("Starting batch, depth",m)},this.endBatch=function(){!function(){if(--m,d._debug("Ending batch, depth",m),m<0)throw"Calls to startBatch() and endBatch() are not paired";0!==m||X()||T||it()}()},this.batch=function(t,e){var n=Rt(t,e);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(t){throw this._info("Exception during execution of batch",t),this.endBatch(),t}},this.addListener=function(t,e,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(t))throw"Illegal argument type: channel must be a string";return jt(t,e,n,!0)},this.removeListener=function(t){if(!(t&&t.channel&&"id"in t))throw"Invalid argument: expected subscription, not "+t;G(t)},this.clearListeners=function(){O={}},this.subscribe=function(t,e,n,i,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(t))throw"Illegal argument type: channel must be a string";if(X())throw"Illegal state: disconnected";L(e)&&(r=i,i=n,n=e,e=void 0),L(i)&&(r=i,i=void 0);var s=!_t(t),o=jt(t,e,n,!1);if(s){var a={id:W(),channel:"/meta/subscribe",subscription:t},c=this._mixin(!1,{},i,a);d._putCallback(c.id,r),et(c)}return o},this.unsubscribe=function(t,e,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(X())throw"Illegal state: disconnected";L(e)&&(n=e,e=void 0),this.removeListener(t);var i=t.channel;if(!_t(i)){var r={id:W(),channel:"/meta/unsubscribe",subscription:i},s=this._mixin(!1,{},e,r);d._putCallback(s.id,n),et(s)}},this.resubscribe=function(t,e){if(H(t),t)return this.subscribe(t.channel,t.scope,t.callback,e)},this.clearSubscriptions=function(){q()},this.publish=function(t,e,n,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!D(t))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(t))throw"Illegal argument: cannot publish to meta channels";if(X())throw"Illegal state: disconnected";L(e)?(i=e,e={},n=void 0):L(n)&&(i=n,n=void 0);var r={id:W(),channel:t,data:e},s=this._mixin(!1,{},n,r);d._putCallback(s.id,i),et(s)},this.publishBinary=function(t,e,n,i,r){L(e)?(r=e,e=new ArrayBuffer(0),n=!0,i=void 0):L(n)?(r=n,n=!0,i=void 0):L(i)&&(r=i,i=void 0);var s={meta:i,data:e,last:n};this.publish(t,s,{ext:{binary:{}}},r)},this.remoteCall=function(t,e,n,i,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!D(t))throw"Illegal argument type: target must be a string";if(X())throw"Illegal state: disconnected";if(L(e)?(r=e,e={},n=k.maxNetworkDelay,i=void 0):L(n)?(r=n,n=k.maxNetworkDelay,i=void 0):L(i)&&(r=i,i=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";t.match(/^\//)||(t="/"+t);var s="/service"+t,o={id:W(),channel:s,data:e},a=this._mixin(!1,{},i,o),c={callback:r};n>0&&(c.timeout=d.setTimeout(function(){d._debug("Timing out remote call",a,"after",n,"ms"),St({id:a.id,error:"406::timeout",successful:!1,failure:{message:a,reason:"Remote Call Timeout"}})},n),d._debug("Scheduled remote call timeout",a,"in",n,"ms")),R[a.id]=c,et(a)},this.remoteCallBinary=function(t,e,n,i,r,s){L(e)?(s=e,e=new ArrayBuffer(0),n=!0,i=void 0,r=k.maxNetworkDelay):L(n)?(s=n,n=!0,i=void 0,r=k.maxNetworkDelay):L(i)?(s=i,i=void 0,r=k.maxNetworkDelay):L(r)&&(s=r,r=k.maxNetworkDelay);var o={meta:i,data:e,last:n};this.remoteCall(t,o,r,{ext:{binary:{}}},s)},this.getStatus=function(){return v},this.isDisconnected=X,this.setBackoffIncrement=function(t){k.backoffIncrement=t},this.getBackoffIncrement=function(){return k.backoffIncrement},this.getBackoffPeriod=function(){return E},this.increaseBackoffPeriod=function(){return E<k.maxBackoff&&(E+=k.backoffIncrement),E},this.resetBackoffPeriod=function(){nt()},this.setLogLevel=function(t){k.logLevel=t},this.registerExtension=function(t,e){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!D(t))throw"Illegal argument type: extension name must be a string";for(var n=!1,i=0;i<U.length;++i){var r=U[i];if(r.name===t){n=!0;break}}return n?(this._info("Could not register extension with name",t,"since another extension with the same name already exists"),!1):(U.push({name:t,extension:e}),this._debug("Registered extension",t),L(e.registered)&&e.registered(t,this),!0)},this.unregisterExtension=function(t){if(!D(t))throw"Illegal argument type: extension name must be a string";for(var e=!1,n=0;n<U.length;++n){var i=U[n];if(i.name===t){U.splice(n,1),e=!0,this._debug("Unregistered extension",t);var r=i.extension;L(r.unregistered)&&r.unregistered();break}}return e},this.getExtension=function(t){for(var e=0;e<U.length;++e){var n=U[e];if(n.name===t)return n.extension}return null},this.getName=function(){return h},this.getClientId=function(){return y},this.getURL=function(){if(n){var t=n.getURL();if(t)return t;if(t=k.urls[n.getType()])return t}return k.url},this.getTransport=function(){return n},this.getConfiguration=function(){return this._mixin(!0,{},k)},this.getAdvice=function(){return this._mixin(!0,{},C)},this.setTimeout=function(t,e){return l.setTimeout(function(){try{d._debug("Invoking timed function",t),t()}catch(e){d._debug("Exception invoking timed function",t,e)}},e)},this.clearTimeout=function(t){l.clearTimeout(t)},window.WebSocket&&this.registerTransport("websocket",new s),this.registerTransport("long-polling",new i),this.registerTransport("callback-polling",new r)},Transport:e,RequestTransport:n,LongPollingTransport:i,CallbackPollingTransport:r,WebSocketTransport:s,Utils:t,Z85:{encode:function(t){var e=null;if(t instanceof ArrayBuffer?e=t:t.buffer instanceof ArrayBuffer?e=t.buffer:Array.isArray(t)&&(e=new Uint8Array(t).buffer),null==e)throw"Cannot Z85 encode "+t;for(var n=e.byteLength,i=n%4,r=4-(0===i?4:i),s=new DataView(e),a="",c=0,u=0;u<n+r;++u){var l=u>=n;if(c=256*c+(l?0:s.getUint8(u)),(u+1)%4==0){for(var d=52200625,h=5;h>0;--h){if(!l||h>r){var p=Math.floor(c/d)%85;a+=o[p]}d/=85}c=0}}return a},decode:function(t){for(var e=t.length%5,n=5-(0===e?5:e),i=0;i<n;++i)t+=o[o.length-1];for(var r=t.length,s=new ArrayBuffer(4*r/5-n),c=new DataView(s),u=0,l=0,d=0,h=0;h<r;++h){var p=t.charCodeAt(l++)-32;if(u=85*u+a[p],l%5==0){for(var f=16777216;f>=1;)d<c.byteLength&&c.setUint8(d++,Math.floor(u/f)%256),f/=256;u=0}}return s}}}}()}),s={CometD:r.CometD,default:r}.CometD;!function(t){t.HANDSHAKE="/meta/handshake",t.CONNECT="/meta/connect",t.SUBSCRIBE="/meta/subscribe",t.UNSUBSCRIBE="/meta/unsubscribe"}(i||(i={}));class o{constructor(t,e="/notification/realtime",n){this.client=t,this.url=e,this.cometd=new s,this.metaHandshake=(t=>{if(!t.successful)throw new Error("Handshake failed")}),this.cometd.websocketEnabled=!0,this.cometd.addListener(i.HANDSHAKE,n||this.metaHandshake)}subscribe(t,e){return this.checkConnection(),this.cometd.subscribe(t,e)}unsubscribe(t){return this.cometd.unsubscribe(t)}disconnect(){this.cometd.disconnect()}checkConnection(){const{cometd:t,client:e,url:n}=this;if(t.isDisconnected()){const{headers:i}=e.getFetchOptions(),r={url:e.getUrl(n),requestHeaders:i};t.configure(r),this.handshake(e.getCometdHandshake())}}handshake(t){this.cometd.handshake(t)}}var a=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class c{constructor(t,e,n){this.filter=n,this.service=t,this.currentPage=e.currentPage,this.nextPage=e.nextPage,this.prevPage=e.prevPage,this.pageSize=e.pageSize,this.totalPages=e.totalPages}next(t={}){return a(this,void 0,void 0,function*(){return this.list(this.getFilter(t,this.nextPage))})}prev(t={}){return a(this,void 0,void 0,function*(){return this.list(this.getFilter(t,this.prevPage))})}list(t={}){return a(this,void 0,void 0,function*(){return this.service.list(t)})}goto(t,e={}){return a(this,void 0,void 0,function*(){return this.list(this.getFilter(e,t))})}getFilter(t,e){return Object.assign(t,this.filter,{currentPage:e})}}var u=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class l{constructor(t,e){this.client=t,this.realtime=e,this.cache=new Map;const n=Object.getPrototypeOf(this);["list","create","update","detail","delete"].forEach(t=>{n.hasOwnProperty(t)||Object.defineProperty(this,t,{get(){}})})}list(t={}){return u(this,void 0,void 0,function*(){const e=this.listUrl,n=yield this.fetch(e,this.changeFetchOptions({headers:{accept:"application/json"},params:t},e)),i=yield n.json();return{res:n,data:this.propertyName?i[this.propertyName]:i,paging:this.getPaging(i,t)}})}detail(t,e={}){return u(this,void 0,void 0,function*(){const n=this.getDetailUrl(t),i=yield this.fetch(n,this.changeFetchOptions({headers:{accept:"application/json"},params:Object.assign({},e)},n));return{res:i,data:yield i.json()}})}create(t){return u(this,void 0,void 0,function*(){const e=this.listUrl,n=JSON.stringify(this.onBeforeCreate(t)),i=yield this.fetch(e,this.changeFetchOptions({method:"POST",body:n,headers:{"content-type":"application/json",accept:"application/json"}},e));return{res:i,data:yield i.json()}})}update(t){return u(this,void 0,void 0,function*(){const e=this.getDetailUrl(t),n=JSON.stringify(this.onBeforeUpdate(t)),i=yield this.fetch(e,this.changeFetchOptions({method:"PUT",body:n,headers:{"content-type":"application/json",accept:"application/json"}},e));return{res:i,data:yield i.json()}})}delete(t,e){return u(this,void 0,void 0,function*(){const n=this.getDetailUrl(t);return{res:yield this.fetch(n,this.changeFetchOptions({method:"DELETE",params:e},n)),data:null}})}onBeforeCreate(t){return delete t.id,t}onBeforeUpdate(t){return t}changeFetchOptions(t,e=""){return t}getUrl(t=""){return`${this.baseUrl.replace(/\/+$/,"")}/${t.replace(/^\/+/,"")}`}getDetailUrl(t){let e;return e="object"==typeof t&&t.id?t.id:t,`${this.listUrl}/${e}`}fetch(t,e){return u(this,void 0,void 0,function*(){const n=this.getUrl(t),i=yield this.client.fetch(n,e);if(i.status>=400){let t=null;try{t=yield i.json()}catch(e){try{t=yield i.text()}catch(t){}}throw{res:i,data:t}}return i})}mimeType(t){return`application/vnd.com.nsn.cumulocity.${t}+json`}getIdString(t){let e;return e="object"==typeof t?t.id:t,String(e)}getPaging(t,e){if(t.statistics){const n=Object.assign(Object.assign({},t.statistics),{nextPage:this.getCurrentPageFromLink(t.next),prevPage:this.getCurrentPageFromLink(t.prev)});return new c(this,n,e)}return null}getCurrentPageFromLink(t=""){const e=t.match(/currentPage=(-{0,1}\d+)/);return e&&parseInt(e[1],10)}}var d=n(function(t){var n=function(t){function e(){this.fetch=!1}return e.prototype=t,new e}("undefined"!=typeof self?self:e);(function(t){!function(t){if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=function(t){return t&&DataView.prototype.isPrototypeOf(t)},r=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};l.prototype.append=function(t,e){t=a(t),e=c(e);var n=this.map[t];this.map[t]=n?n+","+e:e},l.prototype.delete=function(t){delete this.map[a(t)]},l.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},l.prototype.set=function(t,e){this.map[a(t)]=c(e)},l.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},l.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),u(t)},l.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),u(t)},l.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),u(t)},e.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},v.call(g.prototype),v.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},m.error=function(){var t=new m(null,{status:0,statusText:""});return t.type="error",t};var o=[301,302,303,307,308];m.redirect=function(t,e){if(-1===o.indexOf(e))throw new RangeError("Invalid status code");return new m(null,{status:e,headers:{location:t}})},t.Headers=l,t.Request=g,t.Response=m,t.fetch=function(t,n){return new Promise(function(i,r){var s=new g(t,n),o=new XMLHttpRequest;o.onload=function(){var t,e,n={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new l,t.split(/\r?\n/).forEach(function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();e.append(i,r)}}),e)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var r="response"in o?o.response:o.responseText;i(new m(r,n))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.open(s.method,s.url,!0),"include"===s.credentials&&(o.withCredentials=!0),"responseType"in o&&e.blob&&(o.responseType="blob"),s.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function c(t){return"string"!=typeof t&&(t=String(t)),t}function u(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(t){this.map={},t instanceof l?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function d(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function h(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function p(t){var e=new FileReader,n=h(e);return e.readAsArrayBuffer(t),n}function f(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&i(t))this._bodyArrayBuffer=f(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!r(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=d(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,n,i=d(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=h(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(t,e){var n,i,r=(e=e||{}).body;if(t instanceof g){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new l(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),s.indexOf(i)>-1?i:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function y(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}}),e}function m(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new l(e.headers),this.url=e.url||"",this._initBody(t)}}(void 0!==t?t:this)}).call(n,void 0);var i=n.fetch;i.Response=n.Response,i.Request=n.Request,i.Headers=n.Headers;t.exports&&(t.exports=i)}),h=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};let p=new WeakMap;class f{constructor(t,e){this.baseUrl=e,this.tenant="",this.defaultHeaders={},"string"==typeof t?e=t:this.setAuth(t),this.baseUrl=this.resolveServerUrl(e)}setAuth(t){p.set(this,t)}fetch(t,e){return h(this,void 0,void 0,function*(){let n=d;try{n=window.fetch||n}catch(t){}return n(this.getUrl(t,e),this.getFetchOptions(e))})}getUrl(t="",e){const n=e&&e.params;let i="";return n&&Object.keys(n).length&&(i=`?${i=Object.keys(n).map(t=>{let e=n[t];const i=encodeURIComponent(t);return Array.isArray(e)||(e=[e]),e.map(t=>`${i}=${encodeURIComponent(t)}`).join("&")}).join("&")}`),`${this.baseUrl.replace(/\/+$/,"").replace(/^\/+/,"")}/${t.replace(/\/+$/,"").replace(/^\/+/,"")}${i}`}getFetchOptions(t={}){const e=p.get(this);return t.headers=Object.assign({},this.defaultHeaders,t.headers,{UseXBasic:!0}),delete t.params,t=e?e.getFetchOptions(t):t}getCometdHandshake(t={}){const e=p.get(this);return e?e.getCometdHandshake(t):t}resolveServerUrl(t=""){if(t&&t.startsWith("http"))return t.replace(/\/+$/,"");try{const e=window.location;return`${e.protocol}//${e.host}/${t.replace(/\/+$/,"")}`}catch(t){throw Error("Your environment does not support relative URLs. Please provide a base URL.")}}}var v=function(t){function e(){this.message=t}return e.prototype=new Error,e.prototype.name="InvalidCharacterError",e.prototype.code=5,e},g=v("The string to be encoded contains characters out of range"),y="undefined"!=typeof btoa?function(t){return btoa(t)}:function(t){for(var e,n,i=String(t),r="",s=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|s)||(o="=",s%1);r+=o.charAt(63&e>>8-s%1*8)){if((n=i.charCodeAt(s+=.75))>255)throw new g;e=e<<8|n}return r},m=function(t){return y(function(t){return encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)})}(t))},b=(v("The string to be decoded is not correctly encoded"),new WeakMap);class T{constructor(t){this.updateCredentials(t)}updateCredentials({tenant:t,user:e,password:n,token:i,tfa:r}={}){const s=b.get(this)||{};return e&&t&&(e=`${t}/${e}`),e=e||this.user,n=n||s.password,!i&&e&&n&&(i=m(`${e}:${n}`)),e&&(this.user=e),i=i||s.token,r=r||s.tfa,b.set(this,{tfa:r,token:i,password:n}),i}getFetchOptions(t){const e=b.get(this),{token:n,tfa:i}=e,r=this.getCookieValue("XSRF-TOKEN"),s=Object.assign({Authorization:`Basic ${n||""}`},r?{"X-XSRF-TOKEN":r}:void 0);return i&&(s.tfatoken=i),t.headers=Object.assign(s,t.headers),t}getCometdHandshake(t={}){const e=b.get(this),{token:n,tfa:i}=e,r="com.cumulocity.authn",s=t.ext=t.ext||{};s[r]=Object.assign(s[r]||{},{token:n,tfa:i});return t}logout(){delete this.user,b.set(this,{})}getCookieValue(t){try{const e=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return e?e.pop():void 0}catch(t){return}}}var w=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};const O=t=>t;var E;(E=t.Severity||(t.Severity={}))[E.CRITICAL=O("CRITICAL")]="CRITICAL",E[E.MAJOR=O("MAJOR")]="MAJOR",E[E.MINOR=O("MINOR")]="MINOR",E[E.WARNING=O("WARNING")]="WARNING";class S{constructor(){this.operatorFns={__not:t=>`not(${this.buildQueryFilter(t,null)})`,__and:t=>this.buildQueryFilter(t,null,"and"),__or:t=>this.buildQueryFilter(t,null,"or"),__eq:(t,e)=>"object"==typeof t&&null!==t?this.buildQueryFilter(t,e):`${e} eq ${this.quoteString(t)}`,__gt:(t,e)=>`${e} gt ${this.quoteString(t)}`,__ge:(t,e)=>`${e} ge ${this.quoteString(t)}`,__lt:(t,e)=>`${e} lt ${this.quoteString(t)}`,__le:(t,e)=>`${e} le ${this.quoteString(t)}`,__in:(t,e)=>{const n=t.filter(t=>!!t).map(t=>`${e} eq ${this.quoteString(t)}`);return this.glue(n,"or")},__bygroupid:t=>`bygroupid(${t})`,__has:t=>`has(${t})`,__useFilterQueryString:t=>{const e=t.match(/\(.*\)/)[0];return e.substring(1,e.length-1)}}}buildQuery(t){const e=[],n=this.buildQueryFilter(t.__filter||t),i=this.buildQueryOrderby(t.__orderby);return n&&e.push(`$filter=(${n})`),i&&e.push(`$orderby=${i}`),e.join(" ")}buildQueryFilter(t,e,n){const i=e||null,r=n||"and",s=[];if(Array.isArray(t))t.forEach(t=>{const e=this.buildQueryFilter(t,null,r);e&&s.push(e)});else{let e;Object.keys(t).forEach(n=>{void 0!==this.operatorFns[n]?(e=this.operatorFns[n](t[n],i))&&s.push(e):(e=this.operatorFns.__eq(t[n],n))&&s.push(e)})}return this.glue(s,r)}buildQueryOrderby(t){const e=[];return t&&t.forEach(t=>{Object.keys(t).forEach(n=>{0!==t[n]&&e.push(`${n} ${t[n]>0?"asc":"desc"}`)})}),e.join(",")}addAndFilter(t,e){return this.addFilter(t,e,"and")}addOrFilter(t,e){return this.addFilter(t,e,"or")}addFilter(t,e,n){const i=t.__orderby?t.__filter||{}:t.__filter||t,r={[`__${n}`]:this.skipEmptyObjects([i,e])};return t.__filter||t.__orderby?(t.__filter=r,t):r}prependOrderbys(t,e){return this.addOrderbys(t,e,"prepend")}appendOrderbys(t,e){return this.addOrderbys(t,e,"append")}addOrderbys(t,e,n){const i=t.__orderby?t.__filter||{}:t.__filter||t,r=t.__orderby||[],s="prepend"===n?[...e,...r]:[...r,...e],o={__orderby:this.skipEmptyObjects(s)};return this.isEmptyObject(i)||(o.__filter=i),o}glue(t,e){return t.length>1?`(${t.join(`) ${e} (`)})`:t[0]}quoteString(t){return"string"==typeof t?`'${t}'`:t}skipEmptyObjects(t){return t.filter(t=>!this.isEmptyObject(t))}isEmptyObject(t){return 0===Object.keys(t).length}}var U=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class C extends l{constructor(){super(...arguments),this.baseUrl="event",this.listUrl="events",this.propertyName="events",this.channel="/events/*"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return U(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return U(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return U(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return U(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return U(this,void 0,void 0,function*(){return e.delete.call(this,t)})}}var _="object"==typeof self?self.FormData:window.FormData,R=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};var j=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class x extends l{constructor(){super(...arguments),this.baseUrl="inventory",this.listUrl="binaries",this.propertyName="managedObjects"}create(t,e={}){return j(this,void 0,void 0,function*(){const n=this.listUrl,i=new _;let r,s,o;e.fileName&&(r=e.fileName,delete e.fileName),e.fileType&&(s=e.fileType,delete e.fileType),r||(r="bin"),"undefined"!=typeof File&&t instanceof File&&(r=t.name,s=t.type),e.name||(e.name=r),e.type||(e.type=s||"c8y_upload"),i.append("file",t,r),i.append("object",JSON.stringify(e)),"function"==typeof i.getHeaders&&(o=i.getHeaders());const a=Object.assign({accept:"application/json"},o),c=yield this.fetch(n,{method:"POST",body:i,headers:a});return{res:c,data:yield c.json()}})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return j(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return j(this,void 0,void 0,function*(){return e.delete.call(this,t)})}download(t){return j(this,void 0,void 0,function*(){const e=this.getDetailUrl(t);return yield this.fetch(e)})}getIdFromUrl(t){const e=new RegExp("\\/inventory\\/binaries\\/(\\d+)|\\/inventory\\/managedObjects\\/(\\d+)"),n=t.match(e);return n&&(n[1]||n[2])}}var A=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};!function(t){t.ASSETS="childAssets",t.DEVICES="childDevices",t.ADDITIONS="childAdditions"}(t.ChildType||(t.ChildType={}));class I extends l{constructor(t,e){super(t,e),this.baseUrl="inventory",this.listUrl="managedObjects",this.propertyName="managedObjects",this.channel="/managedobjects/*",this.inventoriesQueryParamName="query",this.devicesQueryParamName="q",this.queriesUtil=new S,this.binary=new x(t)}detail(t,e={}){const n=Object.create(null,{detail:{get:()=>super.detail}});return A(this,void 0,void 0,function*(){return n.detail.call(this,t,e)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return A(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return A(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return A(this,void 0,void 0,function*(){return e.list.call(this,t)})}listQuery(t,e={}){const n=Object.create(null,{list:{get:()=>super.list}});return A(this,void 0,void 0,function*(){return e[this.inventoriesQueryParamName]=this.queriesUtil.buildQuery(t),n.list.call(this,e)})}listQueryDevices(t,e={}){const n=Object.create(null,{list:{get:()=>super.list}});return A(this,void 0,void 0,function*(){return e[this.devicesQueryParamName]=this.queriesUtil.buildQuery(t),n.list.call(this,e)})}delete(t,e={}){const n=Object.create(null,{delete:{get:()=>super.delete}});return A(this,void 0,void 0,function*(){return n.delete.call(this,t,e)})}childAdditionsList(e,n={}){return A(this,void 0,void 0,function*(){return this.listChildren(t.ChildType.ADDITIONS,e,n)})}childAdditionsCreate(e,n){return A(this,void 0,void 0,function*(){return this.createChild(t.ChildType.ADDITIONS,e,n)})}childAdditionsAdd(e,n){return A(this,void 0,void 0,function*(){return this.addChild(t.ChildType.ADDITIONS,e,n)})}childAdditionsRemove(e,n){return A(this,void 0,void 0,function*(){return this.removeChild(t.ChildType.ADDITIONS,e,n)})}childAssetsList(e,n={}){return A(this,void 0,void 0,function*(){return this.listChildren(t.ChildType.ASSETS,e,n)})}childAssetsCreate(e,n){return A(this,void 0,void 0,function*(){return this.createChild(t.ChildType.ASSETS,e,n)})}childAssetsAdd(e,n){return A(this,void 0,void 0,function*(){return this.addChild(t.ChildType.ASSETS,e,n)})}childAssetsBulkAdd(e,n){return A(this,void 0,void 0,function*(){return this.addChildBulk(t.ChildType.ASSETS,e,n)})}childAssetsRemove(e,n){return A(this,void 0,void 0,function*(){return this.removeChild(t.ChildType.ASSETS,e,n)})}childDevicesList(e,n={}){return A(this,void 0,void 0,function*(){return this.listChildren(t.ChildType.DEVICES,e,n)})}childDevicesCreate(e,n){return A(this,void 0,void 0,function*(){return this.createChild(t.ChildType.DEVICES,e,n)})}childDevicesAdd(e,n){return A(this,void 0,void 0,function*(){return this.addChild(t.ChildType.DEVICES,e,n)})}childDevicesRemove(e,n){return A(this,void 0,void 0,function*(){return this.removeChild(t.ChildType.DEVICES,e,n)})}onBeforeUpdate(t){return delete t.lastUpdated,t}onBeforeCreate(t){return delete t.id,delete t.lastUpdated,t}getChildrenUrl(t,e){return`${this.getDetailUrl(e)}/${t}`}getChildUrl(t,e,n){const i=this.getIdString(e);return`${this.getChildrenUrl(t,n)}/${i}`}listChildren(t,e,n={}){return A(this,void 0,void 0,function*(){const i=this.getChildrenUrl(t,e),r=yield this.fetch(i,{headers:{"content-type":"application/json"},params:n}),s=yield r.json(),o=s.references.map(t=>t.managedObject),a=this.getPaging(s,n);return a.list=(n=>this.listChildren(t,e,n)),{res:r,data:o,paging:a}})}createChild(t,e,n){return A(this,void 0,void 0,function*(){const i=this.getChildrenUrl(t,n),r=JSON.stringify(this.onBeforeCreate(e)),s={"content-type":this.mimeType("managedObject"),accept:"application/json"},o=yield this.fetch(i,{method:"POST",body:r,headers:s});return{res:o,data:yield o.json()}})}addChild(t,e,n){return A(this,void 0,void 0,function*(){const i=this.getChildrenUrl(t,n),r=this.getIdString(e),s=JSON.stringify({managedObject:{id:String(r)}}),o={accept:"application/json","content-type":this.mimeType("managedObjectReference")},a=yield this.fetch(i,{method:"POST",body:s,headers:o});let c=yield a.json();return{res:a,data:c=c.managedObject}})}addChildBulk(t,e,n){return A(this,void 0,void 0,function*(){const i=this.getChildrenUrl(t,n),r=e.map(t=>({managedObject:{id:this.getIdString(t)}})),s=JSON.stringify({references:r}),o={accept:"application/json","content-type":this.mimeType("managedObjectReferenceCollection")},a=yield this.fetch(i,{method:"POST",body:s,headers:o});return{res:a,data:(yield a.json()).references.map(t=>t.managedObject)}})}removeChild(t,e,n){return A(this,void 0,void 0,function*(){const i=this.getIdString(e),r=`${this.getChildrenUrl(t,n)}/${i}`;return{res:yield this.fetch(r,{method:"DELETE",headers:{accept:"application/json"}}),data:null}})}}var P,k=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class N extends l{constructor(){super(...arguments),this.baseUrl="measurement",this.listUrl="measurements",this.propertyName="measurements",this.channel="/measurements/*"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return k(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return k(this,void 0,void 0,function*(){return e.create.call(this,this.onBeforeCreate(t))})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return k(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return k(this,void 0,void 0,function*(){return e.delete.call(this,t)})}listSeries(t){return k(this,void 0,void 0,function*(){const e=`${this.baseUrl}/${this.listUrl}/series`,n=yield this.client.fetch(e,{params:t});return{res:n,data:yield n.json()}})}onBeforeCreate(t){if(t.time||(t.time=new Date),t.type||(t.type="c8y_Measurement"),t.sourceId){const{sourceId:e}=t;delete t.sourceId,t.source||(t.source={id:String(e)})}return t}}(P=t.aggregationType||(t.aggregationType={})).MINUTELY="MINUTELY",P.HOURLY="HOURLY",P.DAILY="DAILY";var D,L=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class F extends l{constructor(){super(...arguments),this.baseUrl="alarm",this.listUrl="alarms",this.propertyName="alarms",this.channel="/alarms/*"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return L(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return L(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return L(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return L(this,void 0,void 0,function*(){return e.list.call(this,t)})}}(D=t.AlarmStatus||(t.AlarmStatus={}))[D.ACKNOWLEDGED=O("ACKNOWLEDGED")]="ACKNOWLEDGED",D[D.CLEARED=O("CLEARED")]="CLEARED",D[D.ACTIVE=O("ACTIVE")]="ACTIVE";var B=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class $ extends l{constructor(){super(...arguments),this.baseUrl="devicecontrol",this.listUrl="operations",this.propertyName="operations"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return B(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return B(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return B(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return B(this,void 0,void 0,function*(){return e.list.call(this,t)})}}var M,G,H,q=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class V extends l{constructor(){super(...arguments),this.baseUrl="devicecontrol",this.listUrl="bulkoperations",this.propertyName="bulkOperations"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return q(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return q(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return q(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return q(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return q(this,void 0,void 0,function*(){return e.delete.call(this,t)})}}(M=t.OperationBulkStatus||(t.OperationBulkStatus={}))[M.ACTIVE=O("ACTIVE")]="ACTIVE",M[M.IN_PROGRESS=O("IN_PROGRESS")]="IN_PROGRESS",M[M.COMPLETED=O("COMPLETED")]="COMPLETED",M[M.DELETED=O("DELETED")]="DELETED",(G=t.OperationBulkGeneralStatus||(t.OperationBulkGeneralStatus={}))[G.SCHEDULED=O("SCHEDULED")]="SCHEDULED",G[G.EXECUTING=O("EXECUTING")]="EXECUTING",G[G.EXECUTING_WITH_ERROR=O("EXECUTING_WITH_ERROR")]="EXECUTING_WITH_ERROR",G[G.CANCELED=O("CANCELED")]="CANCELED",G[G.FAILED=O("FAILED")]="FAILED",G[G.SUCCESSFUL=O("SUCCESSFUL")]="SUCCESSFUL",G[G.DELETED=O("DELETED")]="DELETED",G[G.INCORRECT=O("INCORRECT")]="INCORRECT",(H=t.OperationStatus||(t.OperationStatus={}))[H.PENDING=O("PENDING")]="PENDING",H[H.EXECUTING=O("EXECUTING")]="EXECUTING",H[H.SUCCESSFUL=O("SUCCESSFUL")]="SUCCESSFUL",H[H.FAILED=O("FAILED")]="FAILED";var X,W,J=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Y extends l{constructor(){super(...arguments),this.baseUrl="tenant",this.listUrl="tenants",this.currentTenantUrl="currentTenant",this.propertyName="tenants",this.fetchOptions={method:"PUT",body:"{}",headers:{"content-type":"application/json",accept:"application/json"}}}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return J(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return J(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return J(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return J(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return J(this,void 0,void 0,function*(){return e.delete.call(this,t)})}current(){return J(this,void 0,void 0,function*(){const t=yield this.fetch(this.currentTenantUrl,{headers:{"content-type":"application/json"}});return{res:t,data:yield t.json()}})}enableSupportUser(){return J(this,void 0,void 0,function*(){return{res:yield this.fetch("support-user/enable",this.fetchOptions),data:null}})}disableSupportUser(){return J(this,void 0,void 0,function*(){return{res:yield this.fetch("support-user/disable",this.fetchOptions),data:null}})}currentTenantType(){return J(this,void 0,void 0,function*(){const t=yield this.current();return t.data.customProperties&&"TRIAL"===t.data.customProperties.tenantType?"TRIAL":"REGULAR"})}getTfaSettings(t){return J(this,void 0,void 0,function*(){const e=`tenants/${this.getIdString(t)}/tfa`;return yield(yield this.fetch(e)).json()})}subscribeApplication(t,e){return J(this,void 0,void 0,function*(){const n=this.getIdString(t),i=e.id,r=`tenants/${n}/applications`,s=JSON.stringify({application:{id:i,self:e.self}}),o={"content-type":this.mimeType("applicationReference")};return{res:yield this.fetch(r,this.changeFetchOptions({method:"POST",body:s,headers:o},r)),data:null}})}unsubscribeApplication(t,e){return J(this,void 0,void 0,function*(){const n=`tenants/${this.getIdString(t)}/applications/${e.id}`;return{res:yield this.fetch(n,this.changeFetchOptions({method:"DELETE"},n)),data:null}})}getIdString(t){return t.id||t.name}onBeforeCreate(t){return t}}(X=t.TenantStatus||(t.TenantStatus={}))[X.ACTIVE=O("ACTIVE")]="ACTIVE",X[X.SUSPENDED=O("SUSPENDED")]="SUSPENDED",(W=t.TfaStrategy||(t.TfaStrategy={})).TOTP="TOTP",W.SMS="SMS";var Q=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class K extends l{constructor(t,e){super(e),this.listUrl="inventory",this.currenUserUrl="currentUser",this.propertyName="inventoryAssignments",this.baseUrl=`user/${t}/roles`}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return Q(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return Q(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Q(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return Q(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return Q(this,void 0,void 0,function*(){return e.delete.call(this,t)})}}var z,Z=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class tt extends l{constructor(){super(...arguments),this.baseUrl="user",this.currentUserUrl="currentUser",this.passwordResetUrl="passwordReset",this.currentUserPhoneUrl="currentUserPhone",this.verifyTFACodeUrl="pin",this.totpCurrentUserURL=`${this.currentUserUrl}/totpSecret`,this.verifyTOTPCodeUrl=`${this.totpCurrentUserURL}/verify`,this.activateTOTPCodeUrl=`${this.totpCurrentUserURL}/activity`,this.revokeTOTPSecretUrl="totpSecret/revoke",this.propertyName="users"}get listUrl(){return`${this.client.tenant}/users`}get newsletterEmailsUrl(){return`${this.client.tenant}/users/newsletterEmails`}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return Z(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return Z(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Z(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return Z(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return Z(this,void 0,void 0,function*(){return e.delete.call(this,t)})}inventoryAssignment(t){return new K(this.getDetailUrl(t),this.client)}current(){return Z(this,void 0,void 0,function*(){const t=yield this.fetch(this.currentUserUrl,{headers:{"content-type":"application/json",Accept:"application/vnd.com.nsn.cumulocity.user+json;"}});return{res:t,data:yield t.json()}})}currentWithEffectiveRoles(){return Z(this,void 0,void 0,function*(){const t=yield this.fetch(this.currentUserUrl,{headers:{"content-type":"application/json",Accept:"application/vnd.com.nsn.cumulocity.currentUser+json;"}});return{res:t,data:yield t.json()}})}updateCurrent(t){return Z(this,void 0,void 0,function*(){const e="application/vnd.com.nsn.cumulocity.user+json",n={"content-type":e,Accept:e},i=JSON.stringify(this.onBeforeUpdate(t)),r=yield this.fetch(this.currentUserUrl,{headers:n,body:i,method:"PUT"});return{res:r,data:yield r.json()}})}sendPasswordResetMail(t,e){return Z(this,void 0,void 0,function*(){const n=this.passwordResetUrl,i=e?{tenantId:e}:{},r=JSON.stringify({email:t});return{res:yield this.fetch(n,{headers:{"content-type":"application/json",accept:"application/json"},method:"POST",params:i,body:r}),data:null}})}resetPassword(t,e){return Z(this,void 0,void 0,function*(){const n=this.passwordResetUrl,i=e?{tenantId:e}:{},r=JSON.stringify(t);return{res:yield this.fetch(n,{headers:{"content-type":"application/json",accept:"application/json"},method:"PUT",params:i,body:r}),data:null}})}verifyTFACode(t){return Z(this,void 0,void 0,function*(){const e=JSON.stringify({pin:t});return{res:yield this.fetch(this.verifyTFACodeUrl,{headers:{"content-type":"application/json",accept:"application/json"},body:e,method:"POST"}),data:null}})}verifyTotpCode(t){return Z(this,void 0,void 0,function*(){const e=JSON.stringify({code:t});return{res:yield this.fetch(this.verifyTOTPCodeUrl,{headers:{"content-type":"application/json"},body:e,method:"POST"}),data:null}})}activateTotp(){return Z(this,void 0,void 0,function*(){const t=JSON.stringify({isActive:!0});return{res:yield this.fetch(this.activateTOTPCodeUrl,{headers:{"content-type":"application/json"},body:t,method:"POST"}),data:null}})}getActivityTotp(){return Z(this,void 0,void 0,function*(){const t=yield this.fetch(this.activateTOTPCodeUrl,{headers:{"content-type":"application/json"},method:"GET"});return{res:t,data:yield t.json()}})}generateTotpSecret(){return Z(this,void 0,void 0,function*(){const t=yield this.fetch(this.totpCurrentUserURL,{headers:{"content-type":"application/json",accept:"application/json"},method:"POST"});return{res:t,data:yield t.json()}})}totpRevokeSecret(t){return Z(this,void 0,void 0,function*(){const e=`${this.getDetailUrl(t)}/${this.revokeTOTPSecretUrl}`;return{res:yield this.fetch(e,{headers:{accept:"application/json"},method:"DELETE"}),data:null}})}savePhoneNumber(t){return Z(this,void 0,void 0,function*(){const e=this.currentUserPhoneUrl,n={method:"PUT",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify({phone:t})},i=yield this.fetch(e,n);return{res:i,data:yield i.json()}})}getNewsletterEmails(){return Z(this,void 0,void 0,function*(){const t=this.newsletterEmailsUrl,e=yield this.fetch(t,{method:"GET",headers:{accept:"text/plain"}});return{res:e,data:yield e.text()}})}hasRole(t,e){return this.hasRoleInUser(t,e)||this.hasRoleInGroups(t,e)}hasAllRoles(t,e){return e.every(e=>this.hasRole(t,e))}hasAnyRole(t,e){return e.some(e=>this.hasRole(t,e))}onBeforeUpdate(t){const e=Object.assign({},t);return delete e.id,delete e.userName,e}getDetailUrl(t){let e;return e="object"==typeof t&&t.id?t.id:"object"==typeof t&&t.userName?t.userName:t,`${this.listUrl}/${encodeURIComponent(String(e))}`}hasRoleInUser(t,e){const n=t.effectiveRoles||[];return this.hasRoleInReferences(t&&t.roles&&t.roles.references||[],e)||n.some(({id:t})=>e===t)}hasRoleInGroups(t,e){return(t&&t.groups&&t.groups.references||[]).some(t=>this.hasRoleInReferences(t.group.roles.references,e))}hasRoleInReferences(t,e){return t.some(t=>t.role.id===e)}}(z=t.PasswordStrength||(t.PasswordStrength={})).GREEN="GREEN",z.RED="RED",z.YELLOW="YELLOW";var et,nt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class it extends l{constructor(t,e){super(t),this.listUrl="binaries",this.propertyName="attachments",this.baseUrl=`application/applications/${this.getIdString(e)}`}upload(t,e){return nt(this,void 0,void 0,function*(){const n=this.listUrl,i=this.createBinaryRequestBody(t,e);let r;"function"==typeof i.getHeaders&&(r=i.getHeaders());const s=Object.assign({accept:"application/json"},r),o=yield this.fetch(n,{method:"POST",body:i,headers:s});return{res:o,data:yield o.json()}})}uploadWithProgressXhr(t,e,n){const i=`/${this.baseUrl}/${this.listUrl}`,r=this.createBinaryRequestBody(t,n);let s;"function"==typeof r.getHeaders&&(s=r.getHeaders());const o=this.client.getFetchOptions().headers;Object.assign(o,{Accept:"application/json"}),Object.assign(o,s);const a=new XMLHttpRequest;a.open("POST",i,!0);for(const t in o)o.hasOwnProperty(t)&&a.setRequestHeader(t,o[t]);return a.upload.addEventListener("progress",e),a.send(r),a}getXMLHttpResponse(t){return new Promise((e,n)=>{t.addEventListener("loadend",()=>{4!==t.readyState||200!==t.status&&201!==t.status?n(t.responseText?{data:JSON.parse(t.responseText)}:"Could not upload file."):e(JSON.parse(t.responseText))})})}list(t){const e=Object.create(null,{list:{get:()=>super.list}});return nt(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return nt(this,void 0,void 0,function*(){return e.delete.call(this,t)})}listPlugins(){return nt(this,void 0,void 0,function*(){const t=`${this.listUrl}/plugins`,e=yield this.fetch(t,{headers:{accept:"application/json"}});return{res:e,data:yield e.json()}})}addPlugin(t,e){return nt(this,void 0,void 0,function*(){const n=`${this.listUrl}/plugins/${encodeURIComponent(t)}`,i=new _,r=e instanceof ArrayBuffer?Buffer.from(e):e;let s;i.append("file",r),"function"==typeof i.getHeaders&&(s=i.getHeaders());const o=Object.assign({accept:"application/json"},s),a=yield this.fetch(n,{method:"POST",body:i,headers:o});return{res:a,data:yield a.json()}})}removePlugin(t){return nt(this,void 0,void 0,function*(){const e=`${this.listUrl}/plugins/${t}`,n=yield this.fetch(e,{method:"DELETE",headers:{accept:"application/json"}});return{res:n,data:yield n.json()}})}updateFiles(t){return nt(this,void 0,void 0,function*(){const e=`${this.listUrl}/files`,n=new _;let i;t.forEach(t=>{const e=t.contents instanceof ArrayBuffer?Buffer.from(t.contents):t.contents;n.append(t.path,e)}),"function"==typeof n.getHeaders&&(i=n.getHeaders());const r=Object.assign({accept:"application/json"},i),s=yield this.fetch(e,{method:"POST",body:n,headers:r});return{res:s,data:yield s.json()}})}downloadArchive(t){return nt(this,void 0,void 0,function*(){const e=`${this.listUrl}/${t}`;return yield this.fetch(e)})}createBinaryRequestBody(t,e){const n=new _,i=t instanceof ArrayBuffer?Buffer.from(t):t;let r=e;return"undefined"!=typeof File&&t instanceof File&&(r=t.name),n.append("file",i,r),n.append("fileName",r),n}}(et=t.ApplicationType||(t.ApplicationType={})).EXTERNAL="EXTERNAL",et.HOSTED="HOSTED",et.MICROSERVICE="MICROSERVICE",et.FEATURE="FEATURE",et.REPOSITORY="REPOSITORY";var rt,st,ot,at=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class ct extends l{constructor(){super(...arguments),this.baseUrl="application",this.listUrl="applications",this.propertyName="applications",this.channel="/applications/*"}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return at(this,void 0,void 0,function*(){return e.create.call(this,t)})}clone(t){return at(this,void 0,void 0,function*(){const e=`${this.getDetailUrl(t)}/clone`,n=yield this.fetch(e,{method:"POST",body:"",headers:{"content-type":"application/json",accept:"application/json"}});return{res:n,data:yield n.json()}})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return at(this,void 0,void 0,function*(){return e.list.call(this,t)})}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return at(this,void 0,void 0,function*(){return e.detail.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return at(this,void 0,void 0,function*(){return e.update.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return at(this,void 0,void 0,function*(){return e.delete.call(this,t)})}listByName(t){return at(this,void 0,void 0,function*(){const e=`applicationsByName/${encodeURIComponent(t)}`,n=yield this.fetch(e,{headers:{"content-type":"application/json"}});return{res:n,data:(yield n.json())[this.propertyName]}})}listByTenant(t,e={}){return at(this,void 0,void 0,function*(){const n=new Y(this.client),i=this.getIdString(t||(yield n.current()).data.name),r=`applicationsByTenant/${encodeURIComponent(i)}`,s=yield this.fetch(r,{headers:{"content-type":"application/json"},params:e});return{res:s,data:(yield s.json())[this.propertyName]}})}listByOwner(t,e={}){return at(this,void 0,void 0,function*(){const n=new Y(this.client),i=this.getIdString(t||(yield n.current()).data.name),r=`applicationsByOwner/${encodeURIComponent(i)}`,s=yield this.fetch(r,{headers:{"content-type":"application/json"},params:e});return{res:s,data:(yield s.json())[this.propertyName]}})}listByUser(t,e={}){return at(this,void 0,void 0,function*(){const n=new tt(this.client),i=this.getIdString(t||(yield n.current()).data),r=`applicationsByUser/${encodeURIComponent(i)}`,s=yield this.fetch(r,{headers:{"content-type":"application/json"},params:e});return{res:s,data:(yield s.json())[this.propertyName]}})}reactivateArchive(t){return at(this,void 0,void 0,function*(){const e=`${this.listUrl}/${t}/refresh`;return{res:yield this.fetch(e,{method:"POST",body:"",headers:{"content-type":"application/json",accept:"application/json"}}),data:null}})}binary(t){return new it(this.client,t)}getHref(e){return e.type===t.ApplicationType.EXTERNAL?e.externalUrl:`/apps/${e.public?"public/":""}${e.contextPath}`}isAvailable(t){return at(this,void 0,void 0,function*(){const{res:e,data:n}=yield this.listByUser(void 0,{dropOverwrittenApps:!0,noPaging:!0});return{data:(n||[]).some(e=>"string"==typeof t?e.name===t||e.contextPath===t:this.isMatch(e,t)),res:e}})}isMatch(t,e){return Object.keys(e).every(n=>Array.isArray(t[n])&&Array.isArray(e[n])?e[n].every(e=>t[n].includes(e)):"object"==typeof t[n]&&null!==t[n]&&"object"==typeof e[n]&&null!==e[n]?this.isMatch(t[n],e[n]):t[n]===e[n])}}(rt=t.BillingMode||(t.BillingMode={})).SUBSCRIPTION="SUBSCRIPTION",rt.RESOURCES="RESOURCES",(st=t.Isolation||(t.Isolation={})).PER_TENANT="PER_TENANT",st.MULTI_TENANT="MULTI_TENANT",(ot=t.ApplicationAvailability||(t.ApplicationAvailability={}))[ot.MARKET=O("MARKET")]="MARKET",ot[ot.PRIVATE=O("PRIVATE")]="PRIVATE";var ut=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class lt extends l{constructor(){super(...arguments),this.baseUrl="tenant/system",this.listUrl="options",this.propertyName="options"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return ut(this,void 0,void 0,function*(){return e.detail.call(this,t)})}list(t={}){return ut(this,void 0,void 0,function*(){const e=this.listUrl,n=yield this.fetch(e,{headers:{"content-type":"application/json"},params:t});return{res:n,data:(yield n.json())[this.propertyName]}})}getDetailUrl(t){return`${this.listUrl}/${t.category}/${t.key}`}onBeforeCreate(t){return t}}var dt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class ht extends l{constructor(){super(...arguments),this.baseUrl="tenant",this.listUrl="options",this.propertyName="options",this.securityOptionsCategories=["password"],this.securityOptionsListUrl="security-options",this.systemOptions="system"}detail(t,e={}){const n=Object.create(null,{detail:{get:()=>super.detail}});return dt(this,void 0,void 0,function*(){return n.detail.call(this,t,e)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return dt(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return dt(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return dt(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return dt(this,void 0,void 0,function*(){return e.delete.call(this,t)})}getDetailUrl(t){const e=encodeURIComponent(t.category),n=encodeURIComponent(t.key);return this.securityOptionsCategories.indexOf(t.category)>-1?`${this.securityOptionsListUrl}/${e}/${n}`:`${this.listUrl}/${e}/${n}`}onBeforeCreate(t){return t}}var pt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class ft extends l{constructor(){super(...arguments),this.baseUrl="tenant",this.listUrl="security-options",this.category="password",this.propertyName="options"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return pt(this,void 0,void 0,function*(){return e.detail.call(this,t)})}getDetailUrl(t){return`${this.listUrl}/${this.category}/${t.key}`}onBeforeCreate(t){return t}}var vt,gt,yt,mt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class bt extends l{constructor(){super(...arguments),this.baseUrl="tenant",this.listUrl="loginOptions",this.propertyName="loginOptions"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return mt(this,void 0,void 0,function*(){return e.detail.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return mt(this,void 0,void 0,function*(){return e.list.call(this,t)})}listForCurrentTenant(){const t=Object.create(null,{list:{get:()=>super.list}});return mt(this,void 0,void 0,function*(){return t.list.call(this,{tenantId:this.client.tenant})})}listForManagement(){const t=Object.create(null,{list:{get:()=>super.list}});return mt(this,void 0,void 0,function*(){return t.list.call(this,{management:!0})})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return mt(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return mt(this,void 0,void 0,function*(){return e.update.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return mt(this,void 0,void 0,function*(){return e.delete.call(this,t)})}}(vt=t.TenantLoginOptionType||(t.TenantLoginOptionType={})).OAUTH2_INTERNAL="OAUTH2_INTERNAL",vt.OAUTH2="OAUTH2",vt.BASIC="BASIC",(gt=t.GrantType||(t.GrantType={})).AUTHORIZATION_CODE="AUTHORIZATION_CODE",gt.PASSWORD="PASSWORD",(yt=t.UserManagementSource||(t.UserManagementSource={})).REMOTE="REMOTE",yt.INTERNAL="INTERNAL";var Tt,wt,Ot=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Et extends l{constructor(){super(...arguments),this.baseUrl="audit",this.listUrl="auditRecords",this.propertyName="auditRecords"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return Ot(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return Ot(this,void 0,void 0,function*(){return e.create.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return Ot(this,void 0,void 0,function*(){return e.list.call(this,t)})}}(Tt=t.AuditRecordType||(t.AuditRecordType={})).ALARM="Alarm",Tt.BULK_OPERATION="BulkOperation",Tt.CEP_MODULE="CepModule",Tt.EVENT="Event",Tt.INVENTORY="Inventory",Tt.INVENTORY_ROLE="InventoryRole",Tt.OPERATION="Operation",Tt.OPTION="Option",Tt.GROUP="Group",Tt.SMART_RULE="SmartRule",Tt.SYSTEM="SYSTEM",Tt.TENANT="Tenant",Tt.USER="User",(wt=t.ChangeType||(t.ChangeType={}))[wt.ADDED=O("ADDED")]="ADDED",wt[wt.REPLACED=O("REPLACED")]="REPLACED",wt[wt.REMOVED=O("REMOVED")]="REMOVED";var St,Ut=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Ct extends l{constructor(){super(...arguments),this.baseUrl="user",this.listUrl="inventoryroles",this.propertyName="roles"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return Ut(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return Ut(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Ut(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return Ut(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return Ut(this,void 0,void 0,function*(){return e.delete.call(this,t)})}}(St=t.DeviceRegistrationStatus||(t.DeviceRegistrationStatus={}))[St.WAITING_FOR_CONNECTION=O("WAITING_FOR_CONNECTION")]="WAITING_FOR_CONNECTION",St[St.PENDING_ACCEPTANCE=O("PENDING_ACCEPTANCE")]="PENDING_ACCEPTANCE",St[St.ACCEPTED=O("ACCEPTED")]="ACCEPTED";var _t=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Rt extends l{constructor(){super(...arguments),this.baseUrl="devicecontrol",this.listUrl="newDeviceRequests",this.propertyName="newDeviceRequests"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return _t(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return _t(this,void 0,void 0,function*(){return e.create.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return _t(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return _t(this,void 0,void 0,function*(){return e.delete.call(this,t)})}accept(e){return _t(this,void 0,void 0,function*(){const n=this.getIdString(e);return Object.getPrototypeOf(this).update.bind(this)({id:n,status:t.DeviceRegistrationStatus.ACCEPTED})})}bootstrap(t,e){return _t(this,void 0,void 0,function*(){const n=this.getIdString(t),i=JSON.stringify({id:n}),r=`${this.baseUrl}/deviceCredentials`,{basicAuth:s}=e;let{basicAuthToken:o}=e;if(s){const{user:t,pass:e}=s;o=m(`${t}:${e}`)}const a={Authorization:`Basic ${o}`,accept:"application/json","content-type":"application/json"},c=yield this.client.fetch(r,{body:i,headers:a,method:"POST"}),u=yield c.json();if(c.status>400)throw{res:c,data:u};return{res:c,data:u}})}onBeforeCreate(t){return t}onBeforeUpdate(t){const e=Object.assign({},t);return delete e.id,e}}var jt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class xt{constructor(t){this.client=t}create(t){return jt(this,void 0,void 0,function*(){let e=t;const n=new _;let i,r="bulk-registration.csv";if("undefined"!=typeof File&&e instanceof File){r=e.name;const t=/\.csv$/;e.name.match(t)&&(e=new File([e],e.name,{type:"text/csv"}))}n.append("file",e,r),"function"==typeof n.getHeaders&&(i=n.getHeaders());const s=Object.assign({accept:"application/json"},i),o=yield this.client.fetch("/devicecontrol/bulkNewDeviceRequests",{method:"POST",body:n,headers:s});return{res:o,data:yield o.json()}})}}var At=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class It extends l{constructor(){super(...arguments),this.baseUrl="user",this.listUrl="roles",this.propertyName="roles"}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return At(this,void 0,void 0,function*(){return e.detail.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return At(this,void 0,void 0,function*(){return e.list.call(this,t)})}}var Pt,kt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};!function(t){t.ROLES="roles",t.USERS="users"}(Pt||(Pt={}));class Nt extends l{constructor(){super(...arguments),this.baseUrl="user",this.propertyName="groups"}get listUrl(){return`${this.client.tenant}/groups`}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return kt(this,void 0,void 0,function*(){return e.detail.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return kt(this,void 0,void 0,function*(){return e.create.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return kt(this,void 0,void 0,function*(){return e.update.call(this,t)})}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return kt(this,void 0,void 0,function*(){return e.list.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return kt(this,void 0,void 0,function*(){return e.delete.call(this,t)})}addRoleToGroup(t,e){return kt(this,void 0,void 0,function*(){return this.addChild(Pt.ROLES,t,e)})}removeRoleFromGroup(t,e){return kt(this,void 0,void 0,function*(){return this.removeChild(Pt.ROLES,t,e)})}addUserToGroup(t,e){return kt(this,void 0,void 0,function*(){return this.addChild(Pt.USERS,t,e)})}removeUserFromGroup(t,e){return kt(this,void 0,void 0,function*(){return this.removeChild(Pt.USERS,t,e)})}getSelf(t){return"object"==typeof t&&t.self?t.self:t}getChildUrl(t,e){return`${this.getDetailUrl(e)}/${t}`}getChildReferenceAsBody(t,e){const n=this.getSelf(e);switch(t){case Pt.ROLES:return JSON.stringify({role:{self:String(n)}});case Pt.USERS:return JSON.stringify({user:{self:String(n)}})}throw new Error("UserGroupService -> getChild -> unsupported child type")}addChild(t,e,n){return kt(this,void 0,void 0,function*(){const i=this.getChildUrl(t,e),r=this.getChildReferenceAsBody(t,n),s=yield this.fetch(i,{method:"POST",body:r,headers:{accept:"application/json","content-type":"application/json"}});let o=yield s.json();return{res:s,data:o=o.managedObject}})}removeChild(t,e,n){return kt(this,void 0,void 0,function*(){const i=this.getIdString(n),r=`${this.getChildUrl(t,e)}/${encodeURIComponent(String(i))}`;return{res:yield this.fetch(r,{method:"DELETE",headers:{accept:"application/json"}}),data:null}})}}var Dt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Lt{constructor(t){this.baseUrl="identity",this.propertyName="externalIds",this.client=t}list(t){return Dt(this,void 0,void 0,function*(){const e=this.getExternalIdsOfGlobalIdUrl(t),n=yield this.fetch(e,{headers:{accept:"application/json"}});return{res:n,data:(yield n.json())[this.propertyName]}})}create(t){return Dt(this,void 0,void 0,function*(){const e=JSON.stringify(t),n=this.getExternalIdsOfGlobalIdUrl(t.managedObject.id),i=yield this.fetch(n,{headers:{"content-type":"application/json",accept:"application/json"},method:"POST",body:e});return{res:i,data:yield i.json()}})}detail(t){return Dt(this,void 0,void 0,function*(){const e=this.getExternalIdUrl(t),n=yield this.fetch(e,{headers:{accept:"application/json"}});return{res:n,data:yield n.json()}})}delete(t){return Dt(this,void 0,void 0,function*(){const e=this.getExternalIdUrl(t);return{res:yield this.fetch(e,{headers:{accept:"application/json"},method:"DELETE"}),data:null}})}fetch(t,e){return Dt(this,void 0,void 0,function*(){const n=yield this.client.fetch(t,e);if(n.status>=400){let t=null;try{t=yield n.json()}catch(e){try{t=yield n.text()}catch(t){}}throw{res:n,data:t}}return n})}getExternalIdsOfGlobalIdUrl(t){return`/${this.baseUrl}/globalIds/${t}/externalIds`}getExternalIdUrl(t){return`/${this.baseUrl}/externalIds/${t.type}/${t.externalId}`}}var Ft=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};var Bt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})},$t=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n};class Mt extends l{constructor(t){super(t),this.baseUrl="inventory",this.listUrl="managedObjects",this.SMART_GROUP_TYPE="c8y_DynamicGroup",this.SMART_GROUP_FRAGMENT_TYPE="c8y_IsDynamicGroup",this.DEVICE_GROUP_FRAGMENT_TYPE="c8y_IsDeviceGroup",this.DEVICE_GROUP_TYPE="c8y_DeviceGroup",this.DEVICE_SUBGROUP_TYPE="c8y_DeviceSubgroup",this.SMART_GROUPS_V2_MICROSERVICE_APP_NAME="smartgroup",this.SMART_GROUPS_V2_MICROSERVICE_BASE_PATH="service/smartgroup",this.SMART_GROUPS_V2_MICROSERVICE_ENDPOINT_PATH=`${this.SMART_GROUPS_V2_MICROSERVICE_BASE_PATH}/smartgroups`,this.applicationService=new ct(t)}detail(t,e={}){const n=Object.create(null,{detail:{get:()=>super.detail}});return Bt(this,void 0,void 0,function*(){return n.detail.call(this,t,e)})}update(t,e={}){const n=Object.create(null,{update:{get:()=>super.update}});return Bt(this,void 0,void 0,function*(){const{id:i}=t,{data:r}=yield this.isSmartGroupsV2MicroserviceInstalled(),{data:s}=yield this.detail(i,{withChildren:!1});return r&&this.isSmartGroupV2(s)?this.updateSmartGroupV2(t,e):n.update.call(this,t)})}updateSmartGroupV2(t,e={}){return Bt(this,void 0,void 0,function*(){const{id:n}=t,i=$t(t,["id"]),r=JSON.stringify(this.onBeforeUpdate(i)),s=`${this.SMART_GROUPS_V2_MICROSERVICE_ENDPOINT_PATH}/${n}`,o=yield this.fetch(s,{method:"PUT",body:r,headers:{"content-type":"application/json",accept:"application/json"},params:Object.assign({},e)});return{res:o,data:yield o.json()}})}delete(t,e={}){const n=Object.create(null,{delete:{get:()=>super.delete}});return Bt(this,void 0,void 0,function*(){const{data:i}=yield this.isSmartGroupsV2MicroserviceInstalled(),r=(yield this.detail(t,{withChildren:!1})).data;return i&&this.isSmartGroupV2(r)?yield this.removeSmartGroupV2(r):yield n.delete.call(this,r,e)})}isSmartGroupsV2MicroserviceInstalled(){return this.applicationService.isAvailable({name:this.SMART_GROUPS_V2_MICROSERVICE_APP_NAME})}isSmartGroup(t){const e=t.hasOwnProperty(this.SMART_GROUP_FRAGMENT_TYPE),n=t&&t.type===this.SMART_GROUP_TYPE;return e||n}isSmartGroupV2(t){const e=t.hasOwnProperty(this.SMART_GROUP_FRAGMENT_TYPE),n=t.hasOwnProperty(this.DEVICE_GROUP_FRAGMENT_TYPE),i=t&&t.type===this.DEVICE_GROUP_TYPE||t.type===this.DEVICE_SUBGROUP_TYPE;return e&&n&&i}removeSmartGroupV2(t){return Bt(this,void 0,void 0,function*(){let e;e="object"==typeof t&&t.id?t.id:t;const n=`${this.SMART_GROUPS_V2_MICROSERVICE_ENDPOINT_PATH}/${e}`;return{res:yield this.client.fetch(n,{method:"DELETE"}),data:null}})}getUrl(t=""){const e=t.replace(/^\/+/,""),n=this.baseUrl.replace(/\/+$/,"");return t.includes(this.SMART_GROUPS_V2_MICROSERVICE_ENDPOINT_PATH)?e:`${n}/${e}`}}var Gt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Ht extends l{constructor(t){super(t),this.baseUrl="service/smartrule",this.rulesUrl="smartrules",this.unupdatableFields=["type","cepModuleId","creationTime","lastUpdated"]}listByContext(t){return Gt(this,void 0,void 0,function*(){const e=this.contextRulesUrl(t),n=yield this.fetch(e,{method:"GET"});return{res:n,data:(yield n.json()).rules}})}bulkDeactivateEnabledSources(t,e){if(0===e.length)return Promise.resolve({res:null,data:null});const{enabledSources:n}=t,i=this.disableEnabledSources(n,e),r=Object.assign({},t);return Object.assign(r,{enabledSources:i}),this.update(r)}update(t){return Gt(this,void 0,void 0,function*(){const e=this.getSmartRulesUrl(t),n=JSON.stringify(this.removeUnclonableFields(t,this.unupdatableFields)),i=yield this.fetch(e,{method:"PUT",body:n,headers:{"content-type":"application/json",accept:"application/json"}});return{res:i,data:yield i.json()}})}disableEnabledSources(t=[],e){return t.filter(t=>!this.getListOfStringIds(e).includes(t))}getListOfStringIds(t){return t.map(t=>"object"==typeof t&&t.id?t.id.toString():t.toString())}getSmartRulesUrl(t){const e=t&&t.c8y_Context&&t.c8y_Context.id;let n=e?this.contextRulesUrl(e):this.rulesUrl;return t.id&&(n=`${n}/${t.id}`),n}removeUnclonableFields(t,e){const n=Object.assign({},t);return e.forEach(t=>{delete n[t]}),n}contextRulesUrl(t={}){return"object"==typeof t&&t.id?`managedObjects/${t.id}/smartrules`:`managedObjects/${t}/smartrules`}}var qt=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}c((i=i.apply(t,e||[])).next())})};class Vt{constructor(t,e){const n=new f(t,e);this.realtime=new o(n),this.alarm=new F(n,this.realtime),this.application=new ct(n,this.realtime),this.audit=new Et(n),this.core=n,this.deviceRegistration=new Rt(n),this.deviceRegistrationBulk=new xt(n),this.event=new C(n,this.realtime),this.inventory=new I(n,this.realtime),this.inventoryBinary=new x(n),this.inventoryRole=new Ct(n),this.measurement=new N(n,this.realtime),this.operation=new $(n),this.operationBulk=new V(n),this.options={security:new ft(n),system:new lt(n),login:new bt(n),tenant:new ht(n)},this.role=new Ct(n),this.tenant=new Y(n),this.user=new tt(n),this.userGroup=new Nt(n),this.userRole=new It(n),this.identity=new Lt(n),this.smartGroups=new Mt(n),this.smartRules=new Ht(n)}static authenticate(t,e){return qt(this,void 0,void 0,function*(){const n=new T(t),i=yield new f(n,e).fetch("/tenant/currentTenant",{method:"GET"});if(200!==i.status)throw{res:i};const{name:r}=yield i.json(),s=new Vt(n,e);return s.core.tenant=r,s})}static deviceBootstrap(t){return qt(this,void 0,void 0,function*(){const{deviceId:e,timeout:n,baseUrl:i,basicAuthToken:r}=t;let{expire:s}=t;n&&!s&&(s=Date.now()+n);const o=new f(void 0,i),a=new Rt(o);let c;try{const{data:n}=yield a.bootstrap(e,{basicAuthToken:r}),{username:o,password:u,tenantId:l}=n,d=new T({user:o,tenant:l,password:u});(c=new Vt(d,i)).core.tenant=l}catch(e){if((!s||Date.now()<s)&&404===e.res.status)return Vt.deviceBootstrap(Object.assign({expire:s},t));throw e}return c})}static getMicroserviceSubscriptions(t,e){return qt(this,void 0,void 0,function*(){const n=yield new f(new T(t),e).fetch("/application/currentApplication/subscriptions"),{users:i}=yield n.json();return i.map(({tenant:t,name:e,password:n})=>({tenant:t,user:e,password:n}))})}setAuth(t){this.core.setAuth(t),this.realtime.disconnect()}}t.Client=Vt,t.AlarmService=F,t.ApplicationService=ct,t.AuditService=Et,t.Service=l,t.FetchClient=f,t.BasicAuth=T,t.CookieAuth=class{constructor(){this.logoutUrl="user/logout"}updateCredentials({user:t}={}){this.user=t}getFetchOptions(t){const e={"X-XSRF-TOKEN":this.getCookieValue("XSRF-TOKEN")};return t.headers=Object.assign(e,t.headers),t}getCometdHandshake(t={}){const e="com.cumulocity.authn",n=this.getCookieValue("XSRF-TOKEN"),i=t.ext=t.ext||{};return i[e]=Object.assign(i[e]||{},{xsrfToken:n}),t}logout(){return w(this,void 0,void 0,function*(){this.user&&delete this.user;const t=new f;t.setAuth(this);const e=JSON.stringify({});return t.fetch(this.logoutUrl,{headers:{"content-type":"application/json",accept:"application/json"},body:e,method:"POST"})})}getCookieValue(t){const e=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return e?e.pop():""}},t.MicroserviceClientRequestAuth=class{constructor(t={}){this.xsrfToken=this.getCookieValue(t,"XSRF-TOKEN"),this.authTokenFromCookie=this.getCookieValue(t,"authorization"),this.authTokenFromHeader=t.authorization}updateCredentials(t={}){}getFetchOptions(t){const e=Object.assign({Authorization:this.authTokenFromCookie?`Bearer ${this.authTokenFromCookie}`:this.authTokenFromHeader},this.xsrfToken?{"X-XSRF-TOKEN":this.xsrfToken}:void 0);return t.headers=Object.assign(e,t.headers),t}getCometdHandshake(t={}){const e="com.cumulocity.authn",n=this.xsrfToken;let i=this.authTokenFromCookie;!i&&this.authTokenFromHeader&&(i=this.authTokenFromHeader.replace("Basic ","").replace("Bearer ",""));const r=t.ext=t.ext||{};return r[e]=Object.assign(r[e]||{},Object.assign({token:i},n?{xsrfToken:n}:void 0)),t}logout(){this.authTokenFromCookie&&delete this.authTokenFromCookie,this.authTokenFromHeader&&delete this.authTokenFromHeader,this.xsrfToken&&delete this.xsrfToken}getCookieValue(t,e){try{const n=t&&t.cookie&&t.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return n?n.pop():void 0}catch(t){return}}},t.Paging=c,t.QueriesUtil=S,t.TrustedCertificateService=class extends l{constructor(){super(...arguments),this.listUrl="trusted-certificates",this.propertyName="certificates"}get baseUrl(){return`/tenant/tenants/${this.client.tenant}`}list(t={}){const e=Object.create(null,{list:{get:()=>super.list}});return Ft(this,void 0,void 0,function*(){return e.list.call(this,t)})}detail(t){const e=Object.create(null,{detail:{get:()=>super.detail}});return Ft(this,void 0,void 0,function*(){return e.detail.call(this,t)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return Ft(this,void 0,void 0,function*(){return e.delete.call(this,t)})}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Ft(this,void 0,void 0,function*(){return e.update.call(this,t)})}create(t){const e=Object.create(null,{create:{get:()=>super.create}});return Ft(this,void 0,void 0,function*(){return e.create.call(this,t)})}getDetailUrl(t){let e;return e="object"==typeof t&&t.fingerprint?t.fingerprint:t,`${this.listUrl}/${e}`}},t.DeviceRegistrationService=Rt,t.DeviceRegistrationBulkService=xt,t.EventService=C,t.EventBinaryService=class extends l{constructor(){super(...arguments),this.baseUrl="event",this.listUrl="events"}upload(t,e){return R(this,void 0,void 0,function*(){const n=this.getDetailUrl(e),i=new _;i.append("file",t);const r=yield this.fetch(n,{method:"POST",body:i,headers:{accept:"application/json"}});return{res:r,data:yield r.json()}})}download(t){return R(this,void 0,void 0,function*(){const e=this.getDetailUrl(t);return yield this.fetch(e)})}delete(t){const e=Object.create(null,{delete:{get:()=>super.delete}});return R(this,void 0,void 0,function*(){return e.delete.call(this,t)})}getDetailUrl(t){let e;return e="object"==typeof t&&t.id?t.id:t,`${this.listUrl}/${e}/binaries`}},t.IdentityService=Lt,t.InventoryService=I,t.InventoryBinaryService=x,t.InventoryRoleService=Ct,t.MeasurementService=N,t.OperationService=$,t.OperationBulkService=V,t.Realtime=o,t.SystemOptionsService=lt,t.TenantService=Y,t.TenantOptionsService=ht,t.TenantSecurityOptionsService=ft,t.TenantLoginOptionsService=bt,t.UserService=tt,t.UserInventoryRoleService=K,t.UserGroupService=Nt,t.UserRoleService=It,t.SmartRulesService=Ht,t.SmartGroupsService=Mt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=client.umd.min.js.map
