import { Component, Input } from '@angular/core';
import { deviceAvailabilityIconMap, PushStatusLabels, SendStatusLabels, tooltips } from './device-availability';
import { TranslateService } from '@ngx-translate/core';
import { get } from 'lodash-es';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@ngx-translate/core';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '../common/icon.directive';
import * as ɵngcc4 from 'ngx-bootstrap/tooltip';
import * as ɵngcc5 from '../i18n/c8y-translate.pipe';

function DeviceStatusComponent_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 4);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r0.status().sendStatus.icon)("ngClass", ctx_r0.status().sendStatus.class);
} }
function DeviceStatusComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 5);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r1.status().pushStatus.icon)("ngClass", ctx_r1.status().pushStatus.class);
} }
function DeviceStatusComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 6);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵpropertyInterpolate("tooltip", ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r2.status().maintenanceStatus.tooltip));
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r2.status().maintenanceStatus.icon)("ngClass", ctx_r2.status().maintenanceStatus.class);
} }
export class DeviceStatusComponent {
    constructor(translateService) {
        this.translateService = translateService;
    }
    set node(value) {
        this._mo = value.mo || value;
    }
    get() {
        return this._mo;
    }
    ngOnChanges() {
        this.setStatusProperites();
    }
    ngAfterContentInit() {
        this.setStatusProperites();
    }
    setStatusProperites() {
        this.requiredAvailability = get(this._mo, 'c8y_RequiredAvailability');
        this.availabilityStatus = get(this._mo, 'c8y_Availability.status');
        this.pushStatus = get(this._mo, 'c8y_Connection.status') || 'UNKNOWN';
        this.sendStatus =
            this.availabilityStatus || (this.requiredAvailability ? 'UNKNOWN' : 'NOT_MONITORED');
    }
    status() {
        let statuses;
        if (this.availabilityStatus === 'MAINTENANCE' || this.pushStatus === 'MAINTENANCE') {
            statuses = this.getMaintenanceStatus();
        }
        else {
            statuses = this.getSendPushStatus();
        }
        return statuses;
    }
    getMaintenanceStatus() {
        return {
            sendStatus: false,
            pushStatus: false,
            maintenanceStatus: {
                icon: deviceAvailabilityIconMap.device.MAINTENANCE.icon,
                class: deviceAvailabilityIconMap.device.MAINTENANCE.class,
                tooltip: tooltips.maintenance
            }
        };
    }
    getSendPushStatus() {
        return {
            sendStatus: {
                icon: deviceAvailabilityIconMap.sendData[this.sendStatus].icon,
                class: deviceAvailabilityIconMap.sendData[this.sendStatus].class,
                status: this.sendStatus,
                label: SendStatusLabels[this.sendStatus],
                tooltip: this.getSendStatusTooltip(this._mo)
            },
            pushStatus: {
                icon: deviceAvailabilityIconMap.push[this.pushStatus].icon,
                class: deviceAvailabilityIconMap.push[this.pushStatus].class,
                status: this.pushStatus,
                label: PushStatusLabels[this.pushStatus],
                tooltip: this.getPushStatusTooltip(this.pushStatus === 'CONNECTED')
            },
            maintenanceStatus: false
        };
    }
    getSendStatusTooltip(device) {
        const availability = device && device.c8y_Availability;
        const lastMessage = availability && availability.lastMessage;
        if (lastMessage) {
            return tooltips.sendStatusConnected(lastMessage, this.translateService);
        }
        return tooltips.sendStatusDisconnected;
    }
    getPushStatusTooltip(isActive) {
        return isActive ? tooltips.pushStatusConnected : tooltips.pushStatusDisconnected;
    }
}
DeviceStatusComponent.ɵfac = function DeviceStatusComponent_Factory(t) { return new (t || DeviceStatusComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TranslateService)); };
DeviceStatusComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DeviceStatusComponent, selectors: [["device-status"]], inputs: { node: ["mo", "node"] }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 6, vars: 9, consts: [["placement", "left", 1, "statusContainer", 3, "title"], ["class", "sendStatus", 3, "c8yIcon", "ngClass", 4, "ngIf"], ["class", "pushStatus", 3, "c8yIcon", "ngClass", 4, "ngIf"], ["class", "maintenanceStatus", "container", "body", "placement", "auto", 3, "tooltip", "c8yIcon", "ngClass", 4, "ngIf"], [1, "sendStatus", 3, "c8yIcon", "ngClass"], [1, "pushStatus", 3, "c8yIcon", "ngClass"], ["container", "body", "placement", "auto", 1, "maintenanceStatus", 3, "tooltip", "c8yIcon", "ngClass"]], template: function DeviceStatusComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵpipe(1, "translate");
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵtemplate(3, DeviceStatusComponent_div_3_Template, 1, 2, "div", 1);
        ɵngcc0.ɵɵtemplate(4, DeviceStatusComponent_div_4_Template, 1, 2, "div", 2);
        ɵngcc0.ɵɵtemplate(5, DeviceStatusComponent_div_5_Template, 2, 5, "div", 3);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵpropertyInterpolate2("title", "", ɵngcc0.ɵɵpipeBind1(1, 5, ctx.status().sendStatus.tooltip), "\n", ɵngcc0.ɵɵpipeBind1(2, 7, ctx.status().pushStatus.tooltip), "");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", !!ctx.status().sendStatus);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !!ctx.status().pushStatus);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !!ctx.status().maintenanceStatus);
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.IconDirective, ɵngcc2.NgClass, ɵngcc4.TooltipDirective], pipes: [ɵngcc5.C8yTranslatePipe], encapsulation: 2 });
DeviceStatusComponent.ctorParameters = () => [
    { type: TranslateService }
];
DeviceStatusComponent.propDecorators = {
    node: [{ type: Input, args: ['mo',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DeviceStatusComponent, [{
        type: Component,
        args: [{
                selector: 'device-status',
                template: "<!-- ATTENTION: keep text format in `tooltip` attribute -->\n<div class=\"statusContainer\"\n    title=\"{{status().sendStatus.tooltip | translate}}\n{{status().pushStatus.tooltip | translate}}\"\n    placement=\"left\"\n   >\n    <div\n    *ngIf=\"!!status().sendStatus\"\n    class=\"sendStatus\"\n    [c8yIcon]=\"status().sendStatus.icon\"\n    [ngClass]=\"status().sendStatus.class\"\n    ></div>\n    <div\n    *ngIf=\"!!status().pushStatus\"\n    class=\"pushStatus\"\n    [c8yIcon]=\"status().pushStatus.icon\"\n    [ngClass]=\"status().pushStatus.class\"\n    >\n    </div>\n\n  <div *ngIf=\"!!status().maintenanceStatus\"\n    class=\"maintenanceStatus\"\n    tooltip=\"{{status().maintenanceStatus.tooltip | translate}}\"\n    container=\"body\"\n    placement=\"auto\"\n    [c8yIcon]=\"status().maintenanceStatus.icon\"\n    [ngClass]=\"status().maintenanceStatus.class\"></div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.TranslateService }]; }, { node: [{
            type: Input,
            args: ['mo']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLXN0YXR1cy5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvZGV2aWNlLXN0YXR1cy9kZXZpY2Utc3RhdHVzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBK0IsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUNMLHlCQUF5QixFQUN6QixnQkFBZ0IsRUFDaEIsZ0JBQWdCLEVBQ2hCLFFBQVEsRUFDVCxNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxXQUFXLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNaEMsTUFBTSxPQUFPLHFCQUFxQjtBQUFHLElBV25DLFlBQW9CLGdCQUFrQztBQUFJLFFBQXRDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7QUFBQyxJQUFFLENBQUM7QUFDNUQsSUFYRSxJQUFpQixJQUFJLENBQUMsS0FBSztBQUM3QixRQUFJLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQUM7QUFDakMsSUFBRSxDQUFDO0FBQ0gsSUFTRSxHQUFHO0FBQ0wsUUFBSSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7QUFDcEIsSUFBRSxDQUFDO0FBQ0gsSUFDRSxXQUFXO0FBQ2IsUUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztBQUMvQixJQUFFLENBQUM7QUFDSCxJQUNFLGtCQUFrQjtBQUNwQixRQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0FBQy9CLElBQUUsQ0FBQztBQUNILElBQ0UsbUJBQW1CO0FBQ3JCLFFBQUksSUFBSSxDQUFDLG9CQUFvQixHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLDBCQUEwQixDQUFDLENBQUM7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QUFDLFdBQVcsQ0FBQztBQUNqRSxRQUFJLElBQUksV0FBVyxFQUFFO0FBQ3JCLFlBQU0sT0FBTyxRQUFRLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQzlFLFNBQUs7QUFDTCxRQUFJLE9BQU8sUUFBUSxDQUFDLHNCQUFzQixDQUFDO0FBQzNDLElBQUUsQ0FBQztBQUNILElBQ1Usb0JBQW9CLENBQUMsUUFBUTtBQUN2QyxRQUFJLE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQztBQUNyRixJQUFFLENBQUM7QUFDSDtpREE5RkMsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSxlQUFlLGtCQUN6Qjs7O3lCQUE2QztBQUM5Qzs7Ozs7Ozs7Ozs7Ozt5SkFDSTtBQUFDO0FBQStDLFlBUDVDLGdCQUFnQjtBQUFHO0FBQUc7QUFDZixtQkFPYixLQUFLLFNBQUMsSUFBSTtBQUFNOzs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIGRldmljZUF2YWlsYWJpbGl0eUljb25NYXAsXG4gIFB1c2hTdGF0dXNMYWJlbHMsXG4gIFNlbmRTdGF0dXNMYWJlbHMsXG4gIHRvb2x0aXBzXG59IGZyb20gJy4vZGV2aWNlLWF2YWlsYWJpbGl0eSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkZXZpY2Utc3RhdHVzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RldmljZS1zdGF0dXMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIERldmljZVN0YXR1c0NvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgnbW8nKSBzZXQgbm9kZSh2YWx1ZSkge1xuICAgIHRoaXMuX21vID0gdmFsdWUubW8gfHwgdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9tbztcbiAgcHJpdmF0ZSByZXF1aXJlZEF2YWlsYWJpbGl0eTtcbiAgcHJpdmF0ZSBhdmFpbGFiaWxpdHlTdGF0dXM7XG4gIHByaXZhdGUgcHVzaFN0YXR1cztcbiAgcHJpdmF0ZSBzZW5kU3RhdHVzO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSkge31cblxuICBnZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21vO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5zZXRTdGF0dXNQcm9wZXJpdGVzKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5zZXRTdGF0dXNQcm9wZXJpdGVzKCk7XG4gIH1cblxuICBzZXRTdGF0dXNQcm9wZXJpdGVzKCkge1xuICAgIHRoaXMucmVxdWlyZWRBdmFpbGFiaWxpdHkgPSBnZXQodGhpcy5fbW8sICdjOHlfUmVxdWlyZWRBdmFpbGFiaWxpdHknKTtcbiAgICB0aGlzLmF2YWlsYWJpbGl0eVN0YXR1cyA9IGdldCh0aGlzLl9tbywgJ2M4eV9BdmFpbGFiaWxpdHkuc3RhdHVzJyk7XG5cbiAgICB0aGlzLnB1c2hTdGF0dXMgPSBnZXQodGhpcy5fbW8sICdjOHlfQ29ubmVjdGlvbi5zdGF0dXMnKSB8fCAnVU5LTk9XTic7XG4gICAgdGhpcy5zZW5kU3RhdHVzID1cbiAgICAgIHRoaXMuYXZhaWxhYmlsaXR5U3RhdHVzIHx8ICh0aGlzLnJlcXVpcmVkQXZhaWxhYmlsaXR5ID8gJ1VOS05PV04nIDogJ05PVF9NT05JVE9SRUQnKTtcbiAgfVxuXG4gIHN0YXR1cygpIHtcbiAgICBsZXQgc3RhdHVzZXM7XG5cbiAgICBpZiAodGhpcy5hdmFpbGFiaWxpdHlTdGF0dXMgPT09ICdNQUlOVEVOQU5DRScgfHwgdGhpcy5wdXNoU3RhdHVzID09PSAnTUFJTlRFTkFOQ0UnKSB7XG4gICAgICBzdGF0dXNlcyA9IHRoaXMuZ2V0TWFpbnRlbmFuY2VTdGF0dXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdHVzZXMgPSB0aGlzLmdldFNlbmRQdXNoU3RhdHVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXR1c2VzO1xuICB9XG5cbiAgZ2V0TWFpbnRlbmFuY2VTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbmRTdGF0dXM6IGZhbHNlLFxuICAgICAgcHVzaFN0YXR1czogZmFsc2UsXG4gICAgICBtYWludGVuYW5jZVN0YXR1czoge1xuICAgICAgICBpY29uOiBkZXZpY2VBdmFpbGFiaWxpdHlJY29uTWFwLmRldmljZS5NQUlOVEVOQU5DRS5pY29uLFxuICAgICAgICBjbGFzczogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5kZXZpY2UuTUFJTlRFTkFOQ0UuY2xhc3MsXG4gICAgICAgIHRvb2x0aXA6IHRvb2x0aXBzLm1haW50ZW5hbmNlXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VuZFB1c2hTdGF0dXMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbmRTdGF0dXM6IHtcbiAgICAgICAgaWNvbjogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5zZW5kRGF0YVt0aGlzLnNlbmRTdGF0dXNdLmljb24sXG4gICAgICAgIGNsYXNzOiBkZXZpY2VBdmFpbGFiaWxpdHlJY29uTWFwLnNlbmREYXRhW3RoaXMuc2VuZFN0YXR1c10uY2xhc3MsXG4gICAgICAgIHN0YXR1czogdGhpcy5zZW5kU3RhdHVzLFxuICAgICAgICBsYWJlbDogU2VuZFN0YXR1c0xhYmVsc1t0aGlzLnNlbmRTdGF0dXNdLFxuICAgICAgICB0b29sdGlwOiB0aGlzLmdldFNlbmRTdGF0dXNUb29sdGlwKHRoaXMuX21vKVxuICAgICAgfSxcbiAgICAgIHB1c2hTdGF0dXM6IHtcbiAgICAgICAgaWNvbjogZGV2aWNlQXZhaWxhYmlsaXR5SWNvbk1hcC5wdXNoW3RoaXMucHVzaFN0YXR1c10uaWNvbixcbiAgICAgICAgY2xhc3M6IGRldmljZUF2YWlsYWJpbGl0eUljb25NYXAucHVzaFt0aGlzLnB1c2hTdGF0dXNdLmNsYXNzLFxuICAgICAgICBzdGF0dXM6IHRoaXMucHVzaFN0YXR1cyxcbiAgICAgICAgbGFiZWw6IFB1c2hTdGF0dXNMYWJlbHNbdGhpcy5wdXNoU3RhdHVzXSxcbiAgICAgICAgdG9vbHRpcDogdGhpcy5nZXRQdXNoU3RhdHVzVG9vbHRpcCh0aGlzLnB1c2hTdGF0dXMgPT09ICdDT05ORUNURUQnKVxuICAgICAgfSxcbiAgICAgIG1haW50ZW5hbmNlU3RhdHVzOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFNlbmRTdGF0dXNUb29sdGlwKGRldmljZSkge1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eSA9IGRldmljZSAmJiBkZXZpY2UuYzh5X0F2YWlsYWJpbGl0eTtcbiAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGF2YWlsYWJpbGl0eSAmJiBhdmFpbGFiaWxpdHkubGFzdE1lc3NhZ2U7XG4gICAgaWYgKGxhc3RNZXNzYWdlKSB7XG4gICAgICByZXR1cm4gdG9vbHRpcHMuc2VuZFN0YXR1c0Nvbm5lY3RlZChsYXN0TWVzc2FnZSwgdGhpcy50cmFuc2xhdGVTZXJ2aWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRvb2x0aXBzLnNlbmRTdGF0dXNEaXNjb25uZWN0ZWQ7XG4gIH1cblxuICBwcml2YXRlIGdldFB1c2hTdGF0dXNUb29sdGlwKGlzQWN0aXZlKSB7XG4gICAgcmV0dXJuIGlzQWN0aXZlID8gdG9vbHRpcHMucHVzaFN0YXR1c0Nvbm5lY3RlZCA6IHRvb2x0aXBzLnB1c2hTdGF0dXNEaXNjb25uZWN0ZWQ7XG4gIH1cbn1cbiJdfQ==