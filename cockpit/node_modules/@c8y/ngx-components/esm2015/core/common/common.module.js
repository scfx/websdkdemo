import { CommonModule as NgCommonModule } from '@angular/common';
import { APP_INITIALIZER, InjectionToken, NgModule } from '@angular/core';
import { DataModule } from '@c8y/ngx-components/api';
import { TooltipModule } from 'ngx-bootstrap/tooltip';
import { distinctUntilChanged, filter, map, startWith, switchMap } from 'rxjs/operators';
import { I18nModule } from '../i18n/i18n.module';
import { TranslateService } from '../i18n/translate.service';
import { DatePipe } from './date.pipe';
import { DropdownDirectionDirective } from './dropdown-direction.directive';
import { ForOfDirective } from './forOf.directive';
import { HumanizeAppNamePipe } from './humanize-app-name.pipe';
import { HumanizePipe } from './humanize.pipe';
import { IconDirective, ICONS } from './icon.directive';
import { IfAllowedDirective } from './if-allowed.directive';
import { LoadMoreComponent } from './load-more.component';
import { LoadingComponent } from './loading.component';
import { MapFunctionPipe } from './map-function.pipe';
import { NumberPipe } from './number.pipe';
import { HOOK_OPTIONS, OptionsService } from './options.service';
import { OutletDirective } from './outlet.directive';
import { Permissions } from './permissions.service';
import { ProgressBarComponent } from './progress-bar.component';
import { ShortenUserNamePipe } from './shorten-user-name.pipe';
import { TenantUiService } from './tenant-ui.service';
import { AppStateService } from './ui-state.service';
import { UserPreferencesService } from './user-preferences/user-preferences.service';
import { ZipService } from './zip.service';
import { TextareaAutoresizeDirective } from './textarea-autoresize.directive';
import { OperationResultComponent } from './operation-result.component';
import { VirtualScrollerWrapperComponent } from './virtual-scroll/virtual-scroller-wrapper.component';
import { ScrollingModule } from '@angular/cdk/scrolling';
import { VirtualScrollWindowDirective } from './virtual-scroll/virtual-scroll-window.directive';
import * as ɵngcc0 from '@angular/core';
export function initializeServices(translateService, state, userPreferences) {
    const initialize = () => {
        const queryStringLanguage = translateService.queryStringLang();
        const firstLanguage = translateService.firstSupportedLanguage();
        /*
          The ?lang parameter will prevent the user preference language from being activated
        */
        if (queryStringLanguage && translateService.getSupported(queryStringLanguage)) {
            translateService.switchToLanguage(queryStringLanguage);
        }
        else {
            state.currentUser
                .pipe(map(user => user && user.userName), filter(u => !!u), distinctUntilChanged(), switchMap(() => userPreferences.get('language')), startWith(firstLanguage), filter(lang => !!lang), distinctUntilChanged())
                .subscribe(lang => {
                translateService.switchToLanguage(lang);
            });
        }
    };
    return initialize;
}
export const ICON_LIST = new InjectionToken('iconList');
/**
 * Commonly used directives, data access and translation. This module is the shared
 * module across all core components. It should be imported by default.
 *
 * @exports IconDirective A directive to set a c8y icon with [c8yIcon]="'rocket'".
 * @exports OutletDirective A directive which allows to set DOM or Angular templates (used for upgrade).
 * @exports I18nModule Translation module.
 * @exports NgCommonModule Angular common module.
 * @exports DataModule The data layer to allow DI with @c8y/client
 * @exports HumanizeAppNamePipe Humanize an application name (e.g. in the app switcher)
 * @exports HumanizePipe Humanize a word. E.g. `device management` gets `Device management`
 * @exports ShortenUserNamePipe Allows a short name. E.g. `Foo Bar` gets `F. Bar`
 * @exports ForOfDirective A forOf directive like ngFor but with load-more function
 * @exports LoadMoreComponent A component to load more data from a certain data-source
 * @exports ProgressBarComponent Displays either defined or undefined progress.
 * @exports DropdownDirectionDirective Determines if a dropdown opens to the bottom or to the top.
 * @exports TextareaAutoresizeDirective resizes a textarea height as the user inputs.
 * @exports OperationResultComponent displays an animated svg for success and error operations.
 */
export class CommonModule {
    static providers() {
        return [
            ...DataModule.providers(),
            // TODO: maybe we can think of a way to remove this C8Y_APP global
            { provide: HOOK_OPTIONS, useValue: window.C8Y_APP || {}, multi: true },
            {
                provide: APP_INITIALIZER,
                useFactory: initializeServices,
                deps: [TranslateService, AppStateService, UserPreferencesService],
                multi: true
            },
            { provide: ICON_LIST, useValue: ICONS, multi: false },
            ...I18nModule.providers(),
            UserPreferencesService,
            OptionsService,
            AppStateService,
            Permissions,
            TenantUiService,
            HumanizePipe,
            HumanizeAppNamePipe,
            ShortenUserNamePipe,
            MapFunctionPipe,
            DatePipe,
            ZipService
        ];
    }
    static forRoot() {
        return {
            ngModule: CommonModule,
            providers: CommonModule.providers()
        };
    }
}
CommonModule.ɵfac = function CommonModule_Factory(t) { return new (t || CommonModule)(); };
CommonModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: CommonModule });
CommonModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[NgCommonModule, I18nModule, TooltipModule, ScrollingModule], I18nModule,
        NgCommonModule] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CommonModule, [{
        type: NgModule,
        args: [{
                imports: [NgCommonModule, I18nModule, TooltipModule, ScrollingModule],
                exports: [
                    IconDirective,
                    OutletDirective,
                    I18nModule,
                    NgCommonModule,
                    HumanizeAppNamePipe,
                    HumanizePipe,
                    IfAllowedDirective,
                    ShortenUserNamePipe,
                    ForOfDirective,
                    LoadMoreComponent,
                    MapFunctionPipe,
                    ProgressBarComponent,
                    DatePipe,
                    NumberPipe,
                    LoadingComponent,
                    DropdownDirectionDirective,
                    TextareaAutoresizeDirective,
                    OperationResultComponent,
                    VirtualScrollerWrapperComponent,
                    VirtualScrollWindowDirective
                ],
                declarations: [
                    IconDirective,
                    OutletDirective,
                    HumanizePipe,
                    HumanizeAppNamePipe,
                    IfAllowedDirective,
                    ShortenUserNamePipe,
                    ForOfDirective,
                    LoadMoreComponent,
                    MapFunctionPipe,
                    ProgressBarComponent,
                    DatePipe,
                    NumberPipe,
                    LoadingComponent,
                    DropdownDirectionDirective,
                    TextareaAutoresizeDirective,
                    OperationResultComponent,
                    VirtualScrollerWrapperComponent,
                    VirtualScrollWindowDirective
                ],
                entryComponents: [LoadMoreComponent, LoadingComponent, VirtualScrollerWrapperComponent]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(CommonModule, { declarations: function () { return [IconDirective,
        OutletDirective,
        HumanizePipe,
        HumanizeAppNamePipe,
        IfAllowedDirective,
        ShortenUserNamePipe,
        ForOfDirective,
        LoadMoreComponent,
        MapFunctionPipe,
        ProgressBarComponent,
        DatePipe,
        NumberPipe,
        LoadingComponent,
        DropdownDirectionDirective,
        TextareaAutoresizeDirective,
        OperationResultComponent,
        VirtualScrollerWrapperComponent,
        VirtualScrollWindowDirective]; }, imports: function () { return [NgCommonModule, I18nModule, TooltipModule, ScrollingModule]; }, exports: function () { return [IconDirective,
        OutletDirective,
        I18nModule,
        NgCommonModule,
        HumanizeAppNamePipe,
        HumanizePipe,
        IfAllowedDirective,
        ShortenUserNamePipe,
        ForOfDirective,
        LoadMoreComponent,
        MapFunctionPipe,
        ProgressBarComponent,
        DatePipe,
        NumberPipe,
        LoadingComponent,
        DropdownDirectionDirective,
        TextareaAutoresizeDirective,
        OperationResultComponent,
        VirtualScrollerWrapperComponent,
        VirtualScrollWindowDirective]; } }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLm1vZHVsZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS9jb21tb24vY29tbW9uLm1vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxJQUFJLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDckQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDN0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbkQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQs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RUFBRTtrQkFDUCxhQUFhLHNCQUNiLGVBQWUsc0JBQ2YsVUFBVSxzQkFDVixjQUFjO2NBQ2Q7S0FBbUIsc0JBQ25CLFlBQVksc0JBQ1osa0JBQWtCLHNCQUNsQjtZQUFtQjtVQUNuQjtPQUFjLHNCQUNkLGlCQUFpQixzQkFDakIsZUFBZTtrQkFDZjtXQUFvQixzQkFDcEI7TUFBUSxzQkFDUjtDQUFVLHNCQUNWO09BQWdCLHNCQUNoQjttQkFBMEI7QUFDMUIsMkJBQTJCO2VBQzNCLHdCQUF3QjtxQkFDeEI7V0FBK0Isc0JBQy9CO3lCQUE0QjtJQUM3QixrQkFDRCxZQUFZLEVBQUU7cUJBQ1osYUFBYTtjQUNiLGVBQWU7cUJBQ2Y7Q0FBWSxzQkFDWjtJQUFtQixzQkFDbkIsa0JBQWtCO2tCQUNsQixtQkFBbUI7VUFDbkIsY0FBYztBQUNkLGlCQUFpQixzQkFDakI7Q0FBZSxzQkFDZixvQkFBb0I7Z0JBQ3BCO0tBQVEsc0JBQ1I7S0FBVSxzQkFDVjtRQUFnQixzQkFDaEI7bUJBQTBCO09BQzFCLDJCQUEyQjtlQUMzQix3QkFBd0I7cUJBQ3hCO1dBQStCLHNCQUMvQjt5QkFBNEI7SUFDN0Isa0JBQ0Q7QUFBZSxFQUFFLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUU7NkJBQStCO0FBQUMsY0FDeEY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2tEQUNJO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21tb25Nb2R1bGUgYXMgTmdDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgQVBQX0lOSVRJQUxJWkVSLCBJbmplY3Rpb25Ub2tlbiwgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERhdGFNb2R1bGUgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL2FwaSc7XG5pbXBvcnQgeyBUb29sdGlwTW9kdWxlIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC90b29sdGlwJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIG1hcCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJMThuTW9kdWxlIH0gZnJvbSAnLi4vaTE4bi9pMThuLm1vZHVsZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4bi90cmFuc2xhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJy4vZGF0ZS5waXBlJztcbmltcG9ydCB7IERyb3Bkb3duRGlyZWN0aW9uRGlyZWN0aXZlIH0gZnJvbSAnLi9kcm9wZG93bi1kaXJlY3Rpb24uZGlyZWN0aXZlJztcbmltcG9ydCB7IEZvck9mRGlyZWN0aXZlIH0gZnJvbSAnLi9mb3JPZi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgSHVtYW5pemVBcHBOYW1lUGlwZSB9IGZyb20gJy4vaHVtYW5pemUtYXBwLW5hbWUucGlwZSc7XG5pbXBvcnQgeyBIdW1hbml6ZVBpcGUgfSBmcm9tICcuL2h1bWFuaXplLnBpcGUnO1xuaW1wb3J0IHsgSWNvbkRpcmVjdGl2ZSwgSUNPTlMgfSBmcm9tICcuL2ljb24uZGlyZWN0aXZlJztcbmltcG9ydCB7IElmQWxsb3dlZERpcmVjdGl2ZSB9IGZyb20gJy4vaWYtYWxsb3dlZC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTG9hZE1vcmVDb21wb25lbnQgfSBmcm9tICcuL2xvYWQtbW9yZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTG9hZGluZ0NvbXBvbmVudCB9IGZyb20gJy4vbG9hZGluZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgTWFwRnVuY3Rpb25QaXBlIH0gZnJvbSAnLi9tYXAtZnVuY3Rpb24ucGlwZSc7XG5pbXBvcnQgeyBOdW1iZXJQaXBlIH0gZnJvbSAnLi9udW1iZXIucGlwZSc7XG5pbXBvcnQgeyBIT09LX09QVElPTlMsIE9wdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi9vcHRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3V0bGV0RGlyZWN0aXZlIH0gZnJvbSAnLi9vdXRsZXQuZGlyZWN0aXZlJztcbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSAnLi9wZXJtaXNzaW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7IFByb2dyZXNzQmFyQ29tcG9uZW50IH0gZnJvbSAnLi9wcm9ncmVzcy1iYXIuY29tcG9uZW50JztcbmltcG9ydCB7IFNob3J0ZW5Vc2VyTmFtZVBpcGUgfSBmcm9tICcuL3Nob3J0ZW4tdXNlci1uYW1lLnBpcGUnO1xuaW1wb3J0IHsgVGVuYW50VWlTZXJ2aWNlIH0gZnJvbSAnLi90ZW5hbnQtdWkuc2VydmljZSc7XG5pbXBvcnQgeyBBcHBTdGF0ZVNlcnZpY2UgfSBmcm9tICcuL3VpLXN0YXRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSB9IGZyb20gJy4vdXNlci1wcmVmZXJlbmNlcy91c2VyLXByZWZlcmVuY2VzLnNlcnZpY2UnO1xuaW1wb3J0IHsgWmlwU2VydmljZSB9IGZyb20gJy4vemlwLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGV4dGFyZWFBdXRvcmVzaXplRGlyZWN0aXZlIH0gZnJvbSAnLi90ZXh0YXJlYS1hdXRvcmVzaXplLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBPcGVyYXRpb25SZXN1bHRDb21wb25lbnQgfSBmcm9tICcuL29wZXJhdGlvbi1yZXN1bHQuY29tcG9uZW50JztcbmltcG9ydCB7IFZpcnR1YWxTY3JvbGxlcldyYXBwZXJDb21wb25lbnQgfSBmcm9tICcuL3ZpcnR1YWwtc2Nyb2xsL3ZpcnR1YWwtc2Nyb2xsZXItd3JhcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgU2Nyb2xsaW5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Njcm9sbGluZyc7XG5pbXBvcnQgeyBWaXJ0dWFsU2Nyb2xsV2luZG93RGlyZWN0aXZlIH0gZnJvbSAnLi92aXJ0dWFsLXNjcm9sbC92aXJ0dWFsLXNjcm9sbC13aW5kb3cuZGlyZWN0aXZlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVTZXJ2aWNlcyhcbiAgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSxcbiAgc3RhdGU6IEFwcFN0YXRlU2VydmljZSxcbiAgdXNlclByZWZlcmVuY2VzOiBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4pIHtcbiAgY29uc3QgaW5pdGlhbGl6ZSA9ICgpID0+IHtcbiAgICBjb25zdCBxdWVyeVN0cmluZ0xhbmd1YWdlID0gdHJhbnNsYXRlU2VydmljZS5xdWVyeVN0cmluZ0xhbmcoKTtcbiAgICBjb25zdCBmaXJzdExhbmd1YWdlID0gdHJhbnNsYXRlU2VydmljZS5maXJzdFN1cHBvcnRlZExhbmd1YWdlKCk7XG5cbiAgICAvKlxuICAgICAgVGhlID9sYW5nIHBhcmFtZXRlciB3aWxsIHByZXZlbnQgdGhlIHVzZXIgcHJlZmVyZW5jZSBsYW5ndWFnZSBmcm9tIGJlaW5nIGFjdGl2YXRlZFxuICAgICovXG4gICAgaWYgKHF1ZXJ5U3RyaW5nTGFuZ3VhZ2UgJiYgdHJhbnNsYXRlU2VydmljZS5nZXRTdXBwb3J0ZWQocXVlcnlTdHJpbmdMYW5ndWFnZSkpIHtcbiAgICAgIHRyYW5zbGF0ZVNlcnZpY2Uuc3dpdGNoVG9MYW5ndWFnZShxdWVyeVN0cmluZ0xhbmd1YWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdGUuY3VycmVudFVzZXJcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgbWFwKHVzZXIgPT4gdXNlciAmJiB1c2VyLnVzZXJOYW1lKSxcbiAgICAgICAgICBmaWx0ZXIodSA9PiAhIXUpLFxuICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHVzZXJQcmVmZXJlbmNlcy5nZXQoJ2xhbmd1YWdlJykpLFxuICAgICAgICAgIHN0YXJ0V2l0aChmaXJzdExhbmd1YWdlKSxcbiAgICAgICAgICBmaWx0ZXIobGFuZyA9PiAhIWxhbmcpLFxuICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKGxhbmcgPT4ge1xuICAgICAgICAgIHRyYW5zbGF0ZVNlcnZpY2Uuc3dpdGNoVG9MYW5ndWFnZShsYW5nKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5pdGlhbGl6ZTtcbn1cblxuZXhwb3J0IGNvbnN0IElDT05fTElTVCA9IG5ldyBJbmplY3Rpb25Ub2tlbignaWNvbkxpc3QnKTtcblxuLyoqXG4gKiBDb21tb25seSB1c2VkIGRpcmVjdGl2ZXMsIGRhdGEgYWNjZXNzIGFuZCB0cmFuc2xhdGlvbi4gVGhpcyBtb2R1bGUgaXMgdGhlIHNoYXJlZFxuICogbW9kdWxlIGFjcm9zcyBhbGwgY29yZSBjb21wb25lbnRzLiBJdCBzaG91bGQgYmUgaW1wb3J0ZWQgYnkgZGVmYXVsdC5cbiAqXG4gKiBAZXhwb3J0cyBJY29uRGlyZWN0aXZlIEEgZGlyZWN0aXZlIHRvIHNldCBhIGM4eSBpY29uIHdpdGggW2M4eUljb25dPVwiJ3JvY2tldCdcIi5cbiAqIEBleHBvcnRzIE91dGxldERpcmVjdGl2ZSBBIGRpcmVjdGl2ZSB3aGljaCBhbGxvd3MgdG8gc2V0IERPTSBvciBBbmd1bGFyIHRlbXBsYXRlcyAodXNlZCBmb3IgdXBncmFkZSkuXG4gKiBAZXhwb3J0cyBJMThuTW9kdWxlIFRyYW5zbGF0aW9uIG1vZHVsZS5cbiAqIEBleHBvcnRzIE5nQ29tbW9uTW9kdWxlIEFuZ3VsYXIgY29tbW9uIG1vZHVsZS5cbiAqIEBleHBvcnRzIERhdGFNb2R1bGUgVGhlIGRhdGEgbGF5ZXIgdG8gYWxsb3cgREkgd2l0aCBAYzh5L2NsaWVudFxuICogQGV4cG9ydHMgSHVtYW5pemVBcHBOYW1lUGlwZSBIdW1hbml6ZSBhbiBhcHBsaWNhdGlvbiBuYW1lIChlLmcuIGluIHRoZSBhcHAgc3dpdGNoZXIpXG4gKiBAZXhwb3J0cyBIdW1hbml6ZVBpcGUgSHVtYW5pemUgYSB3b3JkLiBFLmcuIGBkZXZpY2UgbWFuYWdlbWVudGAgZ2V0cyBgRGV2aWNlIG1hbmFnZW1lbnRgXG4gKiBAZXhwb3J0cyBTaG9ydGVuVXNlck5hbWVQaXBlIEFsbG93cyBhIHNob3J0IG5hbWUuIEUuZy4gYEZvbyBCYXJgIGdldHMgYEYuIEJhcmBcbiAqIEBleHBvcnRzIEZvck9mRGlyZWN0aXZlIEEgZm9yT2YgZGlyZWN0aXZlIGxpa2UgbmdGb3IgYnV0IHdpdGggbG9hZC1tb3JlIGZ1bmN0aW9uXG4gKiBAZXhwb3J0cyBMb2FkTW9yZUNvbXBvbmVudCBBIGNvbXBvbmVudCB0byBsb2FkIG1vcmUgZGF0YSBmcm9tIGEgY2VydGFpbiBkYXRhLXNvdXJjZVxuICogQGV4cG9ydHMgUHJvZ3Jlc3NCYXJDb21wb25lbnQgRGlzcGxheXMgZWl0aGVyIGRlZmluZWQgb3IgdW5kZWZpbmVkIHByb2dyZXNzLlxuICogQGV4cG9ydHMgRHJvcGRvd25EaXJlY3Rpb25EaXJlY3RpdmUgRGV0ZXJtaW5lcyBpZiBhIGRyb3Bkb3duIG9wZW5zIHRvIHRoZSBib3R0b20gb3IgdG8gdGhlIHRvcC5cbiAqIEBleHBvcnRzIFRleHRhcmVhQXV0b3Jlc2l6ZURpcmVjdGl2ZSByZXNpemVzIGEgdGV4dGFyZWEgaGVpZ2h0IGFzIHRoZSB1c2VyIGlucHV0cy5cbiAqIEBleHBvcnRzIE9wZXJhdGlvblJlc3VsdENvbXBvbmVudCBkaXNwbGF5cyBhbiBhbmltYXRlZCBzdmcgZm9yIHN1Y2Nlc3MgYW5kIGVycm9yIG9wZXJhdGlvbnMuXG4gKi9cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtOZ0NvbW1vbk1vZHVsZSwgSTE4bk1vZHVsZSwgVG9vbHRpcE1vZHVsZSwgU2Nyb2xsaW5nTW9kdWxlXSxcbiAgZXhwb3J0czogW1xuICAgIEljb25EaXJlY3RpdmUsXG4gICAgT3V0bGV0RGlyZWN0aXZlLFxuICAgIEkxOG5Nb2R1bGUsXG4gICAgTmdDb21tb25Nb2R1bGUsXG4gICAgSHVtYW5pemVBcHBOYW1lUGlwZSxcbiAgICBIdW1hbml6ZVBpcGUsXG4gICAgSWZBbGxvd2VkRGlyZWN0aXZlLFxuICAgIFNob3J0ZW5Vc2VyTmFtZVBpcGUsXG4gICAgRm9yT2ZEaXJlY3RpdmUsXG4gICAgTG9hZE1vcmVDb21wb25lbnQsXG4gICAgTWFwRnVuY3Rpb25QaXBlLFxuICAgIFByb2dyZXNzQmFyQ29tcG9uZW50LFxuICAgIERhdGVQaXBlLFxuICAgIE51bWJlclBpcGUsXG4gICAgTG9hZGluZ0NvbXBvbmVudCxcbiAgICBEcm9wZG93bkRpcmVjdGlvbkRpcmVjdGl2ZSxcbiAgICBUZXh0YXJlYUF1dG9yZXNpemVEaXJlY3RpdmUsXG4gICAgT3BlcmF0aW9uUmVzdWx0Q29tcG9uZW50LFxuICAgIFZpcnR1YWxTY3JvbGxlcldyYXBwZXJDb21wb25lbnQsXG4gICAgVmlydHVhbFNjcm9sbFdpbmRvd0RpcmVjdGl2ZVxuICBdLFxuICBkZWNsYXJhdGlvbnM6IFtcbiAgICBJY29uRGlyZWN0aXZlLFxuICAgIE91dGxldERpcmVjdGl2ZSxcbiAgICBIdW1hbml6ZVBpcGUsXG4gICAgSHVtYW5pemVBcHBOYW1lUGlwZSxcbiAgICBJZkFsbG93ZWREaXJlY3RpdmUsXG4gICAgU2hvcnRlblVzZXJOYW1lUGlwZSxcbiAgICBGb3JPZkRpcmVjdGl2ZSxcbiAgICBMb2FkTW9yZUNvbXBvbmVudCxcbiAgICBNYXBGdW5jdGlvblBpcGUsXG4gICAgUHJvZ3Jlc3NCYXJDb21wb25lbnQsXG4gICAgRGF0ZVBpcGUsXG4gICAgTnVtYmVyUGlwZSxcbiAgICBMb2FkaW5nQ29tcG9uZW50LFxuICAgIERyb3Bkb3duRGlyZWN0aW9uRGlyZWN0aXZlLFxuICAgIFRleHRhcmVhQXV0b3Jlc2l6ZURpcmVjdGl2ZSxcbiAgICBPcGVyYXRpb25SZXN1bHRDb21wb25lbnQsXG4gICAgVmlydHVhbFNjcm9sbGVyV3JhcHBlckNvbXBvbmVudCxcbiAgICBWaXJ0dWFsU2Nyb2xsV2luZG93RGlyZWN0aXZlXG4gIF0sXG4gIGVudHJ5Q29tcG9uZW50czogW0xvYWRNb3JlQ29tcG9uZW50LCBMb2FkaW5nQ29tcG9uZW50LCBWaXJ0dWFsU2Nyb2xsZXJXcmFwcGVyQ29tcG9uZW50XVxufSlcbmV4cG9ydCBjbGFzcyBDb21tb25Nb2R1bGUge1xuICBzdGF0aWMgcHJvdmlkZXJzKCkge1xuICAgIHJldHVybiBbXG4gICAgICAuLi5EYXRhTW9kdWxlLnByb3ZpZGVycygpLFxuICAgICAgLy8gVE9ETzogbWF5YmUgd2UgY2FuIHRoaW5rIG9mIGEgd2F5IHRvIHJlbW92ZSB0aGlzIEM4WV9BUFAgZ2xvYmFsXG4gICAgICB7IHByb3ZpZGU6IEhPT0tfT1BUSU9OUywgdXNlVmFsdWU6ICh3aW5kb3cgYXMgYW55KS5DOFlfQVBQIHx8IHt9LCBtdWx0aTogdHJ1ZSB9LFxuICAgICAge1xuICAgICAgICBwcm92aWRlOiBBUFBfSU5JVElBTElaRVIsXG4gICAgICAgIHVzZUZhY3Rvcnk6IGluaXRpYWxpemVTZXJ2aWNlcyxcbiAgICAgICAgZGVwczogW1RyYW5zbGF0ZVNlcnZpY2UsIEFwcFN0YXRlU2VydmljZSwgVXNlclByZWZlcmVuY2VzU2VydmljZV0sXG4gICAgICAgIG11bHRpOiB0cnVlXG4gICAgICB9LFxuICAgICAgeyBwcm92aWRlOiBJQ09OX0xJU1QsIHVzZVZhbHVlOiBJQ09OUywgbXVsdGk6IGZhbHNlIH0sXG4gICAgICAuLi5JMThuTW9kdWxlLnByb3ZpZGVycygpLFxuICAgICAgVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICAgIE9wdGlvbnNTZXJ2aWNlLFxuICAgICAgQXBwU3RhdGVTZXJ2aWNlLFxuICAgICAgUGVybWlzc2lvbnMsXG4gICAgICBUZW5hbnRVaVNlcnZpY2UsXG4gICAgICBIdW1hbml6ZVBpcGUsXG4gICAgICBIdW1hbml6ZUFwcE5hbWVQaXBlLFxuICAgICAgU2hvcnRlblVzZXJOYW1lUGlwZSxcbiAgICAgIE1hcEZ1bmN0aW9uUGlwZSxcbiAgICAgIERhdGVQaXBlLFxuICAgICAgWmlwU2VydmljZVxuICAgIF07XG4gIH1cblxuICBzdGF0aWMgZm9yUm9vdCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmdNb2R1bGU6IENvbW1vbk1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogQ29tbW9uTW9kdWxlLnByb3ZpZGVycygpXG4gICAgfTtcbiAgfVxufVxuIl19