import { Directive, Input, TemplateRef, ViewContainerRef } from '@angular/core';
import { Permissions } from './permissions.service';
/**
 * A structural directive that conditionally includes a template only if the user has
 * all or any of the roles passed as an input. By default the directive checks all roles:
 *
 * ```
 * <button *c8yIfAllowed="['ROLE_RECORD_DELETE', 'ROLE_ENTRY_DELETE']" (click)="delete()" title="Delete">
 *   Delete
 * </button>
 * ```
 *
 * To check if the user has any of the required roles to view the element you need to use the `allowAny` input:
 *
 * ```
 * <button *c8yIfAllowed="['ROLE_RECORD_DELETE', 'ROLE_ENTRY_DELETE']; allowAny: true" (click)="delete()" title="Delete">
 *   Delete
 * </button>
 * ```
 *
 * or use the shorter version
 *
 * ```
 * <button *c8yIfAllowed="['ROLE_RECORD_DELETE', 'ROLE_ENTRY_DELETE']; allowAny" (click)="delete()" title="Delete">
 *   Delete
 * </button>
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './permissions.service';
export class IfAllowedDirective {
    constructor(template, container, permissions) {
        this.template = template;
        this.container = container;
        this.permissions = permissions;
        this.allowAny = false;
    }
    /**
     * One or many roles required for the element to be rendered
     */
    set c8yIfAllowed(roleIds) {
        this.rolesIds = Array.isArray(roleIds) ? roleIds : !!roleIds ? [roleIds] : [];
    }
    /**
     * Switches to the mode where at least one of the provided roles is sufficient for the element to be rendered
     */
    set c8yIfAllowedAllowAny(allowAny) {
        this.allowAny = allowAny === null || allowAny;
    }
    ngOnInit() {
        if (!this.rolesIds ||
            !this.rolesIds.length ||
            (this.allowAny
                ? this.permissions.hasAnyRole(this.rolesIds)
                : this.permissions.hasAllRoles(this.rolesIds))) {
            this.container.createEmbeddedView(this.template);
        }
    }
}
IfAllowedDirective.ɵfac = function IfAllowedDirective_Factory(t) { return new (t || IfAllowedDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Permissions)); };
IfAllowedDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: IfAllowedDirective, selectors: [["", "c8yIfAllowed", ""]], inputs: { c8yIfAllowed: "c8yIfAllowed", c8yIfAllowedAllowAny: "c8yIfAllowedAllowAny" } });
IfAllowedDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: Permissions }
];
IfAllowedDirective.propDecorators = {
    c8yIfAllowed: [{ type: Input }],
    c8yIfAllowedAllowAny: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(IfAllowedDirective, [{
        type: Directive,
        args: [{
                selector: '[c8yIfAllowed]'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }, { type: ɵngcc0.ViewContainerRef }, { type: ɵngcc1.Permissions }]; }, { c8yIfAllowed: [{
            type: Input
        }], c8yIfAllowedAllowAny: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWYtYWxsb3dlZC5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvY29tbW9uL2lmLWFsbG93ZWQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOzs7QUFJSCxNQUFNLE9BQU8sa0JBQWtCO0FBQy9CLElBbUJFLFlBQ1UsUUFBMEIsRUFDMUIsU0FBMkIsRUFDM0IsV0FBd0I7QUFDakMsUUFIUyxhQUFRLEdBQVIsUUFBUSxDQUFrQjtBQUFDLFFBQzNCLGNBQVMsR0FBVCxTQUFTLENBQWtCO0FBQUMsUUFDNUIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7QUFDcEMsUUFOVSxhQUFRLEdBQVksS0FBSyxDQUFDO0FBQ3BDLElBS0ssQ0FBQztBQUNOLElBeEJFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBRSxJQUNJLFlBQVksQ0FBQyxPQUEwQjtBQUM3QyxRQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDbEYsSUFBRSxDQUFDO0FBQ0gsSUFDRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQUUsSUFDSSxvQkFBb0IsQ0FBQyxRQUFpQjtBQUM1QyxRQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxLQUFLLElBQUksSUFBSSxRQUFRLENBQUM7QUFDbEQsSUFBRSxDQUFDO0FBQ0gsSUFVRSxRQUFRO0FBQ1YsUUFBSSxJQUNFLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDcEIsWUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTTtBQUMzQixZQUFNLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDcEIsZ0JBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7QUFDcEQsZ0JBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUNoRDtBQUNOLFlBQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdkQsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNIOzhDQXhDQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLGdCQUFnQixjQUMzQjs4TkFDSTtBQUFDO0FBRUksWUFsQ2lCLFdBQVc7QUFBSSxZQUFGLGdCQUFnQjtBQUFJLFlBQ25ELFdBQVc7QUFBRztBQUFHO0FBR3BCLDJCQWdDSCxLQUFLO0FBQ04sbUNBT0MsS0FBSztBQUNQOzs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBUZW1wbGF0ZVJlZiwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUGVybWlzc2lvbnMgfSBmcm9tICcuL3Blcm1pc3Npb25zLnNlcnZpY2UnO1xuXG4vKipcbiAqIEEgc3RydWN0dXJhbCBkaXJlY3RpdmUgdGhhdCBjb25kaXRpb25hbGx5IGluY2x1ZGVzIGEgdGVtcGxhdGUgb25seSBpZiB0aGUgdXNlciBoYXNcbiAqIGFsbCBvciBhbnkgb2YgdGhlIHJvbGVzIHBhc3NlZCBhcyBhbiBpbnB1dC4gQnkgZGVmYXVsdCB0aGUgZGlyZWN0aXZlIGNoZWNrcyBhbGwgcm9sZXM6XG4gKlxuICogYGBgXG4gKiA8YnV0dG9uICpjOHlJZkFsbG93ZWQ9XCJbJ1JPTEVfUkVDT1JEX0RFTEVURScsICdST0xFX0VOVFJZX0RFTEVURSddXCIgKGNsaWNrKT1cImRlbGV0ZSgpXCIgdGl0bGU9XCJEZWxldGVcIj5cbiAqICAgRGVsZXRlXG4gKiA8L2J1dHRvbj5cbiAqIGBgYFxuICpcbiAqIFRvIGNoZWNrIGlmIHRoZSB1c2VyIGhhcyBhbnkgb2YgdGhlIHJlcXVpcmVkIHJvbGVzIHRvIHZpZXcgdGhlIGVsZW1lbnQgeW91IG5lZWQgdG8gdXNlIHRoZSBgYWxsb3dBbnlgIGlucHV0OlxuICpcbiAqIGBgYFxuICogPGJ1dHRvbiAqYzh5SWZBbGxvd2VkPVwiWydST0xFX1JFQ09SRF9ERUxFVEUnLCAnUk9MRV9FTlRSWV9ERUxFVEUnXTsgYWxsb3dBbnk6IHRydWVcIiAoY2xpY2spPVwiZGVsZXRlKClcIiB0aXRsZT1cIkRlbGV0ZVwiPlxuICogICBEZWxldGVcbiAqIDwvYnV0dG9uPlxuICogYGBgXG4gKlxuICogb3IgdXNlIHRoZSBzaG9ydGVyIHZlcnNpb25cbiAqXG4gKiBgYGBcbiAqIDxidXR0b24gKmM4eUlmQWxsb3dlZD1cIlsnUk9MRV9SRUNPUkRfREVMRVRFJywgJ1JPTEVfRU5UUllfREVMRVRFJ107IGFsbG93QW55XCIgKGNsaWNrKT1cImRlbGV0ZSgpXCIgdGl0bGU9XCJEZWxldGVcIj5cbiAqICAgRGVsZXRlXG4gKiA8L2J1dHRvbj5cbiAqIGBgYFxuICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYzh5SWZBbGxvd2VkXSdcbn0pXG5leHBvcnQgY2xhc3MgSWZBbGxvd2VkRGlyZWN0aXZlIHtcbiAgLyoqXG4gICAqIE9uZSBvciBtYW55IHJvbGVzIHJlcXVpcmVkIGZvciB0aGUgZWxlbWVudCB0byBiZSByZW5kZXJlZFxuICAgKi9cbiAgQElucHV0KClcbiAgc2V0IGM4eUlmQWxsb3dlZChyb2xlSWRzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICAgIHRoaXMucm9sZXNJZHMgPSBBcnJheS5pc0FycmF5KHJvbGVJZHMpID8gcm9sZUlkcyA6ICEhcm9sZUlkcyA/IFtyb2xlSWRzXSA6IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFN3aXRjaGVzIHRvIHRoZSBtb2RlIHdoZXJlIGF0IGxlYXN0IG9uZSBvZiB0aGUgcHJvdmlkZWQgcm9sZXMgaXMgc3VmZmljaWVudCBmb3IgdGhlIGVsZW1lbnQgdG8gYmUgcmVuZGVyZWRcbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCBjOHlJZkFsbG93ZWRBbGxvd0FueShhbGxvd0FueTogYm9vbGVhbikge1xuICAgIHRoaXMuYWxsb3dBbnkgPSBhbGxvd0FueSA9PT0gbnVsbCB8fCBhbGxvd0FueTtcbiAgfVxuXG4gIHByaXZhdGUgcm9sZXNJZHM6IHN0cmluZ1tdO1xuICBwcml2YXRlIGFsbG93QW55OiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PixcbiAgICBwcml2YXRlIGNvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIHBlcm1pc3Npb25zOiBQZXJtaXNzaW9uc1xuICApIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKFxuICAgICAgIXRoaXMucm9sZXNJZHMgfHxcbiAgICAgICF0aGlzLnJvbGVzSWRzLmxlbmd0aCB8fFxuICAgICAgKHRoaXMuYWxsb3dBbnlcbiAgICAgICAgPyB0aGlzLnBlcm1pc3Npb25zLmhhc0FueVJvbGUodGhpcy5yb2xlc0lkcylcbiAgICAgICAgOiB0aGlzLnBlcm1pc3Npb25zLmhhc0FsbFJvbGVzKHRoaXMucm9sZXNJZHMpKVxuICAgICkge1xuICAgICAgdGhpcy5jb250YWluZXIuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudGVtcGxhdGUpO1xuICAgIH1cbiAgfVxufVxuIl19