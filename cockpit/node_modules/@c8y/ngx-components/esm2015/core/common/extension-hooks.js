import { NavigationEnd } from '@angular/router';
import { castArray, flatten, isFunction, sortBy } from 'lodash-es';
import { combineLatest, defer, from, isObservable, merge, of, race } from 'rxjs';
import { filter, map, startWith, switchMap } from 'rxjs/operators';
export function fromTrigger(router, refresh, factories) {
    return merge(router.events.pipe(filter(evt => evt instanceof NavigationEnd)), ...castArray(refresh)).pipe(startWith(1), switchMap(() => fromFactories(factories, router)));
}
export function fromTriggerOnce(router, refresh, factories) {
    return merge(...castArray(refresh)).pipe(startWith(1), switchMap(() => fromFactories(factories, router)));
}
export function fromFactories(factories, router, withFirstEmpty = true) {
    return !Array.isArray(factories) || factories.length < 1
        ? of([])
        : defer(() => {
            const factoryObservables = resolveInjectedFactories(factories).map(f => {
                return toObservableOfArrays(Array.isArray(f) ? f : f && isFunction(f.get) ? f.get(getActivatedRoute(router)) : [f], withFirstEmpty);
            });
            return combineLatest(...factoryObservables);
        }).pipe(map(results => sortByPriority([].concat(...results))));
}
export function resolveInjectedFactories(factories) {
    return flatten(factories.map(f => (isFunction(f) ? f() : [f])));
}
export function stateToFactory(componentsState) {
    const components$ = componentsState.pipe(map((componentSet) => [...componentSet]));
    return { get: () => components$ };
}
export function sortByPriority(items) {
    return sortBy(items, 'priority');
}
export function toObservableOfArrays(factoryResult, withFirstEmpty) {
    let observable;
    if (!factoryResult) {
        return of([]);
    }
    else {
        observable = toObservable(factoryResult);
        if (withFirstEmpty) {
            const withEmptyFirst = observable.pipe(startWith([]));
            observable = race(observable, withEmptyFirst);
        }
    }
    return observable.pipe(map(result => (Array.isArray(result) ? result : [result]).filter(item => !!item)));
}
export function isPromise(obj) {
    return !!obj && typeof obj.then === 'function';
}
/**
 * Converts any value provided to an Observable that emits this value once and then completes.
 * A convienience method to represent all the data as Observables rather than
 * a mixture of Observables and other types.
 *
 * @param value The value the resulting Observable will emit.
 */
export function toObservable(value) {
    if (isObservable(value)) {
        return value;
    }
    if (isPromise(value)) {
        return from(value);
    }
    return of(value);
}
/**
 * Helper function to get the activated route in
 * a service (as ActivatedRoute injection only
 * works in components). Works as long as we only use
 * a tree and no child is active at the same time.
 *
 * @param router The current router
 */
export function getActivatedRoute(router) {
    if (router && router.routerState && router.routerState.root) {
        let route = router.routerState.root;
        while (route.firstChild) {
            route = route.firstChild;
        }
        return route;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9uLWhvb2tzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS9jb21tb24vZXh0ZW5zaW9uLWhvb2tzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBa0IsYUFBYSxFQUFVLE1BQU0saUJBQWlCLENBQUM7QUFDeEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdGLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuRSxNQUFNLFVBQVUsV0FBVyxDQUFJLE1BQU0sRUFBRSxPQUFPLEVBQUUsU0FBUztJQUN2RCxPQUFPLEtBQUssQ0FDVixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFlBQVksYUFBYSxDQUFDLENBQUMsRUFDL0QsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQ3RCLENBQUMsSUFBSSxDQUNKLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFDWixTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFJLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUNyRCxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQUksTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTO0lBQzNELE9BQU8sS0FBSyxDQUFDLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUN0QyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQ1osU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBSSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FDckQsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUMzQixTQUFVLEVBQ1YsTUFBZSxFQUNmLGNBQWMsR0FBRyxJQUFJO0lBRXJCLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUN0RCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNSLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFO1lBQ1QsTUFBTSxrQkFBa0IsR0FBRyx3QkFBd0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3JFLE9BQU8sb0JBQW9CLENBQ3pCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDdEYsY0FBYyxDQUNmLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sYUFBYSxDQUFDLEdBQUcsa0JBQWtCLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNyRSxDQUFDO0FBRUQsTUFBTSxVQUFVLHdCQUF3QixDQUFDLFNBQVM7SUFDaEQsT0FBTyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsRSxDQUFDO0FBRUQsTUFBTSxVQUFVLGNBQWMsQ0FBSSxlQUFlO0lBQy9DLE1BQU0sV0FBVyxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsWUFBb0IsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzRixPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFDLEtBQUs7SUFDbEMsT0FBTyxNQUFNLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLFVBQVUsb0JBQW9CLENBQUMsYUFBYSxFQUFFLGNBQWM7SUFDaEUsSUFBSSxVQUFVLENBQUM7SUFDZixJQUFJLENBQUMsYUFBYSxFQUFFO1FBQ2xCLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ2Y7U0FBTTtRQUNMLFVBQVUsR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDekMsSUFBSSxjQUFjLEVBQUU7WUFDbEIsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RCxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQztTQUMvQztLQUNGO0lBQ0QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUNwQixHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUNsRixDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQVUsR0FBUTtJQUN6QyxPQUFPLENBQUMsQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQztBQUNqRCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsTUFBTSxVQUFVLFlBQVksQ0FBSSxLQUFxQztJQUNuRSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN2QixPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDcEIsT0FBTyxJQUFJLENBQUMsS0FBbUIsQ0FBQyxDQUFDO0tBQ2xDO0lBRUQsT0FBTyxFQUFFLENBQUMsS0FBVSxDQUFDLENBQUM7QUFDeEIsQ0FBQztBQW1DRDs7Ozs7OztHQU9HO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQixDQUFDLE1BQWM7SUFDOUMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLFdBQVcsSUFBSSxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRTtRQUMzRCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztRQUNwQyxPQUFPLEtBQUssQ0FBQyxVQUFVLEVBQUU7WUFDdkIsS0FBSyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUM7U0FDMUI7UUFDRCxPQUFPLEtBQUssQ0FBQztLQUNkO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBOYXZpZ2F0aW9uRW5kLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgY2FzdEFycmF5LCBmbGF0dGVuLCBpc0Z1bmN0aW9uLCBzb3J0QnkgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgZGVmZXIsIGZyb20sIGlzT2JzZXJ2YWJsZSwgbWVyZ2UsIE9ic2VydmFibGUsIG9mLCByYWNlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tVHJpZ2dlcjxUPihyb3V0ZXIsIHJlZnJlc2gsIGZhY3Rvcmllcykge1xuICByZXR1cm4gbWVyZ2UoXG4gICAgcm91dGVyLmV2ZW50cy5waXBlKGZpbHRlcihldnQgPT4gZXZ0IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkpLFxuICAgIC4uLmNhc3RBcnJheShyZWZyZXNoKVxuICApLnBpcGUoXG4gICAgc3RhcnRXaXRoKDEpLFxuICAgIHN3aXRjaE1hcCgoKSA9PiBmcm9tRmFjdG9yaWVzPFQ+KGZhY3Rvcmllcywgcm91dGVyKSlcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21UcmlnZ2VyT25jZTxUPihyb3V0ZXIsIHJlZnJlc2gsIGZhY3Rvcmllcykge1xuICByZXR1cm4gbWVyZ2UoLi4uY2FzdEFycmF5KHJlZnJlc2gpKS5waXBlKFxuICAgIHN0YXJ0V2l0aCgxKSxcbiAgICBzd2l0Y2hNYXAoKCkgPT4gZnJvbUZhY3RvcmllczxUPihmYWN0b3JpZXMsIHJvdXRlcikpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tRmFjdG9yaWVzPFQ+KFxuICBmYWN0b3JpZXM/LFxuICByb3V0ZXI/OiBSb3V0ZXIsXG4gIHdpdGhGaXJzdEVtcHR5ID0gdHJ1ZVxuKTogT2JzZXJ2YWJsZTxUW10+IHtcbiAgcmV0dXJuICFBcnJheS5pc0FycmF5KGZhY3RvcmllcykgfHwgZmFjdG9yaWVzLmxlbmd0aCA8IDFcbiAgICA/IG9mKFtdKVxuICAgIDogZGVmZXIoKCkgPT4ge1xuICAgICAgICBjb25zdCBmYWN0b3J5T2JzZXJ2YWJsZXMgPSByZXNvbHZlSW5qZWN0ZWRGYWN0b3JpZXMoZmFjdG9yaWVzKS5tYXAoZiA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRvT2JzZXJ2YWJsZU9mQXJyYXlzKFxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShmKSA/IGYgOiBmICYmIGlzRnVuY3Rpb24oZi5nZXQpID8gZi5nZXQoZ2V0QWN0aXZhdGVkUm91dGUocm91dGVyKSkgOiBbZl0sXG4gICAgICAgICAgICB3aXRoRmlyc3RFbXB0eVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY29tYmluZUxhdGVzdCguLi5mYWN0b3J5T2JzZXJ2YWJsZXMpO1xuICAgICAgfSkucGlwZShtYXAocmVzdWx0cyA9PiBzb3J0QnlQcmlvcml0eShbXS5jb25jYXQoLi4ucmVzdWx0cykpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlSW5qZWN0ZWRGYWN0b3JpZXMoZmFjdG9yaWVzKSB7XG4gIHJldHVybiBmbGF0dGVuKGZhY3Rvcmllcy5tYXAoZiA9PiAoaXNGdW5jdGlvbihmKSA/IGYoKSA6IFtmXSkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0YXRlVG9GYWN0b3J5PFQ+KGNvbXBvbmVudHNTdGF0ZSk6IEV4dGVuc2lvbkZhY3Rvcnk8VD4ge1xuICBjb25zdCBjb21wb25lbnRzJCA9IGNvbXBvbmVudHNTdGF0ZS5waXBlKG1hcCgoY29tcG9uZW50U2V0OiBTZXQ8VD4pID0+IFsuLi5jb21wb25lbnRTZXRdKSk7XG4gIHJldHVybiB7IGdldDogKCkgPT4gY29tcG9uZW50cyQgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeVByaW9yaXR5KGl0ZW1zKSB7XG4gIHJldHVybiBzb3J0QnkoaXRlbXMsICdwcmlvcml0eScpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9PYnNlcnZhYmxlT2ZBcnJheXMoZmFjdG9yeVJlc3VsdCwgd2l0aEZpcnN0RW1wdHkpIHtcbiAgbGV0IG9ic2VydmFibGU7XG4gIGlmICghZmFjdG9yeVJlc3VsdCkge1xuICAgIHJldHVybiBvZihbXSk7XG4gIH0gZWxzZSB7XG4gICAgb2JzZXJ2YWJsZSA9IHRvT2JzZXJ2YWJsZShmYWN0b3J5UmVzdWx0KTtcbiAgICBpZiAod2l0aEZpcnN0RW1wdHkpIHtcbiAgICAgIGNvbnN0IHdpdGhFbXB0eUZpcnN0ID0gb2JzZXJ2YWJsZS5waXBlKHN0YXJ0V2l0aChbXSkpO1xuICAgICAgb2JzZXJ2YWJsZSA9IHJhY2Uob2JzZXJ2YWJsZSwgd2l0aEVtcHR5Rmlyc3QpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb2JzZXJ2YWJsZS5waXBlKFxuICAgIG1hcChyZXN1bHQgPT4gKEFycmF5LmlzQXJyYXkocmVzdWx0KSA/IHJlc3VsdCA6IFtyZXN1bHRdKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0pKVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQcm9taXNlPFQgPSBhbnk+KG9iajogYW55KTogb2JqIGlzIFByb21pc2U8VD4ge1xuICByZXR1cm4gISFvYmogJiYgdHlwZW9mIG9iai50aGVuID09PSAnZnVuY3Rpb24nO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGFueSB2YWx1ZSBwcm92aWRlZCB0byBhbiBPYnNlcnZhYmxlIHRoYXQgZW1pdHMgdGhpcyB2YWx1ZSBvbmNlIGFuZCB0aGVuIGNvbXBsZXRlcy5cbiAqIEEgY29udmllbmllbmNlIG1ldGhvZCB0byByZXByZXNlbnQgYWxsIHRoZSBkYXRhIGFzIE9ic2VydmFibGVzIHJhdGhlciB0aGFuXG4gKiBhIG1peHR1cmUgb2YgT2JzZXJ2YWJsZXMgYW5kIG90aGVyIHR5cGVzLlxuICpcbiAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdGhlIHJlc3VsdGluZyBPYnNlcnZhYmxlIHdpbGwgZW1pdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvT2JzZXJ2YWJsZTxUPih2YWx1ZTogVCB8IFByb21pc2U8VD4gfCBPYnNlcnZhYmxlPFQ+KTogT2JzZXJ2YWJsZTxUPiB7XG4gIGlmIChpc09ic2VydmFibGUodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgaWYgKGlzUHJvbWlzZSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZnJvbSh2YWx1ZSBhcyBQcm9taXNlPFQ+KTtcbiAgfVxuXG4gIHJldHVybiBvZih2YWx1ZSBhcyBUKTtcbn1cblxuLyoqXG4gKiBBbGxvd3MgdG8gZXh0ZW5kIHRoZSBleGlzdGluZyBhcHBsaWNhdGlvbnMgZnJvbSBhIG1vZHVsZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFeHRlbnNpb25GYWN0b3J5PFQ+IHtcbiAgLyoqXG4gICAqIEFsbG93cyB0byByZXNvbHZlIHRoZSBkYXRhIG9mIGFuIGV4dGVuc2lvbiBwb2ludC5cbiAgICogVGhlIHJldHVybiB2YWx1ZSBjYW4gYmUgYSBQcm9taXNlIG9yIE9ic2VydmFibGVcbiAgICogKGFsbG93aW5nIGZvciBhc3luY2hyb25vdXMgZGF0YSByZXNvbHV0aW9uKS5cbiAgICpcbiAgICogQHBhcmFtIGFjdGl2YXRlZFJvdXRlIFRoZSBjdXJyZW50IGFjdGl2YXRlZCByb3V0ZSAoaWYgcG9zc2libGUgdG8gcmVzb2x2ZSkuXG4gICAqL1xuICBnZXQoYWN0aXZhdGVkUm91dGU/OiBBY3RpdmF0ZWRSb3V0ZSk6IE9ic2VydmFibGU8VFtdIHwgVD4gfCBQcm9taXNlPFRbXSB8IFQ+IHwgVFtdIHwgVDtcbn1cblxuLyoqXG4gKiBFeHRlbnNpb24gcG9pbnRzIGFsbG93IHRvIGV4dGVuZCB0aGUgYXBwbGljYXRpb24gZnJvbVxuICogYW55IG1vZHVsZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4dGVuc2lvblBvaW50PFQ+IHtcbiAgLyoqXG4gICAqIE9ic2VydmFibGUgdGhhdCBlbWl0cyBvZiBhcnJheSBvZiBleHRlbnNpb25zIGFjdGl2ZSBhdCBhbnkgZ2l2ZSB0aW1lXG4gICAqL1xuICByZWFkb25seSBpdGVtcyQ6IE9ic2VydmFibGU8VFtdPjtcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgZmFjdG9yaWVzIHRoYXQgY2FuIGJlIGFkZGVkIGR5bmFtaWNhbGx5LiAod2l0aG91dCBob29rKVxuICAgKi9cbiAgZmFjdG9yaWVzOiBUW107XG4gIC8qKlxuICAgKiBDYWxsIHRoZSBleHRlbnNpb24gZmFjdG9yaWVzIHRvIHJlZnJlc2ggdGhlbS5cbiAgICovXG4gIHJlZnJlc2goKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSBhY3RpdmF0ZWQgcm91dGUgaW5cbiAqIGEgc2VydmljZSAoYXMgQWN0aXZhdGVkUm91dGUgaW5qZWN0aW9uIG9ubHlcbiAqIHdvcmtzIGluIGNvbXBvbmVudHMpLiBXb3JrcyBhcyBsb25nIGFzIHdlIG9ubHkgdXNlXG4gKiBhIHRyZWUgYW5kIG5vIGNoaWxkIGlzIGFjdGl2ZSBhdCB0aGUgc2FtZSB0aW1lLlxuICpcbiAqIEBwYXJhbSByb3V0ZXIgVGhlIGN1cnJlbnQgcm91dGVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY3RpdmF0ZWRSb3V0ZShyb3V0ZXI6IFJvdXRlcikge1xuICBpZiAocm91dGVyICYmIHJvdXRlci5yb3V0ZXJTdGF0ZSAmJiByb3V0ZXIucm91dGVyU3RhdGUucm9vdCkge1xuICAgIGxldCByb3V0ZSA9IHJvdXRlci5yb3V0ZXJTdGF0ZS5yb290O1xuICAgIHdoaWxlIChyb3V0ZS5maXJzdENoaWxkKSB7XG4gICAgICByb3V0ZSA9IHJvdXRlLmZpcnN0Q2hpbGQ7XG4gICAgfVxuICAgIHJldHVybiByb3V0ZTtcbiAgfVxufVxuIl19