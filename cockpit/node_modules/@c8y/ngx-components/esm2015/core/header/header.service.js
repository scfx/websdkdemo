import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { distinctUntilChanged, map, combineLatest, delay, debounceTime } from 'rxjs/operators';
import { OptionsService } from '../common/options.service';
import { StateService } from '../common/state-service.abstract';
import { NavigatorService } from '../navigator/navigator.service';
import { HumanizeAppNamePipe } from '../common';
import * as i0 from "@angular/core";
import * as i1 from "../navigator/navigator.service";
import * as i2 from "../common/options.service";
import * as i3 from "../common/humanize-app-name.pipe";
/**
 * A service which defines header functions.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../navigator/navigator.service';
import * as ɵngcc2 from '../common/options.service';
import * as ɵngcc3 from '../common';
export class HeaderService extends StateService {
    constructor(navigatorService, options, humanizeAppName) {
        super();
        this.navigatorService = navigatorService;
        this.options = options;
        this.humanizeAppName = humanizeAppName;
        this.headerOpen = false;
        this.DELAY_TO_AVOID_FLICKERING_ON_ASYNC_NODES = 1000;
        this.hasItemsInNavigator$ = this.navigatorService.items$.pipe(delay(this.DELAY_TO_AVOID_FLICKERING_ON_ASYNC_NODES), map(({ length }) => !!length), distinctUntilChanged());
        this.state$ = new BehaviorSubject({
            title: undefined,
            nav: {
                open: false
            }
        });
        this.title = undefined;
        this.header$ = this.map((header) => header);
        this.navigatorOpen$ = this.map(({ nav }) => nav.open).pipe(combineLatest(this.hasItemsInNavigator$), map(([open, hasItems]) => open && hasItems));
        const titleReference = document.querySelector('title');
        const isGlobalTitleValid = (!!options.globalTitle && typeof options.globalTitle === 'string' && options.globalTitle.length > 0);
        this.title = {
            elementRef: titleReference,
            titleSuffix: isGlobalTitleValid ? `${options.globalTitle} - ${options.name}` : options.name
        };
        this.humanizeAppName.transform(options.name)
            .subscribe(nameTranslated => {
            this.title.titleSuffix = isGlobalTitleValid ? `${options.globalTitle} - ${nameTranslated}` : nameTranslated;
        });
    }
    get state() {
        return this.state$.value;
    }
    get navigatorHiddenOnStartup() {
        return this.options.hideNavigator;
    }
    get largeWidth() {
        return document.documentElement.clientWidth > 1200;
    }
    get shouldToggle() {
        return this.largeWidth && !this.navigatorHiddenOnStartup && !this.state.nav.open;
    }
    /**
     * Toggles the main header menu in mobile view.
     */
    toggle() {
        this.headerOpen = !this.headerOpen;
    }
    /**
     * Toggles the navigator open status.
     */
    toggleNavigator() {
        this.state.nav.open = !this.state.nav.open;
        this.emitNewState();
    }
    /**
     * Force to close the navigator.
     */
    closeNavigator() {
        this.state.nav.open = false;
        this.emitNewState();
    }
    /**
     * Configures navigation options.
     * @param config Object with the properties:
     * - open: Boolean
     */
    configNavigator(config = {}) {
        this.state.nav = Object.assign(this.state.nav, config);
        this.emitNewState();
    }
    /**
     * Change the application title.
     * @param newTitle The new title of the application.
     */
    changeTitle(newTitle, pageTitleUpdate = true) {
        this.state.title = newTitle;
        this.state.pageTitleUpdate = pageTitleUpdate;
        this.emitNewState();
    }
    /**
     * Change the page title.
     * @param newTitle The new title of the page.
     */
    changePageTitle(newTitle) {
        this.title.elementRef.innerText = newTitle
            ? `${newTitle} / ${this.title.titleSuffix}`
            : `${this.title.titleSuffix}`;
    }
    /**
     * This methods checks if the navigator toggles on startup
     * or if an item is added to the navigator node.
     * Delay of 300ms is intended for animation purpose.
     */
    verifyIfNavOpen() {
        this.hasItemsInNavigator$
            .pipe(debounceTime(300))
            .subscribe(hasItems => hasItems && this.shouldToggle && this.toggleNavigator());
    }
    shouldShowBreadcrumbs() {
        return this.options.breadcrumbs;
    }
}
HeaderService.ɵfac = function HeaderService_Factory(t) { return new (t || HeaderService)(ɵngcc0.ɵɵinject(ɵngcc1.NavigatorService), ɵngcc0.ɵɵinject(ɵngcc2.OptionsService), ɵngcc0.ɵɵinject(ɵngcc3.HumanizeAppNamePipe)); };
HeaderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function HeaderService_Factory() { return new HeaderService(i0.ɵɵinject(i1.NavigatorService), i0.ɵɵinject(i2.OptionsService), i0.ɵɵinject(i3.HumanizeAppNamePipe)); }, token: HeaderService, providedIn: "root" });
HeaderService.ctorParameters = () => [
    { type: NavigatorService },
    { type: OptionsService },
    { type: HumanizeAppNamePipe }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(HeaderService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.NavigatorService }, { type: ɵngcc2.OptionsService }, { type: ɵngcc3.HumanizeAppNamePipe }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvaGVhZGVyL2hlYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDL0YsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVsRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDaEQ7QUFFZ0M7QUFJOUI7QUFDOEM7QUFOaEQ7QUFDQTtBQUNBLEdBQUc7Ozs7O0FBSUgsTUFBTSxPQUFPLGFBQWMsU0FBUSxZQUFZO0FBQy9DLElBb0JFLFlBQ1UsZ0JBQWtDLEVBQ2xDLE9BQXVCLEVBQ3ZCLGVBQW9DO0FBQzlDLFFBQ0UsS0FBSyxFQUFFLENBQUM7QUFDWixRQUxZLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7QUFBQyxRQUNuQyxZQUFPLEdBQVAsT0FBTyxDQUFnQjtBQUFDLFFBQ3hCLG9CQUFlLEdBQWYsZUFBZSxDQUFxQjtBQUFDLFFBdkIvQyxlQUFVLEdBQUcsS0FBSyxDQUFDO0FBQ3JCLFFBRVcsNkNBQXdDLEdBQUcsSUFBSSxDQUFDO0FBQzNELFFBQ0UseUJBQW9CLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ3RELEtBQUssQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsRUFDcEQsR0FBRyxDQUFDLENBQUMsRUFB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SyxDQUFDLFdBQVcsRUFBRTtBQUNqRCxZQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDcEMsSUFBRSxDQUFDO0FBQ0gsSUFDRTtBQUNGO0FBQ0U7QUFDRTtBQUVKLE9BREs7QUFDTCxJQUFFLGVBQWU7QUFDakIsUUFBSSxJQUFJLENBQUMsb0JBQW9CO0FBQzdCLGFBQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM5QixhQUFPLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDO0FBQ3RGLElBQUUsQ0FBQztBQUNILElBQ0UscUJBQXFCO0FBQ3ZCLFFBQUksT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQyxJQUFFLENBQUM7QUFDSDsyTkFBQztBQUNELDBRQXBJSztBQUFDO0VBSEwsVUFBVSxTQUFDLHJCQUdpQyxZQVZwQyxnQkFBZ0I7T0FRdkIsVUFBVSxFQUFFLE1BQU0sekJBUlMsWUFGcEIsY0FBYztTQVd0QixUQVgwQixZQUlsQixtQkFBbUI7QUFBRzs7Ozs7O3dKQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAsIGNvbWJpbmVMYXRlc3QsIGRlbGF5LCBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBPcHRpb25zU2VydmljZSB9IGZyb20gJy4uL2NvbW1vbi9vcHRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3N0YXRlLXNlcnZpY2UuYWJzdHJhY3QnO1xuaW1wb3J0IHsgTmF2aWdhdG9yU2VydmljZSB9IGZyb20gJy4uL25hdmlnYXRvci9uYXZpZ2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBIZWFkZXIgfSBmcm9tICcuL2hlYWRlci5tb2RlbCc7XG5pbXBvcnQgeyBIdW1hbml6ZUFwcE5hbWVQaXBlIH0gZnJvbSAnLi4vY29tbW9uJztcblxuLyoqXG4gKiBBIHNlcnZpY2Ugd2hpY2ggZGVmaW5lcyBoZWFkZXIgZnVuY3Rpb25zLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBIZWFkZXJTZXJ2aWNlIGV4dGVuZHMgU3RhdGVTZXJ2aWNlIHtcbiAgaGVhZGVyT3BlbiA9IGZhbHNlO1xuICBoZWFkZXIkOiBPYnNlcnZhYmxlPEhlYWRlcj47XG4gIG5hdmlnYXRvck9wZW4kOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICByZWFkb25seSBERUxBWV9UT19BVk9JRF9GTElDS0VSSU5HX09OX0FTWU5DX05PREVTID0gMTAwMDtcblxuICBoYXNJdGVtc0luTmF2aWdhdG9yJCA9IHRoaXMubmF2aWdhdG9yU2VydmljZS5pdGVtcyQucGlwZShcbiAgICBkZWxheSh0aGlzLkRFTEFZX1RPX0FWT0lEX0ZMSUNLRVJJTkdfT05fQVNZTkNfTk9ERVMpLFxuICAgIG1hcCgoeyBsZW5ndGggfSkgPT4gISFsZW5ndGgpLFxuICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgKTtcblxuICBzdGF0ZSQ6IEJlaGF2aW9yU3ViamVjdDxIZWFkZXI+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxIZWFkZXI+KHtcbiAgICB0aXRsZTogdW5kZWZpbmVkLFxuICAgIG5hdjoge1xuICAgICAgb3BlbjogZmFsc2VcbiAgICB9XG4gIH0pO1xuXG4gIHRpdGxlID0gdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbmF2aWdhdG9yU2VydmljZTogTmF2aWdhdG9yU2VydmljZSxcbiAgICBwcml2YXRlIG9wdGlvbnM6IE9wdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgaHVtYW5pemVBcHBOYW1lOiBIdW1hbml6ZUFwcE5hbWVQaXBlLFxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuaGVhZGVyJCA9IHRoaXMubWFwKChoZWFkZXI6IEhlYWRlcikgPT4gaGVhZGVyKTtcbiAgICB0aGlzLm5hdmlnYXRvck9wZW4kID0gdGhpcy5tYXAoKHsgbmF2IH0pID0+IG5hdi5vcGVuKS5waXBlKFxuICAgICAgY29tYmluZUxhdGVzdCh0aGlzLmhhc0l0ZW1zSW5OYXZpZ2F0b3IkKSxcbiAgICAgIG1hcCgoW29wZW4sIGhhc0l0ZW1zXSkgPT4gb3BlbiAmJiBoYXNJdGVtcylcbiAgICApO1xuICAgIGNvbnN0IHRpdGxlUmVmZXJlbmNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGl0bGUnKTtcblxuICAgIGNvbnN0IGlzR2xvYmFsVGl0bGVWYWxpZCA9ICghIW9wdGlvbnMuZ2xvYmFsVGl0bGUgJiYgdHlwZW9mIG9wdGlvbnMuZ2xvYmFsVGl0bGUgPT09ICdzdHJpbmcnICYmIG9wdGlvbnMuZ2xvYmFsVGl0bGUubGVuZ3RoID4gMCk7XG5cbiAgICB0aGlzLnRpdGxlID0ge1xuICAgICAgZWxlbWVudFJlZjogdGl0bGVSZWZlcmVuY2UsXG4gICAgICB0aXRsZVN1ZmZpeDogaXNHbG9iYWxUaXRsZVZhbGlkID8gYCR7b3B0aW9ucy5nbG9iYWxUaXRsZX0gLSAke29wdGlvbnMubmFtZX1gIDogb3B0aW9ucy5uYW1lXG4gICAgfTtcbiAgICB0aGlzLmh1bWFuaXplQXBwTmFtZS50cmFuc2Zvcm0ob3B0aW9ucy5uYW1lKVxuICAgICAgLnN1YnNjcmliZSggbmFtZVRyYW5zbGF0ZWQgPT4ge1xuICAgICAgdGhpcy50aXRsZS50aXRsZVN1ZmZpeCA9IGlzR2xvYmFsVGl0bGVWYWxpZCA/IGAke29wdGlvbnMuZ2xvYmFsVGl0bGV9IC0gJHtuYW1lVHJhbnNsYXRlZH1gIDogbmFtZVRyYW5zbGF0ZWQ7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGdldCBzdGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZSQudmFsdWU7XG4gIH1cblxuICBnZXQgbmF2aWdhdG9ySGlkZGVuT25TdGFydHVwKCkge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaGlkZU5hdmlnYXRvcjtcbiAgfVxuXG4gIGdldCBsYXJnZVdpZHRoKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPiAxMjAwO1xuICB9XG5cbiAgZ2V0IHNob3VsZFRvZ2dsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5sYXJnZVdpZHRoICYmICF0aGlzLm5hdmlnYXRvckhpZGRlbk9uU3RhcnR1cCAmJiAhdGhpcy5zdGF0ZS5uYXYub3BlbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGVzIHRoZSBtYWluIGhlYWRlciBtZW51IGluIG1vYmlsZSB2aWV3LlxuICAgKi9cbiAgdG9nZ2xlKCkge1xuICAgIHRoaXMuaGVhZGVyT3BlbiA9ICF0aGlzLmhlYWRlck9wZW47XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlcyB0aGUgbmF2aWdhdG9yIG9wZW4gc3RhdHVzLlxuICAgKi9cbiAgdG9nZ2xlTmF2aWdhdG9yKCkge1xuICAgIHRoaXMuc3RhdGUubmF2Lm9wZW4gPSAhdGhpcy5zdGF0ZS5uYXYub3BlbjtcbiAgICB0aGlzLmVtaXROZXdTdGF0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmNlIHRvIGNsb3NlIHRoZSBuYXZpZ2F0b3IuXG4gICAqL1xuICBjbG9zZU5hdmlnYXRvcigpIHtcbiAgICB0aGlzLnN0YXRlLm5hdi5vcGVuID0gZmFsc2U7XG4gICAgdGhpcy5lbWl0TmV3U3RhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmVzIG5hdmlnYXRpb24gb3B0aW9ucy5cbiAgICogQHBhcmFtIGNvbmZpZyBPYmplY3Qgd2l0aCB0aGUgcHJvcGVydGllczpcbiAgICogLSBvcGVuOiBCb29sZWFuXG4gICAqL1xuICBjb25maWdOYXZpZ2F0b3IoY29uZmlnOiBhbnkgPSB7fSkge1xuICAgIHRoaXMuc3RhdGUubmF2ID0gT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLm5hdiwgY29uZmlnKTtcbiAgICB0aGlzLmVtaXROZXdTdGF0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgYXBwbGljYXRpb24gdGl0bGUuXG4gICAqIEBwYXJhbSBuZXdUaXRsZSBUaGUgbmV3IHRpdGxlIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGNoYW5nZVRpdGxlKG5ld1RpdGxlPzogYW55LCBwYWdlVGl0bGVVcGRhdGU6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgdGhpcy5zdGF0ZS50aXRsZSA9IG5ld1RpdGxlO1xuICAgIHRoaXMuc3RhdGUucGFnZVRpdGxlVXBkYXRlID0gcGFnZVRpdGxlVXBkYXRlO1xuXG4gICAgdGhpcy5lbWl0TmV3U3RhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIHBhZ2UgdGl0bGUuXG4gICAqIEBwYXJhbSBuZXdUaXRsZSBUaGUgbmV3IHRpdGxlIG9mIHRoZSBwYWdlLlxuICAgKi9cbiAgY2hhbmdlUGFnZVRpdGxlKG5ld1RpdGxlPzogc3RyaW5nKSB7XG4gICAgdGhpcy50aXRsZS5lbGVtZW50UmVmLmlubmVyVGV4dCA9IG5ld1RpdGxlXG4gICAgICA/IGAke25ld1RpdGxlfSAvICR7dGhpcy50aXRsZS50aXRsZVN1ZmZpeH1gXG4gICAgICA6IGAke3RoaXMudGl0bGUudGl0bGVTdWZmaXh9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZHMgY2hlY2tzIGlmIHRoZSBuYXZpZ2F0b3IgdG9nZ2xlcyBvbiBzdGFydHVwXG4gICAqIG9yIGlmIGFuIGl0ZW0gaXMgYWRkZWQgdG8gdGhlIG5hdmlnYXRvciBub2RlLlxuICAgKiBEZWxheSBvZiAzMDBtcyBpcyBpbnRlbmRlZCBmb3IgYW5pbWF0aW9uIHB1cnBvc2UuXG4gICAqL1xuICB2ZXJpZnlJZk5hdk9wZW4oKSB7XG4gICAgdGhpcy5oYXNJdGVtc0luTmF2aWdhdG9yJFxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpXG4gICAgICAuc3Vic2NyaWJlKGhhc0l0ZW1zID0+IGhhc0l0ZW1zICYmIHRoaXMuc2hvdWxkVG9nZ2xlICYmIHRoaXMudG9nZ2xlTmF2aWdhdG9yKCkpO1xuICB9XG5cbiAgc2hvdWxkU2hvd0JyZWFkY3J1bWJzKCkge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYnJlYWRjcnVtYnM7XG4gIH1cbn1cbiJdfQ==