import { Component, Input, HostBinding, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { debounceTime } from 'rxjs/operators';
import { fromEventPattern, fromEvent, merge } from 'rxjs';
import { Router } from '@angular/router';
import { HeaderService } from '../header/header.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from '../header/header.service';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '../common/icon.directive';
import * as ɵngcc5 from '../i18n/c8y-translate.pipe';

const _c0 = ["container"];
const _c1 = ["left"];
const _c2 = ["right"];
const _c3 = ["tabsContainer"];
function TabsOutletComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 12, 13);
    ɵngcc0.ɵɵlistener("click", function TabsOutletComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(); return ctx_r8.scroll("left"); });
    ɵngcc0.ɵɵelement(2, "i", 14);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", "chevron-left");
} }
function TabsOutletComponent_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 15, 16);
    ɵngcc0.ɵɵlistener("click", function TabsOutletComponent_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(); return ctx_r11.scroll("right"); });
    ɵngcc0.ɵɵelement(2, "i", 14);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", "chevron-right");
} }
function TabsOutletComponent_li_6_i_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "i", 14);
} if (rf & 2) {
    const tab_r13 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("c8yIcon", tab_r13 == null ? null : tab_r13.icon);
} }
function TabsOutletComponent_li_6_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 23);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const tab_r13 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, tab_r13 == null ? null : tab_r13.label));
} }
function TabsOutletComponent_li_6_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
const _c4 = function (a0) { return { "active": a0 }; };
function TabsOutletComponent_li_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 17);
    ɵngcc0.ɵɵelementStart(1, "a", 18, 19);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵtemplate(4, TabsOutletComponent_li_6_i_4_Template, 1, 1, "i", 20);
    ɵngcc0.ɵɵtemplate(5, TabsOutletComponent_li_6_span_5_Template, 3, 3, "span", 21);
    ɵngcc0.ɵɵtemplate(6, TabsOutletComponent_li_6_ng_container_6_Template, 1, 0, "ng-container", 22);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const tab_r13 = ctx.$implicit;
    const _r14 = ɵngcc0.ɵɵreference(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(8, _c4, _r14.isActive));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(3, 6, tab_r13 == null ? null : tab_r13.label));
    ɵngcc0.ɵɵproperty("routerLink", tab_r13.path);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", !tab_r13.template && (tab_r13 == null ? null : tab_r13.icon));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !tab_r13.template);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", tab_r13.template);
} }
function TabsOutletComponent_option_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "option", 24);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const tab_r20 = ctx.$implicit;
    const ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("value", tab_r20.path)("selected", ctx_r6.isActive(tab_r20));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 3, tab_r20 == null ? null : tab_r20.label), " ");
} }
export class TabsOutletComponent {
    constructor(router, renderer, el, header) {
        this.router = router;
        this.renderer = renderer;
        this.el = el;
        this.header = header;
        this.tabs = [];
        this.orientation = 'vertical';
        this.navigatorOpen = false;
        this.showLeft = false;
        this.showRight = false;
    }
    get isNavigatorOpen() {
        return this.navigatorOpen;
    }
    get hasTabs() {
        let visibleTabs = [];
        if (this.tabs) {
            visibleTabs = this.tabs.filter(tab => tab.hide !== true);
        }
        return visibleTabs.length;
    }
    get isHorizontal() {
        return this.orientation === 'horizontal';
    }
    get isVertical() {
        return this.orientation !== 'horizontal';
    }
    ngOnDestroy() {
        if (this.scrollSubscription) {
            this.scrollSubscription.unsubscribe();
        }
    }
    ngAfterContentInit() {
        if (this.orientation === 'horizontal') {
            this.scrollSubscribe();
        }
    }
    isActive(tab) {
        if (tab && tab.path) {
            return this.router.isActive(tab.path, false);
        }
        else {
            return false;
        }
    }
    navigateTo(path) {
        this.header.toggle();
        this.router.navigate([path]);
    }
    scroll(direction = 'right') {
        const { widthScroll, width, scrollLeft } = this.getDimensions();
        const multiplier = direction === 'left' ? -1 : 1;
        let targetScroll = scrollLeft + width * multiplier;
        if (targetScroll < 0) {
            targetScroll = 0;
        }
        if (targetScroll > widthScroll - width) {
            targetScroll = widthScroll - width;
        }
        // TODO: we should animate this
        this.container.nativeElement.scrollLeft = targetScroll;
    }
    scrollSubscribe() {
        let unlisten;
        this.scrollSubscription = merge(fromEvent(this.container.nativeElement, 'scroll'), fromEventPattern((handler) => {
            unlisten = this.renderer.listen('window', 'resize', handler);
        }, () => unlisten())).pipe(debounceTime(250)).subscribe(() => this.updateScroll());
    }
    updateScroll() {
        const { widthScroll, width, scrollLeft } = this.getDimensions();
        this.showLeft = !!scrollLeft;
        this.showRight = widthScroll > width + scrollLeft;
    }
    getDimensions() {
        const elTabs = this.tabsContainer.nativeElement;
        const el = this.container.nativeElement;
        const widthScroll = elTabs.scrollWidth;
        const width = el.clientWidth;
        const scrollLeft = el.scrollLeft;
        return { widthScroll, width, scrollLeft };
    }
}
TabsOutletComponent.ɵfac = function TabsOutletComponent_Factory(t) { return new (t || TabsOutletComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.HeaderService)); };
TabsOutletComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: TabsOutletComponent, selectors: [["c8y-tabs-outlet"], ["c8y-ui-tabs"]], viewQuery: function TabsOutletComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 7, ElementRef);
        ɵngcc0.ɵɵviewQuery(_c1, 5, ElementRef);
        ɵngcc0.ɵɵviewQuery(_c2, 5, ElementRef);
        ɵngcc0.ɵɵviewQuery(_c3, 5, ElementRef);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.container = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.leftBtn = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.rightBtn = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.tabsContainer = _t.first);
    } }, hostVars: 8, hostBindings: function TabsOutletComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("navigator-open", ctx.isNavigatorOpen)("page-tabs", ctx.hasTabs)("page-tabs-horizontal", ctx.isHorizontal)("page-tabs-vertical", ctx.isVertical);
    } }, inputs: { tabs: "tabs", orientation: "orientation", navigatorOpen: "navigatorOpen" }, decls: 12, vars: 4, consts: [[1, "tabContainer", "hidden-xs"], ["container", ""], ["class", "tabs-slider tabs-slider-left", 3, "click", 4, "ngIf"], ["class", "tabs-slider tabs-slider-right", 3, "click", 4, "ngIf"], [1, "nav", "nav-tabs", "nav-tabsc8y"], ["tabsContainer", ""], [3, "ngClass", 4, "ngFor", "ngForOf"], [1, "visible-xs", "mobile-tabs"], [1, "c8y-select-wrapper"], [3, "change"], ["select", ""], [3, "value", "selected", 4, "ngFor", "ngForOf"], [1, "tabs-slider", "tabs-slider-left", 3, "click"], ["left", ""], [3, "c8yIcon"], [1, "tabs-slider", "tabs-slider-right", 3, "click"], ["right", ""], [3, "ngClass"], ["routerLinkActive", "", 3, "routerLink", "title"], ["rla", "routerLinkActive"], [3, "c8yIcon", 4, "ngIf"], ["class", "txt", 4, "ngIf"], [4, "ngTemplateOutlet"], [1, "txt"], [3, "value", "selected"]], template: function TabsOutletComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0, 1);
        ɵngcc0.ɵɵtemplate(2, TabsOutletComponent_button_2_Template, 3, 1, "button", 2);
        ɵngcc0.ɵɵtemplate(3, TabsOutletComponent_button_3_Template, 3, 1, "button", 3);
        ɵngcc0.ɵɵelementStart(4, "ul", 4, 5);
        ɵngcc0.ɵɵtemplate(6, TabsOutletComponent_li_6_Template, 7, 10, "li", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "div", 7);
        ɵngcc0.ɵɵelementStart(8, "div", 8);
        ɵngcc0.ɵɵelementStart(9, "select", 9, 10);
        ɵngcc0.ɵɵlistener("change", function TabsOutletComponent_Template_select_change_9_listener($event) { return ctx.navigateTo($event.target.value); });
        ɵngcc0.ɵɵtemplate(11, TabsOutletComponent_option_11_Template, 3, 5, "option", 11);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showLeft);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showRight);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.tabs);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.tabs);
    } }, directives: [ɵngcc3.NgIf, ɵngcc3.NgForOf, ɵngcc4.IconDirective, ɵngcc3.NgClass, ɵngcc1.RouterLinkWithHref, ɵngcc1.RouterLinkActive, ɵngcc3.NgTemplateOutlet], pipes: [ɵngcc5.C8yTranslatePipe], encapsulation: 2 });
TabsOutletComponent.ctorParameters = () => [
    { type: Router },
    { type: Renderer2 },
    { type: ElementRef },
    { type: HeaderService }
];
TabsOutletComponent.propDecorators = {
    tabs: [{ type: Input }],
    orientation: [{ type: Input }],
    navigatorOpen: [{ type: Input }],
    isNavigatorOpen: [{ type: HostBinding, args: ['class.navigator-open',] }],
    hasTabs: [{ type: HostBinding, args: ['class.page-tabs',] }],
    isHorizontal: [{ type: HostBinding, args: ['class.page-tabs-horizontal',] }],
    isVertical: [{ type: HostBinding, args: ['class.page-tabs-vertical',] }],
    container: [{ type: ViewChild, args: ['container', { read: ElementRef, static: true },] }],
    leftBtn: [{ type: ViewChild, args: ['left', { read: ElementRef, static: false },] }],
    rightBtn: [{ type: ViewChild, args: ['right', { read: ElementRef, static: false },] }],
    tabsContainer: [{ type: ViewChild, args: ['tabsContainer', { read: ElementRef, static: false },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TabsOutletComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-tabs-outlet,c8y-ui-tabs',
                template: "<div #container class=\"tabContainer hidden-xs\">\n  <button class=\"tabs-slider tabs-slider-left\" #left *ngIf=\"showLeft\" (click)=\"scroll('left')\">\n    <i [c8yIcon]=\"'chevron-left'\"></i>\n  </button>\n  <button class=\"tabs-slider tabs-slider-right\" #right *ngIf=\"showRight\" (click)=\"scroll('right')\">\n    <i [c8yIcon]=\"'chevron-right'\"></i>\n  </button>\n  <ul class=\"nav nav-tabs nav-tabsc8y\" #tabsContainer>\n    <li [ngClass]=\"{'active': rla.isActive}\" *ngFor=\"let tab of tabs\">\n      <a [routerLink]=\"tab.path\" routerLinkActive #rla=\"routerLinkActive\" title=\"{{tab?.label | translate}}\">\n        <i [c8yIcon]=\"tab?.icon\" *ngIf=\"!tab.template && tab?.icon\"></i>\n        <span class=\"txt\" *ngIf=\"!tab.template\">{{tab?.label | translate}}</span>\n        <ng-container *ngTemplateOutlet=\"tab.template\"></ng-container>\n      </a>\n    </li>\n  </ul>\n</div>\n\n<div class=\"visible-xs mobile-tabs\">\n  <div class=\"c8y-select-wrapper\">\n    <select (change)=\"navigateTo($event.target.value)\" #select>\n      <option *ngFor=\"let tab of tabs\" [value]=\"tab.path\" [selected]=\"isActive(tab)\">\n        {{tab?.label | translate}}\n      </option>\n    </select>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ElementRef }, { type: ɵngcc2.HeaderService }]; }, { tabs: [{
            type: Input
        }], orientation: [{
            type: Input
        }], navigatorOpen: [{
            type: Input
        }], isNavigatorOpen: [{
            type: HostBinding,
            args: ['class.navigator-open']
        }], hasTabs: [{
            type: HostBinding,
            args: ['class.page-tabs']
        }], isHorizontal: [{
            type: HostBinding,
            args: ['class.page-tabs-horizontal']
        }], isVertical: [{
            type: HostBinding,
            args: ['class.page-tabs-vertical']
        }], container: [{
            type: ViewChild,
            args: ['container', { read: ElementRef, static: true }]
        }], leftBtn: [{
            type: ViewChild,
            args: ['left', { read: ElementRef, static: false }]
        }], rightBtn: [{
            type: ViewChild,
            args: ['right', { read: ElementRef, static: false }]
        }], tabsContainer: [{
            type: ViewChild,
            args: ['tabsContainer', { read: ElementRef, static: false }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFicy1vdXRsZXQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL3RhYnMvdGFicy1vdXRsZXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFdBQVcsRUFDWCxTQUFTLEVBQ1QsVUFBVSxFQUVWLFNBQVMsRUFHVyxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU16RCxNQUFNLE9BQU8sbUJBQW1CO0FBQUcsSUE0QmpDLFlBQ1UsTUFBYyxFQUNkLFFBQW1CLEVBQ25CLEVBQWMsRUFDZCxNQUFxQjtBQUM5QixRQUpTLFdBQU0sR0FBTixNQUFNLENBQVE7QUFBQyxRQUNmLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBQyxRQUNwQixPQUFFLEdBQUYsRUFBRSxDQUFZO0FBQUMsUUFDZixXQUFNLEdBQU4sTUFBTSxDQUFlO0FBQ2pDLFFBaENXLFNBQUksR0FBVSxFQUFFLENBQUM7QUFDNUIsUUFBVyxnQkFBVyxHQUE4QixVQUFVLENBQUM7QUFDL0QsUUFBVyxrQkFBYSxHQUFHLEtBQUssQ0FBQztBQUNqQyxRQUFFLGFBQVEsR0FBWSxLQUFLLENBQUM7QUFDNUIsUUFBRSxjQUFTLEdBQVksS0FBSyxDQUFDO0FBQzdCLElBMkJLLENBQUM7QUFDTixJQTVCRSxJQUF5QyxlQUFlO0FB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QUM1Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs2TkFDSTtBQUFDO0FBQTZDLFlBUjFDLE1BQU07QUFBSSxZQVRqQixTQUFTO0FBQ1QsWUFBQSxVQUFVO0FBQ1YsWUFTTyxhQUFhO0FBQUc7QUFBRztBQUVwQixtQkFLTCxLQUFLO0FBQUssMEJBQ1YsS0FBSztBQUFLLDRCQUNWLEtBQUs7QUFBSyw4QkFHVixXQUFXLFNBQUMsc0JBQXNCO0FBQU8sc0JBR3pDLFdBQVcsU0FBQyxpQkFBaUI7QUFBTywyQkFPcEMsV0FBVyxTQUFDLDRCQUE0QjtBQUFPLHlCQUcvQyxXQUFXLFNBQUMsMEJBQTBCO0FBQU8sd0JBRzdDLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUM7QUFBTyxzQkFDOUQsU0FBUyxTQUFDLE1BQU0sRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBQztBQUFPLHVCQUMxRCxTQUFTLFNBQUMsT0FBTyxFQUFFLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFDO0FBQU8sNEJBQzNELFNBQVMsU0FBQyxlQUFlLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUM7QUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgSG9zdEJpbmRpbmcsXG4gIFJlbmRlcmVyMixcbiAgRWxlbWVudFJlZixcbiAgT25DaGFuZ2VzLFxuICBWaWV3Q2hpbGQsXG4gIE9uRGVzdHJveSxcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQWZ0ZXJDb250ZW50Q2hlY2tlZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBmcm9tRXZlbnRQYXR0ZXJuLCBmcm9tRXZlbnQsIG1lcmdlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBUYWIgfSBmcm9tICcuL3RhYi5tb2RlbCc7XG5pbXBvcnQgeyBIZWFkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vaGVhZGVyL2hlYWRlci5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXRhYnMtb3V0bGV0LGM4eS11aS10YWJzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RhYnMtb3V0bGV0LmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgVGFic091dGxldENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gIEBJbnB1dCgpIHRhYnM6IGFueVtdID0gW107XG4gIEBJbnB1dCgpIG9yaWVudGF0aW9uOiAndmVydGljYWwnIHwgJ2hvcml6b250YWwnID0gJ3ZlcnRpY2FsJztcbiAgQElucHV0KCkgbmF2aWdhdG9yT3BlbiA9IGZhbHNlO1xuICBzaG93TGVmdDogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93UmlnaHQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5uYXZpZ2F0b3Itb3BlbicpIGdldCBpc05hdmlnYXRvck9wZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMubmF2aWdhdG9yT3BlbjtcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnBhZ2UtdGFicycpIGdldCBoYXNUYWJzKCkge1xuICAgIGxldCB2aXNpYmxlVGFicyA9IFtdO1xuICAgIGlmICh0aGlzLnRhYnMpIHtcbiAgICAgIHZpc2libGVUYWJzID0gdGhpcy50YWJzLmZpbHRlcih0YWIgPT4gdGFiLmhpZGUgIT09IHRydWUpO1xuICAgIH1cbiAgICByZXR1cm4gdmlzaWJsZVRhYnMubGVuZ3RoO1xuICB9XG4gIEBIb3N0QmluZGluZygnY2xhc3MucGFnZS10YWJzLWhvcml6b250YWwnKSBnZXQgaXNIb3Jpem9udGFsKCkge1xuICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCc7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5wYWdlLXRhYnMtdmVydGljYWwnKSBnZXQgaXNWZXJ0aWNhbCgpIHtcbiAgICByZXR1cm4gdGhpcy5vcmllbnRhdGlvbiAhPT0gJ2hvcml6b250YWwnO1xuICB9XG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHtyZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWV9KSBwcml2YXRlIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnbGVmdCcsIHtyZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IGZhbHNlfSkgcHJpdmF0ZSBsZWZ0QnRuOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdyaWdodCcsIHtyZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IGZhbHNlfSkgcHJpdmF0ZSByaWdodEJ0bjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgndGFic0NvbnRhaW5lcicsIHtyZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IGZhbHNlfSkgcHJpdmF0ZSB0YWJzQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuICBwcml2YXRlIHNjcm9sbFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBoZWFkZXI6IEhlYWRlclNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zY3JvbGxTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgaWYgKHRoaXMub3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgdGhpcy5zY3JvbGxTdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGlzQWN0aXZlKHRhYjogVGFiKSB7XG4gICAgaWYgKHRhYiAmJiB0YWIucGF0aCkge1xuICAgICAgcmV0dXJuIHRoaXMucm91dGVyLmlzQWN0aXZlKHRhYi5wYXRoLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBuYXZpZ2F0ZVRvKHBhdGgpIHtcbiAgICB0aGlzLmhlYWRlci50b2dnbGUoKTtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbcGF0aF0pO1xuICB9XG5cbiAgc2Nyb2xsKGRpcmVjdGlvbjogJ3JpZ2h0JyB8ICdsZWZ0JyA9ICdyaWdodCcpIHtcbiAgICBjb25zdCB7IHdpZHRoU2Nyb2xsLCB3aWR0aCwgc2Nyb2xsTGVmdCB9ID0gdGhpcy5nZXREaW1lbnNpb25zKCk7XG4gICAgY29uc3QgbXVsdGlwbGllciA9IGRpcmVjdGlvbiA9PT0gJ2xlZnQnID8gLTEgOiAxO1xuXG4gICAgbGV0IHRhcmdldFNjcm9sbCA9IHNjcm9sbExlZnQgKyB3aWR0aCAqIG11bHRpcGxpZXI7XG4gICAgaWYgKHRhcmdldFNjcm9sbCA8IDApIHtcbiAgICAgIHRhcmdldFNjcm9sbCA9IDA7XG4gICAgfVxuICAgIGlmICh0YXJnZXRTY3JvbGwgPiB3aWR0aFNjcm9sbCAtIHdpZHRoKSB7XG4gICAgICB0YXJnZXRTY3JvbGwgPSB3aWR0aFNjcm9sbCAtIHdpZHRoO1xuICAgIH1cbiAgICAvLyBUT0RPOiB3ZSBzaG91bGQgYW5pbWF0ZSB0aGlzXG4gICAgdGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ID0gdGFyZ2V0U2Nyb2xsO1xuICB9XG5cbiAgcHJpdmF0ZSBzY3JvbGxTdWJzY3JpYmUoKSB7XG4gICAgbGV0IHVubGlzdGVuO1xuICAgIHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uID0gbWVyZ2UoXG4gICAgICBmcm9tRXZlbnQodGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudCwgJ3Njcm9sbCcpLFxuICAgICAgZnJvbUV2ZW50UGF0dGVybihcbiAgICAgICAgKGhhbmRsZXI6IGFueSkgPT4ge1xuICAgICAgICAgIHVubGlzdGVuID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ3dpbmRvdycsICdyZXNpemUnLCBoYW5kbGVyKTtcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4gdW5saXN0ZW4oKVxuICAgICAgKVxuICAgICkucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgyNTApXG4gICAgKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy51cGRhdGVTY3JvbGwoKSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNjcm9sbCgpIHtcbiAgICBjb25zdCB7IHdpZHRoU2Nyb2xsLCB3aWR0aCwgc2Nyb2xsTGVmdCB9ID0gdGhpcy5nZXREaW1lbnNpb25zKCk7XG4gICAgdGhpcy5zaG93TGVmdCA9ICEhc2Nyb2xsTGVmdDtcbiAgICB0aGlzLnNob3dSaWdodCA9IHdpZHRoU2Nyb2xsID4gd2lkdGggKyBzY3JvbGxMZWZ0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREaW1lbnNpb25zKCkge1xuICAgIGNvbnN0IGVsVGFicyA9IHRoaXMudGFic0NvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IGVsID0gdGhpcy5jb250YWluZXIubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCB3aWR0aFNjcm9sbCA9ICAgZWxUYWJzLnNjcm9sbFdpZHRoO1xuICAgIGNvbnN0IHdpZHRoID0gZWwuY2xpZW50V2lkdGg7XG4gICAgY29uc3Qgc2Nyb2xsTGVmdCA9IGVsLnNjcm9sbExlZnQ7XG4gICAgcmV0dXJuIHsgd2lkdGhTY3JvbGwsIHdpZHRoLCBzY3JvbGxMZWZ0IH07XG4gIH1cbn1cbiJdfQ==