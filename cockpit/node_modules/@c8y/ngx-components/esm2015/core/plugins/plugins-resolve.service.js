import { __awaiter } from "tslib";
import { Compiler, Injectable, InjectFlags, Injector, NgModuleFactory } from '@angular/core';
import { ActionBarService, HOOK_ACTION_BAR } from '../action-bar/action-bar.service';
import { ActionService, HOOK_ACTION } from '../action/action.service';
import { BreadcrumbService, HOOK_BREADCRUMB } from '../breadcrumb/breadcrumb.service';
import { HOOK_DOCS } from '../docs/docs.models';
import { DocsService } from '../docs/docs.service';
import { HOOK_COMPONENTS } from '../dynamic-component/dynamic-component.model';
import { DynamicComponentService } from '../dynamic-component/dynamic-component.service';
import { HOOK_NAVIGATOR_NODES, NavigatorService } from '../navigator/navigator.service';
import { HOOK_ONCE_ROUTE, HOOK_ROUTE, RouterService } from '../router/router.service';
import { HOOK_SEARCH, SearchService } from '../search/search.service';
import { HOOK_TABS, TabsService } from '../tabs/tabs.service';
import * as i0 from "@angular/core";
import * as i1 from "../tabs/tabs.service";
import * as i2 from "../navigator/navigator.service";
import * as i3 from "../action/action.service";
import * as i4 from "../action-bar/action-bar.service";
import * as i5 from "../breadcrumb/breadcrumb.service";
import * as i6 from "../dynamic-component/dynamic-component.service";
import * as i7 from "../search/search.service";
import * as i8 from "../router/router.service";
import * as i9 from "../docs/docs.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../tabs/tabs.service';
import * as ɵngcc2 from '../navigator/navigator.service';
import * as ɵngcc3 from '../action/action.service';
import * as ɵngcc4 from '../action-bar/action-bar.service';
import * as ɵngcc5 from '../breadcrumb/breadcrumb.service';
import * as ɵngcc6 from '../dynamic-component/dynamic-component.service';
import * as ɵngcc7 from '../search/search.service';
import * as ɵngcc8 from '../router/router.service';
import * as ɵngcc9 from '../docs/docs.service';
export class PluginsResolveService {
    constructor(tabs, navigator, action, actionBar, breadcrumb, dynamicComponent, search, c8yRouter, docs, compiler, injector) {
        this.tabs = tabs;
        this.navigator = navigator;
        this.action = action;
        this.actionBar = actionBar;
        this.breadcrumb = breadcrumb;
        this.dynamicComponent = dynamicComponent;
        this.search = search;
        this.c8yRouter = c8yRouter;
        this.docs = docs;
        this.compiler = compiler;
        this.injector = injector;
        this.allHooks = [
            { token: HOOK_ACTION, service: this.action, values: [] },
            { token: HOOK_ACTION_BAR, service: this.actionBar, values: [] },
            { token: HOOK_NAVIGATOR_NODES, service: this.navigator, values: [] },
            { token: HOOK_BREADCRUMB, service: this.breadcrumb, values: [] },
            { token: HOOK_COMPONENTS, service: this.dynamicComponent, values: [] },
            { token: HOOK_ONCE_ROUTE, service: this.c8yRouter, values: [] },
            { token: HOOK_ROUTE, service: this.c8yRouter, values: [] },
            { token: HOOK_ROUTE, service: this.c8yRouter, values: [] },
            { token: HOOK_SEARCH, service: this.search, values: [] },
            { token: HOOK_TABS, service: this.tabs, values: [] },
            { token: HOOK_DOCS, service: this.docs, values: [] }
        ];
    }
    /**
     * Loads plugins by resolving the remote NgModules and injecting it. Also attaching
     * the hooks onto the root injector.
     * @param remoteModules The remote plugins to load as factory name mapping array.
     */
    resolveRemotePlugins(remoteModules) {
        return __awaiter(this, void 0, void 0, function* () {
            const remoteNgModules = remoteModules
                .filter(({ factory }) => factory)
                .map(({ name, factory }) => factory[name]);
            for (const remoteNgModule of remoteNgModules) {
                let factory;
                if (remoteNgModule instanceof NgModuleFactory) {
                    // AOT
                    factory = remoteNgModule;
                }
                else {
                    // JIT
                    factory = yield this.compiler.compileModuleAsync(remoteNgModule);
                }
                const moduleRef = factory.create(this.injector);
                this.allHooks.forEach(hook => {
                    hook.values = [...hook.values, ...moduleRef.injector.get(hook.token, [], InjectFlags.Self)];
                });
            }
            this.allHooks.forEach(hook => {
                if (hook.values.length) {
                    hook.service.factories = [...hook.service.factories, ...hook.values];
                    hook.service.refresh();
                }
            });
        });
    }
}
PluginsResolveService.ɵfac = function PluginsResolveService_Factory(t) { return new (t || PluginsResolveService)(ɵngcc0.ɵɵinject(ɵngcc1.TabsService), ɵngcc0.ɵɵinject(ɵngcc2.NavigatorService), ɵngcc0.ɵɵinject(ɵngcc3.ActionService), ɵngcc0.ɵɵinject(ɵngcc4.ActionBarService), ɵngcc0.ɵɵinject(ɵngcc5.BreadcrumbService), ɵngcc0.ɵɵinject(ɵngcc6.DynamicComponentService), ɵngcc0.ɵɵinject(ɵngcc7.SearchService), ɵngcc0.ɵɵinject(ɵngcc8.RouterService), ɵngcc0.ɵɵinject(ɵngcc9.DocsService), ɵngcc0.ɵɵinject(ɵngcc0.Compiler), ɵngcc0.ɵɵinject(ɵngcc0.Injector)); };
PluginsResolveService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PluginsResolveService_Factory() { return new PluginsResolveService(i0.ɵɵinject(i1.TabsService), i0.ɵɵinject(i2.NavigatorService), i0.ɵɵinject(i3.ActionService), i0.ɵɵinject(i4.ActionBarService), i0.ɵɵinject(i5.BreadcrumbService), i0.ɵɵinject(i6.DynamicComponentService), i0.ɵɵinject(i7.SearchService), i0.ɵɵinject(i8.RouterService), i0.ɵɵinject(i9.DocsService), i0.ɵɵinject(i0.Compiler), i0.ɵɵinject(i0.INJECTOR)); }, token: PluginsResolveService, providedIn: "root" });
PluginsResolveService.ctorParameters = () => [
    { type: TabsService },
    { type: NavigatorService },
    { type: ActionService },
    { type: ActionBarService },
    { type: BreadcrumbService },
    { type: DynamicComponentService },
    { type: SearchService },
    { type: RouterService },
    { type: DocsService },
    { type: Compiler },
    { type: Injector }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PluginsResolveService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.TabsService }, { type: ɵngcc2.NavigatorService }, { type: ɵngcc3.ActionService }, { type: ɵngcc4.ActionBarService }, { type: ɵngcc5.BreadcrumbService }, { type: ɵngcc6.DynamicComponentService }, { type: ɵngcc7.SearchService }, { type: ɵngcc8.RouterService }, { type: ɵngcc9.DocsService }, { type: ɵngcc0.Compiler }, { type: ɵngcc0.Injector }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2lucy1yZXNvbHZlLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvcGx1Z2lucy9wbHVnaW5zLXJlc29sdmUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFFBQVEsRUFDUixVQUFVLEVBQ1YsV0FBVyxFQUVYLFFBQVEsRUFDUixlQUFlLEVBQ2hCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRixPQUFPLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUV0RixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUN6RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN4RixPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RixPQUFPLEVBQUUsV0FBVyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUQ7QUFDb0M7QUFDckI7QUFLYjtBQUNXO0FBRUo7QUFHTjtBQUNRO0FBQWdEO0FBQ3JCOzs7Ozs7Ozs7OztBQVJ0QyxNQUFNLE9BQU8scUJBQXFCO0FBQ2xDLElBa0JFLFlBQ1UsSUFBaUIsRUFDakIs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ckJBSUksWUFUSSxXQUFXO1lBTTdCLFVBQVUsRUFBRSxNQUFNLDlCQU5lLFlBSEosZ0JBQWdCO1lBVTlDLFpBVmtELFlBUDFDLGFBQWE7QUFBSSxZQURqQixnQkFBZ0I7QUFBSSxZQUVwQixpQkFBaUI7QUFBSSxZQUtyQix1QkFBdUI7QUFBSSxZQUdkLGFBQWE7QUFBSSxZQURELGFBQWE7QUFBSSxZQUo5QyxXQUFXO0FBQUksWUFidEIsUUFBUTtBQUNSLFlBR0EsUUFBUTtBQUNUOzs7Ozs7b1pBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBpbGVyLFxuICBJbmplY3RhYmxlLFxuICBJbmplY3RGbGFncyxcbiAgSW5qZWN0aW9uVG9rZW4sXG4gIEluamVjdG9yLFxuICBOZ01vZHVsZUZhY3Rvcnlcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJQXBwbGljYXRpb24sIElJZGVudGlmaWVkIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgQWN0aW9uQmFyU2VydmljZSwgSE9PS19BQ1RJT05fQkFSIH0gZnJvbSAnLi4vYWN0aW9uLWJhci9hY3Rpb24tYmFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWN0aW9uU2VydmljZSwgSE9PS19BQ1RJT04gfSBmcm9tICcuLi9hY3Rpb24vYWN0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgQnJlYWRjcnVtYlNlcnZpY2UsIEhPT0tfQlJFQURDUlVNQiB9IGZyb20gJy4uL2JyZWFkY3J1bWIvYnJlYWRjcnVtYi5zZXJ2aWNlJztcbmltcG9ydCB7IEV4dGVuc2lvblBvaW50IH0gZnJvbSAnLi4vY29tbW9uL2V4dGVuc2lvbi1ob29rcyc7XG5pbXBvcnQgeyBIT09LX0RPQ1MgfSBmcm9tICcuLi9kb2NzL2RvY3MubW9kZWxzJztcbmltcG9ydCB7IERvY3NTZXJ2aWNlIH0gZnJvbSAnLi4vZG9jcy9kb2NzLnNlcnZpY2UnO1xuaW1wb3J0IHsgSE9PS19DT01QT05FTlRTIH0gZnJvbSAnLi4vZHluYW1pYy1jb21wb25lbnQvZHluYW1pYy1jb21wb25lbnQubW9kZWwnO1xuaW1wb3J0IHsgRHluYW1pY0NvbXBvbmVudFNlcnZpY2UgfSBmcm9tICcuLi9keW5hbWljLWNvbXBvbmVudC9keW5hbWljLWNvbXBvbmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEhPT0tfTkFWSUdBVE9SX05PREVTLCBOYXZpZ2F0b3JTZXJ2aWNlIH0gZnJvbSAnLi4vbmF2aWdhdG9yL25hdmlnYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IEhPT0tfT05DRV9ST1VURSwgSE9PS19ST1VURSwgUm91dGVyU2VydmljZSB9IGZyb20gJy4uL3JvdXRlci9yb3V0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBIT09LX1NFQVJDSCwgU2VhcmNoU2VydmljZSB9IGZyb20gJy4uL3NlYXJjaC9zZWFyY2guc2VydmljZSc7XG5pbXBvcnQgeyBIT09LX1RBQlMsIFRhYnNTZXJ2aWNlIH0gZnJvbSAnLi4vdGFicy90YWJzLnNlcnZpY2UnO1xuXG50eXBlIEFwcGxpY2F0aW9uID0gSUlkZW50aWZpZWQgfCBJQXBwbGljYXRpb24gfCBudW1iZXIgfCBzdHJpbmc7XG50eXBlIFBhY2thZ2UgPSBBcHBsaWNhdGlvbjtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUGx1Z2luc1Jlc29sdmVTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhbGxIb29rczogQXJyYXk8e1xuICAgIHRva2VuOiBJbmplY3Rpb25Ub2tlbjxhbnk+O1xuICAgIHNlcnZpY2U6IEV4dGVuc2lvblBvaW50PGFueT47XG4gICAgdmFsdWVzOiBhbnlbXTtcbiAgfT4gPSBbXG4gICAgeyB0b2tlbjogSE9PS19BQ1RJT04sIHNlcnZpY2U6IHRoaXMuYWN0aW9uLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19BQ1RJT05fQkFSLCBzZXJ2aWNlOiB0aGlzLmFjdGlvbkJhciwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfTkFWSUdBVE9SX05PREVTLCBzZXJ2aWNlOiB0aGlzLm5hdmlnYXRvciwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfQlJFQURDUlVNQiwgc2VydmljZTogdGhpcy5icmVhZGNydW1iLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19DT01QT05FTlRTLCBzZXJ2aWNlOiB0aGlzLmR5bmFtaWNDb21wb25lbnQsIHZhbHVlczogW10gfSxcbiAgICB7IHRva2VuOiBIT09LX09OQ0VfUk9VVEUsIHNlcnZpY2U6IHRoaXMuYzh5Um91dGVyLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19ST1VURSwgc2VydmljZTogdGhpcy5jOHlSb3V0ZXIsIHZhbHVlczogW10gfSxcbiAgICB7IHRva2VuOiBIT09LX1JPVVRFLCBzZXJ2aWNlOiB0aGlzLmM4eVJvdXRlciwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfU0VBUkNILCBzZXJ2aWNlOiB0aGlzLnNlYXJjaCwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfVEFCUywgc2VydmljZTogdGhpcy50YWJzLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19ET0NTLCBzZXJ2aWNlOiB0aGlzLmRvY3MsIHZhbHVlczogW10gfVxuICBdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdGFiczogVGFic1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBuYXZpZ2F0b3I6IE5hdmlnYXRvclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhY3Rpb246IEFjdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhY3Rpb25CYXI6IEFjdGlvbkJhclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBicmVhZGNydW1iOiBCcmVhZGNydW1iU2VydmljZSxcbiAgICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnQ6IER5bmFtaWNDb21wb25lbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgc2VhcmNoOiBTZWFyY2hTZXJ2aWNlLFxuICAgIHByaXZhdGUgYzh5Um91dGVyOiBSb3V0ZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgZG9jczogRG9jc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBjb21waWxlcjogQ29tcGlsZXIsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBMb2FkcyBwbHVnaW5zIGJ5IHJlc29sdmluZyB0aGUgcmVtb3RlIE5nTW9kdWxlcyBhbmQgaW5qZWN0aW5nIGl0LiBBbHNvIGF0dGFjaGluZ1xuICAgKiB0aGUgaG9va3Mgb250byB0aGUgcm9vdCBpbmplY3Rvci5cbiAgICogQHBhcmFtIHJlbW90ZU1vZHVsZXMgVGhlIHJlbW90ZSBwbHVnaW5zIHRvIGxvYWQgYXMgZmFjdG9yeSBuYW1lIG1hcHBpbmcgYXJyYXkuXG4gICAqL1xuICBhc3luYyByZXNvbHZlUmVtb3RlUGx1Z2lucyhyZW1vdGVNb2R1bGVzOiBBcnJheTx7IGZhY3Rvcnk7IG5hbWUgfT4pIHtcbiAgICBjb25zdCByZW1vdGVOZ01vZHVsZXMgPSByZW1vdGVNb2R1bGVzXG4gICAgICAuZmlsdGVyKCh7IGZhY3RvcnkgfSkgPT4gZmFjdG9yeSlcbiAgICAgIC5tYXAoKHsgbmFtZSwgZmFjdG9yeSB9KSA9PiBmYWN0b3J5W25hbWVdKTtcblxuICAgIGZvciAoY29uc3QgcmVtb3RlTmdNb2R1bGUgb2YgcmVtb3RlTmdNb2R1bGVzKSB7XG4gICAgICBsZXQgZmFjdG9yeTogTmdNb2R1bGVGYWN0b3J5PHVua25vd24+O1xuICAgICAgaWYgKHJlbW90ZU5nTW9kdWxlIGluc3RhbmNlb2YgTmdNb2R1bGVGYWN0b3J5KSB7XG4gICAgICAgIC8vIEFPVFxuICAgICAgICBmYWN0b3J5ID0gcmVtb3RlTmdNb2R1bGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBKSVRcbiAgICAgICAgZmFjdG9yeSA9IGF3YWl0IHRoaXMuY29tcGlsZXIuY29tcGlsZU1vZHVsZUFzeW5jKHJlbW90ZU5nTW9kdWxlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbW9kdWxlUmVmID0gZmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG5cbiAgICAgIHRoaXMuYWxsSG9va3MuZm9yRWFjaChob29rID0+IHtcbiAgICAgICAgaG9vay52YWx1ZXMgPSBbLi4uaG9vay52YWx1ZXMsIC4uLm1vZHVsZVJlZi5pbmplY3Rvci5nZXQoaG9vay50b2tlbiwgW10sIEluamVjdEZsYWdzLlNlbGYpXTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuYWxsSG9va3MuZm9yRWFjaChob29rID0+IHtcbiAgICAgIGlmIChob29rLnZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgaG9vay5zZXJ2aWNlLmZhY3RvcmllcyA9IFsuLi5ob29rLnNlcnZpY2UuZmFjdG9yaWVzLCAuLi5ob29rLnZhbHVlc107XG4gICAgICAgIGhvb2suc2VydmljZS5yZWZyZXNoKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==