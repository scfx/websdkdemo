import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { FormGroup } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { ɵdefineHiddenProp } from '@ngx-formly/core';
import { find, forOwn, get, mapValues, pick } from 'lodash-es';
import { BehaviorSubject, combineLatest, from, merge, of, Subject } from 'rxjs';
import { catchError, map, shareReplay, switchMap, tap } from 'rxjs/operators';
import { AlertService } from '../alert/alert.service';
import { Permissions, Status } from '../common/index';
import { C8yJSONSchema } from '../dynamic-forms/json-schema/c8y-json-schema.service';
import { ModalService } from '../modal/modal.service';
import { ProviderConfigurationService } from './service/provider-configuration.service';
import { ProviderDefinitionsService } from './service/provider-definitions.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../common/index';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from '../modal/modal.service';
import * as ɵngcc4 from '../alert/alert.service';
import * as ɵngcc5 from './service/provider-definitions.service';
import * as ɵngcc6 from './service/provider-configuration.service';
import * as ɵngcc7 from '../dynamic-forms/json-schema/c8y-json-schema.service';
import * as ɵngcc8 from '../header/title/title.component';
import * as ɵngcc9 from '@angular/forms';
import * as ɵngcc10 from '@angular/common';
import * as ɵngcc11 from '../forms/form-group.component';
import * as ɵngcc12 from '../select/typeahead.component';
import * as ɵngcc13 from '../forms/messages.component';
import * as ɵngcc14 from '../forms/message.directive';
import * as ɵngcc15 from '../common/if-allowed.directive';
import * as ɵngcc16 from '../list-group/list-item.component';
import * as ɵngcc17 from '../search/highlight.component';
import * as ɵngcc18 from '@ngx-formly/core';
import * as ɵngcc19 from '../i18n/c8y-translate.pipe';

function ProviderConfigurationComponent_p_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 14);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵpipe(3, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, ɵngcc0.ɵɵpipeBind1(3, 3, ctx_r0.layout$).description), " ");
} }
function ProviderConfigurationComponent_c8y_li_26_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-li", 15);
    ɵngcc0.ɵɵlistener("click", function ProviderConfigurationComponent_c8y_li_26_Template_c8y_li_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r6); const provider_r4 = restoredCtx.$implicit; const ctx_r5 = ɵngcc0.ɵɵnextContext(); ctx_r5.changeProvider$.next(provider_r4); return ctx_r5.providerInput$.next(""); });
    ɵngcc0.ɵɵpipe(1, "async");
    ɵngcc0.ɵɵelement(2, "c8y-highlight", 16);
    ɵngcc0.ɵɵpipe(3, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const provider_r4 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("active", ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r1.selectedProvider$) === provider_r4);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("text", provider_r4.displayName || "--")("pattern", ɵngcc0.ɵɵpipeBind1(3, 5, ctx_r1.providerInput$));
} }
function ProviderConfigurationComponent_formly_form_32_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "formly-form", 17);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("form", ctx_r2.form)("fields", ctx_r2.fields)("model", ctx_r2.model)("options", ctx_r2.options);
} }
function ProviderConfigurationComponent_div_34_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 21);
    ɵngcc0.ɵɵlistener("click", function ProviderConfigurationComponent_div_34_button_1_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(2); return ctx_r9.deleteProviderConfiguration(); });
    ɵngcc0.ɵɵpipe(1, "async");
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵpipe(7, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext(2);
    let tmp_1_0;
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(3, 7, ɵngcc0.ɵɵpipeBind1(4, 9, ctx_r7.layout$).deleteBtnLabel));
    ɵngcc0.ɵɵproperty("disabled", !((tmp_1_0 = ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r7.configuration$)) == null ? null : tmp_1_0.provider) && !((tmp_1_0 = ɵngcc0.ɵɵpipeBind1(2, 5, ctx_r7.configuration$)) == null ? null : tmp_1_0.providerName));
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 11, ɵngcc0.ɵɵpipeBind1(7, 13, ctx_r7.layout$).deleteBtnLabel), " ");
} }
function ProviderConfigurationComponent_div_34_button_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "button", 22);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r8 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 3, ɵngcc0.ɵɵpipeBind1(2, 5, ctx_r8.layout$).saveBtnLabel));
    ɵngcc0.ɵɵproperty("disabled", ctx_r8.form.invalid || ctx_r8.form.pristine);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 7, ɵngcc0.ɵɵpipeBind1(5, 9, ctx_r8.layout$).saveBtnLabel), " ");
} }
function ProviderConfigurationComponent_div_34_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 18);
    ɵngcc0.ɵɵtemplate(1, ProviderConfigurationComponent_div_34_button_1_Template, 8, 15, "button", 19);
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵtemplate(3, ProviderConfigurationComponent_div_34_button_3_Template, 6, 11, "button", 20);
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("c8yIfAllowed", ɵngcc0.ɵɵpipeBind1(2, 2, ctx_r3.layout$).deleteRoles);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIfAllowed", ɵngcc0.ɵɵpipeBind1(4, 4, ctx_r3.layout$).saveRoles);
} }
export class ProviderConfigurationComponent {
    constructor(permissions, activatedRoute, modalService, alertService, providerDefinitionsService, providerConfigurationService, jsonschema) {
        this.permissions = permissions;
        this.activatedRoute = activatedRoute;
        this.modalService = modalService;
        this.alertService = alertService;
        this.providerDefinitionsService = providerDefinitionsService;
        this.providerConfigurationService = providerConfigurationService;
        this.jsonschema = jsonschema;
        this.layout$ = this.activatedRoute.data.pipe(map((config) => config.layout), tap((layout) => (this.layout = layout)), tap((layout) => {
            this.options.formState.disabled = !this.permissions.hasAllRoles(layout.saveRoles);
            this.beforeSaveHook = layout.beforeSaveHook;
        }));
        this.allRoles$ = this.layout$.pipe(map((layout) => [
            ...(layout.deleteRoles || []),
            ...(layout.saveRoles || [])
        ]));
        this.changeProvider$ = new BehaviorSubject(null);
        this.providerInput$ = new BehaviorSubject('');
        this.form = new FormGroup({});
        this.fields = [];
        this.options = {
            formState: {
                disabled: false
            }
        };
        this.reload$ = new BehaviorSubject(null);
        this.updatedConfiguration$ = new Subject();
    }
    ngOnInit() {
        const allProviders$ = from(this.providerDefinitionsService.list()).pipe(map(result => result.data), shareReplay(1));
        this.providers$ = combineLatest(allProviders$, this.providerInput$).pipe(map(([providers, input]) => input
            ? providers.filter(el => el.displayName.toLowerCase().indexOf(input.toLowerCase()) >= 0)
            : providers), shareReplay(1));
        this.configuration$ = merge(this.updatedConfiguration$, this.reload$.pipe(switchMap(() => from(this.providerConfigurationService.detail()).pipe(catchError(() => of({})))), map(result => result.data))).pipe(map(this.removeEncryptedValues), shareReplay(1));
        this.selectedProvider$ = combineLatest(allProviders$, this.configuration$, this.changeProvider$).pipe(tap(([_, configuration, newProvider]) => (this.model = newProvider
            ? pick(this.model, 'sms.senderName', 'sms.senderAddress')
            : configuration)), map(([providers, configuration, newProvider]) => newProvider ||
            find(providers, (provider) => get(configuration, 'provider') === provider.id)), tap((provider) => {
            if (provider) {
                const config = this.jsonschema.toFieldConfig(get(provider, 'schema'));
                if (config.fieldGroup) {
                    config.fieldGroup.forEach((fieldConfig) => {
                        ɵdefineHiddenProp(fieldConfig, '_keyPath', {
                            key: fieldConfig.key,
                            path: [fieldConfig.key]
                        });
                        fieldConfig.expressionProperties = {
                            'templateOptions.disabled': 'formState.disabled'
                        };
                    });
                }
                this.fields = [config];
                this.form = new FormGroup({});
            }
        }), shareReplay(1));
    }
    saveProviderConfiguration() {
        return __awaiter(this, void 0, void 0, function* () {
            const modelToSave = !!this.beforeSaveHook
                ? yield this.beforeSaveHook(this.model, this.fields)
                : this.model;
            forOwn(modelToSave, (value, key) => {
                if (Array.isArray(value)) {
                    modelToSave[key] = value.filter(item => !!item || item === 0);
                }
            });
            try {
                const res = yield this.providerConfigurationService.update(modelToSave);
                this.changeProvider$.next(null);
                this.updatedConfiguration$.next(res.data);
                this.alertService.success(this.layout.configurationUpdatedSuccessMsg);
                this.form.markAsPristine();
            }
            catch (err) {
                this.alertService.addServerFailure(err);
            }
        });
    }
    deleteProviderConfiguration() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.modalService.confirm(this.layout.deleteConfigurationModalTitle, this.layout.deleteConfigurationModalBody, Status.DANGER, {
                    ok: this.layout.deleteConfigurationModalOkBtnLabel,
                    cancel: this.layout.deleteConfigurationModalCancelBtnLabel
                });
                yield this.providerConfigurationService.delete();
                this.reload$.next();
                this.alertService.success(this.layout.configurationDeletedSuccessMsg);
            }
            catch (err) {
                if (err) {
                    this.alertService.addServerFailure(err);
                }
            }
        });
    }
    removeEncryptedValues(configuration) {
        return mapValues(configuration, value => (value === '<<Encrypted>>' ? undefined : value));
    }
}
ProviderConfigurationComponent.ɵfac = function ProviderConfigurationComponent_Factory(t) { return new (t || ProviderConfigurationComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Permissions), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.ProviderDefinitionsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc6.ProviderConfigurationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc7.C8yJSONSchema)); };
ProviderConfigurationComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProviderConfigurationComponent, selectors: [["c8y-sms-gateway"]], features: [ɵngcc0.ɵɵProvidersFeature([ProviderConfigurationService, ProviderDefinitionsService])], decls: 36, vars: 47, consts: [[1, "row"], [1, "col-md-8", "col-xs-12"], [1, "card", "card--fullpage", 3, "ngSubmit"], [1, "card-header", "separator"], [1, "card-title"], [1, "inner-scroll"], [1, "card-block"], ["class", "m-b-8", 4, "ngIf"], ["for", "providerName"], ["name", "providerName", 3, "disabled", "ngModel", "displayProperty", "placeholder", "allowFreeEntries", "required", "container", "onSearch"], ["class", "p-l-8 p-r-8 c8y-list__item--link", 3, "active", "click", 4, "ngFor", "ngForOf"], ["name", "notExisting", 3, "text"], [3, "form", "fields", "model", "options", 4, "ngIf"], ["class", "card-footer separator", 4, "c8yIfAllowedAllowAny", "c8yIfAllowed"], [1, "m-b-8"], [1, "p-l-8", "p-r-8", "c8y-list__item--link", 3, "active", "click"], [3, "text", "pattern"], [3, "form", "fields", "model", "options"], [1, "card-footer", "separator"], ["class", "btn btn-default", "type", "button", 3, "disabled", "title", "click", 4, "c8yIfAllowed"], ["class", "btn btn-primary", "type", "submit", 3, "disabled", "title", 4, "c8yIfAllowed"], ["type", "button", 1, "btn", "btn-default", 3, "disabled", "title", "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "disabled", "title"]], template: function ProviderConfigurationComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-title");
        ɵngcc0.ɵɵtext(1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "div", 0);
        ɵngcc0.ɵɵelementStart(5, "div", 1);
        ɵngcc0.ɵɵelementStart(6, "form", 2);
        ɵngcc0.ɵɵlistener("ngSubmit", function ProviderConfigurationComponent_Template_form_ngSubmit_6_listener() { return ctx.saveProviderConfiguration(); });
        ɵngcc0.ɵɵelementStart(7, "div", 3);
        ɵngcc0.ɵɵelementStart(8, "h4", 4);
        ɵngcc0.ɵɵtext(9);
        ɵngcc0.ɵɵpipe(10, "translate");
        ɵngcc0.ɵɵpipe(11, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(12, "div", 5);
        ɵngcc0.ɵɵelementStart(13, "div", 6);
        ɵngcc0.ɵɵtemplate(14, ProviderConfigurationComponent_p_14_Template, 4, 5, "p", 7);
        ɵngcc0.ɵɵpipe(15, "async");
        ɵngcc0.ɵɵelementStart(16, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(17, "label", 8);
        ɵngcc0.ɵɵtext(18);
        ɵngcc0.ɵɵpipe(19, "translate");
        ɵngcc0.ɵɵpipe(20, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(21, "c8y-typeahead", 9);
        ɵngcc0.ɵɵlistener("onSearch", function ProviderConfigurationComponent_Template_c8y_typeahead_onSearch_21_listener($event) { return ctx.providerInput$.next($event); });
        ɵngcc0.ɵɵpipe(22, "async");
        ɵngcc0.ɵɵpipe(23, "async");
        ɵngcc0.ɵɵpipe(24, "translate");
        ɵngcc0.ɵɵpipe(25, "async");
        ɵngcc0.ɵɵtemplate(26, ProviderConfigurationComponent_c8y_li_26_Template, 4, 7, "c8y-li", 10);
        ɵngcc0.ɵɵpipe(27, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(28, "c8y-messages");
        ɵngcc0.ɵɵelement(29, "c8y-message", 11);
        ɵngcc0.ɵɵpipe(30, "translate");
        ɵngcc0.ɵɵpipe(31, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(32, ProviderConfigurationComponent_formly_form_32_Template, 1, 4, "formly-form", 12);
        ɵngcc0.ɵɵpipe(33, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(34, ProviderConfigurationComponent_div_34_Template, 5, 6, "div", 13);
        ɵngcc0.ɵɵpipe(35, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 15, ɵngcc0.ɵɵpipeBind1(3, 17, ctx.layout$).pageTitle), "\n");
        ɵngcc0.ɵɵadvance(8);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(10, 19, ɵngcc0.ɵɵpipeBind1(11, 21, ctx.layout$).cardTitle), " ");
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngIf", !!ɵngcc0.ɵɵpipeBind1(15, 23, ctx.layout$).description);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(19, 25, ɵngcc0.ɵɵpipeBind1(20, 27, ctx.layout$).providerName));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(24, 33, ɵngcc0.ɵɵpipeBind1(25, 35, ctx.layout$).providerNamePlaceholder));
        ɵngcc0.ɵɵproperty("disabled", !ctx.permissions.hasAllRoles(ɵngcc0.ɵɵpipeBind1(22, 29, ctx.layout$).saveRoles))("ngModel", ɵngcc0.ɵɵpipeBind1(23, 31, ctx.selectedProvider$))("displayProperty", "displayName")("allowFreeEntries", false)("required", true)("container", "body");
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind1(27, 37, ctx.providers$));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("text", ɵngcc0.ɵɵpipeBind1(30, 39, ɵngcc0.ɵɵpipeBind1(31, 41, ctx.layout$).providerNameNoMatchesHint));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(33, 43, ctx.selectedProvider$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("c8yIfAllowed", ɵngcc0.ɵɵpipeBind1(35, 45, ctx.allRoles$));
    } }, directives: [ɵngcc8.TitleComponent, ɵngcc9.ɵNgNoValidate, ɵngcc9.NgControlStatusGroup, ɵngcc9.NgForm, ɵngcc10.NgIf, ɵngcc11.FormGroupComponent, ɵngcc12.TypeaheadComponent, ɵngcc9.NgControlStatus, ɵngcc9.NgModel, ɵngcc9.RequiredValidator, ɵngcc10.NgForOf, ɵngcc13.MessagesComponent, ɵngcc14.MessageDirective, ɵngcc15.IfAllowedDirective, ɵngcc16.ListItemComponent, ɵngcc17.HighlightComponent, ɵngcc18.FormlyForm], pipes: [ɵngcc19.C8yTranslatePipe, ɵngcc10.AsyncPipe], encapsulation: 2 });
ProviderConfigurationComponent.ctorParameters = () => [
    { type: Permissions },
    { type: ActivatedRoute },
    { type: ModalService },
    { type: AlertService },
    { type: ProviderDefinitionsService },
    { type: ProviderConfigurationService },
    { type: C8yJSONSchema }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProviderConfigurationComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-sms-gateway',
                template: "<c8y-title>\n  {{ (layout$ | async).pageTitle | translate }}\n</c8y-title>\n\n<div class=\"row\">\n  <div class=\"col-md-8 col-xs-12\">\n    <form class=\"card card--fullpage\" (ngSubmit)=\"saveProviderConfiguration()\">\n      <div class=\"card-header separator\">\n        <h4 class=\"card-title\">\n          {{ (layout$ | async).cardTitle | translate }}\n        </h4>\n      </div>\n      <div class=\"inner-scroll\">\n        <div class=\"card-block\">\n          <p *ngIf=\"!!(layout$ | async).description\" class=\"m-b-8\">\n            {{ (layout$ | async).description | translate }}\n          </p>\n          <c8y-form-group>\n            <label for=\"providerName\">{{ (layout$ | async).providerName | translate }}</label>\n            <c8y-typeahead\n              [disabled]=\"!permissions.hasAllRoles((layout$ | async).saveRoles)\"\n              [ngModel]=\"selectedProvider$ | async\"\n              [displayProperty]=\"'displayName'\"\n              name=\"providerName\"\n              placeholder=\"{{ (layout$ | async).providerNamePlaceholder | translate }}\"\n              (onSearch)=\"providerInput$.next($event)\"\n              [allowFreeEntries]=\"false\"\n              [required]=\"true\"\n              [container]=\"'body'\"\n            >\n              <c8y-li\n                *ngFor=\"let provider of providers$ | async\"\n                class=\"p-l-8 p-r-8 c8y-list__item--link\"\n                (click)=\"changeProvider$.next(provider); providerInput$.next('')\"\n                [active]=\"(selectedProvider$ | async) === provider\"\n              >\n                <c8y-highlight\n                  [text]=\"provider.displayName || '--'\"\n                  [pattern]=\"providerInput$ | async\"\n                ></c8y-highlight>\n              </c8y-li>\n            </c8y-typeahead>\n            <c8y-messages\n              ><c8y-message\n                name=\"notExisting\"\n                [text]=\"(layout$ | async).providerNameNoMatchesHint | translate\"\n              ></c8y-message>\n            </c8y-messages>\n          </c8y-form-group>\n          <formly-form\n            *ngIf=\"selectedProvider$ | async\"\n            [form]=\"form\"\n            [fields]=\"fields\"\n            [model]=\"model\"\n            [options]=\"options\"\n          ></formly-form>\n        </div>\n      </div>\n      <div class=\"card-footer separator\" *c8yIfAllowed=\"allRoles$ | async; allowAny\">\n        <button\n          *c8yIfAllowed=\"(layout$ | async).deleteRoles\"\n          class=\"btn btn-default\"\n          type=\"button\"\n          (click)=\"deleteProviderConfiguration()\"\n          [disabled]=\"\n            !(configuration$ | async)?.provider && !(configuration$ | async)?.providerName\n          \"\n          title=\"{{ (layout$ | async).deleteBtnLabel | translate }}\"\n        >\n          {{ (layout$ | async).deleteBtnLabel | translate }}\n        </button>\n        <button\n          *c8yIfAllowed=\"(layout$ | async).saveRoles\"\n          class=\"btn btn-primary\"\n          type=\"submit\"\n          [disabled]=\"form.invalid || form.pristine\"\n          title=\"{{ (layout$ | async).saveBtnLabel | translate }}\"\n        >\n          {{ (layout$ | async).saveBtnLabel | translate }}\n        </button>\n      </div>\n    </form>\n  </div>\n</div>\n",
                providers: [ProviderConfigurationService, ProviderDefinitionsService]
            }]
    }], function () { return [{ type: ɵngcc1.Permissions }, { type: ɵngcc2.ActivatedRoute }, { type: ɵngcc3.ModalService }, { type: ɵngcc4.AlertService }, { type: ɵngcc5.ProviderDefinitionsService }, { type: ɵngcc6.ProviderConfigurationService }, { type: ɵngcc7.C8yJSONSchema }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZXItY29uZmlndXJhdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvcHJvdmlkZXItY29uZmlndXJhdGlvbi9wcm92aWRlci1jb25maWd1cmF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWpELE9BQU8sRUFBd0MsaUJBQWlCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzRixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUYsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFDckYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBT3RELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3hGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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OUYsSUFBRSxDQUFDO0FBQ0g7MERBdkxDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsaUJBQWlCLGtCQUMzQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQUFzRCxrQkFDdEQ7RUFBUyxFQUFFLENBQUMsNEJBQTRCLEVBQUU7cUJBQTBCLENBQUM7QUFDdEU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OytlQUNJO0FBQUM7QUFDVSxZQWxCUCxXQUFXO0FBQUksWUFQZixjQUFjO0FBQUksWUFTbEIsWUFBWTtBQUFJLFlBSGhCLFlBQVk7QUFBSSxZQVdoQiwwQkFBMEI7QUFBSSxZQUQ5Qiw0QkFBNEI7QUFBSSxZQVJoQyxhQUFhO0FBQUc7Ozs7Ozs7O3VTQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IElSZXN1bHQgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBGb3JtbHlGaWVsZENvbmZpZywgRm9ybWx5Rm9ybU9wdGlvbnMsIMm1ZGVmaW5lSGlkZGVuUHJvcCB9IGZyb20gJ0BuZ3gtZm9ybWx5L2NvcmUnO1xuaW1wb3J0IHsgZmluZCwgZm9yT3duLCBnZXQsIG1hcFZhbHVlcywgcGljayB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIGZyb20sIG1lcmdlLCBPYnNlcnZhYmxlLCBvZiwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCBzaGFyZVJlcGxheSwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UgfSBmcm9tICcuLi9hbGVydC9hbGVydC5zZXJ2aWNlJztcbmltcG9ydCB7IFBlcm1pc3Npb25zLCBTdGF0dXMgfSBmcm9tICcuLi9jb21tb24vaW5kZXgnO1xuaW1wb3J0IHsgQzh5SlNPTlNjaGVtYSB9IGZyb20gJy4uL2R5bmFtaWMtZm9ybXMvanNvbi1zY2hlbWEvYzh5LWpzb24tc2NoZW1hLnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9kYWxTZXJ2aWNlIH0gZnJvbSAnLi4vbW9kYWwvbW9kYWwuc2VydmljZSc7XG5pbXBvcnQge1xuICBEeW5hbWljUHJvdmlkZXJDb25maWcsXG4gIER5bmFtaWNQcm92aWRlckxheW91dENvbmZpZ1xufSBmcm9tICcuL21vZGVsL2R5bmFtaWMtcHJvdmlkZXItY29uZmlnLm1vZGVsJztcbmltcG9ydCB7IFByb3ZpZGVyRGVmaW5pdGlvbiB9IGZyb20gJy4vbW9kZWwvcHJvdmlkZXItZGVmaW5pdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBQcm92aWRlclByb3BlcnRpZXMgfSBmcm9tICcuL21vZGVsL3Byb3ZpZGVyLXByb3BlcnRpZXMubW9kZWwnO1xuaW1wb3J0IHsgUHJvdmlkZXJDb25maWd1cmF0aW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9wcm92aWRlci1jb25maWd1cmF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJvdmlkZXJEZWZpbml0aW9uc1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvcHJvdmlkZXItZGVmaW5pdGlvbnMuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zbXMtZ2F0ZXdheScsXG4gIHRlbXBsYXRlVXJsOiAnLi9wcm92aWRlci1jb25maWd1cmF0aW9uLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbUHJvdmlkZXJDb25maWd1cmF0aW9uU2VydmljZSwgUHJvdmlkZXJEZWZpbml0aW9uc1NlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIFByb3ZpZGVyQ29uZmlndXJhdGlvbkNvbXBvbmVudCB7XG4gIGxheW91dCQ6IE9ic2VydmFibGU8RHluYW1pY1Byb3ZpZGVyTGF5b3V0Q29uZmlnPiA9IHRoaXMuYWN0aXZhdGVkUm91dGUuZGF0YS5waXBlKFxuICAgIG1hcCgoY29uZmlnOiBEeW5hbWljUHJvdmlkZXJDb25maWcpID0+IGNvbmZpZy5sYXlvdXQpLFxuICAgIHRhcCgobGF5b3V0OiBEeW5hbWljUHJvdmlkZXJMYXlvdXRDb25maWcpID0+ICh0aGlzLmxheW91dCA9IGxheW91dCkpLFxuICAgIHRhcCgobGF5b3V0OiBEeW5hbWljUHJvdmlkZXJMYXlvdXRDb25maWcpID0+IHtcbiAgICAgIHRoaXMub3B0aW9ucy5mb3JtU3RhdGUuZGlzYWJsZWQgPSAhdGhpcy5wZXJtaXNzaW9ucy5oYXNBbGxSb2xlcyhsYXlvdXQuc2F2ZVJvbGVzKTtcbiAgICAgIHRoaXMuYmVmb3JlU2F2ZUhvb2sgPSBsYXlvdXQuYmVmb3JlU2F2ZUhvb2s7XG4gICAgfSlcbiAgKTtcblxuICBhbGxSb2xlcyQ6IE9ic2VydmFibGU8c3RyaW5nW10+ID0gdGhpcy5sYXlvdXQkLnBpcGUoXG4gICAgbWFwKChsYXlvdXQ6IER5bmFtaWNQcm92aWRlckxheW91dENvbmZpZykgPT4gW1xuICAgICAgLi4uKGxheW91dC5kZWxldGVSb2xlcyB8fCBbXSksXG4gICAgICAuLi4obGF5b3V0LnNhdmVSb2xlcyB8fCBbXSlcbiAgICBdKVxuICApO1xuXG4gIHByb3ZpZGVycyQ6IE9ic2VydmFibGU8UHJvdmlkZXJEZWZpbml0aW9uW10+O1xuICBzZWxlY3RlZFByb3ZpZGVyJDogT2JzZXJ2YWJsZTxQcm92aWRlckRlZmluaXRpb24+O1xuICBjaGFuZ2VQcm92aWRlciQ6IFN1YmplY3Q8UHJvdmlkZXJEZWZpbml0aW9uPiA9IG5ldyBCZWhhdmlvclN1YmplY3QobnVsbCk7XG4gIGNvbmZpZ3VyYXRpb24kOiBPYnNlcnZhYmxlPFByb3ZpZGVyUHJvcGVydGllcz47XG4gIHByb3ZpZGVySW5wdXQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcblxuICBmb3JtID0gbmV3IEZvcm1Hcm91cCh7fSk7XG4gIG1vZGVsOiBQcm92aWRlclByb3BlcnRpZXM7XG4gIGZpZWxkczogRm9ybWx5RmllbGRDb25maWdbXSA9IFtdO1xuICBvcHRpb25zOiBGb3JtbHlGb3JtT3B0aW9ucyA9IHtcbiAgICBmb3JtU3RhdGU6IHtcbiAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIHJlbG9hZCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHZvaWQ+KG51bGwpO1xuICBwcml2YXRlIHVwZGF0ZWRDb25maWd1cmF0aW9uJCA9IG5ldyBTdWJqZWN0PFByb3ZpZGVyUHJvcGVydGllcz4oKTtcbiAgcHJpdmF0ZSBsYXlvdXQ6IER5bmFtaWNQcm92aWRlckxheW91dENvbmZpZztcbiAgcHJpdmF0ZSBiZWZvcmVTYXZlSG9vazogKFxuICAgIG1vZGVsOiBQcm92aWRlclByb3BlcnRpZXMsXG4gICAgZmllbGRzOiBGb3JtbHlGaWVsZENvbmZpZ1tdXG4gICkgPT4gUHJvbWlzZTxQcm92aWRlclByb3BlcnRpZXM+IHwgUHJvdmlkZXJQcm9wZXJ0aWVzO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBwZXJtaXNzaW9uczogUGVybWlzc2lvbnMsXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IE1vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgcHJvdmlkZXJEZWZpbml0aW9uc1NlcnZpY2U6IFByb3ZpZGVyRGVmaW5pdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcHJvdmlkZXJDb25maWd1cmF0aW9uU2VydmljZTogUHJvdmlkZXJDb25maWd1cmF0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGpzb25zY2hlbWE6IEM4eUpTT05TY2hlbWFcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IGFsbFByb3ZpZGVycyQ6IE9ic2VydmFibGU8UHJvdmlkZXJEZWZpbml0aW9uW10+ID0gZnJvbShcbiAgICAgIHRoaXMucHJvdmlkZXJEZWZpbml0aW9uc1NlcnZpY2UubGlzdCgpXG4gICAgKS5waXBlKFxuICAgICAgbWFwKHJlc3VsdCA9PiByZXN1bHQuZGF0YSksXG4gICAgICBzaGFyZVJlcGxheSgxKVxuICAgICk7XG5cbiAgICB0aGlzLnByb3ZpZGVycyQgPSBjb21iaW5lTGF0ZXN0KGFsbFByb3ZpZGVycyQsIHRoaXMucHJvdmlkZXJJbnB1dCQpLnBpcGUoXG4gICAgICBtYXAoKFtwcm92aWRlcnMsIGlucHV0XTogW1Byb3ZpZGVyRGVmaW5pdGlvbltdLCBzdHJpbmddKSA9PlxuICAgICAgICBpbnB1dFxuICAgICAgICAgID8gcHJvdmlkZXJzLmZpbHRlcihlbCA9PiBlbC5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoaW5wdXQudG9Mb3dlckNhc2UoKSkgPj0gMClcbiAgICAgICAgICA6IHByb3ZpZGVyc1xuICAgICAgKSxcbiAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgKTtcblxuICAgIHRoaXMuY29uZmlndXJhdGlvbiQgPSBtZXJnZShcbiAgICAgIHRoaXMudXBkYXRlZENvbmZpZ3VyYXRpb24kLFxuICAgICAgdGhpcy5yZWxvYWQkLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PlxuICAgICAgICAgIGZyb20odGhpcy5wcm92aWRlckNvbmZpZ3VyYXRpb25TZXJ2aWNlLmRldGFpbCgpKS5waXBlKGNhdGNoRXJyb3IoKCkgPT4gb2Yoe30gYXMgYW55KSkpXG4gICAgICAgICksXG4gICAgICAgIG1hcChyZXN1bHQgPT4gcmVzdWx0LmRhdGEpXG4gICAgICApXG4gICAgKS5waXBlKFxuICAgICAgbWFwKHRoaXMucmVtb3ZlRW5jcnlwdGVkVmFsdWVzKSxcbiAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgKTtcblxuICAgIHRoaXMuc2VsZWN0ZWRQcm92aWRlciQgPSBjb21iaW5lTGF0ZXN0KFxuICAgICAgYWxsUHJvdmlkZXJzJCxcbiAgICAgIHRoaXMuY29uZmlndXJhdGlvbiQsXG4gICAgICB0aGlzLmNoYW5nZVByb3ZpZGVyJFxuICAgICkucGlwZShcbiAgICAgIHRhcChcbiAgICAgICAgKFtfLCBjb25maWd1cmF0aW9uLCBuZXdQcm92aWRlcl06IFtcbiAgICAgICAgICBQcm92aWRlckRlZmluaXRpb25bXSxcbiAgICAgICAgICBQcm92aWRlclByb3BlcnRpZXMsXG4gICAgICAgICAgUHJvdmlkZXJEZWZpbml0aW9uXG4gICAgICAgIF0pID0+XG4gICAgICAgICAgKHRoaXMubW9kZWwgPSBuZXdQcm92aWRlclxuICAgICAgICAgICAgPyBwaWNrKHRoaXMubW9kZWwsICdzbXMuc2VuZGVyTmFtZScsICdzbXMuc2VuZGVyQWRkcmVzcycpXG4gICAgICAgICAgICA6IGNvbmZpZ3VyYXRpb24pXG4gICAgICApLFxuICAgICAgbWFwKFxuICAgICAgICAoW3Byb3ZpZGVycywgY29uZmlndXJhdGlvbiwgbmV3UHJvdmlkZXJdOiBbXG4gICAgICAgICAgUHJvdmlkZXJEZWZpbml0aW9uW10sXG4gICAgICAgICAgUHJvdmlkZXJQcm9wZXJ0aWVzLFxuICAgICAgICAgIFByb3ZpZGVyRGVmaW5pdGlvblxuICAgICAgICBdKSA9PlxuICAgICAgICAgIG5ld1Byb3ZpZGVyIHx8XG4gICAgICAgICAgZmluZChcbiAgICAgICAgICAgIHByb3ZpZGVycyxcbiAgICAgICAgICAgIChwcm92aWRlcjogUHJvdmlkZXJEZWZpbml0aW9uKSA9PiBnZXQoY29uZmlndXJhdGlvbiwgJ3Byb3ZpZGVyJykgPT09IHByb3ZpZGVyLmlkXG4gICAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIHRhcCgocHJvdmlkZXI6IFByb3ZpZGVyRGVmaW5pdGlvbikgPT4ge1xuICAgICAgICBpZiAocHJvdmlkZXIpIHtcbiAgICAgICAgICBjb25zdCBjb25maWc6IEZvcm1seUZpZWxkQ29uZmlnID0gdGhpcy5qc29uc2NoZW1hLnRvRmllbGRDb25maWcoZ2V0KHByb3ZpZGVyLCAnc2NoZW1hJykpO1xuICAgICAgICAgIGlmIChjb25maWcuZmllbGRHcm91cCkge1xuICAgICAgICAgICAgY29uZmlnLmZpZWxkR3JvdXAuZm9yRWFjaCgoZmllbGRDb25maWc6IEZvcm1seUZpZWxkQ29uZmlnKSA9PiB7XG4gICAgICAgICAgICAgIMm1ZGVmaW5lSGlkZGVuUHJvcChmaWVsZENvbmZpZywgJ19rZXlQYXRoJywge1xuICAgICAgICAgICAgICAgIGtleTogZmllbGRDb25maWcua2V5LFxuICAgICAgICAgICAgICAgIHBhdGg6IFtmaWVsZENvbmZpZy5rZXldXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGZpZWxkQ29uZmlnLmV4cHJlc3Npb25Qcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgICAgICd0ZW1wbGF0ZU9wdGlvbnMuZGlzYWJsZWQnOiAnZm9ybVN0YXRlLmRpc2FibGVkJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuZmllbGRzID0gW2NvbmZpZ107XG4gICAgICAgICAgdGhpcy5mb3JtID0gbmV3IEZvcm1Hcm91cCh7fSk7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVByb3ZpZGVyQ29uZmlndXJhdGlvbigpIHtcbiAgICBjb25zdCBtb2RlbFRvU2F2ZTogUHJvdmlkZXJQcm9wZXJ0aWVzID0gISF0aGlzLmJlZm9yZVNhdmVIb29rXG4gICAgICA/IGF3YWl0IHRoaXMuYmVmb3JlU2F2ZUhvb2sodGhpcy5tb2RlbCwgdGhpcy5maWVsZHMpXG4gICAgICA6IHRoaXMubW9kZWw7XG5cbiAgICBmb3JPd24obW9kZWxUb1NhdmUsICh2YWx1ZTogYW55LCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIG1vZGVsVG9TYXZlW2tleV0gPSB2YWx1ZS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gfHwgaXRlbSA9PT0gMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzOiBJUmVzdWx0PFByb3ZpZGVyUHJvcGVydGllcz4gPSBhd2FpdCB0aGlzLnByb3ZpZGVyQ29uZmlndXJhdGlvblNlcnZpY2UudXBkYXRlKFxuICAgICAgICBtb2RlbFRvU2F2ZVxuICAgICAgKTtcbiAgICAgIHRoaXMuY2hhbmdlUHJvdmlkZXIkLm5leHQobnVsbCk7XG4gICAgICB0aGlzLnVwZGF0ZWRDb25maWd1cmF0aW9uJC5uZXh0KHJlcy5kYXRhKTtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYXlvdXQuY29uZmlndXJhdGlvblVwZGF0ZWRTdWNjZXNzTXNnKTtcbiAgICAgIHRoaXMuZm9ybS5tYXJrQXNQcmlzdGluZSgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2UuYWRkU2VydmVyRmFpbHVyZShlcnIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVByb3ZpZGVyQ29uZmlndXJhdGlvbigpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5tb2RhbFNlcnZpY2UuY29uZmlybShcbiAgICAgICAgdGhpcy5sYXlvdXQuZGVsZXRlQ29uZmlndXJhdGlvbk1vZGFsVGl0bGUsXG4gICAgICAgIHRoaXMubGF5b3V0LmRlbGV0ZUNvbmZpZ3VyYXRpb25Nb2RhbEJvZHksXG4gICAgICAgIFN0YXR1cy5EQU5HRVIsXG4gICAgICAgIHtcbiAgICAgICAgICBvazogdGhpcy5sYXlvdXQuZGVsZXRlQ29uZmlndXJhdGlvbk1vZGFsT2tCdG5MYWJlbCxcbiAgICAgICAgICBjYW5jZWw6IHRoaXMubGF5b3V0LmRlbGV0ZUNvbmZpZ3VyYXRpb25Nb2RhbENhbmNlbEJ0bkxhYmVsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBhd2FpdCB0aGlzLnByb3ZpZGVyQ29uZmlndXJhdGlvblNlcnZpY2UuZGVsZXRlKCk7XG4gICAgICB0aGlzLnJlbG9hZCQubmV4dCgpO1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxheW91dC5jb25maWd1cmF0aW9uRGVsZXRlZFN1Y2Nlc3NNc2cpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVFbmNyeXB0ZWRWYWx1ZXMoY29uZmlndXJhdGlvbjogUHJvdmlkZXJQcm9wZXJ0aWVzKTogUHJvdmlkZXJQcm9wZXJ0aWVzIHtcbiAgICByZXR1cm4gbWFwVmFsdWVzKGNvbmZpZ3VyYXRpb24sIHZhbHVlID0+ICh2YWx1ZSA9PT0gJzw8RW5jcnlwdGVkPj4nID8gdW5kZWZpbmVkIDogdmFsdWUpKTtcbiAgfVxufVxuIl19