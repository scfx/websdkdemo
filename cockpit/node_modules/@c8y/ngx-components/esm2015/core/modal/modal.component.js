import { Component, Input, Optional, Output, EventEmitter, HostListener } from '@angular/core';
import { BsModalRef } from 'ngx-bootstrap/modal';
import { gettext } from '../i18n/gettext';
import { isEmpty } from 'lodash';
/**
 * C8y modal component.
 * ## Example:
 *
 * Creating custom modal:
 * ```typescript
 *  import { Component } from "@angular/core";
 *  import { Subject } from 'rxjs';
 *
 * @Component({
 *  selector: "my-modal",
 *  template: `
 *    <c8y-modal title="CustomTitle"
 *      (onClose)="onClose($event)"
 *      (onDismiss)="onDismiss($event)"
 *      [labels]="labels"
 *      [disabled]="true" <- will disable ok button
 *      >
 *        <span>I am body of modal</span>
 *        <span>For simple string use body="string"</span>
 *    </c8y-modal>`
 * })
 *
 * export class MyModalComponent {
 *
 *  closeSubject: Subject<boolean> = new Subject();
 *  labels : ModalLabels = {ok: "customOK", cancel: "customCancel"};
 *
 *  onDismiss(event){
 *    this.closeSubject.next(false);
 *  }
 *
 *  onClose(event) {
 *    this.closeSubject.next(true);
 *  }
 * }
 * ```
 * Showing modal:
 * ```typescript
 * import { BsModalService } from "ngx-bootstrap/modal";
 *
 * constructor(
 *  public bsModalService: BsModalService,
 * ) {}
 *
 * showModal() {
 *  const modalRef = this.bsModalService.show(MyModalComponent);
 *  modalRef.content.closeSubject.subscribe(result => {
 *    console.log('results:', result);
 *  });
 * }
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '../i18n/c8y-translate.pipe';

function ModalComponent_div_9_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 8);
    ɵngcc0.ɵɵlistener("click", function ModalComponent_div_9_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r3 = ɵngcc0.ɵɵnextContext(2); return ctx_r3._dismiss(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r1.labels.cancel));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, ctx_r1.labels.cancel), " ");
} }
function ModalComponent_div_9_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 9);
    ɵngcc0.ɵɵlistener("click", function ModalComponent_div_9_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5._close(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r2.labels.ok));
    ɵngcc0.ɵɵproperty("disabled", ctx_r2.disabled);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 5, ctx_r2.labels.ok), " ");
} }
function ModalComponent_div_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 5);
    ɵngcc0.ɵɵprojection(1, 2);
    ɵngcc0.ɵɵtemplate(2, ModalComponent_div_9_button_2_Template, 4, 6, "button", 6);
    ɵngcc0.ɵɵtemplate(3, ModalComponent_div_9_button_3_Template, 4, 7, "button", 7);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.labels.cancel);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.labels.ok);
} }
const _c0 = [[["", "c8y-modal-title", ""]], "*", [["", "c8y-modal-footer", ""]]];
const _c1 = ["[c8y-modal-title]", "*", "[c8y-modal-footer]"];
export class ModalComponent {
    constructor(modal) {
        this.modal = modal;
        this.onDismiss = new EventEmitter();
        this.onClose = new EventEmitter();
        this.disabled = false;
        this.customFooter = false;
        this._labels = { ok: gettext('OK'), cancel: gettext('Cancel') };
    }
    set labels({ ok, cancel }) {
        this._labels = { ok, cancel };
    }
    get labels() { return this._labels; }
    _dismiss() {
        let fn = this.dismiss;
        if (!fn && this.modal) {
            fn = () => this.modal.hide();
        }
        if (fn) {
            fn();
        }
        this.onDismiss.emit(true);
    }
    _close() {
        let fn = this.close;
        if (!fn && this.modal) {
            fn = () => this.modal.hide();
        }
        if (fn) {
            fn();
        }
        this.onClose.emit(true);
    }
    onEnterKeyDown(event) {
        const hasOnlyOneButton = isEmpty(this.labels.ok) !== isEmpty(this.labels.cancel);
        const isCancelClickable = !this.customFooter && this.labels.cancel;
        const isOkClickable = !this.customFooter && !this.disabled && this.labels.ok;
        if (hasOnlyOneButton && isCancelClickable) {
            this._dismiss();
        }
        if (hasOnlyOneButton && isOkClickable) {
            this._close();
        }
    }
}
ModalComponent.ɵfac = function ModalComponent_Factory(t) { return new (t || ModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalRef, 8)); };
ModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ModalComponent, selectors: [["c8y-modal"]], hostBindings: function ModalComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown.enter", function ModalComponent_keydown_enter_HostBindingHandler($event) { return ctx.onEnterKeyDown($event); }, false, ɵngcc0.ɵɵresolveDocument);
    } }, inputs: { disabled: "disabled", customFooter: "customFooter", labels: "labels", close: "close", dismiss: "dismiss", title: "title", body: "body" }, outputs: { onDismiss: "onDismiss", onClose: "onClose" }, ngContentSelectors: _c1, decls: 10, vars: 7, consts: [[1, "modal-header"], [3, "hidden"], [1, "modal-body"], [1, "text-center", "text-break-word", 3, "hidden"], ["class", "modal-footer", 4, "ngIf"], [1, "modal-footer"], ["class", "btn btn-default", 3, "title", "click", 4, "ngIf"], ["class", "btn btn-primary", 3, "title", "disabled", "click", 4, "ngIf"], [1, "btn", "btn-default", 3, "title", "click"], [1, "btn", "btn-primary", 3, "title", "disabled", "click"]], template: function ModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c0);
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵprojection(1);
        ɵngcc0.ɵɵelementStart(2, "h3", 1);
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "div", 2);
        ɵngcc0.ɵɵelementStart(6, "p", 3);
        ɵngcc0.ɵɵtext(7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵprojection(8, 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(9, ModalComponent_div_9_Template, 4, 2, "div", 4);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("hidden", !ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 5, ctx.title), " ");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("hidden", !ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.body, " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.customFooter);
    } }, directives: [ɵngcc2.NgIf], pipes: [ɵngcc3.C8yTranslatePipe], encapsulation: 2 });
ModalComponent.ctorParameters = () => [
    { type: BsModalRef, decorators: [{ type: Optional }] }
];
ModalComponent.propDecorators = {
    onDismiss: [{ type: Output }],
    onClose: [{ type: Output }],
    disabled: [{ type: Input }],
    close: [{ type: Input }],
    dismiss: [{ type: Input }],
    title: [{ type: Input }],
    body: [{ type: Input }],
    customFooter: [{ type: Input }],
    labels: [{ type: Input }],
    onEnterKeyDown: [{ type: HostListener, args: ['document:keydown.enter', ['$event'],] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ModalComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-modal',
                template: "<div class=\"modal-header\">\n  <ng-content select=\"[c8y-modal-title]\"></ng-content>\n  <h3 [hidden]=\"!title\">\n    {{ title | translate }}\n  </h3>\n</div>\n<div class=\"modal-body\">\n  <p [hidden]=\"!title\" class=\"text-center text-break-word\">\n    {{ body }}\n  </p>\n  <ng-content></ng-content>\n</div>\n<div\n  class=\"modal-footer\"\n  *ngIf=\"!customFooter\">\n  <ng-content select=\"[c8y-modal-footer]\"></ng-content>\n  <button\n    title=\"{{ labels.cancel | translate }}\"\n    *ngIf=\"labels.cancel\"\n    class=\"btn btn-default\"\n    (click)=\"_dismiss()\"\n  >\n    {{ labels.cancel | translate }}\n  </button>\n  <button\n    title=\"{{ labels.ok | translate }}\"\n    *ngIf=\"labels.ok\"\n    class=\"btn btn-primary\"\n    (click)=\"_close()\"\n    [disabled]=\"disabled\"\n  >\n    {{ labels.ok | translate }}\n  </button>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalRef, decorators: [{
                type: Optional
            }] }]; }, { onDismiss: [{
            type: Output
        }], onClose: [{
            type: Output
        }], disabled: [{
            type: Input
        }], customFooter: [{
            type: Input
        }], labels: [{
            type: Input
        }], onEnterKeyDown: [{
            type: HostListener,
            args: ['document:keydown.enter', ['$event']]
        }], close: [{
            type: Input
        }], dismiss: [{
            type: Input
        }], title: [{
            type: Input
        }], body: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL21vZGFsL21vZGFsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0YsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMxQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBR2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNSCxNQUFNLE9BQU8sY0FBYztBQUMzQixJQWdCRSxZQUFnQyxLQUFpQjtBQUFJLFFBQXJCLFVBQUssR0FBTCxLQUFLLENBQVk7QUFBQyxRQWhCeEMsY0FBUyxHQUEwQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ2xFLFFBQVksWUFBTyxHQUEwQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ2hFLFFBQVcsYUFBUSxHQUFHLEtBQUssQ0FBQztBQUM1QixRQUlXLGlCQUFZLEdBQVksS0FBSyxDQUFDO0FBQ3pDLFFBTVUsWUFBTyxHQUFp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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3B0aW9uYWwsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICduZ3gtYm9vdHN0cmFwL21vZGFsJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICcuLi9pMThuL2dldHRleHQnO1xuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBNb2RhbExhYmVscyB9IGZyb20gJy4uL3NlbGVjdC1tb2RhbC9zZWxlY3QtbW9kYWwubW9kZWwnO1xuXG4vKipcbiAqIEM4eSBtb2RhbCBjb21wb25lbnQuXG4gKiAjIyBFeGFtcGxlOlxuICpcbiAqIENyZWF0aW5nIGN1c3RvbSBtb2RhbDpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqICBpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuICogIGltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBAQ29tcG9uZW50KHtcbiAqICBzZWxlY3RvcjogXCJteS1tb2RhbFwiLFxuICogIHRlbXBsYXRlOiBgXG4gKiAgICA8Yzh5LW1vZGFsIHRpdGxlPVwiQ3VzdG9tVGl0bGVcIlxuICogICAgICAob25DbG9zZSk9XCJvbkNsb3NlKCRldmVudClcIlxuICogICAgICAob25EaXNtaXNzKT1cIm9uRGlzbWlzcygkZXZlbnQpXCJcbiAqICAgICAgW2xhYmVsc109XCJsYWJlbHNcIlxuICogICAgICBbZGlzYWJsZWRdPVwidHJ1ZVwiIDwtIHdpbGwgZGlzYWJsZSBvayBidXR0b25cbiAqICAgICAgPlxuICogICAgICAgIDxzcGFuPkkgYW0gYm9keSBvZiBtb2RhbDwvc3Bhbj5cbiAqICAgICAgICA8c3Bhbj5Gb3Igc2ltcGxlIHN0cmluZyB1c2UgYm9keT1cInN0cmluZ1wiPC9zcGFuPlxuICogICAgPC9jOHktbW9kYWw+YFxuICogfSlcbiAqXG4gKiBleHBvcnQgY2xhc3MgTXlNb2RhbENvbXBvbmVudCB7XG4gKlxuICogIGNsb3NlU3ViamVjdDogU3ViamVjdDxib29sZWFuPiA9IG5ldyBTdWJqZWN0KCk7XG4gKiAgbGFiZWxzIDogTW9kYWxMYWJlbHMgPSB7b2s6IFwiY3VzdG9tT0tcIiwgY2FuY2VsOiBcImN1c3RvbUNhbmNlbFwifTtcbiAqXG4gKiAgb25EaXNtaXNzKGV2ZW50KXtcbiAqICAgIHRoaXMuY2xvc2VTdWJqZWN0Lm5leHQoZmFsc2UpO1xuICogIH1cbiAqXG4gKiAgb25DbG9zZShldmVudCkge1xuICogICAgdGhpcy5jbG9zZVN1YmplY3QubmV4dCh0cnVlKTtcbiAqICB9XG4gKiB9XG4gKiBgYGBcbiAqIFNob3dpbmcgbW9kYWw6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gXCJuZ3gtYm9vdHN0cmFwL21vZGFsXCI7XG4gKlxuICogY29uc3RydWN0b3IoXG4gKiAgcHVibGljIGJzTW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAqICkge31cbiAqXG4gKiBzaG93TW9kYWwoKSB7XG4gKiAgY29uc3QgbW9kYWxSZWYgPSB0aGlzLmJzTW9kYWxTZXJ2aWNlLnNob3coTXlNb2RhbENvbXBvbmVudCk7XG4gKiAgbW9kYWxSZWYuY29udGVudC5jbG9zZVN1YmplY3Quc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gKiAgICBjb25zb2xlLmxvZygncmVzdWx0czonLCByZXN1bHQpO1xuICogIH0pO1xuICogfVxuICogYGBgXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1tb2RhbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9tb2RhbC5jb21wb25lbnQuaHRtbCcsXG59KVxuXG5leHBvcnQgY2xhc3MgTW9kYWxDb21wb25lbnQge1xuICBAT3V0cHV0KCkgb25EaXNtaXNzOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBvbkNsb3NlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIGNsb3NlOiAoKSA9PiB2b2lkO1xuICBASW5wdXQoKSBkaXNtaXNzOiAoKSA9PiB2b2lkO1xuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xuICBASW5wdXQoKSBib2R5OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGN1c3RvbUZvb3RlcjogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBzZXQgbGFiZWxzKHtvaywgY2FuY2VsfTogTW9kYWxMYWJlbHMpIHtcbiAgICB0aGlzLl9sYWJlbHMgPSB7b2sgLCBjYW5jZWx9O1xuICB9XG5cbiAgZ2V0IGxhYmVscygpOiBNb2RhbExhYmVscyB7IHJldHVybiB0aGlzLl9sYWJlbHM7IH1cblxuICBwcml2YXRlIF9sYWJlbHM6IE1vZGFsTGFiZWxzID0gIHsgb2s6IGdldHRleHQoJ09LJyksIGNhbmNlbDogZ2V0dGV4dCgnQ2FuY2VsJykgfTtcblxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcml2YXRlIG1vZGFsOiBCc01vZGFsUmVmKSB7fVxuXG4gIF9kaXNtaXNzKCkge1xuICAgIGxldCBmbiA9IHRoaXMuZGlzbWlzcztcbiAgICBpZiAoIWZuICYmIHRoaXMubW9kYWwpIHsgZm4gPSAoKSA9PiB0aGlzLm1vZGFsLmhpZGUoKTsgfVxuICAgIGlmIChmbikgeyBmbigpOyB9XG4gICAgdGhpcy5vbkRpc21pc3MuZW1pdCh0cnVlKTtcbiAgfVxuXG4gIF9jbG9zZSgpIHtcbiAgICBsZXQgZm4gPSB0aGlzLmNsb3NlO1xuICAgIGlmICghZm4gJiYgdGhpcy5tb2RhbCkgeyBmbiA9ICgpID0+IHRoaXMubW9kYWwuaGlkZSgpOyB9XG4gICAgaWYgKGZuKSB7IGZuKCk7IH1cbiAgICB0aGlzLm9uQ2xvc2UuZW1pdCh0cnVlKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmtleWRvd24uZW50ZXInLCBbJyRldmVudCddKSBvbkVudGVyS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGNvbnN0IGhhc09ubHlPbmVCdXR0b24gPSBpc0VtcHR5KHRoaXMubGFiZWxzLm9rKSAhPT0gaXNFbXB0eSh0aGlzLmxhYmVscy5jYW5jZWwpO1xuICAgIGNvbnN0IGlzQ2FuY2VsQ2xpY2thYmxlID0gIXRoaXMuY3VzdG9tRm9vdGVyICYmIHRoaXMubGFiZWxzLmNhbmNlbDtcbiAgICBjb25zdCBpc09rQ2xpY2thYmxlID0gIXRoaXMuY3VzdG9tRm9vdGVyICYmICF0aGlzLmRpc2FibGVkICYmIHRoaXMubGFiZWxzLm9rO1xuICAgIGlmIChoYXNPbmx5T25lQnV0dG9uICAmJiBpc0NhbmNlbENsaWNrYWJsZSkge1xuICAgICAgdGhpcy5fZGlzbWlzcygpO1xuICAgIH1cbiAgICBpZiAoaGFzT25seU9uZUJ1dHRvbiAgJiYgaXNPa0NsaWNrYWJsZSkge1xuICAgICAgdGhpcy5fY2xvc2UoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==