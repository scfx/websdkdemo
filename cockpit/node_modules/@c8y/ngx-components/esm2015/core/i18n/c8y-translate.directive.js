import { TranslateDirective, TranslateService } from '@ngx-translate/core';
import { ChangeDetectorRef, Directive, ElementRef, EventEmitter } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@ngx-translate/core';
export class C8yTranslateDirective extends TranslateDirective {
    constructor(translateService, element, _ref) {
        super(translateService, element, _ref);
        /**
         * Used to trigger events when html is replaced by directive.
         */
        this.htmlUpdateEvent = new EventEmitter();
    }
    /**
     * Used to get private element property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _elementRef() {
        return this.element;
    }
    /**
     * Used to get private translateService property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _translateService() {
        return this.translateService;
    }
    /**
     * Overridden method from original directive.
     * For simple text nodes, it just invokes the base method.
     * For complex nodes, it builds translation key from whole inner HTML
     * and replaces it with its translation.
     * This prevents splitting HTML into pieces and attempting to translate each one separately
     * which doesn't work, because we extract strings in whole.
     */
    checkNodes(forceUpdate = false, translations) {
        if (!this.htmlMode && (this.isElementSimpleTextType() || this.isElementInnerHtmlEmpty())) {
            /**
             * If element does not contain complex html, then fallBack to default logic.
             */
            super.checkNodes(forceUpdate, translations);
        }
        else {
            this.htmlMode = true;
            if (this.isLookupKeyMissing()) {
                this._elementRef.nativeElement.lookupKey = this.getLookupKey();
            }
            if (this.lookupKeyExist()) {
                const newTranslation = this.getNewTranslation();
                if (!this.lastTranslation || this.lastTranslation !== newTranslation) {
                    this.lastTranslation = newTranslation;
                    this.updateHtmlContent();
                    this.htmlUpdateEvent.emit();
                }
            }
        }
    }
    ngOnDestroy() {
        this.htmlUpdateEvent.complete();
        super.ngOnDestroy();
    }
    /**
     * Builds lookup key from innerHTML, removes comments (that might be added by Angular) and trims it.
     */
    getLookupKey() {
        return this._elementRef.nativeElement.innerHTML.replace(/<!--.*?-->/gs, '').trim();
    }
    isElementSimpleTextType() {
        return this._elementRef.nativeElement.childNodes.length === 1 && this._elementRef.nativeElement.childNodes[0].nodeType === 3;
    }
    isElementInnerHtmlEmpty() {
        return !this._elementRef.nativeElement.innerHTML;
    }
    isLookupKeyMissing() {
        return !this._elementRef.nativeElement.lookupKey;
    }
    lookupKeyExist() {
        return this._elementRef.nativeElement.lookupKey;
    }
    getNewTranslation() {
        return this._translateService.instant(this._elementRef.nativeElement.lookupKey, this.currentParams || {});
    }
    updateHtmlContent() {
        this._elementRef.nativeElement.innerHTML = this.lastTranslation;
    }
}
C8yTranslateDirective.ɵfac = function C8yTranslateDirective_Factory(t) { return new (t || C8yTranslateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TranslateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
C8yTranslateDirective.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: C8yTranslateDirective, selectors: [["", "translate", ""], ["", "ngx-translate", ""]], features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
C8yTranslateDirective.ctorParameters = () => [
    { type: TranslateService },
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(C8yTranslateDirective, [{
        type: Directive,
        args: [{
                selector: '[translate],[ngx-translate]'
            }]
    }], function () { return [{ type: ɵngcc1.TranslateService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.ChangeDetectorRef }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzh5LXRyYW5zbGF0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvaTE4bi9jOHktdHJhbnNsYXRlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMzRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7OztBQUt2RixNQUFNLE9BQU8scUJBQXNCLFNBQVEsa0JBQWtCO0FBQzdELElBK0JFLFlBQ0UsZ0JBQWtDLEVBQ2xDLE9BQW1CLEVBQ25CLElBQXVCO0FBQzNCLFFBQUksS0FBSyxDQUFDLGdCQUFnQixFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQyxRQXRCRTtBQUNGO0FBRUEsV0FESztBQUNMLFFBQUUsb0JBQWUsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztBQUNqRSxJQWtCRSxDQUFDO0FBQ0gsSUFyQ0U7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLElBQVksV0FBVztBQUFLLFFBQzFCLE9BQVEsSUFBWSxDQUFDLE9BQU8sQ0FBQztBQUNqQyxJQUFFLENBQUM7QUFDSCxJQUNFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBRSxJQUFZLGlCQUFpQjtBQUFLLFFBQ2hDLE9BQVEsSUFBWSxDQUFDLGdCQUFnQixDQUFDO0FBQzFDLElBQUUsQ0FBQztBQUNILElBeUJFO0FBQ0Y7QUFDRTtBQUNFO0FBQ0U7QUFDRTtBQUNFO0FBRUosT0FERDtBQUNMLElBQUUsVUFBVSxDQUFDLFdBQVcsR0FBRyxLQUFLLEVBQUUsWUFBa0I7QUFDcEQsUUFBSSxJQUNFLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxJQUFJLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLEVBQ3BGO0FBQ04s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aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3RyYW5zbGF0ZV0sW25neC10cmFuc2xhdGVdJ1xufSlcbmV4cG9ydCBjbGFzcyBDOHlUcmFuc2xhdGVEaXJlY3RpdmUgZXh0ZW5kcyBUcmFuc2xhdGVEaXJlY3RpdmUge1xuICAvKipcbiAgICogVXNlZCB0byBnZXQgcHJpdmF0ZSBlbGVtZW50IHByb3BlcnR5IGZyb20gVHJhbnNsYXRlRGlyZWN0aXZlLCBzbyBpdCBkb2Vzbid0IHRocm93IHRzRXJyb3JzXG4gICAqL1xuICBwcml2YXRlIGdldCBfZWxlbWVudFJlZigpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gKHRoaXMgYXMgYW55KS5lbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gZ2V0IHByaXZhdGUgdHJhbnNsYXRlU2VydmljZSBwcm9wZXJ0eSBmcm9tIFRyYW5zbGF0ZURpcmVjdGl2ZSwgc28gaXQgZG9lc24ndCB0aHJvdyB0c0Vycm9yc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXQgX3RyYW5zbGF0ZVNlcnZpY2UoKTogVHJhbnNsYXRlU2VydmljZSB7XG4gICAgcmV0dXJuICh0aGlzIGFzIGFueSkudHJhbnNsYXRlU2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIHRvIHRyaWdnZXIgZXZlbnRzIHdoZW4gaHRtbCBpcyByZXBsYWNlZCBieSBkaXJlY3RpdmUuXG4gICAqL1xuICBodG1sVXBkYXRlRXZlbnQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogV2hlbiB0aGlzIGRpcmVjdGl2ZSBzdWNjZXNzZnVsbHkgdHJhbnNsYXRlcyBub2RlLCBpdCBzdG9yZXMgaXRzIHZhbHVlIGluIHRoaXMgcHJvcGVydHkuXG4gICAqIEFub3RoZXIgdHJhbnNsYXRpb24gd2lsbCBiZSBwZXJmb3JtZWQgb25seSBpZiBuZXcgdHJhbnNsYXRpb24gdmFsdWUgZGlmZmVycyBmcm9tIHN0b3JlZCBvbmUuXG4gICAqL1xuICBsYXN0VHJhbnNsYXRpb246IHN0cmluZztcblxuICAvKipcbiAgICogV2hlbiB0aGlzIGRpcmVjdGl2ZSBlbmNvdW50ZXJzIGVsZW1lbnQgdGhhdCBpcyBIVE1MLCBpdCBzaG91bGQgc3dpdGNoIHRvIEh0bWwgbW9kZSBldmVuIGlmXG4gICAqIG5ldyB0cmFuc2xhdGVkIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBhbnkgSFRNTC5cbiAgICovXG4gIGh0bWxNb2RlOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHRyYW5zbGF0ZVNlcnZpY2U6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBfcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKHRyYW5zbGF0ZVNlcnZpY2UsIGVsZW1lbnQsIF9yZWYpO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRkZW4gbWV0aG9kIGZyb20gb3JpZ2luYWwgZGlyZWN0aXZlLlxuICAgKiBGb3Igc2ltcGxlIHRleHQgbm9kZXMsIGl0IGp1c3QgaW52b2tlcyB0aGUgYmFzZSBtZXRob2QuXG4gICAqIEZvciBjb21wbGV4IG5vZGVzLCBpdCBidWlsZHMgdHJhbnNsYXRpb24ga2V5IGZyb20gd2hvbGUgaW5uZXIgSFRNTFxuICAgKiBhbmQgcmVwbGFjZXMgaXQgd2l0aCBpdHMgdHJhbnNsYXRpb24uXG4gICAqIFRoaXMgcHJldmVudHMgc3BsaXR0aW5nIEhUTUwgaW50byBwaWVjZXMgYW5kIGF0dGVtcHRpbmcgdG8gdHJhbnNsYXRlIGVhY2ggb25lIHNlcGFyYXRlbHlcbiAgICogd2hpY2ggZG9lc24ndCB3b3JrLCBiZWNhdXNlIHdlIGV4dHJhY3Qgc3RyaW5ncyBpbiB3aG9sZS5cbiAgICovXG4gIGNoZWNrTm9kZXMoZm9yY2VVcGRhdGUgPSBmYWxzZSwgdHJhbnNsYXRpb25zPzogYW55KSB7XG4gICAgaWYgKFxuICAgICAgIXRoaXMuaHRtbE1vZGUgJiYgKHRoaXMuaXNFbGVtZW50U2ltcGxlVGV4dFR5cGUoKSB8fCB0aGlzLmlzRWxlbWVudElubmVySHRtbEVtcHR5KCkpXG4gICAgKSB7XG4gICAgICAvKipcbiAgICAgICAqIElmIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBjb21wbGV4IGh0bWwsIHRoZW4gZmFsbEJhY2sgdG8gZGVmYXVsdCBsb2dpYy5cbiAgICAgICAqL1xuICAgICAgc3VwZXIuY2hlY2tOb2Rlcyhmb3JjZVVwZGF0ZSwgdHJhbnNsYXRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5odG1sTW9kZSA9IHRydWU7XG4gICAgICBpZiAodGhpcy5pc0xvb2t1cEtleU1pc3NpbmcoKSkge1xuICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQubG9va3VwS2V5ID0gdGhpcy5nZXRMb29rdXBLZXkoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmxvb2t1cEtleUV4aXN0KCkpIHtcbiAgICAgICAgY29uc3QgbmV3VHJhbnNsYXRpb24gPSB0aGlzLmdldE5ld1RyYW5zbGF0aW9uKCk7XG4gICAgICAgIGlmICghdGhpcy5sYXN0VHJhbnNsYXRpb24gfHwgdGhpcy5sYXN0VHJhbnNsYXRpb24gIT09IG5ld1RyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgdGhpcy5sYXN0VHJhbnNsYXRpb24gPSBuZXdUcmFuc2xhdGlvbjtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUh0bWxDb250ZW50KCk7XG4gICAgICAgICAgdGhpcy5odG1sVXBkYXRlRXZlbnQuZW1pdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5odG1sVXBkYXRlRXZlbnQuY29tcGxldGUoKTtcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBsb29rdXAga2V5IGZyb20gaW5uZXJIVE1MLCByZW1vdmVzIGNvbW1lbnRzICh0aGF0IG1pZ2h0IGJlIGFkZGVkIGJ5IEFuZ3VsYXIpIGFuZCB0cmltcyBpdC5cbiAgICovXG4gIHByaXZhdGUgZ2V0TG9va3VwS2V5KCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MLnJlcGxhY2UoLzwhLS0uKj8tLT4vZ3MsICcnKS50cmltKCk7XG4gIH1cblxuICBwcml2YXRlIGlzRWxlbWVudFNpbXBsZVRleHRUeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEgJiYgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgPT09IDM7XG4gIH1cblxuICBwcml2YXRlIGlzRWxlbWVudElubmVySHRtbEVtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmlubmVySFRNTDtcbiAgfVxuXG4gIHByaXZhdGUgaXNMb29rdXBLZXlNaXNzaW5nKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxvb2t1cEtleTtcbiAgfVxuXG4gIHByaXZhdGUgbG9va3VwS2V5RXhpc3QoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5sb29rdXBLZXk7XG4gIH1cblxuICBwcml2YXRlIGdldE5ld1RyYW5zbGF0aW9uKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3RyYW5zbGF0ZVNlcnZpY2UuaW5zdGFudChcbiAgICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5sb29rdXBLZXksXG4gICAgICB0aGlzLmN1cnJlbnRQYXJhbXMgfHwge31cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVIdG1sQ29udGVudCgpOiB2b2lkIHtcbiAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5sYXN0VHJhbnNsYXRpb247XG4gIH1cbn1cbiJdfQ==