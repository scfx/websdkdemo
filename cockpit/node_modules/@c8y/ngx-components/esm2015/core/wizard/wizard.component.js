import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { BsModalRef } from 'ngx-bootstrap/modal';
import { filter } from 'rxjs/operators';
import { WizardService } from './wizard.service';
/**
 * A generic component that is intended to serve as the building block of more wizards.
 *
 * **Example**
 * ```html
 * <button
 *    title="Add application"
 *    class="btn btn-primary"
 *    (click)="addApplication()"
 *  >
 *    Add application
 *  </button>
 * ```
 *
 * ```ts
 * import { Component } from '@angular/core';
 * import { WizardConfig, WizardService, Wizard } from '@c8y/ngx-components';
 * import { ModalOptions } from 'ngx-bootstrap/modal';
 *
 * @Component({
 *  selector: 'c8y-add-application-wizard',
 *  templateUrl: './templatePath'
 * })
 * export class AddApplicationWizardComponent {
 *   constructor(private wizardService: WizardService) {}
 *
 *   addApplication() {
 *     const wizardConfig: WizardConfig = {
 *       headerText: 'Add Application',
 *       headerIcon: 'c8y-icon-modules',
 *       bodyHeaderText: 'Select methods',
 *       bodyHeaderIcon: 'c8y-icon-modules'
 *     };
 *
 *     const initialState: Wizard = {
 *       wizardConfig,
 *       id: 'uploadApplication'
 *     };
 *
 *     const modalOptions: ModalOptions = { initialState };
 *
 *     this.wizardService.show(modalOptions);
 *   }
 * }
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './wizard.service';
import * as ɵngcc2 from 'ngx-bootstrap/modal';

const _c0 = ["headerRef"];
const _c1 = ["bodyRef"];
const _c2 = ["footerRef"];
function WizardComponent_1_ng_template_0_Template(rf, ctx) { }
function WizardComponent_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WizardComponent_1_ng_template_0_Template, 0, 0, "ng-template");
} }
function WizardComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 6);
    ɵngcc0.ɵɵelement(1, "h1", 7);
    ɵngcc0.ɵɵelementStart(2, "h4");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r2.wizardConfig.headerIcon);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 2, ctx_r2.wizardConfig.headerText));
} }
function WizardComponent_5_ng_template_0_Template(rf, ctx) { }
function WizardComponent_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WizardComponent_5_ng_template_0_Template, 0, 0, "ng-template");
} }
function WizardComponent_ng_template_7_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵelementStart(1, "div", 10);
    ɵngcc0.ɵɵelement(2, "i", 7);
    ɵngcc0.ɵɵelementStart(3, "span");
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r11 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r11.wizardConfig.bodyHeaderIcon);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 2, ctx_r11.wizardConfig.bodyHeaderText));
} }
function WizardComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WizardComponent_ng_template_7_div_0_Template, 6, 4, "div", 8);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.wizardConfig.bodyHeaderText);
} }
function WizardComponent_10_ng_template_0_Template(rf, ctx) { }
function WizardComponent_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WizardComponent_10_ng_template_0_Template, 0, 0, "ng-template");
} }
function WizardComponent_ng_template_12_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 11);
    ɵngcc0.ɵɵelementStart(1, "button", 12);
    ɵngcc0.ɵɵlistener("click", function WizardComponent_ng_template_12_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.close(); });
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementStart(3, "span", 13);
    ɵngcc0.ɵɵtext(4, "Cancel");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(2, 1, "Cancel"));
} }
export class WizardComponent {
    constructor(wizardService, bsModalRef) {
        this.wizardService = wizardService;
        this.bsModalRef = bsModalRef;
        /**
         * A configuration object that allows you to set header values, both text and icon.
         */
        this.wizardConfig = {};
        /**
         * The event that is emitted when the wizard is closed.
         */
        this.onClose = new EventEmitter();
        /**
         * The event that is emitted when the wizard is reseted.
         */
        this.onReset = new EventEmitter();
        /**
         * The event that is emitted when the wizard entry is clicked.
         */
        this.onSelect = new EventEmitter();
        this.headerTemplate$ = this.wizardService.headerTemplate$.pipe(filter(header => header.wizardId === this.id));
        this.bodyTemplate$ = this.wizardService.bodyTemplate$.pipe(filter(body => body.wizardId === this.id));
        this.footerTemplate$ = this.wizardService.footerTemplate$.pipe(filter(footer => footer.wizardId === this.id));
    }
    ngOnInit() {
        this.emitTemplates();
    }
    /**
     * Resets the wizard.
     * @param result Custom result object which will be emitted via onReset output.
     */
    reset(result) {
        this.onReset.emit(result);
        this.emitTemplates();
    }
    /**
     * Closes the wizard.
     * @param result Custom result object which will be emitted via onClose output.
     */
    close(result) {
        this.onClose.emit(result);
        this.bsModalRef.hide();
    }
    emitTemplates() {
        setTimeout(() => {
            this.wizardService.headerTemplate$.next({ template: this.header, wizardId: this.id });
            this.wizardService.bodyTemplate$.next({ template: this.body, wizardId: this.id });
            this.wizardService.footerTemplate$.next({ template: this.footer, wizardId: this.id });
        });
    }
}
WizardComponent.ɵfac = function WizardComponent_Factory(t) { return new (t || WizardComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.WizardService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.BsModalRef)); };
WizardComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WizardComponent, selectors: [["c8y-wizard"]], viewQuery: function WizardComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 7);
        ɵngcc0.ɵɵviewQuery(_c1, 7);
        ɵngcc0.ɵɵviewQuery(_c2, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.header = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.body = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.footer = _t.first);
    } }, inputs: { wizardConfig: "wizardConfig", id: "id" }, outputs: { onClose: "onClose", onReset: "onReset", onSelect: "onSelect" }, decls: 14, vars: 9, consts: [[1, "viewport-modal", "animated", "fadeIn"], [4, "ngTemplateOutlet"], ["headerRef", ""], ["bodyRef", ""], [3, "onSelect"], ["footerRef", ""], [1, "modal-header", "dialog-header", "animated", "fadeIn"], [3, "c8yIcon"], ["class", "p-16 p-t-8 text-center", 4, "ngIf"], [1, "p-16", "p-t-8", "text-center"], [1, "c8y-wizard-nav"], [1, "modal-footer", "animated", "fadeIn"], ["type", "button", 1, "btn", "btn-default", 3, "title", "click"], ["translate", ""]], template: function WizardComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, WizardComponent_1_Template, 1, 0, undefined, 1);
        ɵngcc0.ɵɵpipe(2, "async");
        ɵngcc0.ɵɵtemplate(3, WizardComponent_ng_template_3_Template, 5, 4, "ng-template", null, 2, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵtemplate(5, WizardComponent_5_Template, 1, 0, undefined, 1);
        ɵngcc0.ɵɵpipe(6, "async");
        ɵngcc0.ɵɵtemplate(7, WizardComponent_ng_template_7_Template, 1, 1, "ng-template", null, 3, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementStart(9, "c8y-wizard-outlet", 4);
        ɵngcc0.ɵɵlistener("onSelect", function WizardComponent_Template_c8y_wizard_outlet_onSelect_9_listener($event) { return ctx.onSelect.emit($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(10, WizardComponent_10_Template, 1, 0, undefined, 1);
        ɵngcc0.ɵɵpipe(11, "async");
        ɵngcc0.ɵɵtemplate(12, WizardComponent_ng_template_12_Template, 5, 3, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        let tmp_0_0;
        let tmp_1_0;
        let tmp_2_0;
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", (tmp_0_0 = ɵngcc0.ɵɵpipeBind1(2, 3, ctx.headerTemplate$)) == null ? null : tmp_0_0.template);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", (tmp_1_0 = ɵngcc0.ɵɵpipeBind1(6, 5, ctx.bodyTemplate$)) == null ? null : tmp_1_0.template);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", (tmp_2_0 = ɵngcc0.ɵɵpipeBind1(11, 7, ctx.footerTemplate$)) == null ? null : tmp_2_0.template);
    } }, encapsulation: 2 });
WizardComponent.ctorParameters = () => [
    { type: WizardService },
    { type: BsModalRef }
];
WizardComponent.propDecorators = {
    header: [{ type: ViewChild, args: ['headerRef', { static: true },] }],
    body: [{ type: ViewChild, args: ['bodyRef', { static: true },] }],
    footer: [{ type: ViewChild, args: ['footerRef', { static: true },] }],
    id: [{ type: Input }],
    wizardConfig: [{ type: Input }],
    onClose: [{ type: Output }],
    onReset: [{ type: Output }],
    onSelect: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WizardComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-wizard',
                template: "<div class=\"viewport-modal animated fadeIn\">\n  <ng-template *ngTemplateOutlet=\"(headerTemplate$ | async)?.template\"></ng-template>\n\n  <ng-template #headerRef>\n    <div class=\"modal-header dialog-header animated fadeIn\">\n      <h1 [c8yIcon]=\"wizardConfig.headerIcon\"></h1>\n      <h4>{{ wizardConfig.headerText | translate }}</h4>\n    </div>\n  </ng-template>\n\n  <ng-template *ngTemplateOutlet=\"(bodyTemplate$ | async)?.template\"></ng-template>\n\n  <ng-template #bodyRef>\n    <div class=\"p-16 p-t-8 text-center\" *ngIf=\"wizardConfig.bodyHeaderText\">\n      <div class=\"c8y-wizard-nav\">\n        <i [c8yIcon]=\"wizardConfig.bodyHeaderIcon\"></i>\n        <span>{{ wizardConfig.bodyHeaderText | translate }}</span>\n      </div>\n    </div>\n  </ng-template>\n  <c8y-wizard-outlet (onSelect)=\"onSelect.emit($event)\"></c8y-wizard-outlet>\n\n  <ng-template *ngTemplateOutlet=\"(footerTemplate$ | async)?.template\"></ng-template>\n  <ng-template #footerRef>\n    <div class=\"modal-footer animated fadeIn\">\n      <button\n        (click)=\"close()\"\n        type=\"button\"\n        class=\"btn btn-default\"\n        title=\"{{ 'Cancel' | translate }}\"\n      >\n        <span translate>Cancel</span>\n      </button>\n    </div>\n  </ng-template>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.WizardService }, { type: ɵngcc2.BsModalRef }]; }, { wizardConfig: [{
            type: Input
        }], onClose: [{
            type: Output
        }], onReset: [{
            type: Output
        }], onSelect: [{
            type: Output
        }], header: [{
            type: ViewChild,
            args: ['headerRef', { static: true }]
        }], body: [{
            type: ViewChild,
            args: ['bodyRef', { static: true }]
        }], footer: [{
            type: ViewChild,
            args: ['footerRef', { static: true }]
        }], id: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS93aXphcmQvd2l6YXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUVOLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXhDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTUgsTUFBTSxPQUFPLGVBQWU7QUFBRyxJQW1DN0IsWUFBbUIsYUFBNEIsRUFBUyxVQUFzQjtBQUFJLFFBQS9ELGtCQUFhLEdBQWIsYUFBYSxDQUFlO0FBQUMsUUFBUSxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUExQi9FO0FBQ0Y7QUFFQSxXQURLO0FBQ0wsUUFBVyxpQkFBWSxHQUFpQixFQUFFLENBQUM7QUFDM0MsUUFBRTtBQUNGO0FBRUEsV0FESztBQUNMLFFBQVksWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQzVELFFBQUU7QUFDRjtB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QU07QUFBSyxzQkFJWCxNQUFNO0FBQUssdUJBSVgsTUFBTTtBQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICduZ3gtYm9vdHN0cmFwL21vZGFsJztcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFdpemFyZCwgV2l6YXJkQ29uZmlnLCBXaXphcmRFbnRyeSB9IGZyb20gJy4vd2l6YXJkLm1vZGVsJztcbmltcG9ydCB7IFdpemFyZFNlcnZpY2UgfSBmcm9tICcuL3dpemFyZC5zZXJ2aWNlJztcblxuLyoqXG4gKiBBIGdlbmVyaWMgY29tcG9uZW50IHRoYXQgaXMgaW50ZW5kZWQgdG8gc2VydmUgYXMgdGhlIGJ1aWxkaW5nIGJsb2NrIG9mIG1vcmUgd2l6YXJkcy5cbiAqXG4gKiAqKkV4YW1wbGUqKlxuICogYGBgaHRtbFxuICogPGJ1dHRvblxuICogICAgdGl0bGU9XCJBZGQgYXBwbGljYXRpb25cIlxuICogICAgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIlxuICogICAgKGNsaWNrKT1cImFkZEFwcGxpY2F0aW9uKClcIlxuICogID5cbiAqICAgIEFkZCBhcHBsaWNhdGlvblxuICogIDwvYnV0dG9uPlxuICogYGBgXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuICogaW1wb3J0IHsgV2l6YXJkQ29uZmlnLCBXaXphcmRTZXJ2aWNlLCBXaXphcmQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbiAqIGltcG9ydCB7IE1vZGFsT3B0aW9ucyB9IGZyb20gJ25neC1ib290c3RyYXAvbW9kYWwnO1xuICpcbiAqIEBDb21wb25lbnQoe1xuICogIHNlbGVjdG9yOiAnYzh5LWFkZC1hcHBsaWNhdGlvbi13aXphcmQnLFxuICogIHRlbXBsYXRlVXJsOiAnLi90ZW1wbGF0ZVBhdGgnXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFkZEFwcGxpY2F0aW9uV2l6YXJkQ29tcG9uZW50IHtcbiAqICAgY29uc3RydWN0b3IocHJpdmF0ZSB3aXphcmRTZXJ2aWNlOiBXaXphcmRTZXJ2aWNlKSB7fVxuICpcbiAqICAgYWRkQXBwbGljYXRpb24oKSB7XG4gKiAgICAgY29uc3Qgd2l6YXJkQ29uZmlnOiBXaXphcmRDb25maWcgPSB7XG4gKiAgICAgICBoZWFkZXJUZXh0OiAnQWRkIEFwcGxpY2F0aW9uJyxcbiAqICAgICAgIGhlYWRlckljb246ICdjOHktaWNvbi1tb2R1bGVzJyxcbiAqICAgICAgIGJvZHlIZWFkZXJUZXh0OiAnU2VsZWN0IG1ldGhvZHMnLFxuICogICAgICAgYm9keUhlYWRlckljb246ICdjOHktaWNvbi1tb2R1bGVzJ1xuICogICAgIH07XG4gKlxuICogICAgIGNvbnN0IGluaXRpYWxTdGF0ZTogV2l6YXJkID0ge1xuICogICAgICAgd2l6YXJkQ29uZmlnLFxuICogICAgICAgaWQ6ICd1cGxvYWRBcHBsaWNhdGlvbidcbiAqICAgICB9O1xuICpcbiAqICAgICBjb25zdCBtb2RhbE9wdGlvbnM6IE1vZGFsT3B0aW9ucyA9IHsgaW5pdGlhbFN0YXRlIH07XG4gKlxuICogICAgIHRoaXMud2l6YXJkU2VydmljZS5zaG93KG1vZGFsT3B0aW9ucyk7XG4gKiAgIH1cbiAqIH1cbiAqIGBgYFxuICovXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS13aXphcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vd2l6YXJkLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBXaXphcmRDb21wb25lbnQgaW1wbGVtZW50cyBXaXphcmQsIE9uSW5pdCB7XG4gIEBWaWV3Q2hpbGQoJ2hlYWRlclJlZicsIHsgc3RhdGljOiB0cnVlIH0pIGhlYWRlcjogVGVtcGxhdGVSZWY8YW55PjtcbiAgQFZpZXdDaGlsZCgnYm9keVJlZicsIHsgc3RhdGljOiB0cnVlIH0pIGJvZHk6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBWaWV3Q2hpbGQoJ2Zvb3RlclJlZicsIHsgc3RhdGljOiB0cnVlIH0pIGZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcbiAgLyoqXG4gICAqIFRoZSBpZCBwYXJhbWV0ZXIgaWRlbnRpZmllcyB0aGUgcGFydGljdWxhciB3aXphcmQgYW5kIGNhbiBiZSB1c2VkIHRvIHJlZmVyIHRvIGl0IHdoZW4gaG9va2luZyB3aXphcmQgZW50cmllcy5cbiAgICogRXhhbXBsZTogXCJ3aXphcmRJZFwiLlxuICAgKi9cbiAgQElucHV0KCkgaWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIEEgY29uZmlndXJhdGlvbiBvYmplY3QgdGhhdCBhbGxvd3MgeW91IHRvIHNldCBoZWFkZXIgdmFsdWVzLCBib3RoIHRleHQgYW5kIGljb24uXG4gICAqL1xuICBASW5wdXQoKSB3aXphcmRDb25maWc6IFdpemFyZENvbmZpZyA9IHt9O1xuICAvKipcbiAgICogVGhlIGV2ZW50IHRoYXQgaXMgZW1pdHRlZCB3aGVuIHRoZSB3aXphcmQgaXMgY2xvc2VkLlxuICAgKi9cbiAgQE91dHB1dCgpIG9uQ2xvc2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogVGhlIGV2ZW50IHRoYXQgaXMgZW1pdHRlZCB3aGVuIHRoZSB3aXphcmQgaXMgcmVzZXRlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBvblJlc2V0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgLyoqXG4gICAqIFRoZSBldmVudCB0aGF0IGlzIGVtaXR0ZWQgd2hlbiB0aGUgd2l6YXJkIGVudHJ5IGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25TZWxlY3Q6IEV2ZW50RW1pdHRlcjxXaXphcmRFbnRyeT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHJlYWRvbmx5IGhlYWRlclRlbXBsYXRlJCA9IHRoaXMud2l6YXJkU2VydmljZS5oZWFkZXJUZW1wbGF0ZSQucGlwZShcbiAgICBmaWx0ZXIoaGVhZGVyID0+IGhlYWRlci53aXphcmRJZCA9PT0gdGhpcy5pZClcbiAgKTtcbiAgcmVhZG9ubHkgYm9keVRlbXBsYXRlJCA9IHRoaXMud2l6YXJkU2VydmljZS5ib2R5VGVtcGxhdGUkLnBpcGUoXG4gICAgZmlsdGVyKGJvZHkgPT4gYm9keS53aXphcmRJZCA9PT0gdGhpcy5pZClcbiAgKTtcbiAgcmVhZG9ubHkgZm9vdGVyVGVtcGxhdGUkID0gdGhpcy53aXphcmRTZXJ2aWNlLmZvb3RlclRlbXBsYXRlJC5waXBlKFxuICAgIGZpbHRlcihmb290ZXIgPT4gZm9vdGVyLndpemFyZElkID09PSB0aGlzLmlkKVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB3aXphcmRTZXJ2aWNlOiBXaXphcmRTZXJ2aWNlLCBwdWJsaWMgYnNNb2RhbFJlZjogQnNNb2RhbFJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmVtaXRUZW1wbGF0ZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldHMgdGhlIHdpemFyZC5cbiAgICogQHBhcmFtIHJlc3VsdCBDdXN0b20gcmVzdWx0IG9iamVjdCB3aGljaCB3aWxsIGJlIGVtaXR0ZWQgdmlhIG9uUmVzZXQgb3V0cHV0LlxuICAgKi9cbiAgcmVzZXQocmVzdWx0PzogYW55KSB7XG4gICAgdGhpcy5vblJlc2V0LmVtaXQocmVzdWx0KTtcbiAgICB0aGlzLmVtaXRUZW1wbGF0ZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIHdpemFyZC5cbiAgICogQHBhcmFtIHJlc3VsdCBDdXN0b20gcmVzdWx0IG9iamVjdCB3aGljaCB3aWxsIGJlIGVtaXR0ZWQgdmlhIG9uQ2xvc2Ugb3V0cHV0LlxuICAgKi9cbiAgY2xvc2UocmVzdWx0PzogYW55KSB7XG4gICAgdGhpcy5vbkNsb3NlLmVtaXQocmVzdWx0KTtcbiAgICB0aGlzLmJzTW9kYWxSZWYuaGlkZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0VGVtcGxhdGVzKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy53aXphcmRTZXJ2aWNlLmhlYWRlclRlbXBsYXRlJC5uZXh0KHsgdGVtcGxhdGU6IHRoaXMuaGVhZGVyLCB3aXphcmRJZDogdGhpcy5pZCB9KTtcbiAgICAgIHRoaXMud2l6YXJkU2VydmljZS5ib2R5VGVtcGxhdGUkLm5leHQoeyB0ZW1wbGF0ZTogdGhpcy5ib2R5LCB3aXphcmRJZDogdGhpcy5pZCB9KTtcbiAgICAgIHRoaXMud2l6YXJkU2VydmljZS5mb290ZXJUZW1wbGF0ZSQubmV4dCh7IHRlbXBsYXRlOiB0aGlzLmZvb3Rlciwgd2l6YXJkSWQ6IHRoaXMuaWQgfSk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==