import { Component, ComponentFactoryResolver, EventEmitter, Host, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { Router } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WizardComponent } from '../wizard.component';
import { WizardService } from '../wizard.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../wizard.component';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from '../wizard.service';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '../../common/icon.directive';
import * as ɵngcc6 from '../../i18n/c8y-translate.pipe';

const _c0 = ["container"];
function WizardOutletComponent_div_1_div_1_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 8);
    ɵngcc0.ɵɵlistener("click", function WizardOutletComponent_div_1_div_1_button_1_Template_button_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r8); const entry_r6 = restoredCtx.$implicit; const ctx_r7 = ɵngcc0.ɵɵnextContext(3); return ctx_r7.handleEntry(entry_r6); });
    ɵngcc0.ɵɵelementStart(1, "div", 9);
    ɵngcc0.ɵɵelement(2, "i", 10);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 11);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const entry_r6 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", entry_r6.c8yIcon || "cogs");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(4, 3, entry_r6.name));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 5, entry_r6.name), " ");
} }
function WizardOutletComponent_div_1_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 6);
    ɵngcc0.ɵɵtemplate(1, WizardOutletComponent_div_1_div_1_button_1_Template, 7, 7, "button", 7);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r2.entries);
} }
function WizardOutletComponent_div_1_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵelementStart(1, "p");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "No options available."));
} }
function WizardOutletComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵtemplate(1, WizardOutletComponent_div_1_div_1_Template, 2, 1, "div", 4);
    ɵngcc0.ɵɵtemplate(2, WizardOutletComponent_div_1_ng_template_2_Template, 4, 3, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r3 = ɵngcc0.ɵɵreference(3);
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.entries.length > 0)("ngIfElse", _r3);
} }
export class WizardOutletComponent {
    constructor(wizardComponent, router, c8yWizardService, resolver) {
        this.wizardComponent = wizardComponent;
        this.router = router;
        this.c8yWizardService = c8yWizardService;
        this.resolver = resolver;
        /**
         * The event that is emitted when the wizard entry is clicked.
         */
        this.onSelect = new EventEmitter();
        /**
         * List of wizard entries.
         */
        this.entries = [];
        /**
         * @ignore
         */
        this.showList = true;
        /**
         * @ignore
         */
        this.destroy$ = new Subject();
    }
    ngAfterViewInit() {
        this.c8yWizardService
            .getEntriesListById(this.wizardComponent.id)
            .pipe(takeUntil(this.destroy$))
            .subscribe((entries) => {
            this.container.clear();
            this.entries = entries;
            this.onEntriesLoaded();
        });
        this.wizardComponent.onReset.pipe(takeUntil(this.destroy$)).subscribe(() => {
            if (this.componentInstance) {
                this.componentInstance = undefined;
                this.container.clear();
                this.showList = true;
            }
        });
    }
    /**
     * Handles the wizard entry, if the entry contains a path, the user will be redirected to it.
     * Otherwise, an attempt will be made to create a dynamic component provided in the entry.
     * @param entry Wizard menu entry.
     */
    handleEntry(entry = {}) {
        const { path, component } = entry;
        if (path) {
            this.handlePath(path);
            return;
        }
        if (component) {
            this.handleComponent(component);
            this.onSelect.emit(entry);
        }
    }
    ngOnDestroy() {
        if (this.componentInstance) {
            this.container.clear();
        }
        this.destroy$.next(true);
        this.destroy$.unsubscribe();
    }
    onEntriesLoaded() {
        const [firstEntry] = this.entries;
        const isSingleEntry = this.entries.length === 1;
        const shouldRedirectToPath = firstEntry && !!firstEntry.path;
        const shouldOmitListOfEntries = isSingleEntry && !shouldRedirectToPath;
        if (shouldOmitListOfEntries) {
            this.handleEntry(firstEntry);
        }
    }
    handlePath(path) {
        this.router.navigateByUrl(path);
        if (this.wizardComponent) {
            this.wizardComponent.close();
        }
    }
    handleComponent(component) {
        this.showList = false;
        const factory = this.resolver.resolveComponentFactory(component);
        this.componentInstance = this.container.createComponent(factory);
    }
}
WizardOutletComponent.ɵfac = function WizardOutletComponent_Factory(t) { return new (t || WizardOutletComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.WizardComponent, 1), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.WizardService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver)); };
WizardOutletComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WizardOutletComponent, selectors: [["c8y-wizard-outlet"]], viewQuery: function WizardOutletComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 5, ViewContainerRef);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.container = _t.first);
    } }, outputs: { onSelect: "onSelect" }, decls: 4, vars: 2, consts: [["class", "modal-inner-scroll animated fadeIn", 4, "ngIf"], [3, "hidden"], ["container", ""], [1, "modal-inner-scroll", "animated", "fadeIn"], ["class", "list-group list-group-links", 4, "ngIf", "ngIfElse"], ["emptyState", ""], [1, "list-group", "list-group-links"], ["type", "button", "class", "list-group-item d-flex a-i-center p-t-8 p-b-8", 3, "click", 4, "ngFor", "ngForOf"], ["type", "button", 1, "list-group-item", "d-flex", "a-i-center", "p-t-8", "p-b-8", 3, "click"], [1, "list-item-icon"], [3, "c8yIcon"], [1, "list-item-body", "text-truncate", 3, "title"], [1, "c8y-empty-state"]], template: function WizardOutletComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementContainerStart(0);
        ɵngcc0.ɵɵtemplate(1, WizardOutletComponent_div_1_Template, 4, 2, "div", 0);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelement(2, "template", 1, 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showList);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("hidden", ctx.showList);
    } }, directives: [ɵngcc4.NgIf, ɵngcc4.NgForOf, ɵngcc5.IconDirective], pipes: [ɵngcc6.C8yTranslatePipe], encapsulation: 2 });
WizardOutletComponent.ctorParameters = () => [
    { type: WizardComponent, decorators: [{ type: Host }] },
    { type: Router },
    { type: WizardService },
    { type: ComponentFactoryResolver }
];
WizardOutletComponent.propDecorators = {
    container: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    onSelect: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WizardOutletComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-wizard-outlet',
                template: "<ng-container>\n  <div class=\"modal-inner-scroll animated fadeIn\" *ngIf=\"showList\">\n    <div class=\"list-group list-group-links\" *ngIf=\"entries.length > 0; else emptyState\">\n      <button\n        *ngFor=\"let entry of entries\"\n        type=\"button\"\n        class=\"list-group-item d-flex a-i-center p-t-8 p-b-8\"\n        (click)=\"handleEntry(entry)\"\n      >\n        <div class=\"list-item-icon\">\n          <i [c8yIcon]=\"entry.c8yIcon || 'cogs'\"></i>\n        </div>\n        <div title=\"{{ entry.name | translate }}\" class=\"list-item-body text-truncate\">\n          {{ entry.name | translate }}\n        </div>\n      </button>\n    </div>\n\n    <ng-template #emptyState>\n      <div class=\"c8y-empty-state\">\n        <p>{{ 'No options available.' | translate }}</p>\n      </div>\n    </ng-template>\n  </div>\n</ng-container>\n<template #container [hidden]=\"showList\"></template>\n"
            }]
    }], function () { return [{ type: ɵngcc1.WizardComponent, decorators: [{
                type: Host
            }] }, { type: ɵngcc2.Router }, { type: ɵngcc3.WizardService }, { type: ɵngcc0.ComponentFactoryResolver }]; }, { onSelect: [{
            type: Output
        }], container: [{
            type: ViewChild,
            args: ['container', { read: ViewContainerRef }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLW91dGxldC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvcmUvd2l6YXJkL3dpemFyZC1vdXRsZXQvd2l6YXJkLW91dGxldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCx3QkFBd0IsRUFDeEIsWUFBWSxFQUNaLElBQUksRUFFSixNQUFNLEVBQ04sU0FBUyxFQUNULGdCQUFnQixFQUNqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXRELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTWxELE1BQU0sT0FBTyxxQkFBcUI7QUFBRyxJQXNCbkMsWUFDa0IsZUFBZ0MsRUFDeEMsTUFBYyxFQUNkLGdCQUErQixFQUMvQixRQUFrQztBQUMzQyxRQUppQixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFBQyxRQUN6QyxXQUFNLEdBQU4sTUFBTSxDQUFRO0FBQUMsUUFDZixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWU7QUFBQyxRQUNoQyxhQUFRLEdBQVIsUUFBUSxDQUEwQjtBQUM5QyxRQXpCRTtBQUNGO0FBRUEsV0FESztBQUNMLFFBQVksYUFBUSxHQUE4QixJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ3JFLFFBQUU7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUFFLFlBQU8sR0FBa0IsRUFBRSxDQUFDO0FBQzlCLFFBQUU7QUFDRjtBQUVBLFdBREs7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QUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3BDLFFBQ0ksSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO0FBQzlCLFlBQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUNuQyxTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0gsSUFDVSxlQUFlLENBQUMsU0FBYztBQUN4QyxRQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0FBQzFCLFFBQUksTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNyRSxRQUFJLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNyRSxJQUFFLENBQUM7QUFDSDtpREF0R0MsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSxtQkFBbUIsa0JBQzdCOzs7Ozs7cVdBQTZDLGNBQzlDOzs7Ozs7Ozs7O2dJQUNJO0FBQUM7QUFBK0MsWUFSNUMsZUFBZSx1QkErQm5CLElBQUk7QUFBTyxZQWxDUCxNQUFNO0FBQUksWUFLVixhQUFhO0FBQUksWUFieEIsd0JBQXdCO0FBQ3pCO0FBQUc7QUFHSSx3QkFnQkwsU0FBUyxTQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTtBQUFPLHVCQUl4RCxNQUFNO0FBQUk7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFdpemFyZENvbXBvbmVudCB9IGZyb20gJy4uL3dpemFyZC5jb21wb25lbnQnO1xuaW1wb3J0IHsgV2l6YXJkRW50cnkgfSBmcm9tICcuLi93aXphcmQubW9kZWwnO1xuaW1wb3J0IHsgV2l6YXJkU2VydmljZSB9IGZyb20gJy4uL3dpemFyZC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXdpemFyZC1vdXRsZXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vd2l6YXJkLW91dGxldC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgV2l6YXJkT3V0bGV0Q29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIGNvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcbiAgLyoqXG4gICAqIFRoZSBldmVudCB0aGF0IGlzIGVtaXR0ZWQgd2hlbiB0aGUgd2l6YXJkIGVudHJ5IGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25TZWxlY3Q6IEV2ZW50RW1pdHRlcjxXaXphcmRFbnRyeT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIC8qKlxuICAgKiBMaXN0IG9mIHdpemFyZCBlbnRyaWVzLlxuICAgKi9cbiAgZW50cmllczogV2l6YXJkRW50cnlbXSA9IFtdO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgc2hvd0xpc3Q6IGJvb2xlYW4gPSB0cnVlO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgcHJpdmF0ZSBkZXN0cm95JDogU3ViamVjdDxib29sZWFuPiA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBwcml2YXRlIGNvbXBvbmVudEluc3RhbmNlOiBhbnk7XG4gIGNvbnN0cnVjdG9yKFxuICAgIEBIb3N0KCkgcHJpdmF0ZSB3aXphcmRDb21wb25lbnQ6IFdpemFyZENvbXBvbmVudCxcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgYzh5V2l6YXJkU2VydmljZTogV2l6YXJkU2VydmljZSxcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmM4eVdpemFyZFNlcnZpY2VcbiAgICAgIC5nZXRFbnRyaWVzTGlzdEJ5SWQodGhpcy53aXphcmRDb21wb25lbnQuaWQpXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChlbnRyaWVzOiBXaXphcmRFbnRyeVtdKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZW50cmllcyA9IGVudHJpZXM7XG4gICAgICAgIHRoaXMub25FbnRyaWVzTG9hZGVkKCk7XG4gICAgICB9KTtcblxuICAgIHRoaXMud2l6YXJkQ29tcG9uZW50Lm9uUmVzZXQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5jb21wb25lbnRJbnN0YW5jZSkge1xuICAgICAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGVhcigpO1xuICAgICAgICB0aGlzLnNob3dMaXN0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSB3aXphcmQgZW50cnksIGlmIHRoZSBlbnRyeSBjb250YWlucyBhIHBhdGgsIHRoZSB1c2VyIHdpbGwgYmUgcmVkaXJlY3RlZCB0byBpdC5cbiAgICogT3RoZXJ3aXNlLCBhbiBhdHRlbXB0IHdpbGwgYmUgbWFkZSB0byBjcmVhdGUgYSBkeW5hbWljIGNvbXBvbmVudCBwcm92aWRlZCBpbiB0aGUgZW50cnkuXG4gICAqIEBwYXJhbSBlbnRyeSBXaXphcmQgbWVudSBlbnRyeS5cbiAgICovXG4gIGhhbmRsZUVudHJ5KGVudHJ5OiBXaXphcmRFbnRyeSA9IHt9IGFzIFdpemFyZEVudHJ5KSB7XG4gICAgY29uc3QgeyBwYXRoLCBjb21wb25lbnQgfSA9IGVudHJ5O1xuICAgIGlmIChwYXRoKSB7XG4gICAgICB0aGlzLmhhbmRsZVBhdGgocGF0aCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbXBvbmVudCkge1xuICAgICAgdGhpcy5oYW5kbGVDb21wb25lbnQoY29tcG9uZW50KTtcbiAgICAgIHRoaXMub25TZWxlY3QuZW1pdChlbnRyeSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50SW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyLmNsZWFyKCk7XG4gICAgfVxuICAgIHRoaXMuZGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICB0aGlzLmRlc3Ryb3kkLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIG9uRW50cmllc0xvYWRlZCgpIHtcbiAgICBjb25zdCBbZmlyc3RFbnRyeV0gPSB0aGlzLmVudHJpZXM7XG4gICAgY29uc3QgaXNTaW5nbGVFbnRyeSA9IHRoaXMuZW50cmllcy5sZW5ndGggPT09IDE7XG4gICAgY29uc3Qgc2hvdWxkUmVkaXJlY3RUb1BhdGggPSBmaXJzdEVudHJ5ICYmICEhZmlyc3RFbnRyeS5wYXRoO1xuICAgIGNvbnN0IHNob3VsZE9taXRMaXN0T2ZFbnRyaWVzID0gaXNTaW5nbGVFbnRyeSAmJiAhc2hvdWxkUmVkaXJlY3RUb1BhdGg7XG5cbiAgICBpZiAoc2hvdWxkT21pdExpc3RPZkVudHJpZXMpIHtcbiAgICAgIHRoaXMuaGFuZGxlRW50cnkoZmlyc3RFbnRyeSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVQYXRoKHBhdGg6IHN0cmluZykge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwocGF0aCk7XG5cbiAgICBpZiAodGhpcy53aXphcmRDb21wb25lbnQpIHtcbiAgICAgIHRoaXMud2l6YXJkQ29tcG9uZW50LmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVDb21wb25lbnQoY29tcG9uZW50OiBhbnkpIHtcbiAgICB0aGlzLnNob3dMaXN0ID0gZmFsc2U7XG4gICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50KTtcbiAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlID0gdGhpcy5jb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnkpO1xuICB9XG59XG4iXX0=