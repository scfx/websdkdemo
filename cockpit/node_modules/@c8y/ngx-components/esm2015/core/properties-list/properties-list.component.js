import { Component, Input } from '@angular/core';
import { sortBy, get } from 'lodash-es';
/**
 * Renders a list of properties of an object.
 *
 * @example
 * ```html
 * <c8y-properties-list
 *   icon="info"
 *   [properties]="properties"
 *   [values]="options"
 *   [emptyLabel]="'-'"
 *   [title]="'Application properties' | translate"
 * ></c8y-properties-list>
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '../common/icon.directive';
import * as ɵngcc3 from '../i18n/c8y-translate.pipe';

function PropertiesListComponent_i_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "i", 5);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("c8yIcon", ctx_r0.icon);
} }
function PropertiesListComponent_li_6_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 12);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const prop_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(prop_r2.value);
} }
function PropertiesListComponent_li_6_a_6_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "a", 13);
    ɵngcc0.ɵɵlistener("click", function PropertiesListComponent_li_6_a_6_Template_a_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const prop_r2 = ɵngcc0.ɵɵnextContext().$implicit; return prop_r2.action($event, prop_r2); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const prop_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(prop_r2.value);
} }
const _c0 = function (a0) { return { pointer: a0 }; };
function PropertiesListComponent_li_6_span_7_span_1_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "span", 15);
    ɵngcc0.ɵɵlistener("click", function PropertiesListComponent_li_6_span_7_span_1_Template_span_click_0_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r16); const propTag_r13 = restoredCtx.$implicit; const prop_r2 = ɵngcc0.ɵɵnextContext(2).$implicit; return prop_r2.action && prop_r2.action($event, propTag_r13); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const propTag_r13 = ctx.$implicit;
    const prop_r2 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(2, _c0, prop_r2.action));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(propTag_r13);
} }
function PropertiesListComponent_li_6_span_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtemplate(1, PropertiesListComponent_li_6_span_7_span_1_Template, 2, 4, "span", 14);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const prop_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", prop_r2.value);
} }
const _c1 = function (a0, a1) { return { "separator-top-bottom": a0, "separator-bottom": a1 }; };
const _c2 = function (a0, a1, a2, a3, a4) { return { "m-l-16": a0, legend: a1, "form-block": a2, "m-b-0": a3, "m-t-4": a4 }; };
function PropertiesListComponent_li_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 6);
    ɵngcc0.ɵɵelementStart(1, "div", 7);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "span", 8);
    ɵngcc0.ɵɵtemplate(5, PropertiesListComponent_li_6_span_5_Template, 2, 1, "span", 9);
    ɵngcc0.ɵɵtemplate(6, PropertiesListComponent_li_6_a_6_Template, 2, 1, "a", 10);
    ɵngcc0.ɵɵtemplate(7, PropertiesListComponent_li_6_span_7_Template, 2, 1, "span", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const prop_r2 = ctx.$implicit;
    const i_r3 = ctx.index;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(9, _c1, i_r3 === 0, i_r3 > 0));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction5(12, _c2, ctx_r1.hasGroup(prop_r2), prop_r2.type === "group", prop_r2.type === "group", prop_r2.type === "group", prop_r2.type === "group"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 7, prop_r2.label), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngSwitch", prop_r2.type);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngSwitchCase", "string");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngSwitchCase", "link");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngSwitchCase", "array");
} }
export class PropertiesListComponent {
    constructor() {
        /**
         * A string array of groups that are shown. If noParse is set to false,
         * each complex key will form a group.
         */
        this.groups = [];
        /**
         * The component tries to parse the properties and resolve keys and types. You can
         * avoid this by setting this property to true.
         */
        this.noParse = false;
        this._data = {};
    }
    /**
     * The properties that this list should display.
     */
    set properties(items) {
        this._properties = this.parseProperties(items);
    }
    /**
     * @ignore
     */
    get properties() {
        if (this.noParse) {
            return this._properties;
        }
        const propsWithGroups = [
            ...this._properties,
            ...this.groups.map(group => ({
                key: group,
                label: group,
                value: group,
                type: 'group'
            }))
        ].filter(item => !!item.value);
        return sortBy(propsWithGroups, ['key']);
    }
    /**
     * An object where the properties keys are resolved from.
     */
    set data(data) {
        this._data = data;
        this._properties = this.parseProperties(this._properties);
    }
    /**
     * Checks if a certain property has an group associated.
     * @param item The property to verify.
     */
    hasGroup(item) {
        if (!item.key) {
            return false;
        }
        const keyPath = item.key.split('.');
        return keyPath.length > 1 && this.groups.includes(keyPath[0]);
    }
    /**
     * @ignore
     */
    ngOnInit() {
        this._properties = this.parseProperties(this._properties);
    }
    /**
     * Used in trackBy to avoid recalculation all the time.
     * @ignore
     */
    identity(index, item) {
        return item.value;
    }
    parseProperties(items = []) {
        return items.map(item => this.parsePropertyItem(item));
    }
    parsePropertyItem(item) {
        if (this.noParse) {
            return item;
        }
        item.value = this.resolveValueFromKey(item);
        item.value = item.transform && item.value ? item.transform(item.value) : item.value;
        item.type = this.resolveType(item);
        item.value = this.attachEmptyLabel(item);
        return item;
    }
    resolveValueFromKey(item) {
        if (item.key && this._data) {
            const keyPath = item.key.split('.');
            const rootGroup = keyPath[0];
            if (keyPath.length > 1 && !this.groups.includes(rootGroup)) {
                this.groups.push(rootGroup);
            }
            return get(this._data, item.key);
        }
        return item.value;
    }
    resolveType(item) {
        return Array.isArray(item.value) ? 'array' : item.action && item.value ? 'link' : 'string';
    }
    attachEmptyLabel(item) {
        if (!item.value) {
            return this.emptyLabel;
        }
        return item.value;
    }
}
PropertiesListComponent.ɵfac = function PropertiesListComponent_Factory(t) { return new (t || PropertiesListComponent)(); };
PropertiesListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: PropertiesListComponent, selectors: [["c8y-properties-list"]], inputs: { groups: "groups", noParse: "noParse", properties: "properties", data: "data", title: "title", icon: "icon", emptyLabel: "emptyLabel" }, decls: 7, vars: 6, consts: [[1, "m-b-8"], ["class", "text-info m-r-8", 3, "c8yIcon", 4, "ngIf"], [1, "text-label-small"], [1, "list-unstyled", "small"], ["class", "p-t-4 p-b-4 d-flex", 3, "ngClass", 4, "ngFor", "ngForOf", "ngForTrackBy"], [1, "text-info", "m-r-8", 3, "c8yIcon"], [1, "p-t-4", "p-b-4", "d-flex", 3, "ngClass"], [1, "small", "text-medium", "text-nowrap", "m-r-4", 3, "ngClass"], [1, "flex-item-right", 3, "ngSwitch"], ["class", "flex-item-right", 4, "ngSwitchCase"], ["class", "flex-item-right pointer text-truncate m-l-4", 3, "click", 4, "ngSwitchCase"], [4, "ngSwitchCase"], [1, "flex-item-right"], [1, "flex-item-right", "pointer", "text-truncate", "m-l-4", 3, "click"], ["class", "label label-default m-l-4", 3, "ngClass", "click", 4, "ngFor", "ngForOf"], [1, "label", "label-default", "m-l-4", 3, "ngClass", "click"]], template: function PropertiesListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "p", 0);
        ɵngcc0.ɵɵtemplate(1, PropertiesListComponent_i_1_Template, 1, 1, "i", 1);
        ɵngcc0.ɵɵelementStart(2, "span", 2);
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "ul", 3);
        ɵngcc0.ɵɵtemplate(6, PropertiesListComponent_li_6_Template, 8, 18, "li", 4);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.icon);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 4, ctx.title));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.properties)("ngForTrackBy", ctx.identity);
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgForOf, ɵngcc2.IconDirective, ɵngcc1.NgClass, ɵngcc1.NgSwitch, ɵngcc1.NgSwitchCase], pipes: [ɵngcc3.C8yTranslatePipe], encapsulation: 2 });
PropertiesListComponent.propDecorators = {
    properties: [{ type: Input }],
    title: [{ type: Input }],
    icon: [{ type: Input }],
    data: [{ type: Input }],
    groups: [{ type: Input }],
    noParse: [{ type: Input }],
    emptyLabel: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PropertiesListComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-properties-list',
                template: "<p class=\"m-b-8\">\n  <i *ngIf=\"icon\" [c8yIcon]=\"icon\" class=\"text-info m-r-8\"></i>\n  <span class=\"text-label-small\">{{ title | translate }}</span>\n</p>\n<ul class=\"list-unstyled small\">\n  <li class=\"p-t-4 p-b-4 d-flex\" \n    *ngFor=\"let prop of properties; let i = index; trackBy: identity\"\n    [ngClass]=\"{'separator-top-bottom': i === 0, 'separator-bottom': i > 0}\"\n    >\n    <div\n      [ngClass]=\"{\n        'm-l-16': hasGroup(prop),\n        legend: prop.type === 'group',\n        'form-block': prop.type === 'group',\n        'm-b-0': prop.type === 'group',\n        'm-t-4': prop.type === 'group'\n      }\"\n      class=\"small text-medium text-nowrap m-r-4\"\n    >\n      {{ prop.label | translate }}\n    </div>\n    <span [ngSwitch]=\"prop.type\" class=\"flex-item-right\">\n      <span *ngSwitchCase=\"'string'\" class=\"flex-item-right\">{{ prop.value }}</span>\n      <a\n        *ngSwitchCase=\"'link'\"\n        (click)=\"prop.action($event, prop)\"\n        class=\"flex-item-right pointer text-truncate m-l-4\"\n        >{{ prop.value }}</a\n      >\n      <span *ngSwitchCase=\"'array'\">\n        <span\n          class=\"label label-default m-l-4\"\n          *ngFor=\"let propTag of prop.value\"\n          (click)=\"prop.action && prop.action($event, propTag)\"\n          [ngClass]=\"{\n            pointer: prop.action\n          }\"\n          >{{ propTag }}</span\n        >\n      </span>\n    </span>\n  </li>\n</ul>\n"
            }]
    }], function () { return []; }, { groups: [{
            type: Input
        }], noParse: [{
            type: Input
        }], properties: [{
            type: Input
        }], data: [{
            type: Input
        }], title: [{
            type: Input
        }], icon: [{
            type: Input
        }], emptyLabel: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydGllcy1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS9wcm9wZXJ0aWVzLWxpc3QvcHJvcGVydGllcy1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUd4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUtILE1BQU0sT0FBTyx1QkFBdUI7QUFDcEMsSUFMQTtBQUNHLFFBcUREO0FBQ0Y7QUFDTTtBQUVBLFdBREQ7QUFDTCxRQUNFLFdBQU0sR0FBYSxFQUFFLENBQUM7QUFDeEIsUUFDRTtBQUNGO0FBQ007QUFFQSxXQUREO0FBQ0wsUUFDRSxZQUFPLEdBQVksS0FBSyxDQUFDO0FBQzNCLFFBU1UsVUFBSyxHQUFHLEVBQUUsQ0FBQztBQUNyQixJQWtFQSxDQUFDO0FBQ0QsSUEzSUU7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLElBQ0ksVUFBVSxDQUFDLEtBQTJCO0FBQzVDLFFBQUksSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ25ELElBQUUsQ0FBQztBQUNILElBQ0U7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLElBQUksVUFBVTtBQUFLLFFBQ2pCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtBQUN0QixZQUFNLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztBQUM5QixTQUFLO0FBQ0wsUUFBSSxNQUFNLGVB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QVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUscUJBQXFCO1dBQy9COzs7Ozs7OzZCQUErQztZQUNoRDs7Ozs7Ozs7OztzTEFDSTtBQUFDO0FBRUYseUJBRUQsS0FBSztBQUNOLG9CQTJCQyxLQUFLO0FBQ04sbUJBS0MsS0FBSztBQUNOLG1CQUtDLEtBQUs7QUFDTixxQkFTQyxLQUFLO0FBQ04sc0JBTUMsS0FBSztBQUNOLHlCQU1DLEtBQUs7QUFDUDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBzb3J0QnksIGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBQcm9wZXJ0aWVzTGlzdEl0ZW0gfSBmcm9tICcuL3Byb3BlcnRpZXMtbGlzdC5tb2RlbCc7XG5cbi8qKlxuICogUmVuZGVycyBhIGxpc3Qgb2YgcHJvcGVydGllcyBvZiBhbiBvYmplY3QuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDxjOHktcHJvcGVydGllcy1saXN0XG4gKiAgIGljb249XCJpbmZvXCJcbiAqICAgW3Byb3BlcnRpZXNdPVwicHJvcGVydGllc1wiXG4gKiAgIFt2YWx1ZXNdPVwib3B0aW9uc1wiXG4gKiAgIFtlbXB0eUxhYmVsXT1cIictJ1wiXG4gKiAgIFt0aXRsZV09XCInQXBwbGljYXRpb24gcHJvcGVydGllcycgfCB0cmFuc2xhdGVcIlxuICogPjwvYzh5LXByb3BlcnRpZXMtbGlzdD5cbiAqIGBgYFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktcHJvcGVydGllcy1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb3BlcnRpZXMtbGlzdC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUHJvcGVydGllc0xpc3RDb21wb25lbnQge1xuICAvKipcbiAgICogVGhlIHByb3BlcnRpZXMgdGhhdCB0aGlzIGxpc3Qgc2hvdWxkIGRpc3BsYXkuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgcHJvcGVydGllcyhpdGVtczogUHJvcGVydGllc0xpc3RJdGVtW10pIHtcbiAgICB0aGlzLl9wcm9wZXJ0aWVzID0gdGhpcy5wYXJzZVByb3BlcnRpZXMoaXRlbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIGdldCBwcm9wZXJ0aWVzKCk6IFByb3BlcnRpZXNMaXN0SXRlbVtdIHtcbiAgICBpZiAodGhpcy5ub1BhcnNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcHJvcGVydGllcztcbiAgICB9XG4gICAgY29uc3QgcHJvcHNXaXRoR3JvdXBzID0gW1xuICAgICAgLi4udGhpcy5fcHJvcGVydGllcyxcbiAgICAgIC4uLnRoaXMuZ3JvdXBzLm1hcChncm91cCA9PiAoe1xuICAgICAgICBrZXk6IGdyb3VwLFxuICAgICAgICBsYWJlbDogZ3JvdXAsXG4gICAgICAgIHZhbHVlOiBncm91cCxcbiAgICAgICAgdHlwZTogJ2dyb3VwJ1xuICAgICAgfSkpXG4gICAgXS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0udmFsdWUpO1xuXG4gICAgcmV0dXJuIHNvcnRCeShwcm9wc1dpdGhHcm91cHMsIFsna2V5J10pO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgdGl0bGUgZm9yIHRoZSBsaXN0LlxuICAgKi9cbiAgQElucHV0KClcbiAgdGl0bGU6IHN0cmluZztcblxuICAvKipcbiAgICogQW4gaWNvbiB3aGljaCBpcyBkaXNwbGF5ZWQgbmV4dCB0byB0aGUgdGl0bGUuXG4gICAqL1xuICBASW5wdXQoKVxuICBpY29uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCB3aGVyZSB0aGUgcHJvcGVydGllcyBrZXlzIGFyZSByZXNvbHZlZCBmcm9tLlxuICAgKi9cbiAgQElucHV0KClcbiAgc2V0IGRhdGEoZGF0YToge30pIHtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICB0aGlzLl9wcm9wZXJ0aWVzID0gdGhpcy5wYXJzZVByb3BlcnRpZXModGhpcy5fcHJvcGVydGllcyk7XG4gIH1cblxuICAvKipcbiAgICogQSBzdHJpbmcgYXJyYXkgb2YgZ3JvdXBzIHRoYXQgYXJlIHNob3duLiBJZiBub1BhcnNlIGlzIHNldCB0byBmYWxzZSxcbiAgICogZWFjaCBjb21wbGV4IGtleSB3aWxsIGZvcm0gYSBncm91cC5cbiAgICovXG4gIEBJbnB1dCgpXG4gIGdyb3Vwczogc3RyaW5nW10gPSBbXTtcblxuICAvKipcbiAgICogVGhlIGNvbXBvbmVudCB0cmllcyB0byBwYXJzZSB0aGUgcHJvcGVydGllcyBhbmQgcmVzb2x2ZSBrZXlzIGFuZCB0eXBlcy4gWW91IGNhblxuICAgKiBhdm9pZCB0aGlzIGJ5IHNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byB0cnVlLlxuICAgKi9cbiAgQElucHV0KClcbiAgbm9QYXJzZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTZXQgdGhpcyBsYWJlbCB0byBkaXNwbGF5IGFsbCBwcm9wZXJ0aWVzIGJ1dCB0aGUgZW1wdHkgb25lc1xuICAgKiBnZXQgdGhlIGBlbXB0eUxhYmVsYCBhc3NpZ25lZC5cbiAgICovXG4gIEBJbnB1dCgpXG4gIGVtcHR5TGFiZWw6IHN0cmluZztcblxuICBwcml2YXRlIF9wcm9wZXJ0aWVzOiBQcm9wZXJ0aWVzTGlzdEl0ZW1bXTtcbiAgcHJpdmF0ZSBfZGF0YSA9IHt9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYSBjZXJ0YWluIHByb3BlcnR5IGhhcyBhbiBncm91cCBhc3NvY2lhdGVkLlxuICAgKiBAcGFyYW0gaXRlbSBUaGUgcHJvcGVydHkgdG8gdmVyaWZ5LlxuICAgKi9cbiAgaGFzR3JvdXAoaXRlbTogUHJvcGVydGllc0xpc3RJdGVtKSB7XG4gICAgaWYgKCFpdGVtLmtleSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBrZXlQYXRoID0gaXRlbS5rZXkuc3BsaXQoJy4nKTtcbiAgICByZXR1cm4ga2V5UGF0aC5sZW5ndGggPiAxICYmIHRoaXMuZ3JvdXBzLmluY2x1ZGVzKGtleVBhdGhbMF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuX3Byb3BlcnRpZXMgPSB0aGlzLnBhcnNlUHJvcGVydGllcyh0aGlzLl9wcm9wZXJ0aWVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIGluIHRyYWNrQnkgdG8gYXZvaWQgcmVjYWxjdWxhdGlvbiBhbGwgdGhlIHRpbWUuXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIGlkZW50aXR5KGluZGV4LCBpdGVtKSB7XG4gICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gIH1cblxuICBwcml2YXRlIHBhcnNlUHJvcGVydGllcyhpdGVtczogUHJvcGVydGllc0xpc3RJdGVtW10gPSBbXSkge1xuICAgIHJldHVybiBpdGVtcy5tYXAoaXRlbSA9PiB0aGlzLnBhcnNlUHJvcGVydHlJdGVtKGl0ZW0pKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VQcm9wZXJ0eUl0ZW0oaXRlbTogUHJvcGVydGllc0xpc3RJdGVtKTogUHJvcGVydGllc0xpc3RJdGVtIHtcbiAgICBpZiAodGhpcy5ub1BhcnNlKSB7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG5cbiAgICBpdGVtLnZhbHVlID0gdGhpcy5yZXNvbHZlVmFsdWVGcm9tS2V5KGl0ZW0pO1xuICAgIGl0ZW0udmFsdWUgPSBpdGVtLnRyYW5zZm9ybSAmJiBpdGVtLnZhbHVlID8gaXRlbS50cmFuc2Zvcm0oaXRlbS52YWx1ZSkgOiBpdGVtLnZhbHVlO1xuICAgIGl0ZW0udHlwZSA9IHRoaXMucmVzb2x2ZVR5cGUoaXRlbSk7XG4gICAgaXRlbS52YWx1ZSA9IHRoaXMuYXR0YWNoRW1wdHlMYWJlbChpdGVtKTtcbiAgICByZXR1cm4gaXRlbTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZVZhbHVlRnJvbUtleShpdGVtOiBQcm9wZXJ0aWVzTGlzdEl0ZW0pIHtcbiAgICBpZiAoaXRlbS5rZXkgJiYgdGhpcy5fZGF0YSkge1xuICAgICAgY29uc3Qga2V5UGF0aCA9IGl0ZW0ua2V5LnNwbGl0KCcuJyk7XG4gICAgICBjb25zdCByb290R3JvdXAgPSBrZXlQYXRoWzBdO1xuICAgICAgaWYgKGtleVBhdGgubGVuZ3RoID4gMSAmJiAhdGhpcy5ncm91cHMuaW5jbHVkZXMocm9vdEdyb3VwKSkge1xuICAgICAgICB0aGlzLmdyb3Vwcy5wdXNoKHJvb3RHcm91cCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0KHRoaXMuX2RhdGEsIGl0ZW0ua2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gIH1cblxuICBwcml2YXRlIHJlc29sdmVUeXBlKGl0ZW06IFByb3BlcnRpZXNMaXN0SXRlbSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGl0ZW0udmFsdWUpID8gJ2FycmF5JyA6IGl0ZW0uYWN0aW9uICYmIGl0ZW0udmFsdWUgPyAnbGluaycgOiAnc3RyaW5nJztcbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoRW1wdHlMYWJlbChpdGVtOiBQcm9wZXJ0aWVzTGlzdEl0ZW0pIHtcbiAgICBpZiAoIWl0ZW0udmFsdWUpIHtcbiAgICAgIHJldHVybiB0aGlzLmVtcHR5TGFiZWw7XG4gICAgfVxuICAgIHJldHVybiBpdGVtLnZhbHVlO1xuICB9XG59XG4iXX0=