import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { InventoryService, OperationStatus } from '@c8y/client';
import { AlertService, gettext } from '@c8y/ngx-components';
import { DeviceConfigurationOperation } from '../repository.model';
import { RepositoryService } from '../repository.service';
import { DeviceConfigurationService } from './device-configuration.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from '../repository.service';
import * as ɵngcc4 from './device-configuration.service';
import * as ɵngcc5 from '@c8y/client';
import * as ɵngcc6 from '@angular/common';
import * as ɵngcc7 from '@angular/forms';
import * as ɵngcc8 from '@c8y/ngx-components/operations/single-operation-details';

const _c0 = function (a0) { return { "icon-spin": a0 }; };
function TextBasedConfigurationComponent_button_4_i_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "i", 12);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(1, _c0, ctx_r3.reloadingConfig));
} }
function TextBasedConfigurationComponent_button_4_i_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "i", 13);
} }
function TextBasedConfigurationComponent_button_4_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 9);
    ɵngcc0.ɵɵlistener("click", function TextBasedConfigurationComponent_button_4_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.reloadConfiguration(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtemplate(2, TextBasedConfigurationComponent_button_4_i_2_Template, 1, 3, "i", 10);
    ɵngcc0.ɵɵtemplate(3, TextBasedConfigurationComponent_button_4_i_3_Template, 1, 0, "i", 11);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 5, "Get configuration from device"));
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.reloadingConfig || ctx_r0.savingConfig);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.reloadingConfig);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r0.reloadingConfig);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 7, "Get configuration from device"), " ");
} }
function TextBasedConfigurationComponent_c8y_single_operation_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "c8y-single-operation", 14);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("operation", ctx_r1.latestOperation);
} }
function TextBasedConfigurationComponent_div_8_span_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 18);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, "Send"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, "Send configuration to device"), " ");
} }
function TextBasedConfigurationComponent_div_8_span_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 18);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, "Sending\u2026"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, "Sending\u2026"), " ");
} }
const _c1 = function (a0) { return { "btn-pending": a0 }; };
function TextBasedConfigurationComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 15);
    ɵngcc0.ɵɵelementStart(1, "button", 16);
    ɵngcc0.ɵɵlistener("click", function TextBasedConfigurationComponent_div_8_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(); return ctx_r9.updateConfiguration(ctx_r9.config); });
    ɵngcc0.ɵɵtemplate(2, TextBasedConfigurationComponent_div_8_span_2_Template, 4, 6, "span", 17);
    ɵngcc0.ɵɵtemplate(3, TextBasedConfigurationComponent_div_8_span_3_Template, 4, 6, "span", 17);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("disabled", ctx_r2.reloadingConfig || ctx_r2.savingConfig || !ctx_r2.config)("ngClass", ɵngcc0.ɵɵpureFunction1(4, _c1, ctx_r2.savingConfig));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.savingConfig);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.savingConfig);
} }
export class TextBasedConfigurationComponent {
    constructor(route, alertService, repositoryService, deviceConfigurationService, inventoryService) {
        this.route = route;
        this.alertService = alertService;
        this.repositoryService = repositoryService;
        this.deviceConfigurationService = deviceConfigurationService;
        this.inventoryService = inventoryService;
        this.reloadingConfig = false;
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.load();
        });
    }
    load() {
        return __awaiter(this, void 0, void 0, function* () {
            this.device = this.route.snapshot.parent.data.contextData;
            yield this.loadDevice();
            yield this.loadOperation();
            this.showTextBasedConfigReload = this.deviceConfigurationService.hasAnySupportedOperation(this.device, [DeviceConfigurationOperation.SEND_CONFIG]);
            this.showTextBasedConfigSave = this.deviceConfigurationService.hasAnySupportedOperation(this.device, [DeviceConfigurationOperation.CONFIG]);
            if (this.device.c8y_Configuration && this.device.c8y_Configuration.config) {
                this.config = this.device.c8y_Configuration.config;
            }
        });
    }
    loadOperation() {
        return __awaiter(this, void 0, void 0, function* () {
            const operation = yield this.repositoryService.getLastConfigUpdateOperation(this.device.id);
            if (operation !== null) {
                this.reloadingConfig =
                    !!operation.c8y_SendConfiguration &&
                        (operation.status === OperationStatus.PENDING ||
                            operation.status === OperationStatus.EXECUTING);
                this.repositoryService.observeOperation(operation).subscribe((operationUpdate) => {
                    this.latestOperation = operationUpdate;
                });
            }
        });
    }
    get savingConfig() {
        return this.latestOperation
            ? !!this.latestOperation.c8y_Configuration &&
                (this.latestOperation.status === OperationStatus.PENDING ||
                    this.latestOperation.status === OperationStatus.EXECUTING)
            : false;
    }
    reloadConfiguration() {
        return __awaiter(this, void 0, void 0, function* () {
            this.reloadingConfig = true;
            const operationCfg = yield this.repositoryService.createTextBasedConfigurationReloadOperation(this.device);
            try {
                this.repositoryService
                    .createObservedOperation(operationCfg)
                    .subscribe(operationUpdate => this.onOperationReloadSuccess(operationUpdate), operationUpdate => this.onOperationReloadError(operationUpdate), () => this.onOperationReloadComplete());
            }
            catch (ex) {
                this.alertService.addServerFailure(ex);
            }
        });
    }
    updateConfiguration(config) {
        return __awaiter(this, void 0, void 0, function* () {
            const operationCfg = yield this.repositoryService.createTextBasedConfigurationUpdateOperation(this.device, config);
            try {
                this.repositoryService
                    .createObservedOperation(operationCfg)
                    .subscribe(operationUpdate => this.onOperationUpdateSuccess(operationUpdate), operationUpdate => this.onOperationUpdateError(operationUpdate), () => this.onOperationUpdateComplete());
            }
            catch (ex) {
                this.alertService.addServerFailure(ex);
            }
        });
    }
    onOperationReloadSuccess(operationUpdate) {
        this.latestOperation = operationUpdate;
        if (operationUpdate.status === OperationStatus.PENDING) {
            this.alertService.success(gettext('Configuration will be reloaded.'));
        }
    }
    onOperationReloadError(operationUpdate) {
        this.latestOperation = operationUpdate;
        this.reloadingConfig = false;
    }
    onOperationReloadComplete() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.loadDevice();
            this.config = this.device.c8y_Configuration.config;
            this.reloadingConfig = false;
        });
    }
    onOperationUpdateSuccess(operationUpdate) {
        this.latestOperation = operationUpdate;
        if (operationUpdate.status === OperationStatus.PENDING) {
            this.alertService.success(gettext('Configuration will be updated.'));
        }
    }
    onOperationUpdateError(operationUpdate) {
        this.latestOperation = operationUpdate;
    }
    onOperationUpdateComplete() {
        this.device.c8y_Configuration.config = this.config;
    }
    loadDevice() {
        return __awaiter(this, void 0, void 0, function* () {
            this.device = (yield this.inventoryService.detail(this.device.id, {
                withChildren: false
            })).data;
        });
    }
}
TextBasedConfigurationComponent.ɵfac = function TextBasedConfigurationComponent_Factory(t) { return new (t || TextBasedConfigurationComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.RepositoryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.DeviceConfigurationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.InventoryService)); };
TextBasedConfigurationComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: TextBasedConfigurationComponent, selectors: [["c8y-text-based-configuration"]], decls: 9, vars: 5, consts: [[1, "d-flex", "d-col", "fit-h"], [1, "card-block", "bg-gray-white", "fit-w"], [1, "content-flex-50"], [1, "flex-item-left", "d-flex"], ["type", "button", "class", "btn btn-default btn-sm flex-item-v-center m-t-8 m-b-8", 3, "title", "disabled", "click", 4, "ngIf"], ["class", "flex-grow", 3, "operation", 4, "ngIf"], [1, "flex-grow"], ["c8y-spellcheck", "false", 1, "form-control", "fit-h", "p-r-16", "p-l-16", 3, "ngModel", "disabled", "ngModelChange"], ["class", "card-footer fit-w separator", 4, "ngIf"], ["type", "button", 1, "btn", "btn-default", "btn-sm", "flex-item-v-center", "m-t-8", "m-b-8", 3, "title", "disabled", "click"], ["c8yIcon", "refresh", "class", "m-r-4", 3, "ngClass", 4, "ngIf"], ["c8yIcon", "download", "class", "m-r-4", 4, "ngIf"], ["c8yIcon", "refresh", 1, "m-r-4", 3, "ngClass"], ["c8yIcon", "download", 1, "m-r-4"], [1, "flex-grow", 3, "operation"], [1, "card-footer", "fit-w", "separator"], ["type", "button", "id", "send-config-btn", 1, "btn", "btn-primary", 3, "disabled", "ngClass", "click"], [3, "title", 4, "ngIf"], [3, "title"]], template: function TextBasedConfigurationComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "fieldset", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "div", 3);
        ɵngcc0.ɵɵtemplate(4, TextBasedConfigurationComponent_button_4_Template, 6, 9, "button", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, TextBasedConfigurationComponent_c8y_single_operation_5_Template, 1, 1, "c8y-single-operation", 5);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "div", 6);
        ɵngcc0.ɵɵelementStart(7, "textarea", 7);
        ɵngcc0.ɵɵlistener("ngModelChange", function TextBasedConfigurationComponent_Template_textarea_ngModelChange_7_listener($event) { return ctx.config = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, TextBasedConfigurationComponent_div_8_Template, 4, 6, "div", 8);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showTextBasedConfigReload);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.latestOperation !== undefined);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngModel", ctx.config)("disabled", ctx.reloadingConfig || ctx.savingConfig);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showTextBasedConfigSave);
    } }, directives: [ɵngcc6.NgIf, ɵngcc7.DefaultValueAccessor, ɵngcc7.NgControlStatus, ɵngcc7.NgModel, ɵngcc2.IconDirective, ɵngcc6.NgClass, ɵngcc8.SingleOperationComponent], pipes: [ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
TextBasedConfigurationComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: AlertService },
    { type: RepositoryService },
    { type: DeviceConfigurationService },
    { type: InventoryService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(TextBasedConfigurationComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-text-based-configuration',
                template: "<div class=\"d-flex d-col fit-h\">\n  <fieldset class=\"card-block bg-gray-white fit-w\">\n    <div class=\"content-flex-50\">\n      <div class=\"flex-item-left d-flex\">\n        <button\n          title=\"{{ 'Get configuration from device' | translate }}\"\n          type=\"button\"\n          class=\"btn btn-default btn-sm flex-item-v-center m-t-8 m-b-8\"\n          *ngIf=\"showTextBasedConfigReload\"\n          (click)=\"reloadConfiguration()\"\n          [disabled]=\"reloadingConfig || savingConfig\"\n        >\n          <i\n            c8yIcon=\"refresh\"\n            *ngIf=\"reloadingConfig\"\n            class=\"m-r-4\"\n            [ngClass]=\"{ 'icon-spin': reloadingConfig }\"\n          ></i>\n          <i c8yIcon=\"download\" *ngIf=\"!reloadingConfig\" class=\"m-r-4\"></i>\n\n          {{ 'Get configuration from device' | translate }}\n        </button>\n      </div>\n      <c8y-single-operation\n        *ngIf=\"latestOperation !== undefined\"\n        [operation]=\"latestOperation\"\n        class=\"flex-grow\"\n      ></c8y-single-operation>\n    </div>\n  </fieldset>\n  <div class=\"flex-grow\">\n    <textarea\n      [(ngModel)]=\"config\"\n      class=\"form-control fit-h p-r-16 p-l-16\"\n      [disabled]=\"reloadingConfig || savingConfig\"\n      c8y-spellcheck=\"false\"\n    ></textarea>\n  </div>\n  <div class=\"card-footer fit-w separator\" *ngIf=\"showTextBasedConfigSave\">\n    <button\n      type=\"button\"\n      id=\"send-config-btn\"\n      (click)=\"updateConfiguration(config)\"\n      [disabled]=\"reloadingConfig || savingConfig || !config\"\n      class=\"btn btn-primary\"\n      [ngClass]=\"{ 'btn-pending': savingConfig }\"\n    >\n      <span title=\"{{ 'Send' | translate }}\" *ngIf=\"!savingConfig\">\n        {{ 'Send configuration to device' | translate }}\n      </span>\n      <span title=\"{{ 'Sending\u2026' | translate }}\" *ngIf=\"savingConfig\">\n        {{ 'Sending\u2026' | translate }}\n      </span>\n    </button>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.AlertService }, { type: ɵngcc3.RepositoryService }, { type: ɵngcc4.DeviceConfigurationService }, { type: ɵngcc5.InventoryService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dC1iYXNlZC1jb25maWd1cmF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcmVwb3NpdG9yeS9jb25maWd1cmF0aW9uLWRldmljZS10YWIvdGV4dC1iYXNlZC1jb25maWd1cmF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDakQsT0FBTyxFQUFrQixnQkFBZ0IsRUFBYyxlQUFlLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDNUYsT0FBTyxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNNUUsTUFBTSxPQUFPLCtCQUErQjtBQUFHLElBUTdDLFlBQ1UsS0FBcUIsRUFDckIsWUFBMEIsRUFDMUIsaUJBQW9DLEVBQ3BDLDBCQUFzRCxFQUN0RCxnQkFBa0M7QUFDM0MsUUFMUyxVQUFLLEdBQUwsS0FBSyxDQUFnQjtBQUFDLFFBQ3RCLGlCQUFZLEdBQVosWUFBWSxDQUFjO0FBQUMsUUFDM0Isc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtBQUFDLFFBQ3JDLCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7QUFBQyxRQUN2RCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0FBQzlDLFFBVEUsb0JBQWUsR0FBRyxLQUFLLENBQUM7QUFDMUIsSUFTRSxDQUFDO0FBQ0gsSUFDUSxRQUFRO0FBQ2hCO0FBSWlCLFlBSmIsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDdEIsUUFBRSxDQUFDO0FBRUYsS0FGRTtBQUNILElBQ1EsSUFBSTtBQUNaO0FBQThELFlBQTFELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7QUFDOUQsWUFBSSxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUM1QixZQUFJLE1BQU0sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQy9CLFlBQUksSUFBSSxDQUFDLHlCQUF5QixHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyx3QkFBd0IsQ0FDdkYsSUFBSSxDQUFDLE1BQU0sRUFDWCxDQUFDLDRCQUE0QixDQUFDLFdBQVcsQ0FBQyxDQUMzQyxDQUFDO0FBQ04sWUFBSSxJQUFJLENBQUMsdUJBQXVCLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLHdCQUF3QixDQUNyRixJQUFJLENBQUMsTUFBTSxFQUNYLENBQUMsNEJBQTRCLENBQUMsTUFBTSxDQUFDLENBQ3RDLENBQUM7QUFDTixZQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRTtBQUMvRSxnQkFBTSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDO0FBQ3pELGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDUSxhQUFhO0FBQ3JCO0FBQThELFlBQTFELE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLDRCQUE0QixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDaEcsWUFBSSxJQUFJLFNBQVMsS0FBSyxJQUFJLEVBQUU7QUFDNUIsZ0JBQU0sSUFBSSxDQUFDLGVBQWU7QUFDMUIsb0JBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxxQkFBcUI7QUFDekMsd0JBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxLQUFLLGVBQWUsQ0FBQyxPQUFPO0FBQ3JELDRCQUFVLFNBQVMsQ0FBQyxNQUFNLEtBQUssZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzFELGdCQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxlQUFlLEVBQUUsRUFBRTtBQUN2RixvQkFBUSxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztBQUMvQyxnQkFBTSxDQUFDLENBQUMsQ0FBQztBQUNULGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDRSxJQUFJLFlBQVk7QUFDbEIsUUFBSSxPQUFPLElBQUksQ0FBQyxlQUFlO0FBQy9CLFlBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQjtBQUNoRCxnQkFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxLQUFLLGVBQWUsQ0FBQyxPQUFPO0FBQ2xFLG9CQUFZLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxLQUFLLGVBQWUsQ0FBQyxTQUFTLENBQUM7QUFDdEUsWUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2QsSUFBRSxDQUFDO0FBQ0gsSUFDUSxtQkFBbUI7QUFDM0I7QUFDNkIsWUFEekIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7QUFDaEMsWUFBSSxNQUFNLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQywyQ0FBMkMsQ0FDM0YsSUFBSSxDQUFDLE1BQU0sQ0FDWixDQUFDO0FBQ04sWUFBSSxJQUFJO0FBQ1IsZ0JBQU0sSUFBSSxDQUFDLGlCQUFpQjtBQUM1QixxQkFBUyx1QkFBdUIsQ0FBQyxZQUFZLENBQUM7QUFDOUMscUJBQVMsU0FBUyxDQUNSLGVBQWUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGVBQWUsQ0FBQyxFQUNqRSxlQUFlLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsRUFDL0QsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQ3ZDLENBQUM7QUFDVixhQUFLO0FBQUMsWUFBQSxPQUFPLEVBQUUsRUFBRTtBQUNqQixnQkFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzdDLGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDUSxtQkFBbUIsQ0FBQyxNQUFNO0FBQ2xDO0FBQThELFlBQTFELE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLDJDQUEyQyxDQUMzRixJQUFJLENBQUMsTUFBTSxFQUNYLE1BQU0sQ0FDUCxDQUFDO0FBQ04sWUFBSSxJQUFJO0FBQ1IsZ0JBQU0sSUFBSSxDQUFDLGlCQUFpQjtBQUM1QixxQkFBUyx1QkFBdUIsQ0FBQyxZQUFZLENBQUM7QUFDOUMscUJBQVMsU0FBUyxDQUNSLGVBQWUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGVBQWUsQ0FBQyxFQUNqRSxlQUFlLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsRUFDL0QsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQ3ZDLENBQUM7QUFDVixhQUFLO0FBQUMsWUFBQSxPQUFPLEVBQUUsRUFBRTtBQUNqQixnQkFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzdDLGFBQUs7QUFDTCxRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDVSx3QkFBd0IsQ0FBQyxlQUFlO0FBQ2xELFFBQUksSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7QUFDM0MsUUFBSSxJQUFJLGVBQWUsQ0FBQyxNQUFNLEtBQUssZUFBZSxDQUFDLE9BQU8sRUFBRTtBQUM1RCxZQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUM7QUFDNUUsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNILElBQ1Usc0JBQXNCLENBQUMsZUFBZTtBQUNoRCxRQUFJLElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO0FBQzNDLFFBQUksSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7QUFDakMsSUFBRSxDQUFDO0FBQ0gsSUFDZ0IseUJBQXlCO0FBQ3pDO0FBQ2lDLFlBRDdCLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQzVCLFlBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQztBQUN2RCxZQUFJLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO0FBQ2pDLFFBQUUsQ0FBQztBQUVGLEtBRkU7QUFDSCxJQUNVLHdCQUF3QixDQUFDLGVBQWU7QUFDbEQsUUFBSSxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztBQUMzQyxRQUFJLElBQUksZUFBZSxDQUFDLE1BQU0sS0FBSyxlQUFlLENBQUMsT0FBTyxFQUFFO0FBQzVELFlBQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQztBQUMzRSxTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0gsSUFDVSxzQkFBc0IsQ0FBQyxlQUFlO0FBQ2hELFFBQUksSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7QUFDM0MsSUFBRSxDQUFDO0FBQ0gsSUFDVSx5QkFBeUI7QUFDbkMsUUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQ3ZELElBQUUsQ0FBQztBQUNILElBQ2dCLFVBQVU7QUFDMUI7QUFBOEQsWUFBMUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRTtBQUN0RSxnQkFBTSxZQUFZLEVBQUUsS0FBSztBQUN6QixhQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUNiLFFBQUUsQ0FBQztBQUVILEtBRkc7QUFDSDsyREF6SUMsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSw4QkFBOEIsa0JBQ3hDOzs7Ozs7OztpSEFBd0QsY0FDekQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7c09BQ0k7QUFBQztBQUF5RCxZQVh0RCxjQUFjO0FBQUksWUFFbEIsWUFBWTtBQUFJLFlBRWhCLGlCQUFpQjtBQUFJLFlBQ3JCLDBCQUEwQjtBQUFJLFlBSmQsZ0JBQWdCO0FBQUc7Ozs7Ozs7a09BQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBJTWFuYWdlZE9iamVjdCwgSW52ZW50b3J5U2VydmljZSwgSU9wZXJhdGlvbiwgT3BlcmF0aW9uU3RhdHVzIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlLCBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBEZXZpY2VDb25maWd1cmF0aW9uT3BlcmF0aW9uIH0gZnJvbSAnLi4vcmVwb3NpdG9yeS5tb2RlbCc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5U2VydmljZSB9IGZyb20gJy4uL3JlcG9zaXRvcnkuc2VydmljZSc7XG5pbXBvcnQgeyBEZXZpY2VDb25maWd1cmF0aW9uU2VydmljZSB9IGZyb20gJy4vZGV2aWNlLWNvbmZpZ3VyYXRpb24uc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS10ZXh0LWJhc2VkLWNvbmZpZ3VyYXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vdGV4dC1iYXNlZC1jb25maWd1cmF0aW9uLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBUZXh0QmFzZWRDb25maWd1cmF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdDtcbiAgbGF0ZXN0T3BlcmF0aW9uOiBJT3BlcmF0aW9uO1xuICBzaG93VGV4dEJhc2VkQ29uZmlnUmVsb2FkOiBib29sZWFuO1xuICBzaG93VGV4dEJhc2VkQ29uZmlnU2F2ZTogYm9vbGVhbjtcbiAgcmVsb2FkaW5nQ29uZmlnID0gZmFsc2U7XG4gIGNvbmZpZzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgYWxlcnRTZXJ2aWNlOiBBbGVydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5U2VydmljZTogUmVwb3NpdG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkZXZpY2VDb25maWd1cmF0aW9uU2VydmljZTogRGV2aWNlQ29uZmlndXJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnlTZXJ2aWNlOiBJbnZlbnRvcnlTZXJ2aWNlXG4gICkge1xuICB9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBhc3luYyBsb2FkKCkge1xuICAgIHRoaXMuZGV2aWNlID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5wYXJlbnQuZGF0YS5jb250ZXh0RGF0YTtcbiAgICBhd2FpdCB0aGlzLmxvYWREZXZpY2UoKTtcbiAgICBhd2FpdCB0aGlzLmxvYWRPcGVyYXRpb24oKTtcbiAgICB0aGlzLnNob3dUZXh0QmFzZWRDb25maWdSZWxvYWQgPSB0aGlzLmRldmljZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmhhc0FueVN1cHBvcnRlZE9wZXJhdGlvbihcbiAgICAgIHRoaXMuZGV2aWNlLFxuICAgICAgW0RldmljZUNvbmZpZ3VyYXRpb25PcGVyYXRpb24uU0VORF9DT05GSUddXG4gICAgKTtcbiAgICB0aGlzLnNob3dUZXh0QmFzZWRDb25maWdTYXZlID0gdGhpcy5kZXZpY2VDb25maWd1cmF0aW9uU2VydmljZS5oYXNBbnlTdXBwb3J0ZWRPcGVyYXRpb24oXG4gICAgICB0aGlzLmRldmljZSxcbiAgICAgIFtEZXZpY2VDb25maWd1cmF0aW9uT3BlcmF0aW9uLkNPTkZJR11cbiAgICApO1xuICAgIGlmICh0aGlzLmRldmljZS5jOHlfQ29uZmlndXJhdGlvbiAmJiB0aGlzLmRldmljZS5jOHlfQ29uZmlndXJhdGlvbi5jb25maWcpIHtcbiAgICAgIHRoaXMuY29uZmlnID0gdGhpcy5kZXZpY2UuYzh5X0NvbmZpZ3VyYXRpb24uY29uZmlnO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRPcGVyYXRpb24oKSB7XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5U2VydmljZS5nZXRMYXN0Q29uZmlnVXBkYXRlT3BlcmF0aW9uKHRoaXMuZGV2aWNlLmlkKTtcbiAgICBpZiAob3BlcmF0aW9uICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnJlbG9hZGluZ0NvbmZpZyA9XG4gICAgICAgICEhb3BlcmF0aW9uLmM4eV9TZW5kQ29uZmlndXJhdGlvbiAmJlxuICAgICAgICAob3BlcmF0aW9uLnN0YXR1cyA9PT0gT3BlcmF0aW9uU3RhdHVzLlBFTkRJTkcgfHxcbiAgICAgICAgICBvcGVyYXRpb24uc3RhdHVzID09PSBPcGVyYXRpb25TdGF0dXMuRVhFQ1VUSU5HKTtcbiAgICAgIHRoaXMucmVwb3NpdG9yeVNlcnZpY2Uub2JzZXJ2ZU9wZXJhdGlvbihvcGVyYXRpb24pLnN1YnNjcmliZSgob3BlcmF0aW9uVXBkYXRlKSA9PiB7XG4gICAgICAgIHRoaXMubGF0ZXN0T3BlcmF0aW9uID0gb3BlcmF0aW9uVXBkYXRlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHNhdmluZ0NvbmZpZygpIHtcbiAgICByZXR1cm4gdGhpcy5sYXRlc3RPcGVyYXRpb25cbiAgICAgID8gISF0aGlzLmxhdGVzdE9wZXJhdGlvbi5jOHlfQ29uZmlndXJhdGlvbiAmJlxuICAgICAgICAgICh0aGlzLmxhdGVzdE9wZXJhdGlvbi5zdGF0dXMgPT09IE9wZXJhdGlvblN0YXR1cy5QRU5ESU5HIHx8XG4gICAgICAgICAgICB0aGlzLmxhdGVzdE9wZXJhdGlvbi5zdGF0dXMgPT09IE9wZXJhdGlvblN0YXR1cy5FWEVDVVRJTkcpXG4gICAgICA6IGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgcmVsb2FkQ29uZmlndXJhdGlvbigpIHtcbiAgICB0aGlzLnJlbG9hZGluZ0NvbmZpZyA9IHRydWU7XG4gICAgY29uc3Qgb3BlcmF0aW9uQ2ZnID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5U2VydmljZS5jcmVhdGVUZXh0QmFzZWRDb25maWd1cmF0aW9uUmVsb2FkT3BlcmF0aW9uKFxuICAgICAgdGhpcy5kZXZpY2VcbiAgICApO1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnJlcG9zaXRvcnlTZXJ2aWNlXG4gICAgICAgIC5jcmVhdGVPYnNlcnZlZE9wZXJhdGlvbihvcGVyYXRpb25DZmcpXG4gICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgb3BlcmF0aW9uVXBkYXRlID0+IHRoaXMub25PcGVyYXRpb25SZWxvYWRTdWNjZXNzKG9wZXJhdGlvblVwZGF0ZSksXG4gICAgICAgICAgb3BlcmF0aW9uVXBkYXRlID0+IHRoaXMub25PcGVyYXRpb25SZWxvYWRFcnJvcihvcGVyYXRpb25VcGRhdGUpLFxuICAgICAgICAgICgpID0+IHRoaXMub25PcGVyYXRpb25SZWxvYWRDb21wbGV0ZSgpXG4gICAgICAgICk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLmFkZFNlcnZlckZhaWx1cmUoZXgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUNvbmZpZ3VyYXRpb24oY29uZmlnKSB7XG4gICAgY29uc3Qgb3BlcmF0aW9uQ2ZnID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5U2VydmljZS5jcmVhdGVUZXh0QmFzZWRDb25maWd1cmF0aW9uVXBkYXRlT3BlcmF0aW9uKFxuICAgICAgdGhpcy5kZXZpY2UsXG4gICAgICBjb25maWdcbiAgICApO1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnJlcG9zaXRvcnlTZXJ2aWNlXG4gICAgICAgIC5jcmVhdGVPYnNlcnZlZE9wZXJhdGlvbihvcGVyYXRpb25DZmcpXG4gICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgb3BlcmF0aW9uVXBkYXRlID0+IHRoaXMub25PcGVyYXRpb25VcGRhdGVTdWNjZXNzKG9wZXJhdGlvblVwZGF0ZSksXG4gICAgICAgICAgb3BlcmF0aW9uVXBkYXRlID0+IHRoaXMub25PcGVyYXRpb25VcGRhdGVFcnJvcihvcGVyYXRpb25VcGRhdGUpLFxuICAgICAgICAgICgpID0+IHRoaXMub25PcGVyYXRpb25VcGRhdGVDb21wbGV0ZSgpXG4gICAgICAgICk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLmFkZFNlcnZlckZhaWx1cmUoZXgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25PcGVyYXRpb25SZWxvYWRTdWNjZXNzKG9wZXJhdGlvblVwZGF0ZSkge1xuICAgIHRoaXMubGF0ZXN0T3BlcmF0aW9uID0gb3BlcmF0aW9uVXBkYXRlO1xuICAgIGlmIChvcGVyYXRpb25VcGRhdGUuc3RhdHVzID09PSBPcGVyYXRpb25TdGF0dXMuUEVORElORykge1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2Uuc3VjY2VzcyhnZXR0ZXh0KCdDb25maWd1cmF0aW9uIHdpbGwgYmUgcmVsb2FkZWQuJykpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25PcGVyYXRpb25SZWxvYWRFcnJvcihvcGVyYXRpb25VcGRhdGUpIHtcbiAgICB0aGlzLmxhdGVzdE9wZXJhdGlvbiA9IG9wZXJhdGlvblVwZGF0ZTtcbiAgICB0aGlzLnJlbG9hZGluZ0NvbmZpZyA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBvbk9wZXJhdGlvblJlbG9hZENvbXBsZXRlKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZERldmljZSgpO1xuICAgIHRoaXMuY29uZmlnID0gdGhpcy5kZXZpY2UuYzh5X0NvbmZpZ3VyYXRpb24uY29uZmlnO1xuICAgIHRoaXMucmVsb2FkaW5nQ29uZmlnID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIG9uT3BlcmF0aW9uVXBkYXRlU3VjY2VzcyhvcGVyYXRpb25VcGRhdGUpIHtcbiAgICB0aGlzLmxhdGVzdE9wZXJhdGlvbiA9IG9wZXJhdGlvblVwZGF0ZTtcbiAgICBpZiAob3BlcmF0aW9uVXBkYXRlLnN0YXR1cyA9PT0gT3BlcmF0aW9uU3RhdHVzLlBFTkRJTkcpIHtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoZ2V0dGV4dCgnQ29uZmlndXJhdGlvbiB3aWxsIGJlIHVwZGF0ZWQuJykpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25PcGVyYXRpb25VcGRhdGVFcnJvcihvcGVyYXRpb25VcGRhdGUpIHtcbiAgICB0aGlzLmxhdGVzdE9wZXJhdGlvbiA9IG9wZXJhdGlvblVwZGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgb25PcGVyYXRpb25VcGRhdGVDb21wbGV0ZSgpIHtcbiAgICB0aGlzLmRldmljZS5jOHlfQ29uZmlndXJhdGlvbi5jb25maWcgPSB0aGlzLmNvbmZpZztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZERldmljZSgpIHtcbiAgICB0aGlzLmRldmljZSA9IChhd2FpdCB0aGlzLmludmVudG9yeVNlcnZpY2UuZGV0YWlsKHRoaXMuZGV2aWNlLmlkLCB7XG4gICAgICB3aXRoQ2hpbGRyZW46IGZhbHNlXG4gICAgfSkpLmRhdGE7XG4gIH1cbn1cbiJdfQ==