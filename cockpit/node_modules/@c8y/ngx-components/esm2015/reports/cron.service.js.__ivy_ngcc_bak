import { Injectable } from '@angular/core';
import { Base } from './export-schedules.interface';
import { TranslateService } from '@ngx-translate/core';
import { formatDate } from '@angular/common';
import { gettext } from '@c8y/ngx-components';
export class CronService {
    constructor(translateService) {
        this.translateService = translateService;
        this.daysOfWeekPosix = [];
        this.daysOfMonth = [
            { value: '1', label: '1.' },
            { value: '2', label: '2.' },
            { value: '3', label: '3.' },
            { value: '4', label: '4.' },
            { value: '5', label: '5.' },
            { value: '6', label: '6.' },
            { value: '7', label: '7.' },
            { value: '8', label: '8.' },
            { value: '9', label: '9.' },
            { value: '10', label: '10.' },
            { value: '11', label: '11.' },
            { value: '12', label: '12.' },
            { value: '13', label: '13.' },
            { value: '14', label: '14.' },
            { value: '15', label: '15.' },
            { value: '16', label: '16.' },
            { value: '17', label: '17.' },
            { value: '18', label: '18.' },
            { value: '19', label: '19.' },
            { value: '20', label: '20.' },
            { value: '21', label: '21.' },
            { value: '22', label: '22.' },
            { value: '23', label: '23.' },
            { value: '24', label: '24.' },
            { value: '25', label: '25.' },
            { value: '26', label: '26.' },
            { value: '27', label: '27.' },
            { value: '28', label: '28.' },
            { value: '29', label: '29.' },
            { value: '30', label: '30.' },
            { value: '31', label: '31.' }
        ];
        this.months = [];
        this.hours = [];
        this.minutes = [];
        this.intervals = [
            { value: 2, label: gettext('Hour') },
            { value: 3, label: gettext('Day') },
            { value: 4, label: gettext('Week') },
            { value: 5, label: gettext('Month') },
            { value: 6, label: gettext('Year') }
        ];
        for (let x = 0; x < 24; x++) {
            this.hours.push({ value: x.toString(), label: `${x}` });
        }
        for (let x = 0; x < 60; x = x + 5) {
            this.minutes.push({ value: x.toString(), label: `${x}` });
        }
        for (let x = 0; x < 7; x++) {
            this.daysOfWeekPosix.push({
                value: x.toString(),
                label: this.getWeekDayName({ weekday: x })
            });
        }
        for (let x = 1; x < 13; x++) {
            this.months.push({
                value: x.toString(),
                label: this.getMonthName({ month: x })
            });
        }
    }
    generateCron(cronConfig) {
        let cron = '';
        cron = cronConfig.minute ? `${cronConfig.minute}` : '*';
        cron += cronConfig.hour ? ` ${cronConfig.hour}` : ' *';
        cron += cronConfig.day ? ` ${cronConfig.day}` : ' *';
        cron += cronConfig.month ? ` ${cronConfig.month}` : ' *';
        cron += cronConfig.weekday ? ` ${cronConfig.weekday}` : ' *';
        return cron;
    }
    generateCronConfig(cron) {
        const parts = cron.split(/\s+/);
        const cronConfig = {
            minute: parts[0],
            hour: parts[1],
            day: parts[2],
            month: parts[3],
            weekday: parts[4]
        };
        return cronConfig;
    }
    getBase(cronConfig) {
        let base = Base.Initial;
        if (cronConfig.minute !== '*' &&
            cronConfig.hour === '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Hour;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Day;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday !== '*') {
            base = Base.Week;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Month;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month !== '*' &&
            cronConfig.weekday === '*') {
            base = Base.Year;
        }
        else {
            // cronConfig invalid
        }
        return base;
    }
    validateModels(base, cronConfig) {
        let valid;
        switch (base) {
            case Base.Initial: // Please select
                valid = false;
                break;
            case Base.Hour:
                if (cronConfig.minute !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Day:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Week:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.weekday !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Month:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.day !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Year:
                if (cronConfig.minute !== '*' &&
                    cronConfig.hour !== '*' &&
                    cronConfig.day !== '*' &&
                    cronConfig.month !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            default:
                valid = false;
        }
        return valid;
    }
    clearNextModels(base, cronConfig) {
        if (base === Base.Initial) {
            // please select, delete all
            // cron expression: every minute at second 0
            cronConfig.minute = '*';
            cronConfig.hour = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Hour) {
            // hour, don't delete minutes
            // cron expression: every hour, at whatever minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Day) {
            // day, don't delete minutes and hours
            // cron expression: every day of every month, at whatever hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Week) {
            // week, delete month and day
            // cron expression: every month, at whatever weekday, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = cronConfig.weekday === '*' || cronConfig.weekday === '?' ? this.daysOfWeekPosix[0].value : cronConfig.weekday;
        }
        else if (base === Base.Month) {
            // month, delete month and weekday
            // cron expression: every month, at whatever day of month, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = cronConfig.day === '*' ? this.daysOfMonth[0].value : cronConfig.day;
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Year) {
            // year, delete weekday
            // cron expression: every year, at whatever month, day of month, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = cronConfig.day === '*' ? this.daysOfMonth[0].value : cronConfig.day;
            cronConfig.month = cronConfig.month === '*' ? this.months[0].value : cronConfig.month;
            cronConfig.weekday = '*';
        }
    }
    getWeekDayName(cronConfig) {
        const date = new Date(0);
        const firstSundayDate = date.getDate() + 3; // because we know date 0 was on Thursday...
        date.setDate(firstSundayDate + parseInt(cronConfig.weekday, 10));
        return formatDate(date, 'EEEE', this.translateService.currentLang);
    }
    getMonthDayName(cronConfig) {
        let name = '';
        this.daysOfMonth.forEach(item => {
            if (item.value === cronConfig.day) {
                name = item.label;
            }
        });
        return name;
    }
    getMonthName(cronConfig) {
        const date = new Date(0);
        date.setMonth(parseInt(cronConfig.month, 10) - 1);
        return formatDate(date, 'LLLL', this.translateService.currentLang);
    }
}
CronService.decorators = [
    { type: Injectable }
];
CronService.ctorParameters = () => [
    { type: TranslateService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vcmVwb3J0cy9jcm9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsSUFBSSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUc5QyxNQUFNLE9BQU8sV0FBVztJQTZDdEIsWUFBb0IsZ0JBQWtDO1FBQWxDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUE1Q3RELG9CQUFlLEdBQVUsRUFBRSxDQUFDO1FBQzVCLGdCQUFXLEdBQUc7WUFDWixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtZQUM3QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRTtTQUM5QixDQUFDO1FBQ0YsV0FBTSxHQUFVLEVBQUUsQ0FBQztRQUNuQixVQUFLLEdBQVUsRUFBRSxDQUFDO1FBQ2xCLFlBQU8sR0FBVSxFQUFFLENBQUM7UUFDcEIsY0FBUyxHQUFHO1lBQ1YsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDcEMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDbkMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDcEMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDckMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7U0FDckMsQ0FBQztRQUVBLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUN6RDtRQUNELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUMzRDtRQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7Z0JBQ3hCLEtBQUssRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO2dCQUNuQixLQUFLLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQTRCLENBQUM7YUFDdEUsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNmLEtBQUssRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO2dCQUNuQixLQUFLLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQTRCLENBQUM7YUFDbEUsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRUQsWUFBWSxDQUFDLFVBQXNCO1FBQ2pDLElBQUksSUFBSSxHQUFXLEVBQUUsQ0FBQztRQUN0QixJQUFJLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUN4RCxJQUFJLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN2RCxJQUFJLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNyRCxJQUFJLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN6RCxJQUFJLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUU3RCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxJQUFZO1FBQzdCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsTUFBTSxVQUFVLEdBQWU7WUFDN0IsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDaEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDZCxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNiLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2YsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDbEIsQ0FBQztRQUVGLE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxPQUFPLENBQUMsVUFBc0I7UUFDNUIsSUFBSSxJQUFJLEdBQVMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUU5QixJQUNFLFVBQVUsQ0FBQyxNQUFNLEtBQUssR0FBRztZQUN6QixVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUc7WUFDdkIsVUFBVSxDQUFDLEdBQUcsS0FBSyxHQUFHO1lBQ3RCLFVBQVUsQ0FBQyxLQUFLLEtBQUssR0FBRztZQUN4QixVQUFVLENBQUMsT0FBTyxLQUFLLEdBQUcsRUFDMUI7WUFDQSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztTQUNsQjthQUFNLElBQ0wsVUFBVSxDQUFDLE1BQU0sS0FBSyxHQUFHO1lBQ3pCLFVBQVUsQ0FBQyxJQUFJLEtBQUssR0FBRztZQUN2QixVQUFVLENBQUMsR0FBRyxLQUFLLEdBQUc7WUFDdEIsVUFBVSxDQUFDLEtBQUssS0FBSyxHQUFHO1lBQ3hCLFVBQVUsQ0FBQyxPQUFPLEtBQUssR0FBRyxFQUMxQjtZQUNBLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQ2pCO2FBQU0sSUFDTCxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUc7WUFDekIsVUFBVSxDQUFDLElBQUksS0FBSyxHQUFHO1lBQ3ZCLFVBQVUsQ0FBQyxHQUFHLEtBQUssR0FBRztZQUN0QixVQUFVLENBQUMsS0FBSyxLQUFLLEdBQUc7WUFDeEIsVUFBVSxDQUFDLE9BQU8sS0FBSyxHQUFHLEVBQzFCO1lBQ0EsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbEI7YUFBTSxJQUNMLFVBQVUsQ0FBQyxNQUFNLEtBQUssR0FBRztZQUN6QixVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUc7WUFDdkIsVUFBVSxDQUFDLEdBQUcsS0FBSyxHQUFHO1lBQ3RCLFVBQVUsQ0FBQyxLQUFLLEtBQUssR0FBRztZQUN4QixVQUFVLENBQUMsT0FBTyxLQUFLLEdBQUcsRUFDMUI7WUFDQSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztTQUNuQjthQUFNLElBQ0wsVUFBVSxDQUFDLE1BQU0sS0FBSyxHQUFHO1lBQ3pCLFVBQVUsQ0FBQyxJQUFJLEtBQUssR0FBRztZQUN2QixVQUFVLENBQUMsR0FBRyxLQUFLLEdBQUc7WUFDdEIsVUFBVSxDQUFDLEtBQUssS0FBSyxHQUFHO1lBQ3hCLFVBQVUsQ0FBQyxPQUFPLEtBQUssR0FBRyxFQUMxQjtZQUNBLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ2xCO2FBQU07WUFDTCxxQkFBcUI7U0FDdEI7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxjQUFjLENBQUMsSUFBVSxFQUFFLFVBQXNCO1FBQy9DLElBQUksS0FBYyxDQUFDO1FBQ25CLFFBQVEsSUFBSSxFQUFFO1lBQ1osS0FBSyxJQUFJLENBQUMsT0FBTyxFQUFFLGdCQUFnQjtnQkFDakMsS0FBSyxHQUFHLEtBQUssQ0FBQztnQkFDZCxNQUFNO1lBQ1IsS0FBSyxJQUFJLENBQUMsSUFBSTtnQkFDWixJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFO29CQUM3QixLQUFLLEdBQUcsSUFBSSxDQUFDO2lCQUNkO3FCQUFNO29CQUNMLEtBQUssR0FBRyxLQUFLLENBQUM7aUJBQ2Y7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssSUFBSSxDQUFDLEdBQUc7Z0JBQ1gsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUcsRUFBRTtvQkFDeEQsS0FBSyxHQUFHLElBQUksQ0FBQztpQkFDZDtxQkFBTTtvQkFDTCxLQUFLLEdBQUcsS0FBSyxDQUFDO2lCQUNmO2dCQUNELE1BQU07WUFDUixLQUFLLElBQUksQ0FBQyxJQUFJO2dCQUNaLElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxHQUFHLElBQUksVUFBVSxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksVUFBVSxDQUFDLE9BQU8sS0FBSyxHQUFHLEVBQUU7b0JBQ3RGLEtBQUssR0FBRyxJQUFJLENBQUM7aUJBQ2Q7cUJBQU07b0JBQ0wsS0FBSyxHQUFHLEtBQUssQ0FBQztpQkFDZjtnQkFDRCxNQUFNO1lBQ1IsS0FBSyxJQUFJLENBQUMsS0FBSztnQkFDYixJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLEtBQUssR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLEtBQUssR0FBRyxFQUFFO29CQUNsRixLQUFLLEdBQUcsSUFBSSxDQUFDO2lCQUNkO3FCQUFNO29CQUNMLEtBQUssR0FBRyxLQUFLLENBQUM7aUJBQ2Y7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssSUFBSSxDQUFDLElBQUk7Z0JBQ1osSUFDRSxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUc7b0JBQ3pCLFVBQVUsQ0FBQyxJQUFJLEtBQUssR0FBRztvQkFDdkIsVUFBVSxDQUFDLEdBQUcsS0FBSyxHQUFHO29CQUN0QixVQUFVLENBQUMsS0FBSyxLQUFLLEdBQUcsRUFDeEI7b0JBQ0EsS0FBSyxHQUFHLElBQUksQ0FBQztpQkFDZDtxQkFBTTtvQkFDTCxLQUFLLEdBQUcsS0FBSyxDQUFDO2lCQUNmO2dCQUNELE1BQU07WUFDUjtnQkFDRSxLQUFLLEdBQUcsS0FBSyxDQUFDO1NBQ2pCO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsZUFBZSxDQUFDLElBQVUsRUFBRSxVQUFzQjtRQUNoRCxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ3pCLDRCQUE0QjtZQUM1Qiw0Q0FBNEM7WUFDNUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7WUFDeEIsVUFBVSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7WUFDdEIsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7WUFDckIsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDdkIsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDMUI7YUFBTSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQzdCLDZCQUE2QjtZQUM3QiwrREFBK0Q7WUFDL0QsVUFBVSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDMUYsVUFBVSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7WUFDdEIsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7WUFDckIsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDdkIsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDMUI7YUFBTSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQzVCLHNDQUFzQztZQUN0QyxzRkFBc0Y7WUFDdEYsVUFBVSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDMUYsVUFBVSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDbEYsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7WUFDckIsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDdkIsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDMUI7YUFBTSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQzdCLDZCQUE2QjtZQUM3QixrRkFBa0Y7WUFDbEYsVUFBVSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDMUYsVUFBVSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDbEYsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7WUFDckIsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDdkIsVUFBVSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsT0FBTyxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsT0FBTyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUU7U0FDckk7YUFBTSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQzlCLGtDQUFrQztZQUNsQyx1RkFBdUY7WUFDdkYsVUFBVSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDMUYsVUFBVSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDbEYsVUFBVSxDQUFDLEdBQUcsR0FBRyxVQUFVLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7WUFDckYsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDdkIsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDMUI7YUFBTSxJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQzdCLHVCQUF1QjtZQUN2Qiw2RkFBNkY7WUFDN0YsVUFBVSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDMUYsVUFBVSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDbEYsVUFBVSxDQUFDLEdBQUcsR0FBRyxVQUFVLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7WUFDckYsVUFBVSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUM7WUFDdEYsVUFBVSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7U0FDMUI7SUFDSCxDQUFDO0lBRUQsY0FBYyxDQUFDLFVBQXNCO1FBQ25DLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyw0Q0FBNEM7UUFDeEYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLFVBQVUsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQsZUFBZSxDQUFDLFVBQXNCO1FBQ3BDLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzlCLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNqQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsWUFBWSxDQUFDLFVBQXNCO1FBQ2pDLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEQsT0FBTyxVQUFVLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckUsQ0FBQzs7O1lBOVFGLFVBQVU7OztZQUpGLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENyb25Db25maWcsIEJhc2UgfSBmcm9tICcuL2V4cG9ydC1zY2hlZHVsZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ3JvblNlcnZpY2Uge1xuICBkYXlzT2ZXZWVrUG9zaXg6IGFueVtdID0gW107XG4gIGRheXNPZk1vbnRoID0gW1xuICAgIHsgdmFsdWU6ICcxJywgbGFiZWw6ICcxLicgfSxcbiAgICB7IHZhbHVlOiAnMicsIGxhYmVsOiAnMi4nIH0sXG4gICAgeyB2YWx1ZTogJzMnLCBsYWJlbDogJzMuJyB9LFxuICAgIHsgdmFsdWU6ICc0JywgbGFiZWw6ICc0LicgfSxcbiAgICB7IHZhbHVlOiAnNScsIGxhYmVsOiAnNS4nIH0sXG4gICAgeyB2YWx1ZTogJzYnLCBsYWJlbDogJzYuJyB9LFxuICAgIHsgdmFsdWU6ICc3JywgbGFiZWw6ICc3LicgfSxcbiAgICB7IHZhbHVlOiAnOCcsIGxhYmVsOiAnOC4nIH0sXG4gICAgeyB2YWx1ZTogJzknLCBsYWJlbDogJzkuJyB9LFxuICAgIHsgdmFsdWU6ICcxMCcsIGxhYmVsOiAnMTAuJyB9LFxuICAgIHsgdmFsdWU6ICcxMScsIGxhYmVsOiAnMTEuJyB9LFxuICAgIHsgdmFsdWU6ICcxMicsIGxhYmVsOiAnMTIuJyB9LFxuICAgIHsgdmFsdWU6ICcxMycsIGxhYmVsOiAnMTMuJyB9LFxuICAgIHsgdmFsdWU6ICcxNCcsIGxhYmVsOiAnMTQuJyB9LFxuICAgIHsgdmFsdWU6ICcxNScsIGxhYmVsOiAnMTUuJyB9LFxuICAgIHsgdmFsdWU6ICcxNicsIGxhYmVsOiAnMTYuJyB9LFxuICAgIHsgdmFsdWU6ICcxNycsIGxhYmVsOiAnMTcuJyB9LFxuICAgIHsgdmFsdWU6ICcxOCcsIGxhYmVsOiAnMTguJyB9LFxuICAgIHsgdmFsdWU6ICcxOScsIGxhYmVsOiAnMTkuJyB9LFxuICAgIHsgdmFsdWU6ICcyMCcsIGxhYmVsOiAnMjAuJyB9LFxuICAgIHsgdmFsdWU6ICcyMScsIGxhYmVsOiAnMjEuJyB9LFxuICAgIHsgdmFsdWU6ICcyMicsIGxhYmVsOiAnMjIuJyB9LFxuICAgIHsgdmFsdWU6ICcyMycsIGxhYmVsOiAnMjMuJyB9LFxuICAgIHsgdmFsdWU6ICcyNCcsIGxhYmVsOiAnMjQuJyB9LFxuICAgIHsgdmFsdWU6ICcyNScsIGxhYmVsOiAnMjUuJyB9LFxuICAgIHsgdmFsdWU6ICcyNicsIGxhYmVsOiAnMjYuJyB9LFxuICAgIHsgdmFsdWU6ICcyNycsIGxhYmVsOiAnMjcuJyB9LFxuICAgIHsgdmFsdWU6ICcyOCcsIGxhYmVsOiAnMjguJyB9LFxuICAgIHsgdmFsdWU6ICcyOScsIGxhYmVsOiAnMjkuJyB9LFxuICAgIHsgdmFsdWU6ICczMCcsIGxhYmVsOiAnMzAuJyB9LFxuICAgIHsgdmFsdWU6ICczMScsIGxhYmVsOiAnMzEuJyB9XG4gIF07XG4gIG1vbnRoczogYW55W10gPSBbXTtcbiAgaG91cnM6IGFueVtdID0gW107XG4gIG1pbnV0ZXM6IGFueVtdID0gW107XG4gIGludGVydmFscyA9IFtcbiAgICB7IHZhbHVlOiAyLCBsYWJlbDogZ2V0dGV4dCgnSG91cicpIH0sXG4gICAgeyB2YWx1ZTogMywgbGFiZWw6IGdldHRleHQoJ0RheScpIH0sXG4gICAgeyB2YWx1ZTogNCwgbGFiZWw6IGdldHRleHQoJ1dlZWsnKSB9LFxuICAgIHsgdmFsdWU6IDUsIGxhYmVsOiBnZXR0ZXh0KCdNb250aCcpIH0sXG4gICAgeyB2YWx1ZTogNiwgbGFiZWw6IGdldHRleHQoJ1llYXInKSB9XG4gIF07XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZSkge1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgMjQ7IHgrKykge1xuICAgICAgdGhpcy5ob3Vycy5wdXNoKHsgdmFsdWU6IHgudG9TdHJpbmcoKSwgbGFiZWw6IGAke3h9YCB9KTtcbiAgICB9XG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCA2MDsgeCA9IHggKyA1KSB7XG4gICAgICB0aGlzLm1pbnV0ZXMucHVzaCh7IHZhbHVlOiB4LnRvU3RyaW5nKCksIGxhYmVsOiBgJHt4fWAgfSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCA3OyB4KyspIHtcbiAgICAgIHRoaXMuZGF5c09mV2Vla1Bvc2l4LnB1c2goe1xuICAgICAgICB2YWx1ZTogeC50b1N0cmluZygpLFxuICAgICAgICBsYWJlbDogdGhpcy5nZXRXZWVrRGF5TmFtZSgoeyB3ZWVrZGF5OiB4IH0gYXMgdW5rbm93bikgYXMgQ3JvbkNvbmZpZylcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZvciAobGV0IHggPSAxOyB4IDwgMTM7IHgrKykge1xuICAgICAgdGhpcy5tb250aHMucHVzaCh7XG4gICAgICAgIHZhbHVlOiB4LnRvU3RyaW5nKCksXG4gICAgICAgIGxhYmVsOiB0aGlzLmdldE1vbnRoTmFtZSgoeyBtb250aDogeCB9IGFzIHVua25vd24pIGFzIENyb25Db25maWcpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZW5lcmF0ZUNyb24oY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGxldCBjcm9uOiBzdHJpbmcgPSAnJztcbiAgICBjcm9uID0gY3JvbkNvbmZpZy5taW51dGUgPyBgJHtjcm9uQ29uZmlnLm1pbnV0ZX1gIDogJyonO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy5ob3VyID8gYCAke2Nyb25Db25maWcuaG91cn1gIDogJyAqJztcbiAgICBjcm9uICs9IGNyb25Db25maWcuZGF5ID8gYCAke2Nyb25Db25maWcuZGF5fWAgOiAnIConO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy5tb250aCA/IGAgJHtjcm9uQ29uZmlnLm1vbnRofWAgOiAnIConO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy53ZWVrZGF5ID8gYCAke2Nyb25Db25maWcud2Vla2RheX1gIDogJyAqJztcblxuICAgIHJldHVybiBjcm9uO1xuICB9XG5cbiAgZ2VuZXJhdGVDcm9uQ29uZmlnKGNyb246IHN0cmluZykge1xuICAgIGNvbnN0IHBhcnRzID0gY3Jvbi5zcGxpdCgvXFxzKy8pO1xuICAgIGNvbnN0IGNyb25Db25maWc6IENyb25Db25maWcgPSB7XG4gICAgICBtaW51dGU6IHBhcnRzWzBdLFxuICAgICAgaG91cjogcGFydHNbMV0sXG4gICAgICBkYXk6IHBhcnRzWzJdLFxuICAgICAgbW9udGg6IHBhcnRzWzNdLFxuICAgICAgd2Vla2RheTogcGFydHNbNF1cbiAgICB9O1xuXG4gICAgcmV0dXJuIGNyb25Db25maWc7XG4gIH1cblxuICBnZXRCYXNlKGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBsZXQgYmFzZTogQmFzZSA9IEJhc2UuSW5pdGlhbDtcblxuICAgIGlmIChcbiAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuaG91ciA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmRheSA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9PT0gJyonXG4gICAgKSB7XG4gICAgICBiYXNlID0gQmFzZS5Ib3VyO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuRGF5O1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgIT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuV2VlaztcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuZGF5ICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcubW9udGggPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID09PSAnKidcbiAgICApIHtcbiAgICAgIGJhc2UgPSBCYXNlLk1vbnRoO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuWWVhcjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY3JvbkNvbmZpZyBpbnZhbGlkXG4gICAgfVxuXG4gICAgcmV0dXJuIGJhc2U7XG4gIH1cblxuICB2YWxpZGF0ZU1vZGVscyhiYXNlOiBCYXNlLCBjcm9uQ29uZmlnOiBDcm9uQ29uZmlnKSB7XG4gICAgbGV0IHZhbGlkOiBib29sZWFuO1xuICAgIHN3aXRjaCAoYmFzZSkge1xuICAgICAgY2FzZSBCYXNlLkluaXRpYWw6IC8vIFBsZWFzZSBzZWxlY3RcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEJhc2UuSG91cjpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicpIHtcbiAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5EYXk6XG4gICAgICAgIGlmIChjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmIGNyb25Db25maWcuaG91ciAhPT0gJyonKSB7XG4gICAgICAgICAgdmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEJhc2UuV2VlazpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicgJiYgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiYgY3JvbkNvbmZpZy53ZWVrZGF5ICE9PSAnKicpIHtcbiAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5Nb250aDpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicgJiYgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiYgY3JvbkNvbmZpZy5kYXkgIT09ICcqJykge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBCYXNlLlllYXI6XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICAgICAgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicgJiZcbiAgICAgICAgICBjcm9uQ29uZmlnLmRheSAhPT0gJyonICYmXG4gICAgICAgICAgY3JvbkNvbmZpZy5tb250aCAhPT0gJyonXG4gICAgICAgICkge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH1cblxuICBjbGVhck5leHRNb2RlbHMoYmFzZTogQmFzZSwgY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGlmIChiYXNlID09PSBCYXNlLkluaXRpYWwpIHtcbiAgICAgIC8vIHBsZWFzZSBzZWxlY3QsIGRlbGV0ZSBhbGxcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgbWludXRlIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSA9ICcqJztcbiAgICAgIGNyb25Db25maWcuaG91ciA9ICcqJztcbiAgICAgIGNyb25Db25maWcuZGF5ID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5tb250aCA9ICcqJztcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9ICcqJztcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuSG91cikge1xuICAgICAgLy8gaG91ciwgZG9uJ3QgZGVsZXRlIG1pbnV0ZXNcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgaG91ciwgYXQgd2hhdGV2ZXIgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgPSBjcm9uQ29uZmlnLm1pbnV0ZSA9PT0gJyonID8gdGhpcy5taW51dGVzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5taW51dGU7XG4gICAgICBjcm9uQ29uZmlnLmhvdXIgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLmRheSA9ICcqJztcbiAgICAgIGNyb25Db25maWcubW9udGggPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSAnKic7XG4gICAgfSBlbHNlIGlmIChiYXNlID09PSBCYXNlLkRheSkge1xuICAgICAgLy8gZGF5LCBkb24ndCBkZWxldGUgbWludXRlcyBhbmQgaG91cnNcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgZGF5IG9mIGV2ZXJ5IG1vbnRoLCBhdCB3aGF0ZXZlciBob3VyIGFuZCBtaW51dGUsIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSA9IGNyb25Db25maWcubWludXRlID09PSAnKicgPyB0aGlzLm1pbnV0ZXNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLm1pbnV0ZTtcbiAgICAgIGNyb25Db25maWcuaG91ciA9IGNyb25Db25maWcuaG91ciA9PT0gJyonID8gdGhpcy5ob3Vyc1swXS52YWx1ZSA6IGNyb25Db25maWcuaG91cjtcbiAgICAgIGNyb25Db25maWcuZGF5ID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5tb250aCA9ICcqJztcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9ICcqJztcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuV2Vlaykge1xuICAgICAgLy8gd2VlaywgZGVsZXRlIG1vbnRoIGFuZCBkYXlcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgbW9udGgsIGF0IHdoYXRldmVyIHdlZWtkYXksIGhvdXIgYW5kIG1pbnV0ZSwgYXQgc2Vjb25kIDBcbiAgICAgIGNyb25Db25maWcubWludXRlID0gY3JvbkNvbmZpZy5taW51dGUgPT09ICcqJyA/IHRoaXMubWludXRlc1swXS52YWx1ZSA6IGNyb25Db25maWcubWludXRlO1xuICAgICAgY3JvbkNvbmZpZy5ob3VyID0gY3JvbkNvbmZpZy5ob3VyID09PSAnKicgPyB0aGlzLmhvdXJzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5ob3VyO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gY3JvbkNvbmZpZy53ZWVrZGF5ID09PSAnKicgfHwgY3JvbkNvbmZpZy53ZWVrZGF5ID09PSAnPycgPyB0aGlzLmRheXNPZldlZWtQb3NpeFswXS52YWx1ZSA6IGNyb25Db25maWcud2Vla2RheSA7XG4gICAgfSBlbHNlIGlmIChiYXNlID09PSBCYXNlLk1vbnRoKSB7XG4gICAgICAvLyBtb250aCwgZGVsZXRlIG1vbnRoIGFuZCB3ZWVrZGF5XG4gICAgICAvLyBjcm9uIGV4cHJlc3Npb246IGV2ZXJ5IG1vbnRoLCBhdCB3aGF0ZXZlciBkYXkgb2YgbW9udGgsIGhvdXIgYW5kIG1pbnV0ZSwgYXQgc2Vjb25kIDBcbiAgICAgIGNyb25Db25maWcubWludXRlID0gY3JvbkNvbmZpZy5taW51dGUgPT09ICcqJyA/IHRoaXMubWludXRlc1swXS52YWx1ZSA6IGNyb25Db25maWcubWludXRlO1xuICAgICAgY3JvbkNvbmZpZy5ob3VyID0gY3JvbkNvbmZpZy5ob3VyID09PSAnKicgPyB0aGlzLmhvdXJzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5ob3VyO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSBjcm9uQ29uZmlnLmRheSA9PT0gJyonID8gdGhpcy5kYXlzT2ZNb250aFswXS52YWx1ZSA6IGNyb25Db25maWcuZGF5O1xuICAgICAgY3JvbkNvbmZpZy5tb250aCA9ICcqJztcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9ICcqJztcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuWWVhcikge1xuICAgICAgLy8geWVhciwgZGVsZXRlIHdlZWtkYXlcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgeWVhciwgYXQgd2hhdGV2ZXIgbW9udGgsIGRheSBvZiBtb250aCwgaG91ciBhbmQgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgPSBjcm9uQ29uZmlnLm1pbnV0ZSA9PT0gJyonID8gdGhpcy5taW51dGVzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5taW51dGU7XG4gICAgICBjcm9uQ29uZmlnLmhvdXIgPSBjcm9uQ29uZmlnLmhvdXIgPT09ICcqJyA/IHRoaXMuaG91cnNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLmhvdXI7XG4gICAgICBjcm9uQ29uZmlnLmRheSA9IGNyb25Db25maWcuZGF5ID09PSAnKicgPyB0aGlzLmRheXNPZk1vbnRoWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5kYXk7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gY3JvbkNvbmZpZy5tb250aCA9PT0gJyonID8gdGhpcy5tb250aHNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLm1vbnRoO1xuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgIH1cbiAgfVxuXG4gIGdldFdlZWtEYXlOYW1lKGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoMCk7XG4gICAgY29uc3QgZmlyc3RTdW5kYXlEYXRlID0gZGF0ZS5nZXREYXRlKCkgKyAzOyAvLyBiZWNhdXNlIHdlIGtub3cgZGF0ZSAwIHdhcyBvbiBUaHVyc2RheS4uLlxuICAgIGRhdGUuc2V0RGF0ZShmaXJzdFN1bmRheURhdGUgKyBwYXJzZUludChjcm9uQ29uZmlnLndlZWtkYXksIDEwKSk7XG4gICAgcmV0dXJuIGZvcm1hdERhdGUoZGF0ZSwgJ0VFRUUnLCB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuY3VycmVudExhbmcpO1xuICB9XG5cbiAgZ2V0TW9udGhEYXlOYW1lKGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBsZXQgbmFtZSA9ICcnO1xuICAgIHRoaXMuZGF5c09mTW9udGguZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGlmIChpdGVtLnZhbHVlID09PSBjcm9uQ29uZmlnLmRheSkge1xuICAgICAgICBuYW1lID0gaXRlbS5sYWJlbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBuYW1lO1xuICB9XG5cbiAgZ2V0TW9udGhOYW1lKGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoMCk7XG4gICAgZGF0ZS5zZXRNb250aChwYXJzZUludChjcm9uQ29uZmlnLm1vbnRoLCAxMCkgLSAxKTtcbiAgICByZXR1cm4gZm9ybWF0RGF0ZShkYXRlLCAnTExMTCcsIHRoaXMudHJhbnNsYXRlU2VydmljZS5jdXJyZW50TGFuZyk7XG4gIH1cbn1cbiJdfQ==