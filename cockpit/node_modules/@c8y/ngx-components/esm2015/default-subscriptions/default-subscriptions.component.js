import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { AlertService, gettext } from '@c8y/ngx-components';
import { DefaultSubscriptionsService } from './default-subscriptions.service';
/**
 * The component shows the main view for managing default subscriptions configuration.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/forms';
import * as ɵngcc2 from './default-subscriptions.service';
import * as ɵngcc3 from '@c8y/ngx-components';
import * as ɵngcc4 from '@angular/common';

function DefaultSubscriptionsComponent_div_40_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 23);
} }
function DefaultSubscriptionsComponent_div_41_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 24);
    ɵngcc0.ɵɵelement(1, "c8y-loading");
    ɵngcc0.ɵɵelementStart(2, "span", 8);
    ɵngcc0.ɵɵtext(3, "Loading application subscriptions\u2026");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
function DefaultSubscriptionsComponent_div_42_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 23);
} }
function DefaultSubscriptionsComponent_div_44_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 25);
} }
function DefaultSubscriptionsComponent_div_45_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 26);
    ɵngcc0.ɵɵelementStart(1, "div", 27);
    ɵngcc0.ɵɵelement(2, "h1", 28);
    ɵngcc0.ɵɵelementStart(3, "h3", 8);
    ɵngcc0.ɵɵtext(4, "No application subscriptions yet.");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "p", 8);
    ɵngcc0.ɵɵtext(6, " Select \"Override inherited\" to define the list of subscribed applications. ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
function DefaultSubscriptionsComponent_div_46_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 25);
} }
function DefaultSubscriptionsComponent_div_47_ng_container_1_span_25_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span");
} }
function DefaultSubscriptionsComponent_div_47_ng_container_1_span_26_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span", 49);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r11 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 1, ctx_r11.disabledCheckboxHint));
} }
function DefaultSubscriptionsComponent_div_47_ng_container_1_span_30_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span");
} }
function DefaultSubscriptionsComponent_div_47_ng_container_1_span_31_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span", 49);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r13 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 1, ctx_r13.disabledCheckboxHint));
} }
const _c0 = function (a0) { return { disabled: a0 }; };
function DefaultSubscriptionsComponent_div_47_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0, 30);
    ɵngcc0.ɵɵelementStart(1, "div", 31);
    ɵngcc0.ɵɵelementStart(2, "div", 32);
    ɵngcc0.ɵɵelementStart(3, "div", 33);
    ɵngcc0.ɵɵelementStart(4, "div", 34);
    ɵngcc0.ɵɵelement(5, "c8y-app-icon", 35);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 36);
    ɵngcc0.ɵɵelementStart(7, "div", 37);
    ɵngcc0.ɵɵelementStart(8, "div", 38);
    ɵngcc0.ɵɵelementStart(9, "p", 39);
    ɵngcc0.ɵɵpipe(10, "async");
    ɵngcc0.ɵɵpipe(11, "humanizeAppName");
    ɵngcc0.ɵɵtext(12);
    ɵngcc0.ɵɵpipe(13, "async");
    ɵngcc0.ɵɵpipe(14, "humanizeAppName");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "small", 40);
    ɵngcc0.ɵɵtext(16);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(17, "div", 41);
    ɵngcc0.ɵɵelementStart(18, "p");
    ɵngcc0.ɵɵelementStart(19, "span", 42);
    ɵngcc0.ɵɵtext(20, " Tenant ID ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtext(21);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(22, "div", 43);
    ɵngcc0.ɵɵelementStart(23, "label", 44);
    ɵngcc0.ɵɵelement(24, "input", 45);
    ɵngcc0.ɵɵtemplate(25, DefaultSubscriptionsComponent_div_47_ng_container_1_span_25_Template, 1, 0, "span", 46);
    ɵngcc0.ɵɵtemplate(26, DefaultSubscriptionsComponent_div_47_ng_container_1_span_26_Template, 2, 3, "span", 47);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(27, "div", 43);
    ɵngcc0.ɵɵelementStart(28, "label", 44);
    ɵngcc0.ɵɵelement(29, "input", 48);
    ɵngcc0.ɵɵtemplate(30, DefaultSubscriptionsComponent_div_47_ng_container_1_span_30_Template, 1, 0, "span", 46);
    ɵngcc0.ɵɵtemplate(31, DefaultSubscriptionsComponent_div_47_ng_container_1_span_31_Template, 2, 3, "span", 47);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r14 = ɵngcc0.ɵɵnextContext();
    const i_r8 = ctx_r14.index;
    const appRowControl_r7 = ctx_r14.$implicit;
    ɵngcc0.ɵɵpropertyInterpolate("formArrayName", i_r8);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("app", appRowControl_r7.value.app)("name", appRowControl_r7.value.app.name)("contextPath", appRowControl_r7.value.app.contextPath);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(10, 14, ɵngcc0.ɵɵpipeBind1(11, 16, appRowControl_r7.value.app)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 18, ɵngcc0.ɵɵpipeBind1(14, 20, appRowControl_r7.value.app)), " ");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(appRowControl_r7.value.app.contextPath);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate1(" ", appRowControl_r7.value.app.owner.tenant.id, " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(22, _c0, appRowControl_r7.controls.subscribedOnCreation.disabled));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !appRowControl_r7.controls.subscribedOnCreation.disabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", appRowControl_r7.controls.subscribedOnCreation.disabled);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(24, _c0, appRowControl_r7.controls.subscribedOnUpgrade.disabled));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !appRowControl_r7.controls.subscribedOnUpgrade.disabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", appRowControl_r7.controls.subscribedOnUpgrade.disabled);
} }
function DefaultSubscriptionsComponent_div_47_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtemplate(1, DefaultSubscriptionsComponent_div_47_ng_container_1_Template, 32, 26, "ng-container", 29);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const appRowControl_r7 = ctx.$implicit;
    const ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r6.shouldShowAppRow(appRowControl_r7.getRawValue()));
} }
export class DefaultSubscriptionsComponent {
    constructor(fb, defaultSubscriptionsService, alertService) {
        this.fb = fb;
        this.defaultSubscriptionsService = defaultSubscriptionsService;
        this.alertService = alertService;
        /** Hint text for disabled checkboxes. */
        this.disabledCheckboxHint = gettext('Select "Override inherited" to enable.');
    }
    /** Initializes the loading of the form and the current settings. */
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            this.loading = true;
            yield this.initForm();
            yield this.loadDefaultSubscriptions();
            this.loading = false;
        });
    }
    /** Loads the list of apps, builds the form and hooks value change events for override switches. */
    initForm() {
        return __awaiter(this, void 0, void 0, function* () {
            this.form = this.fb.group({
                overrideOnCreationSubscriptions: [''],
                overrideOnUpgradeSubscriptions: [''],
                appRows: this.fb.array([])
            });
            const apps = yield this.defaultSubscriptionsService.getSubscribableTenantApps();
            const appRows = this.form.controls.appRows;
            apps.forEach(app => {
                appRows.push(this.fb.group({
                    app: [app],
                    subscribedOnCreation: [''],
                    subscribedOnUpgrade: ['']
                }));
            });
            this.form
                .get('overrideOnCreationSubscriptions')
                .valueChanges.subscribe(value => this.onOverrideOnCreationSubscriptionsChange(value));
            this.form
                .get('overrideOnUpgradeSubscriptions')
                .valueChanges.subscribe(value => this.onOverrideOnUpgradeSubscriptionsChange(value));
        });
    }
    /**
     * Checks if given application row should be displayed.
     * The row is displayed when any of its checkboxes is selected or any of the lists is being overridden.
     */
    shouldShowAppRow(appRowRawValue) {
        const { subscribedOnCreation, subscribedOnUpgrade } = appRowRawValue;
        const { overrideOnCreationSubscriptions, overrideOnUpgradeSubscriptions } = this.form.value;
        return (subscribedOnCreation ||
            subscribedOnUpgrade ||
            overrideOnCreationSubscriptions ||
            overrideOnUpgradeSubscriptions);
    }
    /** Checks if there are no application rows to be displayed. */
    isEmptyView() {
        return !this.form
            .getRawValue()
            .appRows.some(appRowRawValue => this.shouldShowAppRow(appRowRawValue));
    }
    /**
     * Checks if given application is subscribed (present in the given list of applications).
     * @param app Application object to check.
     * @param subscribedApps The list of application objects to check against.
     * @returns True, if the application is present in the list.
     */
    isSubscribed(app, subscribedApps) {
        return subscribedApps && subscribedApps.some(subscribedApp => subscribedApp.name === app.name);
    }
    /** Saves the current value of form object to backend. */
    save() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const defaultSubscriptions = this.getDefaultSubscriptionsForSave();
                yield this.defaultSubscriptionsService.saveDefaultSubscriptionsToCurrentTenant(defaultSubscriptions);
                this.alertService.success(gettext('Saved.'));
            }
            catch (ex) {
                this.alertService.addServerFailure(ex);
            }
        });
    }
    onOverrideOnCreationSubscriptionsChange(overrideOnCreationSubscriptions) {
        const appRowsControls = this.form.controls.appRows.controls;
        if (overrideOnCreationSubscriptions) {
            this.enableSubscribeOnCreationCheckboxes();
            return;
        }
        this.disableSubscribeOnCreationCheckboxes();
        this.restoreSubscribeOnCreationFromParent();
    }
    enableSubscribeOnCreationCheckboxes() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.get('subscribedOnCreation').enable({ emitEvent: false });
        });
    }
    disableSubscribeOnCreationCheckboxes() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.get('subscribedOnCreation').disable({ emitEvent: false });
        });
    }
    restoreSubscribeOnCreationFromParent() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.patchValue({
                subscribedOnCreation: this.isSubscribed(appRowControl.value.app, this.parentDefaultSubscriptions.onCreationSubscriptions)
            });
        });
    }
    onOverrideOnUpgradeSubscriptionsChange(overrideOnUpgradeSubscriptions) {
        const appRowsControls = this.form.controls.appRows.controls;
        if (overrideOnUpgradeSubscriptions) {
            this.enableSubscribeOnUpgradeCheckboxes();
            return;
        }
        this.disableSubscribeOnUpgradeCheckboxes();
        this.restoreSubscribeOnUpgradeFromParent();
    }
    enableSubscribeOnUpgradeCheckboxes() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.get('subscribedOnUpgrade').enable({ emitEvent: false });
        });
    }
    disableSubscribeOnUpgradeCheckboxes() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.get('subscribedOnUpgrade').disable({ emitEvent: false });
        });
    }
    restoreSubscribeOnUpgradeFromParent() {
        const appRowsControls = this.form.controls.appRows.controls;
        appRowsControls.forEach(appRowControl => {
            appRowControl.patchValue({
                subscribedOnUpgrade: this.isSubscribed(appRowControl.value.app, this.parentDefaultSubscriptions.onUpgradeSubscriptions)
            });
        });
    }
    loadDefaultSubscriptions() {
        return __awaiter(this, void 0, void 0, function* () {
            this.parentDefaultSubscriptions = yield this.defaultSubscriptionsService.getDefaultSubscriptionsEvaluatedFromParentTenant();
            this.currentDefaultSubscriptions = yield this.defaultSubscriptionsService.getDefaultSubscriptionsFromCurrentTenant();
            const { overrideOnCreationSubscriptions, overrideOnUpgradeSubscriptions } = this.currentDefaultSubscriptions;
            const onCreationSubscriptions = overrideOnCreationSubscriptions
                ? this.currentDefaultSubscriptions.onCreationSubscriptions
                : this.parentDefaultSubscriptions.onCreationSubscriptions;
            const onUpgradeSubscriptions = overrideOnUpgradeSubscriptions
                ? this.currentDefaultSubscriptions.onUpgradeSubscriptions
                : this.parentDefaultSubscriptions.onUpgradeSubscriptions;
            this.form.patchValue({
                overrideOnCreationSubscriptions,
                overrideOnUpgradeSubscriptions
            });
            this.form.controls.appRows.controls.forEach(appRowControl => {
                appRowControl.patchValue({
                    subscribedOnCreation: this.isSubscribed(appRowControl.value.app, onCreationSubscriptions),
                    subscribedOnUpgrade: this.isSubscribed(appRowControl.value.app, onUpgradeSubscriptions)
                });
            });
        });
    }
    getDefaultSubscriptionsForSave() {
        const { value } = this.form;
        return {
            overrideOnCreationSubscriptions: value.overrideOnCreationSubscriptions,
            onCreationSubscriptions: value.overrideOnCreationSubscriptions
                ? value.appRows.filter(app => app.subscribedOnCreation).map(app => app.app)
                : null,
            overrideOnUpgradeSubscriptions: value.overrideOnUpgradeSubscriptions,
            onUpgradeSubscriptions: value.overrideOnUpgradeSubscriptions
                ? value.appRows.filter(app => app.subscribedOnUpgrade).map(app => app.app)
                : null
        };
    }
}
DefaultSubscriptionsComponent.ɵfac = function DefaultSubscriptionsComponent_Factory(t) { return new (t || DefaultSubscriptionsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DefaultSubscriptionsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.AlertService)); };
DefaultSubscriptionsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DefaultSubscriptionsComponent, selectors: [["c8y-default-subscriptions"]], decls: 53, vars: 30, consts: [[3, "formGroup", "ngSubmit"], [1, "card", "card--fullpage", "col-lg-max"], [1, "card-header", "separator"], ["translate", "", 1, "card-title"], [1, "inner-scroll"], [1, "sticky-top", "separator-bottom"], [1, "flex-row"], [1, "col-sm-6", "col-xs-6", "p-l-24", "p-l-xs-16"], ["translate", ""], [1, "col-sm-6", "col-xs-6", "bg-gray-white", "p-16", "text-center", "separator-bottom"], [1, "row"], [1, "col-sm-6", "col-xs-6"], [1, "c8y-switch", 3, "title"], ["type", "checkbox", "formControlName", "overrideOnCreationSubscriptions"], ["type", "checkbox", "formControlName", "overrideOnUpgradeSubscriptions"], ["class", "card-block", 4, "ngIf"], ["class", "card-block card-block d-flex a-i-center j-c-center d-col", 4, "ngIf"], ["formArrayName", "appRows"], ["class", "bg-gray-white", 4, "ngIf"], ["class", "card-block bg-white", 4, "ngIf"], [4, "ngFor", "ngForOf"], [1, "card-footer", "separator"], ["type", "submit", 1, "btn", "btn-primary", 3, "disabled", "title"], [1, "card-block"], [1, "card-block", "card-block", "d-flex", "a-i-center", "j-c-center", "d-col"], [1, "bg-gray-white"], [1, "card-block", "bg-white"], [1, "c8y-empty-state"], [1, "c8y-icon", "c8y-icon-c8y-data", "c8y-icon-duocolor"], [3, "formArrayName", 4, "ngIf"], [3, "formArrayName"], [1, "flex-row", "a-i-stretch"], [1, "col-sm-6", "col-xs-6", "separator-bottom"], [1, "c8y-list__item__block"], [1, "c8y-list__item__appicon"], [3, "app", "name", "contextPath"], [1, "c8y-list__item__body"], [1, "content-flex-30"], [1, "col-6"], [1, "text-truncate", 3, "title"], [1, "text-muted"], [1, "col-6", "text-right-sm"], ["translate", "", 1, "text-label-small", "m-r-4"], [1, "col-sm-3", "col-xs-3", "bg-gray-white", "separator-bottom", "d-flex", "j-c-center", "a-i-center"], [1, "c8y-checkbox", 3, "ngClass"], ["type", "checkbox", "formControlName", "subscribedOnCreation"], [4, "ngIf"], [3, "title", 4, "ngIf"], ["type", "checkbox", "formControlName", "subscribedOnUpgrade"], [3, "title"]], template: function DefaultSubscriptionsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-title");
        ɵngcc0.ɵɵtext(1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "form", 0);
        ɵngcc0.ɵɵlistener("ngSubmit", function DefaultSubscriptionsComponent_Template_form_ngSubmit_3_listener() { return ctx.save(); });
        ɵngcc0.ɵɵelementStart(4, "div", 1);
        ɵngcc0.ɵɵelementStart(5, "div", 2);
        ɵngcc0.ɵɵelementStart(6, "h4", 3);
        ɵngcc0.ɵɵtext(7, "Applications");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "div", 4);
        ɵngcc0.ɵɵelementStart(9, "div", 5);
        ɵngcc0.ɵɵelementStart(10, "div", 6);
        ɵngcc0.ɵɵelementStart(11, "div", 7);
        ɵngcc0.ɵɵelementStart(12, "p", 8);
        ɵngcc0.ɵɵtext(13, " Configure default subscriptions in the platform, both for tenant creation and for platform upgrade. To display a full list of available applications, override inherited settings. ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "div", 9);
        ɵngcc0.ɵɵelementStart(15, "div", 10);
        ɵngcc0.ɵɵelementStart(16, "div", 11);
        ɵngcc0.ɵɵelementStart(17, "p");
        ɵngcc0.ɵɵelementStart(18, "strong", 8);
        ɵngcc0.ɵɵtext(19, "Subscribed on tenant creation");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "div");
        ɵngcc0.ɵɵelementStart(21, "label", 12);
        ɵngcc0.ɵɵpipe(22, "translate");
        ɵngcc0.ɵɵelement(23, "input", 13);
        ɵngcc0.ɵɵelement(24, "span");
        ɵngcc0.ɵɵelementStart(25, "span");
        ɵngcc0.ɵɵtext(26);
        ɵngcc0.ɵɵpipe(27, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(28, "div", 11);
        ɵngcc0.ɵɵelementStart(29, "p");
        ɵngcc0.ɵɵelementStart(30, "strong", 8);
        ɵngcc0.ɵɵtext(31, "Subscribed on platform upgrade");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(32, "div");
        ɵngcc0.ɵɵelementStart(33, "label", 12);
        ɵngcc0.ɵɵpipe(34, "translate");
        ɵngcc0.ɵɵelement(35, "input", 14);
        ɵngcc0.ɵɵelement(36, "span");
        ɵngcc0.ɵɵelementStart(37, "span");
        ɵngcc0.ɵɵtext(38);
        ɵngcc0.ɵɵpipe(39, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(40, DefaultSubscriptionsComponent_div_40_Template, 1, 0, "div", 15);
        ɵngcc0.ɵɵtemplate(41, DefaultSubscriptionsComponent_div_41_Template, 4, 0, "div", 16);
        ɵngcc0.ɵɵtemplate(42, DefaultSubscriptionsComponent_div_42_Template, 1, 0, "div", 15);
        ɵngcc0.ɵɵelementContainerStart(43, 17);
        ɵngcc0.ɵɵtemplate(44, DefaultSubscriptionsComponent_div_44_Template, 1, 0, "div", 18);
        ɵngcc0.ɵɵtemplate(45, DefaultSubscriptionsComponent_div_45_Template, 7, 0, "div", 19);
        ɵngcc0.ɵɵtemplate(46, DefaultSubscriptionsComponent_div_46_Template, 1, 0, "div", 18);
        ɵngcc0.ɵɵtemplate(47, DefaultSubscriptionsComponent_div_47_Template, 2, 1, "div", 20);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(48, "div", 21);
        ɵngcc0.ɵɵelementStart(49, "button", 22);
        ɵngcc0.ɵɵpipe(50, "translate");
        ɵngcc0.ɵɵtext(51);
        ɵngcc0.ɵɵpipe(52, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 16, "Default subscriptions"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("formGroup", ctx.form);
        ɵngcc0.ɵɵadvance(18);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(22, 18, "Override inherited"));
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(27, 20, "Override inherited"), " ");
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(34, 22, "Override inherited"));
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(39, 24, "Override inherited"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.loading);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.loading);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.loading);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.loading && ctx.isEmptyView());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.loading && ctx.isEmptyView());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.loading && ctx.isEmptyView());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.form.get("appRows")["controls"]);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(50, 26, "Save default subscriptions"));
        ɵngcc0.ɵɵproperty("disabled", ctx.form.invalid || ctx.form.pristine);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(52, 28, "Save"), " ");
    } }, directives: [ɵngcc3.TitleComponent, ɵngcc1.ɵNgNoValidate, ɵngcc1.NgControlStatusGroup, ɵngcc1.FormGroupDirective, ɵngcc3.C8yTranslateDirective, ɵngcc1.CheckboxControlValueAccessor, ɵngcc1.NgControlStatus, ɵngcc1.FormControlName, ɵngcc4.NgIf, ɵngcc1.FormArrayName, ɵngcc4.NgForOf, ɵngcc3.LoadingComponent, ɵngcc3.AppIconComponent, ɵngcc4.NgClass], pipes: [ɵngcc3.C8yTranslatePipe, ɵngcc4.AsyncPipe, ɵngcc3.HumanizeAppNamePipe], encapsulation: 2 });
DefaultSubscriptionsComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: DefaultSubscriptionsService },
    { type: AlertService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DefaultSubscriptionsComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-default-subscriptions',
                template: "<c8y-title>{{ 'Default subscriptions' | translate }}</c8y-title>\n\n<form [formGroup]=\"form\" (ngSubmit)=\"save()\">\n  <div class=\"card card--fullpage col-lg-max\">\n    <div class=\"card-header separator\">\n      <h4 class=\"card-title\" translate>Applications</h4>\n    </div>\n    <div class=\"inner-scroll\">\n      <div class=\"sticky-top separator-bottom\">\n        <div class=\"flex-row\">\n          <div class=\"col-sm-6 col-xs-6 p-l-24 p-l-xs-16\">\n            <p translate>\n              Configure default subscriptions in the platform, both for tenant creation and for\n              platform upgrade. To display a full list of available applications, override inherited\n              settings.\n            </p>\n          </div>\n          <div class=\"col-sm-6 col-xs-6 bg-gray-white p-16 text-center separator-bottom\">\n            <div class=\"row\">\n              <div class=\"col-sm-6 col-xs-6\">\n                <p><strong translate>Subscribed on tenant creation</strong></p>\n                <div>\n                  <label class=\"c8y-switch\" title=\"{{ 'Override inherited' | translate }}\">\n                    <input type=\"checkbox\" formControlName=\"overrideOnCreationSubscriptions\" />\n                    <span></span>\n                    <span>\n                      {{ 'Override inherited' | translate }}\n                    </span>\n                  </label>\n                </div>\n              </div>\n              <div class=\"col-sm-6 col-xs-6\">\n                <p><strong translate>Subscribed on platform upgrade</strong></p>\n                <div>\n                  <label class=\"c8y-switch\" title=\"{{ 'Override inherited' | translate }}\">\n                    <input type=\"checkbox\" formControlName=\"overrideOnUpgradeSubscriptions\" />\n                    <span></span>\n                    <span>\n                      {{ 'Override inherited' | translate }}\n                    </span>\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"card-block\" *ngIf=\"loading\"></div>\n      <div class=\"card-block card-block d-flex a-i-center j-c-center d-col\" *ngIf=\"loading\">\n        <c8y-loading></c8y-loading>\n        <span translate>Loading application subscriptions\u2026</span>\n      </div>\n      <div class=\"card-block\" *ngIf=\"loading\"></div>\n\n      <ng-container formArrayName=\"appRows\">\n        <div class=\"bg-gray-white\" *ngIf=\"!loading && isEmptyView()\"></div>\n        <div class=\"card-block bg-white\" *ngIf=\"!loading && isEmptyView()\">\n          <div class=\"c8y-empty-state\">\n            <h1 class=\"c8y-icon c8y-icon-c8y-data c8y-icon-duocolor\"></h1>\n            <h3 translate>No application subscriptions yet.</h3>\n            <p translate>\n              Select \"Override inherited\" to define the list of subscribed applications.\n            </p>\n          </div>\n        </div>\n        <div class=\"bg-gray-white\" *ngIf=\"!loading && isEmptyView()\"></div>\n\n        <div *ngFor=\"let appRowControl of form.get('appRows')['controls']; let i = index\">\n          <ng-container\n            *ngIf=\"shouldShowAppRow(appRowControl.getRawValue())\"\n            formArrayName=\"{{ i }}\"\n          >\n            <div class=\"flex-row a-i-stretch\">\n              <div class=\"col-sm-6 col-xs-6 separator-bottom\">\n                <div class=\"c8y-list__item__block\">\n                  <div class=\"c8y-list__item__appicon\">\n                    <c8y-app-icon\n                      [app]=\"appRowControl.value.app\"\n                      [name]=\"appRowControl.value.app.name\"\n                      [contextPath]=\"appRowControl.value.app.contextPath\"\n                    ></c8y-app-icon>\n                  </div>\n                  <div class=\"c8y-list__item__body\">\n                    <div class=\"content-flex-30\">\n                      <div class=\"col-6\">\n                        <p\n                          class=\"text-truncate\"\n                          title=\"{{ appRowControl.value.app | humanizeAppName | async }}\"\n                        >\n                          {{ appRowControl.value.app | humanizeAppName | async }}\n                        </p>\n                        <small class=\"text-muted\">{{ appRowControl.value.app.contextPath }}</small>\n                      </div>\n                      <div class=\"col-6 text-right-sm\">\n                        <p>\n                          <span class=\"text-label-small m-r-4\" translate> Tenant ID </span>\n                          {{ appRowControl.value.app.owner.tenant.id }}\n                        </p>\n                        <!-- TODO: uncomment when company name is available\n                            <p>\n                            <span class=\"text-label-small m-r-4\" translate>Company</span>\n                            <small class=\"text-muted\">company name</small>\n                          </p> -->\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div\n                class=\"\n                  col-sm-3 col-xs-3\n                  bg-gray-white\n                  separator-bottom\n                  d-flex\n                  j-c-center\n                  a-i-center\n                \"\n              >\n                <label\n                  class=\"c8y-checkbox\"\n                  [ngClass]=\"{ disabled: appRowControl.controls.subscribedOnCreation.disabled }\"\n                >\n                  <input type=\"checkbox\" formControlName=\"subscribedOnCreation\" />\n                  <span *ngIf=\"!appRowControl.controls.subscribedOnCreation.disabled\"></span>\n                  <span\n                    *ngIf=\"appRowControl.controls.subscribedOnCreation.disabled\"\n                    title=\"{{ disabledCheckboxHint | translate }}\"\n                  ></span>\n                </label>\n              </div>\n\n              <div\n                class=\"\n                  col-sm-3 col-xs-3\n                  bg-gray-white\n                  separator-bottom\n                  d-flex\n                  j-c-center\n                  a-i-center\n                \"\n              >\n                <label\n                  class=\"c8y-checkbox\"\n                  [ngClass]=\"{ disabled: appRowControl.controls.subscribedOnUpgrade.disabled }\"\n                >\n                  <input type=\"checkbox\" formControlName=\"subscribedOnUpgrade\" />\n                  <span *ngIf=\"!appRowControl.controls.subscribedOnUpgrade.disabled\"></span>\n                  <span\n                    *ngIf=\"appRowControl.controls.subscribedOnUpgrade.disabled\"\n                    title=\"{{ disabledCheckboxHint | translate }}\"\n                  ></span>\n                </label>\n              </div>\n            </div>\n          </ng-container>\n        </div>\n      </ng-container>\n    </div>\n    <div class=\"card-footer separator\">\n      <button\n        type=\"submit\"\n        class=\"btn btn-primary\"\n        [disabled]=\"form.invalid || form.pristine\"\n        title=\"{{ 'Save default subscriptions' | translate }}\"\n      >\n        {{ 'Save' | translate }}\n      </button>\n    </div>\n  </div>\n</form>\n"
            }]
    }], function () { return [{ type: ɵngcc1.FormBuilder }, { type: ɵngcc2.DefaultSubscriptionsService }, { type: ɵngcc3.AlertService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmYXVsdC1zdWJzY3JpcHRpb25zLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGVmYXVsdC1zdWJzY3JpcHRpb25zL2RlZmF1bHQtc3Vic2NyaXB0aW9ucy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUMsT0FBTyxFQUFhLFdBQVcsRUFBYSxNQUFNLGdCQUFnQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFNUQsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFOUU7QUFDQTtBQUNBLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0gsTUFBTSxPQUFPLDZCQUE2QjtBQUMxQyxJQVdFLFlBQ1UsRUFBZSxFQUNmLDJCQUF3RCxFQUN4RCxZQUEwQjtBQUNuQyxRQUhTLE9BQUUsR0FBRixFQUFFLENBQWE7QUFBQyxRQUNoQixnQ0FBMkIsR0FBM0IsMkJBQTJCLENBQTZCO0FBQUMsUUFDekQsaUJBQVksR0FBWixZQUFZLENBQWM7QUFDdEMsUUFQRSx5Q0FBeUM7QUFDM0MsUUFBRSx5QkFBb0IsR0FBRyxPQUFPLENBQUMsd0NBQXdDLENBQUMsQ0FBQztBQUMzRSxJQUtLLENBQUM7QUFDTixJQUNFLG9FQUFvRTtBQUN0RSxJQUFRLFFBQVE7QUFDaEI7QUFFVSxZQUZOLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0FBQ3hCLFlBQUksTUFBTSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDMUIsWUFBSSxNQUFNLElB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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBQXFELGNBQ3REOzs7Ozs7d2NBQ0k7QUFBQztBQUNVLFlBZEksV0FBVztBQUFJLFlBSTFCLDJCQUEyQjtBQUFJLFlBRi9CLFlBQVk7QUFBRzs7Ozs7Ozt5SkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQXJyYXksIEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBJQXBwbGljYXRpb24gfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UsIGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IERlZmF1bHRTdWJzY3JpcHRpb25zLCBQYXJ0aWFsQXBwc0xpc3QgfSBmcm9tICcuL2RlZmF1bHQtc3Vic2NyaXB0aW9ucy5tb2RlbCc7XG5pbXBvcnQgeyBEZWZhdWx0U3Vic2NyaXB0aW9uc1NlcnZpY2UgfSBmcm9tICcuL2RlZmF1bHQtc3Vic2NyaXB0aW9ucy5zZXJ2aWNlJztcblxuLyoqXG4gKiBUaGUgY29tcG9uZW50IHNob3dzIHRoZSBtYWluIHZpZXcgZm9yIG1hbmFnaW5nIGRlZmF1bHQgc3Vic2NyaXB0aW9ucyBjb25maWd1cmF0aW9uLlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktZGVmYXVsdC1zdWJzY3JpcHRpb25zJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RlZmF1bHQtc3Vic2NyaXB0aW9ucy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRGVmYXVsdFN1YnNjcmlwdGlvbnNDb21wb25lbnQge1xuICAvKiogRGVmYXVsdCBzdWJzY3JpcHRpb25zIGluaGVyaXRlZCBmcm9tIHBhcmVudCB0ZW5hbnQuICovXG4gIHBhcmVudERlZmF1bHRTdWJzY3JpcHRpb25zOiBEZWZhdWx0U3Vic2NyaXB0aW9ucztcbiAgLyoqIERlZmF1bHQgc3Vic2NyaXB0aW9ucyBkZWZpbmVkIGluIHRoZSBjdXJyZW50IHRlbmFudC4gKi9cbiAgY3VycmVudERlZmF1bHRTdWJzY3JpcHRpb25zOiBEZWZhdWx0U3Vic2NyaXB0aW9ucztcbiAgLyoqIEZvcm0gb2JqZWN0LiAqL1xuICBmb3JtOiBGb3JtR3JvdXA7XG4gIC8qKiBXaGV0aGVyIHRoZSBjb25maWd1cmF0aW9uIGlzIGJlaW5nIGxvYWRlZC4gKi9cbiAgbG9hZGluZzogYm9vbGVhbjtcbiAgLyoqIEhpbnQgdGV4dCBmb3IgZGlzYWJsZWQgY2hlY2tib3hlcy4gKi9cbiAgZGlzYWJsZWRDaGVja2JveEhpbnQgPSBnZXR0ZXh0KCdTZWxlY3QgXCJPdmVycmlkZSBpbmhlcml0ZWRcIiB0byBlbmFibGUuJyk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBmYjogRm9ybUJ1aWxkZXIsXG4gICAgcHJpdmF0ZSBkZWZhdWx0U3Vic2NyaXB0aW9uc1NlcnZpY2U6IERlZmF1bHRTdWJzY3JpcHRpb25zU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlXG4gICkge31cblxuICAvKiogSW5pdGlhbGl6ZXMgdGhlIGxvYWRpbmcgb2YgdGhlIGZvcm0gYW5kIHRoZSBjdXJyZW50IHNldHRpbmdzLiAqL1xuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMuaW5pdEZvcm0oKTtcbiAgICBhd2FpdCB0aGlzLmxvYWREZWZhdWx0U3Vic2NyaXB0aW9ucygpO1xuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICB9XG5cbiAgLyoqIExvYWRzIHRoZSBsaXN0IG9mIGFwcHMsIGJ1aWxkcyB0aGUgZm9ybSBhbmQgaG9va3MgdmFsdWUgY2hhbmdlIGV2ZW50cyBmb3Igb3ZlcnJpZGUgc3dpdGNoZXMuICovXG4gIGFzeW5jIGluaXRGb3JtKCkge1xuICAgIHRoaXMuZm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgb3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9uczogWycnXSxcbiAgICAgIG92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9uczogWycnXSxcbiAgICAgIGFwcFJvd3M6IHRoaXMuZmIuYXJyYXkoW10pXG4gICAgfSk7XG5cbiAgICBjb25zdCBhcHBzID0gYXdhaXQgdGhpcy5kZWZhdWx0U3Vic2NyaXB0aW9uc1NlcnZpY2UuZ2V0U3Vic2NyaWJhYmxlVGVuYW50QXBwcygpO1xuICAgIGNvbnN0IGFwcFJvd3MgPSB0aGlzLmZvcm0uY29udHJvbHMuYXBwUm93cyBhcyBGb3JtQXJyYXk7XG4gICAgYXBwcy5mb3JFYWNoKGFwcCA9PiB7XG4gICAgICBhcHBSb3dzLnB1c2goXG4gICAgICAgIHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgICAgIGFwcDogW2FwcF0sXG4gICAgICAgICAgc3Vic2NyaWJlZE9uQ3JlYXRpb246IFsnJ10sXG4gICAgICAgICAgc3Vic2NyaWJlZE9uVXBncmFkZTogWycnXVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRoaXMuZm9ybVxuICAgICAgLmdldCgnb3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9ucycpXG4gICAgICAudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWx1ZSA9PiB0aGlzLm9uT3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9uc0NoYW5nZSh2YWx1ZSkpO1xuXG4gICAgdGhpcy5mb3JtXG4gICAgICAuZ2V0KCdvdmVycmlkZU9uVXBncmFkZVN1YnNjcmlwdGlvbnMnKVxuICAgICAgLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWUgPT4gdGhpcy5vbk92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9uc0NoYW5nZSh2YWx1ZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBnaXZlbiBhcHBsaWNhdGlvbiByb3cgc2hvdWxkIGJlIGRpc3BsYXllZC5cbiAgICogVGhlIHJvdyBpcyBkaXNwbGF5ZWQgd2hlbiBhbnkgb2YgaXRzIGNoZWNrYm94ZXMgaXMgc2VsZWN0ZWQgb3IgYW55IG9mIHRoZSBsaXN0cyBpcyBiZWluZyBvdmVycmlkZGVuLlxuICAgKi9cbiAgc2hvdWxkU2hvd0FwcFJvdyhhcHBSb3dSYXdWYWx1ZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgc3Vic2NyaWJlZE9uQ3JlYXRpb24sIHN1YnNjcmliZWRPblVwZ3JhZGUgfSA9IGFwcFJvd1Jhd1ZhbHVlO1xuICAgIGNvbnN0IHsgb3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9ucywgb3ZlcnJpZGVPblVwZ3JhZGVTdWJzY3JpcHRpb25zIH0gPSB0aGlzLmZvcm0udmFsdWU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgc3Vic2NyaWJlZE9uQ3JlYXRpb24gfHxcbiAgICAgIHN1YnNjcmliZWRPblVwZ3JhZGUgfHxcbiAgICAgIG92ZXJyaWRlT25DcmVhdGlvblN1YnNjcmlwdGlvbnMgfHxcbiAgICAgIG92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9uc1xuICAgICk7XG4gIH1cblxuICAvKiogQ2hlY2tzIGlmIHRoZXJlIGFyZSBubyBhcHBsaWNhdGlvbiByb3dzIHRvIGJlIGRpc3BsYXllZC4gKi9cbiAgaXNFbXB0eVZpZXcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmZvcm1cbiAgICAgIC5nZXRSYXdWYWx1ZSgpXG4gICAgICAuYXBwUm93cy5zb21lKGFwcFJvd1Jhd1ZhbHVlID0+IHRoaXMuc2hvdWxkU2hvd0FwcFJvdyhhcHBSb3dSYXdWYWx1ZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBnaXZlbiBhcHBsaWNhdGlvbiBpcyBzdWJzY3JpYmVkIChwcmVzZW50IGluIHRoZSBnaXZlbiBsaXN0IG9mIGFwcGxpY2F0aW9ucykuXG4gICAqIEBwYXJhbSBhcHAgQXBwbGljYXRpb24gb2JqZWN0IHRvIGNoZWNrLlxuICAgKiBAcGFyYW0gc3Vic2NyaWJlZEFwcHMgVGhlIGxpc3Qgb2YgYXBwbGljYXRpb24gb2JqZWN0cyB0byBjaGVjayBhZ2FpbnN0LlxuICAgKiBAcmV0dXJucyBUcnVlLCBpZiB0aGUgYXBwbGljYXRpb24gaXMgcHJlc2VudCBpbiB0aGUgbGlzdC5cbiAgICovXG4gIGlzU3Vic2NyaWJlZChhcHA6IElBcHBsaWNhdGlvbiwgc3Vic2NyaWJlZEFwcHM6IFBhcnRpYWxBcHBzTGlzdCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBzdWJzY3JpYmVkQXBwcyAmJiBzdWJzY3JpYmVkQXBwcy5zb21lKHN1YnNjcmliZWRBcHAgPT4gc3Vic2NyaWJlZEFwcC5uYW1lID09PSBhcHAubmFtZSk7XG4gIH1cblxuICAvKiogU2F2ZXMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgZm9ybSBvYmplY3QgdG8gYmFja2VuZC4gKi9cbiAgYXN5bmMgc2F2ZSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGVmYXVsdFN1YnNjcmlwdGlvbnMgPSB0aGlzLmdldERlZmF1bHRTdWJzY3JpcHRpb25zRm9yU2F2ZSgpO1xuICAgICAgYXdhaXQgdGhpcy5kZWZhdWx0U3Vic2NyaXB0aW9uc1NlcnZpY2Uuc2F2ZURlZmF1bHRTdWJzY3JpcHRpb25zVG9DdXJyZW50VGVuYW50KFxuICAgICAgICBkZWZhdWx0U3Vic2NyaXB0aW9uc1xuICAgICAgKTtcbiAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoZ2V0dGV4dCgnU2F2ZWQuJykpO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKGV4KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9uT3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9uc0NoYW5nZShvdmVycmlkZU9uQ3JlYXRpb25TdWJzY3JpcHRpb25zOiBib29sZWFuKSB7XG4gICAgY29uc3QgYXBwUm93c0NvbnRyb2xzID0gKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHM7XG4gICAgaWYgKG92ZXJyaWRlT25DcmVhdGlvblN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIHRoaXMuZW5hYmxlU3Vic2NyaWJlT25DcmVhdGlvbkNoZWNrYm94ZXMoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5kaXNhYmxlU3Vic2NyaWJlT25DcmVhdGlvbkNoZWNrYm94ZXMoKTtcbiAgICB0aGlzLnJlc3RvcmVTdWJzY3JpYmVPbkNyZWF0aW9uRnJvbVBhcmVudCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbmFibGVTdWJzY3JpYmVPbkNyZWF0aW9uQ2hlY2tib3hlcygpIHtcbiAgICBjb25zdCBhcHBSb3dzQ29udHJvbHMgPSAodGhpcy5mb3JtLmNvbnRyb2xzLmFwcFJvd3MgYXMgRm9ybUFycmF5KS5jb250cm9scztcbiAgICBhcHBSb3dzQ29udHJvbHMuZm9yRWFjaChhcHBSb3dDb250cm9sID0+IHtcbiAgICAgIGFwcFJvd0NvbnRyb2wuZ2V0KCdzdWJzY3JpYmVkT25DcmVhdGlvbicpLmVuYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc2FibGVTdWJzY3JpYmVPbkNyZWF0aW9uQ2hlY2tib3hlcygpIHtcbiAgICBjb25zdCBhcHBSb3dzQ29udHJvbHMgPSAodGhpcy5mb3JtLmNvbnRyb2xzLmFwcFJvd3MgYXMgRm9ybUFycmF5KS5jb250cm9scztcbiAgICBhcHBSb3dzQ29udHJvbHMuZm9yRWFjaChhcHBSb3dDb250cm9sID0+IHtcbiAgICAgIGFwcFJvd0NvbnRyb2wuZ2V0KCdzdWJzY3JpYmVkT25DcmVhdGlvbicpLmRpc2FibGUoeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZXN0b3JlU3Vic2NyaWJlT25DcmVhdGlvbkZyb21QYXJlbnQoKSB7XG4gICAgY29uc3QgYXBwUm93c0NvbnRyb2xzID0gKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHM7XG4gICAgYXBwUm93c0NvbnRyb2xzLmZvckVhY2goYXBwUm93Q29udHJvbCA9PiB7XG4gICAgICBhcHBSb3dDb250cm9sLnBhdGNoVmFsdWUoe1xuICAgICAgICBzdWJzY3JpYmVkT25DcmVhdGlvbjogdGhpcy5pc1N1YnNjcmliZWQoXG4gICAgICAgICAgYXBwUm93Q29udHJvbC52YWx1ZS5hcHAsXG4gICAgICAgICAgdGhpcy5wYXJlbnREZWZhdWx0U3Vic2NyaXB0aW9ucy5vbkNyZWF0aW9uU3Vic2NyaXB0aW9uc1xuICAgICAgICApXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25PdmVycmlkZU9uVXBncmFkZVN1YnNjcmlwdGlvbnNDaGFuZ2Uob3ZlcnJpZGVPblVwZ3JhZGVTdWJzY3JpcHRpb25zOiBib29sZWFuKSB7XG4gICAgY29uc3QgYXBwUm93c0NvbnRyb2xzID0gKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHM7XG4gICAgaWYgKG92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9ucykge1xuICAgICAgdGhpcy5lbmFibGVTdWJzY3JpYmVPblVwZ3JhZGVDaGVja2JveGVzKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZVN1YnNjcmliZU9uVXBncmFkZUNoZWNrYm94ZXMoKTtcbiAgICB0aGlzLnJlc3RvcmVTdWJzY3JpYmVPblVwZ3JhZGVGcm9tUGFyZW50KCk7XG4gIH1cblxuICBwcml2YXRlIGVuYWJsZVN1YnNjcmliZU9uVXBncmFkZUNoZWNrYm94ZXMoKSB7XG4gICAgY29uc3QgYXBwUm93c0NvbnRyb2xzID0gKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHM7XG4gICAgYXBwUm93c0NvbnRyb2xzLmZvckVhY2goYXBwUm93Q29udHJvbCA9PiB7XG4gICAgICBhcHBSb3dDb250cm9sLmdldCgnc3Vic2NyaWJlZE9uVXBncmFkZScpLmVuYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRpc2FibGVTdWJzY3JpYmVPblVwZ3JhZGVDaGVja2JveGVzKCkge1xuICAgIGNvbnN0IGFwcFJvd3NDb250cm9scyA9ICh0aGlzLmZvcm0uY29udHJvbHMuYXBwUm93cyBhcyBGb3JtQXJyYXkpLmNvbnRyb2xzO1xuICAgIGFwcFJvd3NDb250cm9scy5mb3JFYWNoKGFwcFJvd0NvbnRyb2wgPT4ge1xuICAgICAgYXBwUm93Q29udHJvbC5nZXQoJ3N1YnNjcmliZWRPblVwZ3JhZGUnKS5kaXNhYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzdG9yZVN1YnNjcmliZU9uVXBncmFkZUZyb21QYXJlbnQoKSB7XG4gICAgY29uc3QgYXBwUm93c0NvbnRyb2xzID0gKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHM7XG4gICAgYXBwUm93c0NvbnRyb2xzLmZvckVhY2goYXBwUm93Q29udHJvbCA9PiB7XG4gICAgICBhcHBSb3dDb250cm9sLnBhdGNoVmFsdWUoe1xuICAgICAgICBzdWJzY3JpYmVkT25VcGdyYWRlOiB0aGlzLmlzU3Vic2NyaWJlZChcbiAgICAgICAgICBhcHBSb3dDb250cm9sLnZhbHVlLmFwcCxcbiAgICAgICAgICB0aGlzLnBhcmVudERlZmF1bHRTdWJzY3JpcHRpb25zLm9uVXBncmFkZVN1YnNjcmlwdGlvbnNcbiAgICAgICAgKVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWREZWZhdWx0U3Vic2NyaXB0aW9ucygpIHtcbiAgICB0aGlzLnBhcmVudERlZmF1bHRTdWJzY3JpcHRpb25zID0gYXdhaXQgdGhpcy5kZWZhdWx0U3Vic2NyaXB0aW9uc1NlcnZpY2UuZ2V0RGVmYXVsdFN1YnNjcmlwdGlvbnNFdmFsdWF0ZWRGcm9tUGFyZW50VGVuYW50KCk7XG4gICAgdGhpcy5jdXJyZW50RGVmYXVsdFN1YnNjcmlwdGlvbnMgPSBhd2FpdCB0aGlzLmRlZmF1bHRTdWJzY3JpcHRpb25zU2VydmljZS5nZXREZWZhdWx0U3Vic2NyaXB0aW9uc0Zyb21DdXJyZW50VGVuYW50KCk7XG5cbiAgICBjb25zdCB7XG4gICAgICBvdmVycmlkZU9uQ3JlYXRpb25TdWJzY3JpcHRpb25zLFxuICAgICAgb3ZlcnJpZGVPblVwZ3JhZGVTdWJzY3JpcHRpb25zXG4gICAgfSA9IHRoaXMuY3VycmVudERlZmF1bHRTdWJzY3JpcHRpb25zO1xuICAgIGNvbnN0IG9uQ3JlYXRpb25TdWJzY3JpcHRpb25zID0gb3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9uc1xuICAgICAgPyB0aGlzLmN1cnJlbnREZWZhdWx0U3Vic2NyaXB0aW9ucy5vbkNyZWF0aW9uU3Vic2NyaXB0aW9uc1xuICAgICAgOiB0aGlzLnBhcmVudERlZmF1bHRTdWJzY3JpcHRpb25zLm9uQ3JlYXRpb25TdWJzY3JpcHRpb25zO1xuICAgIGNvbnN0IG9uVXBncmFkZVN1YnNjcmlwdGlvbnMgPSBvdmVycmlkZU9uVXBncmFkZVN1YnNjcmlwdGlvbnNcbiAgICAgID8gdGhpcy5jdXJyZW50RGVmYXVsdFN1YnNjcmlwdGlvbnMub25VcGdyYWRlU3Vic2NyaXB0aW9uc1xuICAgICAgOiB0aGlzLnBhcmVudERlZmF1bHRTdWJzY3JpcHRpb25zLm9uVXBncmFkZVN1YnNjcmlwdGlvbnM7XG5cbiAgICB0aGlzLmZvcm0ucGF0Y2hWYWx1ZSh7XG4gICAgICBvdmVycmlkZU9uQ3JlYXRpb25TdWJzY3JpcHRpb25zLFxuICAgICAgb3ZlcnJpZGVPblVwZ3JhZGVTdWJzY3JpcHRpb25zXG4gICAgfSk7XG4gICAgKHRoaXMuZm9ybS5jb250cm9scy5hcHBSb3dzIGFzIEZvcm1BcnJheSkuY29udHJvbHMuZm9yRWFjaChhcHBSb3dDb250cm9sID0+IHtcbiAgICAgIGFwcFJvd0NvbnRyb2wucGF0Y2hWYWx1ZSh7XG4gICAgICAgIHN1YnNjcmliZWRPbkNyZWF0aW9uOiB0aGlzLmlzU3Vic2NyaWJlZChhcHBSb3dDb250cm9sLnZhbHVlLmFwcCwgb25DcmVhdGlvblN1YnNjcmlwdGlvbnMpLFxuICAgICAgICBzdWJzY3JpYmVkT25VcGdyYWRlOiB0aGlzLmlzU3Vic2NyaWJlZChhcHBSb3dDb250cm9sLnZhbHVlLmFwcCwgb25VcGdyYWRlU3Vic2NyaXB0aW9ucylcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZWZhdWx0U3Vic2NyaXB0aW9uc0ZvclNhdmUoKTogRGVmYXVsdFN1YnNjcmlwdGlvbnMge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuZm9ybTtcbiAgICByZXR1cm4ge1xuICAgICAgb3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9uczogdmFsdWUub3ZlcnJpZGVPbkNyZWF0aW9uU3Vic2NyaXB0aW9ucyxcbiAgICAgIG9uQ3JlYXRpb25TdWJzY3JpcHRpb25zOiB2YWx1ZS5vdmVycmlkZU9uQ3JlYXRpb25TdWJzY3JpcHRpb25zXG4gICAgICAgID8gdmFsdWUuYXBwUm93cy5maWx0ZXIoYXBwID0+IGFwcC5zdWJzY3JpYmVkT25DcmVhdGlvbikubWFwKGFwcCA9PiBhcHAuYXBwKVxuICAgICAgICA6IG51bGwsXG4gICAgICBvdmVycmlkZU9uVXBncmFkZVN1YnNjcmlwdGlvbnM6IHZhbHVlLm92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9ucyxcbiAgICAgIG9uVXBncmFkZVN1YnNjcmlwdGlvbnM6IHZhbHVlLm92ZXJyaWRlT25VcGdyYWRlU3Vic2NyaXB0aW9uc1xuICAgICAgICA/IHZhbHVlLmFwcFJvd3MuZmlsdGVyKGFwcCA9PiBhcHAuc3Vic2NyaWJlZE9uVXBncmFkZSkubWFwKGFwcCA9PiBhcHAuYXBwKVxuICAgICAgICA6IG51bGxcbiAgICB9O1xuICB9XG59XG4iXX0=