import { __awaiter } from "tslib";
import { Component, Input, EventEmitter } from '@angular/core';
import { InventoryService } from '@c8y/client';
import { gettext } from '@c8y/ngx-components';
import { reject } from 'lodash-es';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/client';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from 'ngx-bootstrap/collapse';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@angular/forms';

function OpcuaAutoApplySettingsComponent_c8y_li_19_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-li", 20);
    ɵngcc0.ɵɵelementStart(1, "c8y-filter", 21);
    ɵngcc0.ɵɵlistener("onSearch", function OpcuaAutoApplySettingsComponent_c8y_li_19_Template_c8y_filter_onSearch_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.filterItems($event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("icon", "search");
} }
function OpcuaAutoApplySettingsComponent_c8y_li_20_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "c8y-li");
    ɵngcc0.ɵɵelementStart(1, "c8y-li-body");
    ɵngcc0.ɵɵelementStart(2, "div", 22);
    ɵngcc0.ɵɵelementStart(3, "p");
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 1, "No items to display."));
} }
function OpcuaAutoApplySettingsComponent_c8y_li_21_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-li");
    ɵngcc0.ɵɵelementStart(1, "c8y-li-checkbox", 23);
    ɵngcc0.ɵɵlistener("onSelect", function OpcuaAutoApplySettingsComponent_c8y_li_21_Template_c8y_li_checkbox_onSelect_1_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r8); const item_r6 = restoredCtx.$implicit; const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.onSelect($event, item_r6); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(2, "c8y-li-body");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelement(5, "br");
    ɵngcc0.ɵɵelementStart(6, "span", 24);
    ɵngcc0.ɵɵtext(7, "ID");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(8, "small");
    ɵngcc0.ɵɵtext(9);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r6 = ctx.$implicit;
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("selected", ctx_r2.isChecked(item_r6));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 3, item_r6.name));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate(item_r6.id);
} }
function OpcuaAutoApplySettingsComponent_li_56_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "li", 25);
    ɵngcc0.ɵɵelementStart(1, "c8y-input-group-list", 26);
    ɵngcc0.ɵɵlistener("onAdd", function OpcuaAutoApplySettingsComponent_li_56_Template_c8y_input_group_list_onAdd_1_listener() { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(); return ctx_r11.add(); })("onRemove", function OpcuaAutoApplySettingsComponent_li_56_Template_c8y_input_group_list_onRemove_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.remove($event); });
    ɵngcc0.ɵɵelementStart(2, "c8y-form-group", 27);
    ɵngcc0.ɵɵelementStart(3, "input", 28);
    ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaAutoApplySettingsComponent_li_56_Template_input_ngModelChange_3_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r12); const i_r10 = restoredCtx.index; const ctx_r14 = ɵngcc0.ɵɵnextContext(); return (ctx_r14.constraints.matchesNodeIds[i_r10] = $event); });
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const i_r10 = ctx.index;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("index", i_r10);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate1("placeholder", "", ɵngcc0.ɵɵpipeBind1(4, 4, "e.g."), " nodeId");
    ɵngcc0.ɵɵproperty("ngModel", ctx_r3.constraints.matchesNodeIds[i_r10])("required", true);
} }
export class OpcuaAutoApplySettingsComponent {
    constructor(inventoryService) {
        this.inventoryService = inventoryService;
        this.opcuaServers = [];
        this.selectedItems = [];
        this.filteredList = [];
        this.checked = {};
        this.sizeToShowFilter = 5;
        this.constraints = {
            browsePathMatchesRegex: '',
            matchesNodeIds: [],
            serverObjectHasFragment: '',
            matchesServerIds: []
        };
        this.placeholderSelectServerIds = gettext('Select server IDs from list');
        this.updateSelectedItem = new EventEmitter();
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            const { data } = yield this.inventoryService.list({
                pageSize: 1000,
                withTotalPages: true,
                type: 'c8y_OpcuaServer'
            });
            this.opcuaServers = data;
            this.filteredList = data;
            this.selectedItems = [];
            const { matchesServerIds } = this.constraints;
            data.forEach(server => {
                if (matchesServerIds &&
                    matchesServerIds.length > 0 &&
                    matchesServerIds.find(itemId => itemId === server.id)) {
                    this.selectedItems.push(server);
                    this.checked[server.id] = true;
                    this.showServerIds = true;
                }
            });
        });
    }
    set model(model) {
        if (model && model.applyConstraints) {
            this.constraints = model.applyConstraints;
        }
        this._model = model;
    }
    get model() {
        return this._model;
    }
    serverIdsSelected(items) {
        if (this.constraints) {
            this.constraints.matchesServerIds = items.map((item) => item.id);
        }
        this.selectedItems = items;
    }
    onChangeNodeId(event) {
        if (event.target.checked) {
            this.showRootNodes = true;
            this.add();
        }
        else {
            this.showRootNodes = false;
            this.constraints.matchesNodeIds = [];
        }
    }
    onChangeShowServerIds(event) {
        if (!event.target.checked) {
            this.constraints.matchesServerIds = [];
            this.showServerIds = false;
            this.selectedItems = [];
            this.checked = {};
        }
        else {
            this.showServerIds = true;
        }
    }
    onChangeShowBrowsePath(event) {
        if (!event.target.checked) {
            this.constraints.browsePathMatchesRegex = '';
            this.showBrowsePath = false;
        }
        else {
            this.showBrowsePath = true;
        }
    }
    onChangeShowServerFragment(event) {
        if (!event.target.checked) {
            this.constraints.serverObjectHasFragment = '';
            this.showServerFragment = false;
        }
        else {
            this.showServerFragment = true;
        }
    }
    add() {
        this.constraints.matchesNodeIds.push('');
    }
    remove(index) {
        this.constraints.matchesNodeIds.splice(index, 1);
    }
    trackByFn(index, item) {
        return index;
    }
    updateConstraints(items) {
        if (this.constraints) {
            this.constraints.matchesServerIds = items.map((item) => item.id);
        }
    }
    filterItems(filterText) {
        if (filterText.length !== 0) {
            const search = new RegExp(filterText, 'i');
            this.filteredList = this.opcuaServers.filter(({ name, id }) => {
                return search.test(name) || search.test(id);
            });
        }
        else {
            this.filteredList = this.opcuaServers;
        }
    }
    isChecked(item) {
        return this.checked[item.id];
    }
    onSelect(selected, item) {
        if (!selected) {
            this.selectedItems = reject(this.selectedItems, { id: item.id });
            delete this.checked[item.id];
        }
        else {
            this.selectedItems.push(item);
            this.checked[item.id] = selected;
        }
        this.updateSelectedItem.emit(true);
        this.updateConstraints(this.selectedItems);
    }
}
OpcuaAutoApplySettingsComponent.ɵfac = function OpcuaAutoApplySettingsComponent_Factory(t) { return new (t || OpcuaAutoApplySettingsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.InventoryService)); };
OpcuaAutoApplySettingsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: OpcuaAutoApplySettingsComponent, selectors: [["opcua-auto-apply"]], inputs: { model: "model" }, decls: 57, vars: 52, consts: [[1, "row"], [1, "col-md-4"], ["translate", ""], [1, "col-md-6"], [1, "list-group", 2, "box-shadow", "none"], [1, "list-group-item"], [1, "c8y-checkbox", 3, "title"], ["type", "checkbox", 3, "checked", "change"], [1, "m-l-8"], [1, "collapse", 3, "collapse"], [3, "items", "selected", "placeholder", "updateItems", "onChange"], ["class", "sticky-top", 4, "ngIf"], [4, "ngIf"], [4, "ngFor", "ngForOf"], [1, "collapse", 3, "isAnimated", "collapse"], [1, "m-t-8", "m-b-8"], ["name", "browsePath", "type", "text", "ngDefaultControl", "", 1, "form-control", 3, "placeholder", "ngModel", "ngModelChange"], ["name", "serverFragment", "type", "text", "ngDefaultControl", "", 1, "form-control", 3, "placeholder", "ngModel", "ngModelChange"], ["c8yInputGroupListContainer", "", 1, "list-unstyled", "p-t-16"], ["class", "m-b-8", 4, "ngFor", "ngForOf", "ngForTrackBy"], [1, "sticky-top"], [3, "icon", "onSearch"], [1, "c8y-empty-state", "text-left"], [3, "selected", "onSelect"], ["translate", "", 1, "text-label-small", "m-r-4"], [1, "m-b-8"], [3, "index", "onAdd", "onRemove"], [1, "form-group--tooltip-validation"], ["type", "text", 1, "form-control", 3, "placeholder", "ngModel", "required", "ngModelChange"]], template: function OpcuaAutoApplySettingsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "p", 2);
        ɵngcc0.ɵɵtext(3, " Specifying auto-apply constraints allows you to limit the scope where the device protocols are applied, for example by specifying a set of possible servers or node IDs. ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "p", 2);
        ɵngcc0.ɵɵtext(5, " If no constraints are set, device protocols are applied at any fitting location on the OPC UA server. ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "div", 3);
        ɵngcc0.ɵɵelementStart(7, "ul", 4);
        ɵngcc0.ɵɵelementStart(8, "li", 5);
        ɵngcc0.ɵɵelementStart(9, "label", 6);
        ɵngcc0.ɵɵpipe(10, "translate");
        ɵngcc0.ɵɵelementStart(11, "input", 7);
        ɵngcc0.ɵɵlistener("change", function OpcuaAutoApplySettingsComponent_Template_input_change_11_listener($event) { return ctx.onChangeShowServerIds($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(12, "span");
        ɵngcc0.ɵɵelementStart(13, "span", 8);
        ɵngcc0.ɵɵtext(14);
        ɵngcc0.ɵɵpipe(15, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(16, "div", 9);
        ɵngcc0.ɵɵelementStart(17, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(18, "c8y-select", 10);
        ɵngcc0.ɵɵlistener("onChange", function OpcuaAutoApplySettingsComponent_Template_c8y_select_onChange_18_listener($event) { return ctx.serverIdsSelected($event); });
        ɵngcc0.ɵɵtemplate(19, OpcuaAutoApplySettingsComponent_c8y_li_19_Template, 2, 1, "c8y-li", 11);
        ɵngcc0.ɵɵtemplate(20, OpcuaAutoApplySettingsComponent_c8y_li_20_Template, 6, 3, "c8y-li", 12);
        ɵngcc0.ɵɵtemplate(21, OpcuaAutoApplySettingsComponent_c8y_li_21_Template, 10, 5, "c8y-li", 13);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(22, "li", 5);
        ɵngcc0.ɵɵelementStart(23, "label", 6);
        ɵngcc0.ɵɵpipe(24, "translate");
        ɵngcc0.ɵɵelementStart(25, "input", 7);
        ɵngcc0.ɵɵlistener("change", function OpcuaAutoApplySettingsComponent_Template_input_change_25_listener($event) { return ctx.onChangeShowBrowsePath($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(26, "span");
        ɵngcc0.ɵɵelementStart(27, "span", 8);
        ɵngcc0.ɵɵtext(28);
        ɵngcc0.ɵɵpipe(29, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(30, "div", 14);
        ɵngcc0.ɵɵelementStart(31, "c8y-form-group", 15);
        ɵngcc0.ɵɵelementStart(32, "input", 16);
        ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaAutoApplySettingsComponent_Template_input_ngModelChange_32_listener($event) { return ctx.constraints.browsePathMatchesRegex = $event; });
        ɵngcc0.ɵɵpipe(33, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(34, "li", 5);
        ɵngcc0.ɵɵelementStart(35, "label", 6);
        ɵngcc0.ɵɵpipe(36, "translate");
        ɵngcc0.ɵɵelementStart(37, "input", 7);
        ɵngcc0.ɵɵlistener("change", function OpcuaAutoApplySettingsComponent_Template_input_change_37_listener($event) { return ctx.onChangeShowServerFragment($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(38, "span");
        ɵngcc0.ɵɵelementStart(39, "span", 8);
        ɵngcc0.ɵɵtext(40);
        ɵngcc0.ɵɵpipe(41, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(42, "div", 14);
        ɵngcc0.ɵɵelementStart(43, "c8y-form-group", 15);
        ɵngcc0.ɵɵelementStart(44, "input", 17);
        ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaAutoApplySettingsComponent_Template_input_ngModelChange_44_listener($event) { return ctx.constraints.serverObjectHasFragment = $event; });
        ɵngcc0.ɵɵpipe(45, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(46, "li", 5);
        ɵngcc0.ɵɵelementStart(47, "label", 6);
        ɵngcc0.ɵɵpipe(48, "translate");
        ɵngcc0.ɵɵelementStart(49, "input", 7);
        ɵngcc0.ɵɵlistener("change", function OpcuaAutoApplySettingsComponent_Template_input_change_49_listener($event) { return ctx.onChangeNodeId($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(50, "span");
        ɵngcc0.ɵɵelementStart(51, "span", 8);
        ɵngcc0.ɵɵtext(52);
        ɵngcc0.ɵɵpipe(53, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(54, "div", 14);
        ɵngcc0.ɵɵelementStart(55, "ul", 18);
        ɵngcc0.ɵɵtemplate(56, OpcuaAutoApplySettingsComponent_li_56_Template, 5, 6, "li", 19);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(9);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(10, 32, "Limit device protocol to a set of servers"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("checked", ctx.constraints.matchesServerIds !== null && ctx.constraints.matchesServerIds.length > 0);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(15, 34, "Limit device protocol to a set of servers"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("collapse", !ctx.showServerIds && (ctx.constraints.matchesServerIds !== null && ctx.constraints.matchesServerIds.length < 1) || !ctx.showServerIds && ctx.constraints.matchesServerIds === null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("items", ctx.opcuaServers)("selected", ctx.selectedItems)("placeholder", ctx.placeholderSelectServerIds)("updateItems", ctx.updateSelectedItem);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.opcuaServers.length > ctx.sizeToShowFilter);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.filteredList && ctx.filteredList.length === 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.filteredList);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(24, 36, "Limit device protocol scope in the address space"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("checked", ctx.constraints.browsePathMatchesRegex !== null && ctx.constraints.browsePathMatchesRegex.length > 0);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(29, 38, "Limit device protocol scope in the address space"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("isAnimated", true)("collapse", !ctx.showBrowsePath && ctx.constraints.browsePathMatchesRegex !== null && ctx.constraints.browsePathMatchesRegex.length < 1 || !ctx.showBrowsePath && ctx.constraints.browsePathMatchesRegex === null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate1("placeholder", "", ɵngcc0.ɵɵpipeBind1(33, 40, "e.g."), " /objects/devices/.*");
        ɵngcc0.ɵɵproperty("ngModel", ctx.constraints.browsePathMatchesRegex);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(36, 42, "Limit device protocol to servers with a certain fragment"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("checked", ctx.constraints.serverObjectHasFragment !== null && ctx.constraints.serverObjectHasFragment.length > 0);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(41, 44, "Limit device protocol to servers with a certain fragment"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("isAnimated", true)("collapse", !ctx.showServerFragment && ctx.constraints.serverObjectHasFragment !== null && ctx.constraints.serverObjectHasFragment.length < 1 || !ctx.showServerFragment && ctx.constraints.serverObjectHasFragment === null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵpropertyInterpolate1("placeholder", "", ɵngcc0.ɵɵpipeBind1(45, 46, "e.g."), " c8y_SomeServerMarker");
        ɵngcc0.ɵɵproperty("ngModel", ctx.constraints.serverObjectHasFragment);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(48, 48, "Limit device protocol to specific root nodes ID"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("checked", ctx.constraints.matchesNodeIds !== null && ctx.constraints.matchesNodeIds.length > 0);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(53, 50, "Limit device protocol to specific root nodes ID"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("isAnimated", true)("collapse", !ctx.showRootNodes && ctx.constraints.matchesNodeIds !== null && ctx.constraints.matchesNodeIds.length < 1 || !ctx.showRootNodes && ctx.constraints.matchesNodeIds === null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.constraints.matchesNodeIds)("ngForTrackBy", ctx.trackByFn);
    } }, directives: [ɵngcc2.C8yTranslateDirective, ɵngcc3.CollapseDirective, ɵngcc2.FormGroupComponent, ɵngcc2.SelectComponent, ɵngcc4.NgIf, ɵngcc4.NgForOf, ɵngcc5.DefaultValueAccessor, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc2.InputGroupListContainerDirective, ɵngcc2.ListItemComponent, ɵngcc2.FilterInputComponent, ɵngcc2.ListItemBodyComponent, ɵngcc2.ListItemCheckboxComponent, ɵngcc2.InputGroupListComponent, ɵngcc2.RequiredInputPlaceholderDirective, ɵngcc5.RequiredValidator], pipes: [ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
OpcuaAutoApplySettingsComponent.ctorParameters = () => [
    { type: InventoryService }
];
OpcuaAutoApplySettingsComponent.propDecorators = {
    model: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(OpcuaAutoApplySettingsComponent, [{
        type: Component,
        args: [{
                selector: 'opcua-auto-apply',
                template: "<div class=\"row\">\n  <div class=\"col-md-4\">\n    <p translate>\n      Specifying auto-apply constraints allows you to limit the scope where the device protocols are\n      applied, for example by specifying a set of possible servers or node IDs.\n    </p>\n    <p translate>\n      If no constraints are set, device protocols are applied at any fitting location on the OPC UA\n      server.\n    </p>\n  </div>\n\n  <div class=\"col-md-6\">\n    <ul class=\"list-group\" style=\"box-shadow: none;\">\n      <!-- Limit device type to a set of servers -->\n      <li class=\"list-group-item\">\n        <label\n          title=\"{{ 'Limit device protocol to a set of servers' | translate }}\"\n          class=\"c8y-checkbox\"\n        >\n          <input\n            type=\"checkbox\"\n            [checked]=\"\n              constraints.matchesServerIds !== null && constraints.matchesServerIds.length > 0\n            \"\n            (change)=\"onChangeShowServerIds($event)\"\n          />\n          <span></span>\n          <span class=\"m-l-8\">\n            {{ 'Limit device protocol to a set of servers' | translate }}\n          </span>\n        </label>\n        <div\n          class=\"collapse\"\n          [collapse]=\"\n            (!showServerIds &&\n              (constraints.matchesServerIds !== null && constraints.matchesServerIds.length < 1)) ||\n            (!showServerIds && constraints.matchesServerIds === null)\n          \"\n        >\n          <c8y-form-group>\n            <c8y-select\n              [items]=\"opcuaServers\"\n              [selected]=\"selectedItems\"\n              [placeholder]=\"placeholderSelectServerIds\"\n              (onChange)=\"serverIdsSelected($event)\"\n              [updateItems]=\"updateSelectedItem\"\n            >\n            \n              <c8y-li *ngIf=\"opcuaServers.length > sizeToShowFilter\" class=\"sticky-top\">\n                <c8y-filter [icon]=\"'search'\"  (onSearch)=\"filterItems($event)\"></c8y-filter>\n              </c8y-li>\n              <c8y-li *ngIf=\"filteredList && filteredList.length === 0\">\n                <c8y-li-body> \n                  <div class=\"c8y-empty-state text-left\">\n                  <p>{{ 'No items to display.' | translate }}</p>\n                </div>\n                </c8y-li-body>\n              </c8y-li>\n              <c8y-li *ngFor=\"let item of filteredList\">\n                <c8y-li-checkbox\n                  [selected]=\"isChecked(item)\"\n                  (onSelect)=\"onSelect($event, item)\"\n                ></c8y-li-checkbox>\n                <c8y-li-body>{{ item.name | translate }}<br>\n                  <span class=\"text-label-small m-r-4\" translate>ID</span> <small>{{ item.id }}</small>\n                </c8y-li-body>\n              </c8y-li>\n            </c8y-select>\n          </c8y-form-group>\n        </div>\n      </li>\n      <!-- Limit device type scope in the address space -->\n      <li class=\"list-group-item\">\n        <label\n          title=\"{{ 'Limit device protocol scope in the address space' | translate }}\"\n          class=\"c8y-checkbox\"\n        >\n          <input\n            type=\"checkbox\"\n            [checked]=\"\n              constraints.browsePathMatchesRegex !== null &&\n              constraints.browsePathMatchesRegex.length > 0\n            \"\n            (change)=\"onChangeShowBrowsePath($event)\"\n          />\n          <span></span>\n          <span class=\"m-l-8\">\n            {{ 'Limit device protocol scope in the address space' | translate }}\n          </span>\n        </label>\n        <div\n          class=\"collapse\"\n          [isAnimated]=\"true\"\n          [collapse]=\"\n            (!showBrowsePath &&\n              constraints.browsePathMatchesRegex !== null &&\n              constraints.browsePathMatchesRegex.length < 1) ||\n            (!showBrowsePath && constraints.browsePathMatchesRegex === null)\n          \"\n        >\n          <c8y-form-group class=\"m-t-8 m-b-8\">\n            <input\n              name=\"browsePath\"\n              type=\"text\"\n              class=\"form-control\"\n              placeholder=\"{{ 'e.g.' | translate }} /objects/devices/.*\"\n              [(ngModel)]=\"constraints.browsePathMatchesRegex\"\n              ngDefaultControl\n            />\n          </c8y-form-group>\n        </div>\n      </li>\n      <!-- Limit device type to servers with a certain fragment-->\n      <li class=\"list-group-item\">\n        <label\n          title=\"{{ 'Limit device protocol to servers with a certain fragment' | translate }}\"\n          class=\"c8y-checkbox\"\n        >\n          <input\n            type=\"checkbox\"\n            [checked]=\"constraints.serverObjectHasFragment !== null && constraints.serverObjectHasFragment.length > 0\"\n            (change)=\"onChangeShowServerFragment($event)\"\n          />\n          <span></span>\n          <span class=\"m-l-8\">\n            {{ 'Limit device protocol to servers with a certain fragment' | translate }}\n          </span>\n        </label>\n        <div\n          class=\"collapse\"\n          [isAnimated]=\"true\"\n          [collapse]=\"(!showServerFragment && constraints.serverObjectHasFragment !== null && constraints.serverObjectHasFragment.length < 1) || (!showServerFragment && constraints.serverObjectHasFragment === null)\"\n        >\n          <c8y-form-group class=\"m-t-8 m-b-8\">\n            <input\n              name=\"serverFragment\"\n              type=\"text\"\n              class=\"form-control\"\n              placeholder=\"{{ 'e.g.' | translate }} c8y_SomeServerMarker\"\n              [(ngModel)]=\"constraints.serverObjectHasFragment\"\n              ngDefaultControl\n            />\n          </c8y-form-group>\n        </div>\n      </li>\n      <!-- Limit device type to a specific root node ID -->\n      <li class=\"list-group-item\">\n        <label\n          title=\"{{ 'Limit device protocol to specific root nodes ID' | translate }}\"\n          class=\"c8y-checkbox\"\n        >\n          <input\n            type=\"checkbox\"\n            [checked]=\"constraints.matchesNodeIds !== null && constraints.matchesNodeIds.length > 0\"\n            (change)=\"onChangeNodeId($event)\"\n          />\n          <span></span>\n          <span class=\"m-l-8\">\n            {{ 'Limit device protocol to specific root nodes ID' | translate }}\n          </span>\n        </label>\n        <div\n          class=\"collapse\"\n          [isAnimated]=\"true\"\n          [collapse]=\"(!showRootNodes && constraints.matchesNodeIds !== null && constraints.matchesNodeIds.length < 1) || ( !showRootNodes && constraints.matchesNodeIds === null)\"\n        >\n            <ul c8yInputGroupListContainer class=\"list-unstyled p-t-16\">\n              <li\n                class=\"m-b-8\"\n                *ngFor=\"let item of constraints.matchesNodeIds; let i = index; trackBy: trackByFn\"\n              >\n                <c8y-input-group-list [index]=\"i\" (onAdd)=\"add()\" (onRemove)=\"remove($event)\">\n                  <c8y-form-group class=\"form-group--tooltip-validation\">\n                    <input\n                      type=\"text\"\n                      class=\"form-control\"\n                      placeholder=\"{{ 'e.g.' | translate }} nodeId\"\n                      [(ngModel)]=\"constraints.matchesNodeIds[i]\"\n                      [required]=\"true\"\n                    />\n                  </c8y-form-group>\n                </c8y-input-group-list>\n              </li>\n            </ul> \n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.InventoryService }]; }, { model: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtYXV0by1hcHBseS1zZXR0aW5ncy5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb3RvY29sLW9wY3VhL29wY3VhLWF1dG8tYXBwbHktc2V0dGluZ3MuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkUsT0FBTyxFQUFrQixnQkFBZ0IsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUMvRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDOUMsT0FBTyxFQUFrQixNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUtuRCxNQUFNLE9BQU8sK0JBQStCO0FBQUcsSUFvQjdDLFlBQW9CLGdCQUFrQztBQUFJLFFBQXRDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7QUFBQyxRQW5CdkQsaUJBQVksR0FBcUIsRUFBRSxDQUFDO0FBQ3RDLFFBQUUsa0JBQWEsR0FBcUIsRUFBRSxDQUFDO0FBQ3ZDLFFBQUUsaUJBQVksR0FBcUIsRUFBRSxDQUFDO0FBQ3RDLFFBQUUsWUFBTyxHQUFHLEVBQUUsQ0FBQztBQUNmLFFBQVcscUJBQWdCLEdBQVcsQ0FBQyxDQUFDO0FBQ3hDLFFBQUUsZ0JBQVcsR0FBeUI7QUFDdEMsWUFBSSxzQkFBc0IsRUFBRSxFQUFFO0FBQzlCLFlBQUksY0FBYyxFQUFFLEVBQUU7QUFDdEIsWUFBSSx1QkFBdUIsRUFBRSxFQUFFO0FBQy9CLFlBQUksZ0JBQWdCLEVBQUUsRUFBRTtBQUN4QixTQUFHLENBQUM7QUFDSixRQUFFLCtCQUEwQixHQUFXLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBQzlFLFFBSUUsdUJBQWtCLEdB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Q0FBQyxRQUFRLEVBQUU7QUFDbkIsWUFBTSxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLFlBQU0sT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNuQyxTQUFLO0FBQUMsYUFBSztBQUNYLFlBQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDcEMsWUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUM7QUFDdkMsU0FBSztBQUNMLFFBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN2QyxRQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDL0MsSUFBRSxDQUFDO0FBQ0g7MkRBekpDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsa0JBQWtCLGtCQUM1Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztzS0FBeUQ7U0FDMUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzhoQkFDSTtBQUFDO0FBQXlELFlBUHRDLGdCQUFnQjtBQUFHO0FBQUc7QUFDYixvQkFzRC9CLEtBQUs7QUFBSTs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQXV0b0FwcGx5Q29uc3RyYWludHMgfSBmcm9tICcuL29wY3VhLXByb3RvY29sLWRldmljZS10eXBlLmludGVyZmFjZSc7XG5pbXBvcnQgeyBJTWFuYWdlZE9iamVjdCwgSW52ZW50b3J5U2VydmljZSB9IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IHNldCwgZmluZCwgbWFwLCByZWplY3QgfSBmcm9tICdsb2Rhc2gtZXMnO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb3BjdWEtYXV0by1hcHBseScsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1hdXRvLWFwcGx5LXNldHRpbmdzLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBPcGN1YUF1dG9BcHBseVNldHRpbmdzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgb3BjdWFTZXJ2ZXJzOiBJTWFuYWdlZE9iamVjdFtdID0gW107XG4gIHNlbGVjdGVkSXRlbXM6IElNYW5hZ2VkT2JqZWN0W10gPSBbXTtcbiAgZmlsdGVyZWRMaXN0OiBJTWFuYWdlZE9iamVjdFtdID0gW107XG4gIGNoZWNrZWQgPSB7fTtcbiAgcmVhZG9ubHkgc2l6ZVRvU2hvd0ZpbHRlcjogbnVtYmVyID0gNTtcbiAgY29uc3RyYWludHM6IEF1dG9BcHBseUNvbnN0cmFpbnRzID0ge1xuICAgIGJyb3dzZVBhdGhNYXRjaGVzUmVnZXg6ICcnLFxuICAgIG1hdGNoZXNOb2RlSWRzOiBbXSxcbiAgICBzZXJ2ZXJPYmplY3RIYXNGcmFnbWVudDogJycsXG4gICAgbWF0Y2hlc1NlcnZlcklkczogW11cbiAgfTtcbiAgcGxhY2Vob2xkZXJTZWxlY3RTZXJ2ZXJJZHM6IHN0cmluZyA9IGdldHRleHQoJ1NlbGVjdCBzZXJ2ZXIgSURzIGZyb20gbGlzdCcpO1xuICBzaG93U2VydmVySWRzOiBib29sZWFuO1xuICBzaG93QnJvd3NlUGF0aDogYm9vbGVhbjtcbiAgc2hvd1NlcnZlckZyYWdtZW50OiBib29sZWFuO1xuICBzaG93Um9vdE5vZGVzOiBib29sZWFuO1xuICB1cGRhdGVTZWxlY3RlZEl0ZW06IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgcHJpdmF0ZSBfbW9kZWw6IElNYW5hZ2VkT2JqZWN0O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaW52ZW50b3J5U2VydmljZTogSW52ZW50b3J5U2VydmljZSkge31cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHRoaXMuaW52ZW50b3J5U2VydmljZS5saXN0KHtcbiAgICAgIHBhZ2VTaXplOiAxMDAwLFxuICAgICAgd2l0aFRvdGFsUGFnZXM6IHRydWUsXG4gICAgICB0eXBlOiAnYzh5X09wY3VhU2VydmVyJ1xuICAgIH0pO1xuXG4gICAgdGhpcy5vcGN1YVNlcnZlcnMgPSBkYXRhO1xuICAgIHRoaXMuZmlsdGVyZWRMaXN0ID0gZGF0YTtcbiAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcblxuICAgIGNvbnN0IHsgbWF0Y2hlc1NlcnZlcklkcyB9ID0gdGhpcy5jb25zdHJhaW50cztcblxuICAgIGRhdGEuZm9yRWFjaChzZXJ2ZXIgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBtYXRjaGVzU2VydmVySWRzICYmXG4gICAgICAgIG1hdGNoZXNTZXJ2ZXJJZHMubGVuZ3RoID4gMCAmJlxuICAgICAgICBtYXRjaGVzU2VydmVySWRzLmZpbmQoaXRlbUlkID0+IGl0ZW1JZCA9PT0gc2VydmVyLmlkKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKHNlcnZlcik7XG4gICAgICAgIHRoaXMuY2hlY2tlZFtzZXJ2ZXIuaWRdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93U2VydmVySWRzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBtb2RlbChtb2RlbCkge1xuICAgIGlmIChtb2RlbCAmJiBtb2RlbC5hcHBseUNvbnN0cmFpbnRzKSB7XG4gICAgICB0aGlzLmNvbnN0cmFpbnRzID0gbW9kZWwuYXBwbHlDb25zdHJhaW50cyBhcyBBdXRvQXBwbHlDb25zdHJhaW50cztcbiAgICB9XG4gICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcbiAgfVxuXG4gIGdldCBtb2RlbCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbW9kZWw7XG4gIH1cblxuICBzZXJ2ZXJJZHNTZWxlY3RlZChpdGVtczogSU1hbmFnZWRPYmplY3RbXSkge1xuICAgIGlmICh0aGlzLmNvbnN0cmFpbnRzKSB7XG4gICAgICB0aGlzLmNvbnN0cmFpbnRzLm1hdGNoZXNTZXJ2ZXJJZHMgPSBpdGVtcy5tYXAoKGl0ZW06IElNYW5hZ2VkT2JqZWN0KSA9PiBpdGVtLmlkKTtcbiAgICB9XG4gICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gaXRlbXM7XG4gIH1cblxuICBvbkNoYW5nZU5vZGVJZChldmVudCkge1xuICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgdGhpcy5zaG93Um9vdE5vZGVzID0gdHJ1ZTtcbiAgICAgIHRoaXMuYWRkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2hvd1Jvb3ROb2RlcyA9IGZhbHNlO1xuICAgICAgdGhpcy5jb25zdHJhaW50cy5tYXRjaGVzTm9kZUlkcyA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2hhbmdlU2hvd1NlcnZlcklkcyhldmVudCkge1xuICAgIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgIHRoaXMuY29uc3RyYWludHMubWF0Y2hlc1NlcnZlcklkcyA9IFtdO1xuICAgICAgdGhpcy5zaG93U2VydmVySWRzID0gZmFsc2U7XG4gICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICAgIHRoaXMuY2hlY2tlZCA9IHt9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNob3dTZXJ2ZXJJZHMgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2hhbmdlU2hvd0Jyb3dzZVBhdGgoZXZlbnQpIHtcbiAgICBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7XG4gICAgICB0aGlzLmNvbnN0cmFpbnRzLmJyb3dzZVBhdGhNYXRjaGVzUmVnZXggPSAnJztcbiAgICAgIHRoaXMuc2hvd0Jyb3dzZVBhdGggPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG93QnJvd3NlUGF0aCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgb25DaGFuZ2VTaG93U2VydmVyRnJhZ21lbnQoZXZlbnQpIHtcbiAgICBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7XG4gICAgICB0aGlzLmNvbnN0cmFpbnRzLnNlcnZlck9iamVjdEhhc0ZyYWdtZW50ID0gJyc7XG4gICAgICB0aGlzLnNob3dTZXJ2ZXJGcmFnbWVudCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNob3dTZXJ2ZXJGcmFnbWVudCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgYWRkKCkge1xuICAgIHRoaXMuY29uc3RyYWludHMubWF0Y2hlc05vZGVJZHMucHVzaCgnJyk7XG4gIH1cblxuICByZW1vdmUoaW5kZXgpIHtcbiAgICB0aGlzLmNvbnN0cmFpbnRzLm1hdGNoZXNOb2RlSWRzLnNwbGljZShpbmRleCwgMSk7XG4gIH1cblxuICB0cmFja0J5Rm4oaW5kZXg6IGFueSwgaXRlbTogYW55KSB7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgdXBkYXRlQ29uc3RyYWludHMoaXRlbXMpIHtcbiAgICBpZiAodGhpcy5jb25zdHJhaW50cykge1xuICAgICAgdGhpcy5jb25zdHJhaW50cy5tYXRjaGVzU2VydmVySWRzID0gaXRlbXMubWFwKChpdGVtOiBJTWFuYWdlZE9iamVjdCkgPT4gaXRlbS5pZCk7XG4gICAgfVxuICB9XG5cbiAgZmlsdGVySXRlbXMoZmlsdGVyVGV4dCkge1xuICAgIGlmIChmaWx0ZXJUZXh0Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29uc3Qgc2VhcmNoID0gbmV3IFJlZ0V4cChmaWx0ZXJUZXh0LCAnaScpO1xuICAgICAgdGhpcy5maWx0ZXJlZExpc3QgPSB0aGlzLm9wY3VhU2VydmVycy5maWx0ZXIoKHsgbmFtZSwgaWQgfSkgPT4ge1xuICAgICAgICByZXR1cm4gc2VhcmNoLnRlc3QobmFtZSkgfHwgc2VhcmNoLnRlc3QoaWQpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlsdGVyZWRMaXN0ID0gdGhpcy5vcGN1YVNlcnZlcnM7XG4gICAgfVxuICB9XG5cbiAgaXNDaGVja2VkKGl0ZW0pIHtcbiAgICByZXR1cm4gdGhpcy5jaGVja2VkW2l0ZW0uaWRdO1xuICB9XG5cbiAgb25TZWxlY3Qoc2VsZWN0ZWQsIGl0ZW0pIHtcbiAgICBpZiAoIXNlbGVjdGVkKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSByZWplY3QodGhpcy5zZWxlY3RlZEl0ZW1zLCB7IGlkOiBpdGVtLmlkIH0pO1xuICAgICAgZGVsZXRlIHRoaXMuY2hlY2tlZFtpdGVtLmlkXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICB0aGlzLmNoZWNrZWRbaXRlbS5pZF0gPSBzZWxlY3RlZDtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZEl0ZW0uZW1pdCh0cnVlKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnN0cmFpbnRzKHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gIH1cbn1cbiJdfQ==