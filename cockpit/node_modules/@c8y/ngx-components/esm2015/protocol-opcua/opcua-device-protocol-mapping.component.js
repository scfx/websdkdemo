import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { ControlContainer, NgModelGroup } from '@angular/forms';
import { AlertService } from '@c8y/ngx-components';
import { isEmpty, assign, unset, get, set, cloneDeep, isEqual } from 'lodash-es';
import { OpcuaDeviceProtocolObjectMapping } from './opcua-device-protocol-object-mapping.component';
import { AddressSpaceService } from './address-space.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/ngx-components';
import * as ɵngcc2 from './address-space.service';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from './opcua-device-protocol-object-mapping-status-icon.component';
import * as ɵngcc5 from 'ngx-bootstrap/collapse';
import * as ɵngcc6 from '@angular/forms';
import * as ɵngcc7 from 'ngx-bootstrap/dropdown';
import * as ɵngcc8 from './opcua-device-protocol-browse-path-validation.directive';
import * as ɵngcc9 from './opcua-device-protocol-object-mapping.component';
import * as ɵngcc10 from './opcua-device-protocol-mapping-customaction.component';
import * as ɵngcc11 from './opcua-address-space-tree.component';
import * as ɵngcc12 from './opcua-device-protocol-data-reporting.component';

const _c0 = ["variableForm"];
const _c1 = ["browsePathModel"];
function OpcuaDeviceProtocolMapping_small_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "small", 19);
    ɵngcc0.ɵɵpipe(1, "json");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "json");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r0.mapping.browsePath));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 4, ctx_r0.mapping.browsePath));
} }
function OpcuaDeviceProtocolMapping_div_26_div_12_opcua_address_space_tree_1_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "opcua-address-space-tree", 48);
    ɵngcc0.ɵɵlistener("selectedNode", function OpcuaDeviceProtocolMapping_div_26_div_12_opcua_address_space_tree_1_Template_opcua_address_space_tree_selectedNode_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r9); ɵngcc0.ɵɵnextContext(2); const _r3 = ɵngcc0.ɵɵreference(7); const ctx_r8 = ɵngcc0.ɵɵnextContext(); ctx_r8.updateBrowsePath($event); return _r3.hide(); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("node", ctx_r7.referencedNode)("moId", ctx_r7.referencedServerId);
} }
function OpcuaDeviceProtocolMapping_div_26_div_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 46);
    ɵngcc0.ɵɵtemplate(1, OpcuaDeviceProtocolMapping_div_26_div_12_opcua_address_space_tree_1_Template, 1, 2, "opcua-address-space-tree", 47);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.showAddressSpaceTree());
} }
function OpcuaDeviceProtocolMapping_div_26_div_44_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 49);
    ɵngcc0.ɵɵelement(1, "opcua-device-protocol-data-reporting", 50);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("model", ctx_r6.mapping);
} }
const _c2 = function () { return ["2:Node1", "2:SubNode1"]; };
function OpcuaDeviceProtocolMapping_div_26_Template(rf, ctx) { if (rf & 1) {
    const _r11 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 20, 21);
    ɵngcc0.ɵɵelementStart(2, "div", 22);
    ɵngcc0.ɵɵelementStart(3, "c8y-form-group", 23);
    ɵngcc0.ɵɵelementStart(4, "label", 24);
    ɵngcc0.ɵɵtext(5, "Path");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 25, 26);
    ɵngcc0.ɵɵelementStart(8, "input", 27, 28);
    ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaDeviceProtocolMapping_div_26_Template_input_ngModelChange_8_listener($event) { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.browsePath = $event; })("change", function OpcuaDeviceProtocolMapping_div_26_Template_input_change_8_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r12 = ɵngcc0.ɵɵnextContext(); return ctx_r12.updateBrowsePathInput(); })("focus", function OpcuaDeviceProtocolMapping_div_26_Template_input_focus_8_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.setTreeFromRefNode(); });
    ɵngcc0.ɵɵpipe(10, "translate");
    ɵngcc0.ɵɵpipe(11, "json");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(12, OpcuaDeviceProtocolMapping_div_26_div_12_Template, 2, 1, "div", 29);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(13, "c8y-messages");
    ɵngcc0.ɵɵelement(14, "c8y-message", 30);
    ɵngcc0.ɵɵpipe(15, "translate");
    ɵngcc0.ɵɵelement(16, "c8y-message", 31);
    ɵngcc0.ɵɵpipe(17, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(18, "c8y-form-group", 32);
    ɵngcc0.ɵɵelementStart(19, "label", 24);
    ɵngcc0.ɵɵtext(20, "Name");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(21, "div", 33);
    ɵngcc0.ɵɵelementStart(22, "input", 34);
    ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaDeviceProtocolMapping_div_26_Template_input_ngModelChange_22_listener($event) { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r14 = ɵngcc0.ɵɵnextContext(); return ctx_r14.nodeDisplayName = $event; })("change", function OpcuaDeviceProtocolMapping_div_26_Template_input_change_22_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.updateDisplayname(); });
    ɵngcc0.ɵɵpipe(23, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(24, "div", 35);
    ɵngcc0.ɵɵelementStart(25, "c8y-form-group", 36);
    ɵngcc0.ɵɵelementStart(26, "label");
    ɵngcc0.ɵɵelementStart(27, "span", 24);
    ɵngcc0.ɵɵtext(28, "Data reporting");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(29, "div", 33);
    ɵngcc0.ɵɵelementStart(30, "label", 37);
    ɵngcc0.ɵɵpipe(31, "translate");
    ɵngcc0.ɵɵelementStart(32, "input", 38);
    ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaDeviceProtocolMapping_div_26_Template_input_ngModelChange_32_listener($event) { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r16 = ɵngcc0.ɵɵnextContext(); return ctx_r16.dataReporting = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(33, "span");
    ɵngcc0.ɵɵelementStart(34, "span");
    ɵngcc0.ɵɵtext(35);
    ɵngcc0.ɵɵpipe(36, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(37, "label", 37);
    ɵngcc0.ɵɵpipe(38, "translate");
    ɵngcc0.ɵɵelementStart(39, "input", 39);
    ɵngcc0.ɵɵlistener("ngModelChange", function OpcuaDeviceProtocolMapping_div_26_Template_input_ngModelChange_39_listener($event) { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.dataReporting = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(40, "span");
    ɵngcc0.ɵɵelementStart(41, "span");
    ɵngcc0.ɵɵtext(42);
    ɵngcc0.ɵɵpipe(43, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(44, OpcuaDeviceProtocolMapping_div_26_div_44_Template, 2, 1, "div", 40);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(45, "c8y-object-mapping", 41);
    ɵngcc0.ɵɵelementStart(46, "div", 42);
    ɵngcc0.ɵɵelement(47, "opcua-device-protocol-mapping-customaction", 43);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(48, "button", 44);
    ɵngcc0.ɵɵlistener("click", function OpcuaDeviceProtocolMapping_div_26_Template_button_click_48_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r18 = ɵngcc0.ɵɵnextContext(); return ctx_r18.cancel(); });
    ɵngcc0.ɵɵpipe(49, "translate");
    ɵngcc0.ɵɵtext(50);
    ɵngcc0.ɵɵpipe(51, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(52, "button", 45);
    ɵngcc0.ɵɵlistener("click", function OpcuaDeviceProtocolMapping_div_26_Template_button_click_52_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r19 = ɵngcc0.ɵɵnextContext(); return ctx_r19.save(); });
    ɵngcc0.ɵɵpipe(53, "translate");
    ɵngcc0.ɵɵtext(54);
    ɵngcc0.ɵɵpipe(55, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r2 = ɵngcc0.ɵɵreference(1);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngModelGroup", ctx_r1.index);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("status", !ctx_r1.isBrowsePathUniq ? "error" : "");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("insideClick", true);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate2("placeholder", "", ɵngcc0.ɵɵpipeBind1(10, 29, "e.g."), " ", ɵngcc0.ɵɵpipeBind1(11, 31, ɵngcc0.ɵɵpureFunction0(55, _c2)), "");
    ɵngcc0.ɵɵproperty("getMappings", ctx_r1.getMappings)("model", ctx_r1.mapping)("ngModel", ctx_r1.browsePath);
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵpropertyInterpolate("text", ɵngcc0.ɵɵpipeBind1(15, 33, "Must be a valid array of strings."));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("text", ɵngcc0.ɵɵpipeBind1(17, 35, "Variable with this path is already added."));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵpropertyInterpolate1("placeholder", "", ɵngcc0.ɵɵpipeBind1(23, 37, "e.g. childDevice2"), " ");
    ɵngcc0.ɵɵproperty("ngModel", ctx_r1.nodeDisplayName);
    ɵngcc0.ɵɵadvance(8);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(31, 39, "Default"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("name", ctx_r1.dataReportingName);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r1.dataReporting);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(36, 41, "Default"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(38, 43, "Custom"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("name", ctx_r1.dataReportingName);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r1.dataReporting);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(43, 45, "Custom"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.dataReporting === "custom");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("mapping", ctx_r1.mapping)("hideAutoObserve", true);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("customAction", ctx_r1.customAction);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(49, 47, "Cancel"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(51, 49, "Cancel"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(53, 51, "Save"));
    ɵngcc0.ɵɵproperty("disabled", !ctx_r1.canSave(_r2));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(55, 53, "Save"), " ");
} }
const _c3 = function (a0) { return { expanded: a0 }; };
const _c4 = function (a0) { return { active: a0 }; };
export class OpcuaDeviceProtocolMapping {
    constructor(alertService, addressSpaceService) {
        this.alertService = alertService;
        this.addressSpaceService = addressSpaceService;
        this.onAction = new EventEmitter();
        this.isPathFocused = false;
        this.isBrowsePathUniq = true;
        this.dataReporting = 'default';
        this.isTreeOpen = false;
        this.isNew = false;
        this.resetModel = false;
        this.moId = '';
        this.getMappings = () => this.getParentAttr('mappings');
    }
    toggleDetail() {
        this.isDetailOpen = !this.isDetailOpen;
        if (this.resetModel) {
            this.initialFormSetup();
        }
    }
    ngOnInit() {
        this.dataReportingName = 'ReportingMode' + this.index;
        this.initialFormSetup();
    }
    ngOnChanges(changes) {
        if (changes._model.previousValue &&
            !isEqual(this._model, changes._model.previousValue.SimpleChange)) {
            if (this.mapping && this.mapping.name === this._model.name) {
                this.mapping.id = this._model.id;
            }
        }
    }
    initialFormSetup() {
        const mapping = {
            id: '',
            browsePath: [],
            name: '',
            subscriptionType: {
                type: 'None'
            }
        };
        const customAction = {
            headers: [{ key: 'Authorization', value: '' }, { key: 'Content-Type', value: '' }],
            bodyTemplate: '',
            type: 'HttpPost',
            endpoint: ''
        };
        this.mapping = assign({}, mapping, cloneDeep(this._model));
        if (isEmpty(this.mapping.browsePath)) {
            this.isNew = true;
            this.isDetailOpen = true;
        }
        else {
            this.browsePath = this.stringfyBrowsePath(this.mapping.browsePath);
            this.nodeDisplayName = this.mapping.name;
        }
        if (this.referencedRootNodeId) {
            this.referencedNode = { nodeId: this.referencedRootNodeId };
            this.addressSpaceService.triggerNodeToOpen({
                node: {
                    nodeId: this.referencedRootNodeId,
                    children: [],
                    expanded: false,
                    absolutePaths: [[]]
                },
                selectedAncestorIds: []
            });
        }
        else {
            this.referencedNode = { nodeId: '' };
        }
        if (get(this.mapping, 'customAction')) {
            this.customAction = assign(customAction, get(this.mapping, 'customAction'));
            this.customAction.headers = this.mapHeadersObjectToList(get(this.customAction, 'headers'));
        }
        else {
            this.customAction = assign({}, customAction);
        }
        unset(this.mapping, 'customAction');
        if (get(this._model, 'subscriptionType')) {
            this.dataReporting = 'custom';
        }
        else {
            this.dataReporting = 'default';
        }
        this.resetModel = false;
    }
    showAddressSpaceTree() {
        return !isEmpty(this.referencedServerId);
    }
    ngAfterViewInit() {
        if (get(this.mapping, 'subscriptionType') &&
            get(this.mapping, 'subscriptionType.type') !== 'None') {
            this.dataReporting = 'custom';
        }
    }
    mapHeadersObjectToList(headers) {
        if (Object.keys(headers).length > 0) {
            return Object.keys(headers).map(item => {
                return { key: item, value: headers[item] };
            });
        }
    }
    stringfyBrowsePath(path) {
        return JSON.stringify(path);
    }
    updateBrowsePath(node) {
        this.mapping.browsePath = node.relativePath;
        this.nodeDisplayName = node.displayName;
        this.mapping.name = this.nodeDisplayName;
        this.browsePath = this.stringfyBrowsePath(this.mapping.browsePath);
        this.browsePathModel.control.markAsDirty();
    }
    updateDisplayname() {
        this.mapping.name = this.nodeDisplayName;
    }
    updateBrowsePathInput() {
        if (this.browsePath) {
            try {
                this.mapping.browsePath = JSON.parse(this.browsePath);
            }
            catch (error) {
                return;
            }
        }
    }
    save() {
        if (this.dataReporting === 'default') {
            unset(this.mapping, 'subscriptionType');
        }
        if (get(this.mapping, 'measurementCreation')) {
            const { measurementCreation } = this.mapping;
            set(measurementCreation, 'fragmentName', get(measurementCreation, 'type'));
        }
        const { customAction } = this.subFormRef.value;
        let modifiedCustomAction;
        if (customAction.hasCustomAction) {
            const reducedHeaders = this.customAction.headers.reduce((result, item) => {
                result[item.key] = item.value;
                return result;
            }, {});
            modifiedCustomAction = assign({}, this.customAction, { headers: reducedHeaders });
        }
        this.onAction.emit({
            action: 'save',
            data: assign({}, this.mapping, { customAction: modifiedCustomAction })
        });
        this.isDetailOpen = false;
    }
    cancel() {
        this.isDetailOpen = false;
        this.resetModel = true;
        if (this.mapping.id === 'new') {
            this.onAction.emit({ action: 'delete', data: assign({}, this.mapping) });
        }
    }
    onDelete() {
        this.onAction.emit({ action: 'delete', data: this.mapping });
    }
    canSave(variableForm) {
        const areValid = () => variableForm.valid && this.objectMappingForm.$componentScope.mappingForm.$valid;
        const areDirty = () => variableForm.dirty || this.objectMappingForm.$componentScope.mappingForm.$dirty;
        return areValid() && areDirty();
    }
    isActive() {
        return this.isDetailOpen;
    }
    setTreeFromRefNode() {
        if (this.referencedRootNodeId) {
            this.addressSpaceService.triggerNodeToOpen({
                node: {
                    nodeId: this.referencedRootNodeId,
                    children: [],
                    expanded: false,
                    absolutePaths: [[]]
                },
                selectedAncestorIds: []
            });
        }
    }
}
OpcuaDeviceProtocolMapping.ɵfac = function OpcuaDeviceProtocolMapping_Factory(t) { return new (t || OpcuaDeviceProtocolMapping)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AddressSpaceService)); };
OpcuaDeviceProtocolMapping.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: OpcuaDeviceProtocolMapping, selectors: [["opcua-device-protocol-mapping"]], viewQuery: function OpcuaDeviceProtocolMapping_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(OpcuaDeviceProtocolObjectMapping, 5);
        ɵngcc0.ɵɵviewQuery(_c0, 5);
        ɵngcc0.ɵɵviewQuery(_c1, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.objectMappingForm = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.subFormRef = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.browsePathModel = _t.first);
    } }, inputs: { _model: ["resource", "_model"], index: "index", getParentAttr: "getParentAttr", referencedServerId: "referencedServerId", referencedRootNodeId: "referencedRootNodeId" }, outputs: { onAction: "onAction" }, features: [ɵngcc0.ɵɵProvidersFeature([], [{ provide: ControlContainer, useExisting: NgModelGroup }]), ɵngcc0.ɵɵNgOnChangesFeature], decls: 27, vars: 18, consts: [[1, "list-group-item", "collapsible", 3, "ngClass"], [1, "flex-row", 3, "click"], [1, "list-item-actions"], [1, "btn", "btn-clean", "showOnHover", "flex-item-right", 3, "title"], ["c8yIcon", "minus-circle", 1, "text-danger", 3, "click"], ["type", "button", 1, "collapse-btn", 3, "title", "ngClass"], ["c8yIcon", "chevron-down"], [1, "list-item-icon"], ["c8yIcon", "sliders"], [1, "list-item-body"], [1, "row", "flex-row"], [1, "col-sm-7", "col-xs-12"], ["class", "text-muted text-truncate", 3, "title", 4, "ngIf"], [1, "col-sm-4", "col-xs-10"], [1, "list-functionalities"], ["translate", "", 1, "small", "m-r-8", "hidden-xs"], [3, "mapping"], [1, "detail", 3, "collapse", "isAnimated"], ["class", "form", 3, "ngModelGroup", 4, "ngIf"], [1, "text-muted", "text-truncate", 3, "title"], [1, "form", 3, "ngModelGroup"], ["variableForm", "ngModelGroup"], [1, "row", "p-t-8"], [1, "col-md-4", 3, "status"], ["translate", ""], ["dropdown", "", 1, "dropdown", 2, "width", "100%", 3, "insideClick"], ["dropdown", "bs-dropdown"], ["c8yBrowsePathValidator", "", "type", "text", "name", "browsePath", "dropdownToggle", "", "required", "", "autocomplete", "off", 1, "form-control", 3, "getMappings", "model", "placeholder", "ngModel", "ngModelChange", "change", "focus"], ["browsePathModel", "ngModel"], ["class", "dropdown-menu panel-inner-scroll", "style", "max-height:200px; width: 100%;", 4, "dropdownMenu"], ["name", "invalidBrowsePathNotation", 3, "text"], ["name", "browsePathNotUnique", 3, "text"], [1, "col-md-4"], [1, "input-group"], ["type", "test", "name", "displayName", "required", "", "autocomplete", "off", 1, "form-control", 3, "placeholder", "ngModel", "ngModelChange", "change"], ["ngModelGroup", "dataReportingSection", 1, "row"], [1, "col-sm-4", "col-md-3", "col-lg-2"], [1, "c8y-radio", "radio-inline", 3, "title"], ["type", "radio", "value", "default", 3, "ngModel", "name", "ngModelChange"], ["type", "radio", "value", "custom", 3, "ngModel", "name", "ngModelChange"], ["class", "col-sm-8 col-md-9 col-lg-10", "ngModelGroup", "overriddenSubscription", 4, "ngIf"], [3, "mapping", "hideAutoObserve"], ["ngModelGroup", "customAction"], [3, "customAction"], ["id", "cancelBtn", 1, "btn", "btn-default", "m-t-16", "m-b-16", 3, "title", "click"], ["id", "saveBtn", 1, "btn", "btn-primary", "m-t-16", "m-b-16", 3, "title", "disabled", "click"], [1, "dropdown-menu", "panel-inner-scroll", 2, "max-height", "200px", "width", "100%"], [3, "node", "moId", "selectedNode", 4, "ngIf"], [3, "node", "moId", "selectedNode"], ["ngModelGroup", "overriddenSubscription", 1, "col-sm-8", "col-md-9", "col-lg-10"], [3, "model"]], template: function OpcuaDeviceProtocolMapping_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵlistener("click", function OpcuaDeviceProtocolMapping_Template_div_click_1_listener() { return ctx.toggleDetail(); });
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "button", 3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementStart(5, "i", 4);
        ɵngcc0.ɵɵlistener("click", function OpcuaDeviceProtocolMapping_Template_i_click_5_listener() { return ctx.onDelete(); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "button", 5);
        ɵngcc0.ɵɵpipe(7, "translate");
        ɵngcc0.ɵɵelement(8, "i", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "div", 7);
        ɵngcc0.ɵɵelement(10, "i", 8);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "div", 9);
        ɵngcc0.ɵɵelementStart(12, "div", 10);
        ɵngcc0.ɵɵelementStart(13, "div", 11);
        ɵngcc0.ɵɵelementStart(14, "p");
        ɵngcc0.ɵɵtext(15);
        ɵngcc0.ɵɵelement(16, "br");
        ɵngcc0.ɵɵtemplate(17, OpcuaDeviceProtocolMapping_small_17_Template, 4, 6, "small", 12);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(18, "p");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(19, "div", 13);
        ɵngcc0.ɵɵelementStart(20, "div", 14);
        ɵngcc0.ɵɵelementStart(21, "label", 15);
        ɵngcc0.ɵɵtext(22, "Functionalities");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtext(23, "\u00A0 ");
        ɵngcc0.ɵɵelement(24, "c8y-object-mapping-status-icons", 16);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(25, "div", 17);
        ɵngcc0.ɵɵtemplate(26, OpcuaDeviceProtocolMapping_div_26_Template, 56, 56, "div", 18);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(14, _c3, ctx.isDetailOpen));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(4, 10, "Delete"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(7, 12, "Expand"));
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(16, _c4, ctx.isDetailOpen));
        ɵngcc0.ɵɵadvance(9);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.nodeDisplayName, "");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.mapping.browsePath.length > 0);
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("mapping", ctx.mapping);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("collapse", !ctx.isDetailOpen)("isAnimated", true);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isDetailOpen);
    } }, directives: [ɵngcc3.NgClass, ɵngcc1.IconDirective, ɵngcc3.NgIf, ɵngcc1.C8yTranslateDirective, ɵngcc4.OpcuaDeviceProtocolObjectMappingStatus, ɵngcc5.CollapseDirective, ɵngcc6.NgControlStatusGroup, ɵngcc6.NgModelGroup, ɵngcc1.FormGroupComponent, ɵngcc7.BsDropdownDirective, ɵngcc1.RequiredInputPlaceholderDirective, ɵngcc6.DefaultValueAccessor, ɵngcc8.OpcuaDeviceProtocolBrowsePathValidation, ɵngcc7.BsDropdownToggleDirective, ɵngcc6.RequiredValidator, ɵngcc6.NgControlStatus, ɵngcc6.NgModel, ɵngcc7.BsDropdownMenuDirective, ɵngcc1.MessagesComponent, ɵngcc1.MessageDirective, ɵngcc6.RadioControlValueAccessor, ɵngcc9.OpcuaDeviceProtocolObjectMapping, ɵngcc10.OpcuaDeviceProtocolMappingCustomAction, ɵngcc11.OpcuaAddressSpaceTreeComponent, ɵngcc12.OpcuaDeviceProtocolDataReportingComponent], pipes: [ɵngcc1.C8yTranslatePipe, ɵngcc3.JsonPipe], encapsulation: 2 });
OpcuaDeviceProtocolMapping.ctorParameters = () => [
    { type: AlertService },
    { type: AddressSpaceService }
];
OpcuaDeviceProtocolMapping.propDecorators = {
    objectMappingForm: [{ type: ViewChild, args: [OpcuaDeviceProtocolObjectMapping, { static: false },] }],
    subFormRef: [{ type: ViewChild, args: ['variableForm', { static: false },] }],
    browsePathModel: [{ type: ViewChild, args: ['browsePathModel', { static: false },] }],
    _model: [{ type: Input, args: ['resource',] }],
    index: [{ type: Input }],
    getParentAttr: [{ type: Input }],
    referencedServerId: [{ type: Input }],
    referencedRootNodeId: [{ type: Input }],
    onAction: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(OpcuaDeviceProtocolMapping, [{
        type: Component,
        args: [{
                selector: 'opcua-device-protocol-mapping',
                template: "<div class=\"list-group-item collapsible\" [ngClass]=\"{ expanded: isDetailOpen }\">\n  <div class=\"flex-row\" (click)=\"toggleDetail()\">\n    <div class=\"list-item-actions\">\n      <button class=\"btn btn-clean showOnHover flex-item-right\" title=\"{{ 'Delete' | translate }}\">\n        <i c8yIcon=\"minus-circle\" class=\"text-danger\" (click)=\"onDelete()\"></i>\n      </button>\n      <button\n        type=\"button\"\n        title=\"{{ 'Expand' | translate }}\"\n        class=\"collapse-btn\"\n        [ngClass]=\"{ active: isDetailOpen }\"\n      >\n        <i c8yIcon=\"chevron-down\"></i>\n      </button>\n    </div>\n\n    <div class=\"list-item-icon\">\n      <i c8yIcon=\"sliders\"></i>\n    </div>\n\n    <div class=\"list-item-body\">\n      <div class=\"row flex-row\">\n        <div class=\"col-sm-7 col-xs-12\">\n          <p>\n            {{ nodeDisplayName }}<br />\n            <small\n              *ngIf=\"mapping.browsePath.length > 0\"\n              class=\"text-muted text-truncate\"\n              title=\"{{ mapping.browsePath | json }}\"\n              >{{ mapping.browsePath | json }}</small\n            >\n          </p>\n          <p></p>\n        </div>\n        <div class=\"col-sm-4 col-xs-10\">\n          <div class=\"list-functionalities\">\n            <label class=\"small m-r-8 hidden-xs\" translate>Functionalities</label>&nbsp;\n            <c8y-object-mapping-status-icons [mapping]=\"mapping\"></c8y-object-mapping-status-icons>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"detail\" [collapse]=\"!isDetailOpen\" [isAnimated]=\"true\">\n    <div class=\"form\" [ngModelGroup]=\"index\" #variableForm=\"ngModelGroup\" *ngIf=\"isDetailOpen\">\n      <div class=\"row p-t-8\">\n        <c8y-form-group class=\"col-md-4\" [status]=\"!isBrowsePathUniq ? 'error' : ''\">\n          <label translate>Path</label>\n          <div\n            class=\"dropdown\"\n            dropdown\n            #dropdown=\"bs-dropdown\"\n            [insideClick]=\"true\"\n            style=\"width:100%;\"\n          >\n            <input\n              class=\"form-control\"\n              c8yBrowsePathValidator\n              [getMappings]=\"getMappings\"\n              [model]=\"mapping\"\n              type=\"text\"\n              name=\"browsePath\"\n              dropdownToggle\n              placeholder=\"{{ 'e.g.' | translate }} {{ ['2:Node1', '2:SubNode1'] | json }}\"\n              [(ngModel)]=\"browsePath\"\n              (change)=\"updateBrowsePathInput()\"\n              (focus)=\"setTreeFromRefNode()\"\n              required\n              #browsePathModel=\"ngModel\"\n              autocomplete=\"off\"\n            />\n            <div\n              *dropdownMenu\n              class=\"dropdown-menu panel-inner-scroll\"\n              style=\"max-height:200px; width: 100%;\"\n            >\n              <opcua-address-space-tree\n                *ngIf=\"showAddressSpaceTree()\"\n                [node]=\"referencedNode\"\n                [moId]=\"referencedServerId\"\n                (selectedNode)=\"updateBrowsePath($event); dropdown.hide()\"\n              ></opcua-address-space-tree>\n            </div>\n          </div>\n          <c8y-messages>\n            <c8y-message\n              name=\"invalidBrowsePathNotation\"\n              text=\"{{ 'Must be a valid array of strings.' | translate }}\"\n            ></c8y-message>\n            <c8y-message\n              name=\"browsePathNotUnique\"\n              text=\"{{ 'Variable with this path is already added.' | translate }}\"\n            ></c8y-message>\n          </c8y-messages>\n        </c8y-form-group>\n\n        <c8y-form-group class=\"col-md-4\">\n          <label translate>Name</label>\n          <div class=\"input-group\">\n            <input\n              class=\"form-control\"\n              type=\"test\"\n              name=\"displayName\"\n              placeholder=\"{{ 'e.g. childDevice2' | translate }} \"\n              required\n              [(ngModel)]=\"nodeDisplayName\"\n              (change)=\"updateDisplayname()\"\n              autocomplete=\"off\"\n            />\n          </div>\n        </c8y-form-group>\n      </div>\n      <div class=\"row\" ngModelGroup=\"dataReportingSection\">\n        <c8y-form-group class=\"col-sm-4 col-md-3 col-lg-2\">\n          <label>\n            <span translate>Data reporting</span>\n          </label>\n          <div class=\"input-group\">\n            <label title=\"{{ 'Default' | translate }}\" class=\"c8y-radio radio-inline\">\n              <input\n                type=\"radio\"\n                [(ngModel)]=\"dataReporting\"\n                name=\"{{ dataReportingName }}\"\n                value=\"default\"\n              />\n              <span></span>\n              <span>{{ 'Default' | translate }}</span>\n            </label>\n            <label title=\"{{ 'Custom' | translate }}\" class=\"c8y-radio radio-inline\">\n              <input\n                type=\"radio\"\n                [(ngModel)]=\"dataReporting\"\n                name=\"{{ dataReportingName }}\"\n                value=\"custom\"\n              />\n              <span></span>\n              <span>{{ 'Custom' | translate }}</span>\n            </label>\n          </div>\n        </c8y-form-group>\n        <div\n          class=\"col-sm-8 col-md-9 col-lg-10\"\n          *ngIf=\"dataReporting === 'custom'\"\n          ngModelGroup=\"overriddenSubscription\"\n        >\n          <opcua-device-protocol-data-reporting\n            [model]=\"mapping\"\n          ></opcua-device-protocol-data-reporting>\n        </div>\n      </div>\n\n      <c8y-object-mapping [mapping]=\"mapping\" [hideAutoObserve]=\"true\"></c8y-object-mapping>\n      <div ngModelGroup=\"customAction\">\n        <opcua-device-protocol-mapping-customaction\n          [customAction]=\"customAction\"\n        ></opcua-device-protocol-mapping-customaction>\n      </div>\n      <button\n        title=\"{{ 'Cancel' | translate }}\"\n        id=\"cancelBtn\"\n        class=\"btn btn-default m-t-16 m-b-16\"\n        (click)=\"cancel()\"\n      >\n        {{ 'Cancel' | translate }}\n      </button>\n      <button\n        title=\"{{ 'Save' | translate }}\"\n        id=\"saveBtn\"\n        class=\"btn btn-primary m-t-16 m-b-16\"\n        (click)=\"save()\"\n        [disabled]=\"!canSave(variableForm)\"\n      >\n        {{ 'Save' | translate }}\n      </button>\n    </div>\n  </div>\n</div>\n",
                viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
            }]
    }], function () { return [{ type: ɵngcc1.AlertService }, { type: ɵngcc2.AddressSpaceService }]; }, { onAction: [{
            type: Output
        }], objectMappingForm: [{
            type: ViewChild,
            args: [OpcuaDeviceProtocolObjectMapping, { static: false }]
        }], subFormRef: [{
            type: ViewChild,
            args: ['variableForm', { static: false }]
        }], browsePathModel: [{
            type: ViewChild,
            args: ['browsePathModel', { static: false }]
        }], _model: [{
            type: Input,
            args: ['resource']
        }], index: [{
            type: Input
        }], getParentAttr: [{
            type: Input
        }], referencedServerId: [{
            type: Input
        }], referencedRootNodeId: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmcuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm90b2NvbC1vcGN1YS9vcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBR1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFVLGdCQUFnQixFQUFlLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxZQUFZLEVBQVcsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBZ0IsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMvRixPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUNwRyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU85RCxNQUFNLE9BQU8sMEJBQTBCO0FBQUcsSUE0QnhDLFlBQ1UsWUFBMEIsRUFDMUIsbUJBQXdDO0FBQ2pELFFBRlMsaUJBQVksR0FBWixZQUFZLENBQWM7QUFBQyxRQUMzQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO0FBQ3BELFFBckJZLGFBQVEsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FB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LFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIFZpZXdDaGlsZCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdGb3JtLCBDb250cm9sQ29udGFpbmVyLCBGb3JtQ29udHJvbCwgTmdNb2RlbEdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlLCBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBpc0VtcHR5LCBhc3NpZ24sIHVuc2V0LCBnZXQsIHNldCwgcmVqZWN0LCBmaW5kLCBjbG9uZURlZXAsIGlzRXF1YWwgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgT3BjdWFEZXZpY2VQcm90b2NvbE9iamVjdE1hcHBpbmcgfSBmcm9tICcuL29wY3VhLWRldmljZS1wcm90b2NvbC1vYmplY3QtbWFwcGluZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgQWRkcmVzc1NwYWNlU2VydmljZSB9IGZyb20gJy4vYWRkcmVzcy1zcGFjZS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vb3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmcuaHRtbCcsXG4gIHZpZXdQcm92aWRlcnM6IFt7IHByb3ZpZGU6IENvbnRyb2xDb250YWluZXIsIHVzZUV4aXN0aW5nOiBOZ01vZGVsR3JvdXAgfV1cbn0pXG5leHBvcnQgY2xhc3MgT3BjdWFEZXZpY2VQcm90b2NvbE1hcHBpbmcgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQoT3BjdWFEZXZpY2VQcm90b2NvbE9iamVjdE1hcHBpbmcsIHsgc3RhdGljOiBmYWxzZSB9KSBvYmplY3RNYXBwaW5nRm9ybTogYW55O1xuICBAVmlld0NoaWxkKCd2YXJpYWJsZUZvcm0nLCB7IHN0YXRpYzogZmFsc2UgfSkgc3ViRm9ybVJlZjogYW55O1xuICBAVmlld0NoaWxkKCdicm93c2VQYXRoTW9kZWwnLCB7IHN0YXRpYzogZmFsc2UgfSkgYnJvd3NlUGF0aE1vZGVsOiBhbnk7XG5cbiAgQElucHV0KCdyZXNvdXJjZScpIF9tb2RlbDtcbiAgQElucHV0KCkgaW5kZXg7XG4gIEBJbnB1dCgpIGdldFBhcmVudEF0dHI7XG4gIEBJbnB1dCgpIHJlZmVyZW5jZWRTZXJ2ZXJJZDtcbiAgQElucHV0KCkgcmVmZXJlbmNlZFJvb3ROb2RlSWQ7XG4gIEBPdXRwdXQoKSBvbkFjdGlvbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBtYXBwaW5nO1xuXG4gIGlzRGV0YWlsT3BlbjtcbiAgY3VzdG9tQWN0aW9uO1xuICByZWZlcmVuY2VkTm9kZTtcbiAgaXNQYXRoRm9jdXNlZCA9IGZhbHNlO1xuICBncm91cE5hbWU6IHN0cmluZztcbiAgYnJvd3NlUGF0aDogc3RyaW5nO1xuICBub2RlRGlzcGxheU5hbWU6IHN0cmluZztcbiAgaXNCcm93c2VQYXRoVW5pcSA9IHRydWU7XG4gIGRhdGFSZXBvcnRpbmcgPSAnZGVmYXVsdCc7XG4gIGlzVHJlZU9wZW4gPSBmYWxzZTtcbiAgaXNOZXcgPSBmYWxzZTtcbiAgcmVzZXRNb2RlbCA9IGZhbHNlO1xuICBkYXRhUmVwb3J0aW5nTmFtZTtcbiAgcHJpdmF0ZSBtb0lkOiBzdHJpbmcgPSAnJztcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhbGVydFNlcnZpY2U6IEFsZXJ0U2VydmljZSxcbiAgICBwcml2YXRlIGFkZHJlc3NTcGFjZVNlcnZpY2U6IEFkZHJlc3NTcGFjZVNlcnZpY2VcbiAgKSB7fVxuXG4gIHRvZ2dsZURldGFpbCgpIHtcbiAgICB0aGlzLmlzRGV0YWlsT3BlbiA9ICF0aGlzLmlzRGV0YWlsT3BlbjtcbiAgICBpZiAodGhpcy5yZXNldE1vZGVsKSB7XG4gICAgICB0aGlzLmluaXRpYWxGb3JtU2V0dXAoKTtcbiAgICB9XG4gIH1cblxuICBnZXRNYXBwaW5ncyA9ICgpID0+IHRoaXMuZ2V0UGFyZW50QXR0cignbWFwcGluZ3MnKTtcblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmRhdGFSZXBvcnRpbmdOYW1lID0gJ1JlcG9ydGluZ01vZGUnICsgdGhpcy5pbmRleDtcbiAgICB0aGlzLmluaXRpYWxGb3JtU2V0dXAoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLl9tb2RlbC5wcmV2aW91c1ZhbHVlICYmXG4gICAgICAhaXNFcXVhbCh0aGlzLl9tb2RlbCwgY2hhbmdlcy5fbW9kZWwucHJldmlvdXNWYWx1ZS5TaW1wbGVDaGFuZ2UpXG4gICAgKSB7XG4gICAgICBpZiAodGhpcy5tYXBwaW5nICYmIHRoaXMubWFwcGluZy5uYW1lID09PSB0aGlzLl9tb2RlbC5uYW1lKSB7XG4gICAgICAgIHRoaXMubWFwcGluZy5pZCA9IHRoaXMuX21vZGVsLmlkO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGluaXRpYWxGb3JtU2V0dXAoKSB7XG4gICAgY29uc3QgbWFwcGluZyA9IHtcbiAgICAgIGlkOiAnJyxcbiAgICAgIGJyb3dzZVBhdGg6IFtdLFxuICAgICAgbmFtZTogJycsXG4gICAgICBzdWJzY3JpcHRpb25UeXBlOiB7XG4gICAgICAgIHR5cGU6ICdOb25lJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBjdXN0b21BY3Rpb24gPSB7XG4gICAgICBoZWFkZXJzOiBbeyBrZXk6ICdBdXRob3JpemF0aW9uJywgdmFsdWU6ICcnIH0sIHsga2V5OiAnQ29udGVudC1UeXBlJywgdmFsdWU6ICcnIH1dLFxuICAgICAgYm9keVRlbXBsYXRlOiAnJyxcbiAgICAgIHR5cGU6ICdIdHRwUG9zdCcsXG4gICAgICBlbmRwb2ludDogJydcbiAgICB9O1xuXG4gICAgdGhpcy5tYXBwaW5nID0gYXNzaWduKHt9LCBtYXBwaW5nLCBjbG9uZURlZXAodGhpcy5fbW9kZWwpKTtcblxuICAgIGlmIChpc0VtcHR5KHRoaXMubWFwcGluZy5icm93c2VQYXRoKSkge1xuICAgICAgdGhpcy5pc05ldyA9IHRydWU7XG4gICAgICB0aGlzLmlzRGV0YWlsT3BlbiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnJvd3NlUGF0aCA9IHRoaXMuc3RyaW5nZnlCcm93c2VQYXRoKHRoaXMubWFwcGluZy5icm93c2VQYXRoKTtcbiAgICAgIHRoaXMubm9kZURpc3BsYXlOYW1lID0gdGhpcy5tYXBwaW5nLm5hbWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVmZXJlbmNlZFJvb3ROb2RlSWQpIHtcbiAgICAgIHRoaXMucmVmZXJlbmNlZE5vZGUgPSB7IG5vZGVJZDogdGhpcy5yZWZlcmVuY2VkUm9vdE5vZGVJZCB9O1xuICAgICAgdGhpcy5hZGRyZXNzU3BhY2VTZXJ2aWNlLnRyaWdnZXJOb2RlVG9PcGVuKHtcbiAgICAgICAgbm9kZToge1xuICAgICAgICAgIG5vZGVJZDogdGhpcy5yZWZlcmVuY2VkUm9vdE5vZGVJZCxcbiAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlLFxuICAgICAgICAgIGFic29sdXRlUGF0aHM6IFtbXV1cbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0ZWRBbmNlc3RvcklkczogW11cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlZmVyZW5jZWROb2RlID0geyBub2RlSWQ6ICcnIH07XG4gICAgfVxuXG4gICAgaWYgKGdldCh0aGlzLm1hcHBpbmcsICdjdXN0b21BY3Rpb24nKSkge1xuICAgICAgdGhpcy5jdXN0b21BY3Rpb24gPSBhc3NpZ24oY3VzdG9tQWN0aW9uLCBnZXQodGhpcy5tYXBwaW5nLCAnY3VzdG9tQWN0aW9uJykpO1xuICAgICAgdGhpcy5jdXN0b21BY3Rpb24uaGVhZGVycyA9IHRoaXMubWFwSGVhZGVyc09iamVjdFRvTGlzdChnZXQodGhpcy5jdXN0b21BY3Rpb24sICdoZWFkZXJzJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmN1c3RvbUFjdGlvbiA9IGFzc2lnbih7fSwgY3VzdG9tQWN0aW9uKTtcbiAgICB9XG5cbiAgICB1bnNldCh0aGlzLm1hcHBpbmcsICdjdXN0b21BY3Rpb24nKTtcbiAgICBpZiAoZ2V0KHRoaXMuX21vZGVsLCAnc3Vic2NyaXB0aW9uVHlwZScpKSB7XG4gICAgICB0aGlzLmRhdGFSZXBvcnRpbmcgPSAnY3VzdG9tJztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRhUmVwb3J0aW5nID0gJ2RlZmF1bHQnO1xuICAgIH1cbiAgICB0aGlzLnJlc2V0TW9kZWwgPSBmYWxzZTtcbiAgfVxuXG4gIHNob3dBZGRyZXNzU3BhY2VUcmVlKCkge1xuICAgIHJldHVybiAhaXNFbXB0eSh0aGlzLnJlZmVyZW5jZWRTZXJ2ZXJJZCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKFxuICAgICAgZ2V0KHRoaXMubWFwcGluZywgJ3N1YnNjcmlwdGlvblR5cGUnKSAmJlxuICAgICAgZ2V0KHRoaXMubWFwcGluZywgJ3N1YnNjcmlwdGlvblR5cGUudHlwZScpICE9PSAnTm9uZSdcbiAgICApIHtcbiAgICAgIHRoaXMuZGF0YVJlcG9ydGluZyA9ICdjdXN0b20nO1xuICAgIH1cbiAgfVxuXG4gIG1hcEhlYWRlcnNPYmplY3RUb0xpc3QoaGVhZGVycykge1xuICAgIGlmIChPYmplY3Qua2V5cyhoZWFkZXJzKS5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXMoaGVhZGVycykubWFwKGl0ZW0gPT4ge1xuICAgICAgICByZXR1cm4geyBrZXk6IGl0ZW0sIHZhbHVlOiBoZWFkZXJzW2l0ZW1dIH07XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzdHJpbmdmeUJyb3dzZVBhdGgocGF0aCkge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwYXRoKTtcbiAgfVxuXG4gIHVwZGF0ZUJyb3dzZVBhdGgobm9kZSkge1xuICAgIHRoaXMubWFwcGluZy5icm93c2VQYXRoID0gbm9kZS5yZWxhdGl2ZVBhdGg7XG4gICAgdGhpcy5ub2RlRGlzcGxheU5hbWUgPSBub2RlLmRpc3BsYXlOYW1lO1xuICAgIHRoaXMubWFwcGluZy5uYW1lID0gdGhpcy5ub2RlRGlzcGxheU5hbWU7XG4gICAgdGhpcy5icm93c2VQYXRoID0gdGhpcy5zdHJpbmdmeUJyb3dzZVBhdGgodGhpcy5tYXBwaW5nLmJyb3dzZVBhdGgpO1xuICAgIHRoaXMuYnJvd3NlUGF0aE1vZGVsLmNvbnRyb2wubWFya0FzRGlydHkoKTtcbiAgfVxuXG4gIHVwZGF0ZURpc3BsYXluYW1lKCkge1xuICAgIHRoaXMubWFwcGluZy5uYW1lID0gdGhpcy5ub2RlRGlzcGxheU5hbWU7XG4gIH1cblxuICB1cGRhdGVCcm93c2VQYXRoSW5wdXQoKSB7XG4gICAgaWYgKHRoaXMuYnJvd3NlUGF0aCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5tYXBwaW5nLmJyb3dzZVBhdGggPSBKU09OLnBhcnNlKHRoaXMuYnJvd3NlUGF0aCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2F2ZSgpIHtcbiAgICBpZiAodGhpcy5kYXRhUmVwb3J0aW5nID09PSAnZGVmYXVsdCcpIHtcbiAgICAgIHVuc2V0KHRoaXMubWFwcGluZywgJ3N1YnNjcmlwdGlvblR5cGUnKTtcbiAgICB9XG5cbiAgICBpZiAoZ2V0KHRoaXMubWFwcGluZywgJ21lYXN1cmVtZW50Q3JlYXRpb24nKSkge1xuICAgICAgY29uc3QgeyBtZWFzdXJlbWVudENyZWF0aW9uIH0gPSB0aGlzLm1hcHBpbmc7XG4gICAgICBzZXQobWVhc3VyZW1lbnRDcmVhdGlvbiwgJ2ZyYWdtZW50TmFtZScsIGdldChtZWFzdXJlbWVudENyZWF0aW9uLCAndHlwZScpKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGN1c3RvbUFjdGlvbiB9ID0gdGhpcy5zdWJGb3JtUmVmLnZhbHVlO1xuICAgIGxldCBtb2RpZmllZEN1c3RvbUFjdGlvbjtcbiAgICBpZiAoY3VzdG9tQWN0aW9uLmhhc0N1c3RvbUFjdGlvbikge1xuICAgICAgY29uc3QgcmVkdWNlZEhlYWRlcnMgPSB0aGlzLmN1c3RvbUFjdGlvbi5oZWFkZXJzLnJlZHVjZSgocmVzdWx0LCBpdGVtKSA9PiB7XG4gICAgICAgIHJlc3VsdFtpdGVtLmtleV0gPSBpdGVtLnZhbHVlO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSwge30pO1xuXG4gICAgICBtb2RpZmllZEN1c3RvbUFjdGlvbiA9IGFzc2lnbih7fSwgdGhpcy5jdXN0b21BY3Rpb24sIHsgaGVhZGVyczogcmVkdWNlZEhlYWRlcnMgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5vbkFjdGlvbi5lbWl0KHtcbiAgICAgIGFjdGlvbjogJ3NhdmUnLFxuICAgICAgZGF0YTogYXNzaWduKHt9LCB0aGlzLm1hcHBpbmcsIHsgY3VzdG9tQWN0aW9uOiBtb2RpZmllZEN1c3RvbUFjdGlvbiB9KVxuICAgIH0pO1xuICAgIHRoaXMuaXNEZXRhaWxPcGVuID0gZmFsc2U7XG4gIH1cblxuICBjYW5jZWwoKSB7XG4gICAgdGhpcy5pc0RldGFpbE9wZW4gPSBmYWxzZTtcbiAgICB0aGlzLnJlc2V0TW9kZWwgPSB0cnVlO1xuICAgIGlmICh0aGlzLm1hcHBpbmcuaWQgPT09ICduZXcnKSB7XG4gICAgICB0aGlzLm9uQWN0aW9uLmVtaXQoeyBhY3Rpb246ICdkZWxldGUnLCBkYXRhOiBhc3NpZ24oe30sIHRoaXMubWFwcGluZykgfSk7XG4gICAgfVxuICB9XG5cbiAgb25EZWxldGUoKSB7XG4gICAgdGhpcy5vbkFjdGlvbi5lbWl0KHsgYWN0aW9uOiAnZGVsZXRlJywgZGF0YTogdGhpcy5tYXBwaW5nIH0pO1xuICB9XG5cbiAgY2FuU2F2ZSh2YXJpYWJsZUZvcm0pIHtcbiAgICBjb25zdCBhcmVWYWxpZCA9ICgpID0+XG4gICAgICB2YXJpYWJsZUZvcm0udmFsaWQgJiYgdGhpcy5vYmplY3RNYXBwaW5nRm9ybS4kY29tcG9uZW50U2NvcGUubWFwcGluZ0Zvcm0uJHZhbGlkO1xuICAgIGNvbnN0IGFyZURpcnR5ID0gKCkgPT5cbiAgICAgIHZhcmlhYmxlRm9ybS5kaXJ0eSB8fCB0aGlzLm9iamVjdE1hcHBpbmdGb3JtLiRjb21wb25lbnRTY29wZS5tYXBwaW5nRm9ybS4kZGlydHk7XG4gICAgcmV0dXJuIGFyZVZhbGlkKCkgJiYgYXJlRGlydHkoKTtcbiAgfVxuXG4gIGlzQWN0aXZlKCkge1xuICAgIHJldHVybiB0aGlzLmlzRGV0YWlsT3BlbjtcbiAgfVxuXG4gIHNldFRyZWVGcm9tUmVmTm9kZSgpIHtcbiAgICBpZiAodGhpcy5yZWZlcmVuY2VkUm9vdE5vZGVJZCkge1xuICAgICAgdGhpcy5hZGRyZXNzU3BhY2VTZXJ2aWNlLnRyaWdnZXJOb2RlVG9PcGVuKHtcbiAgICAgICAgbm9kZToge1xuICAgICAgICAgIG5vZGVJZDogdGhpcy5yZWZlcmVuY2VkUm9vdE5vZGVJZCxcbiAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlLFxuICAgICAgICAgIGFic29sdXRlUGF0aHM6IFtbXV1cbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0ZWRBbmNlc3RvcklkczogW11cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19