{"version":3,"file":"c8y-ngx-components-operations-stepper-bulk-type-configuration.js","sources":["../../operations/stepper-bulk-type-configuration/stepper-bulk-type-configuration.component.ts","../../operations/stepper-bulk-type-configuration/stepper-bulk-type-configuration.module.ts","../../operations/stepper-bulk-type-configuration/c8y-ngx-components-operations-stepper-bulk-type-configuration.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAmBa,qCAAsC,SAAQ,oBAAoB;AAC/E,IAiBE,YACU,oBAA2C,EAC3C,iBAAoC,EACpC,SAA2B;AACpC,QACC,KAAK,EAAE,CAAC;AACZ,QALY,yBAAoB,GAApB,oBAAoB,CAAuB;AAAC,QAC5C,sBAAiB,GAAjB,iBAAiB,CAAmB;AAAC,QACrC,cAAS,GAAT,SAAS,CAAkB;AACvC,QArBW,6BAAwB,GAAG,OAAO,CAAC,wBAAwB,CAAC,CAAC;AACxE,QACE,iBAAY,GAAW,CAAC,CAAC;AAC3B,QAAE,iBAAY,GAAW,EAAE,CAAC;AAC5B,QAAE,gBAAW,GAA4B,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC;AACjE,QAAE,gBAAW,GAA4B,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC;AACjE,QAAE,gBAAW,GAAG,EAAE,CAAC;AACnB,QAAE,uBAAkB,GAAG,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;AACpC,QAAE,oBAAe,GAA4C,aAAa,CACtE,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,WAAW,CACjB,CAAC,IAAI,CACJ,SAAS,CAAC,CAAC,CAAC,IAAI,EAAE,UAAU,CAAC,KAAK,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC,EAC1E,WAAW,CAAC,CAAC,CAAC,CACf,CAAC;AACJ,QAQI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,oBAAoB,CAAC,YAAY,CAAC;AAC/D,QAAI,IAAI,CAAC,sBAAsB,EAAE,CAAC;AAClC,KAAG;AACH,IACE,sBAAsB;AACxB,QAAI,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,WAAW;AAClD,aAAO,IAAI,CACH,YAAY,CAAC,GAAG,CAAC,EACjB,oBAAoB,EAAE,EACtB,SAAS,CAAC,SAAS;AAC3B,YAAU,MAAM,KAAK,GAAG,EAAE,iBAAiB,EAAE,IAAI,SAAS,GAAG,EAAE,CAAC;AAChE,YAAU,OAAO,IAAI,CACT,IAAI,CAAC,iBAAiB,CAAC,qBAAqB,CAAC,cAAc,CAAC,aAAa,EAAE,EAAE,KAAK,EAAE,CAAC,CACtF,CAAC;AACZ,SAAS,CAAC,CACH;AACP,aAAO,SAAS,CAAC,MAAM;AACvB,YAAQ,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC;AAChC,YAAQ,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC,iBAAiB,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;AACjG,SAAO,CAAC,CAAC;AACT,KAAG;AACH,IAAE,WAAW;AAAK,QACd,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,CAAC;AAC9C,KAAG;AACH,IACE,mBAAmB,CAAC,aAA6B;AACnD,QAAI,IAAI,CAAC,qBAAqB,GAAG,aAAa,CAAC;AAC/C,KAAG;AACH,IACE,cAAc,CAAC,MAA8C;AAC/D,QAAI,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;AAC1B,QAAI,IAAI,CAAC,eAAe,EAAE,CAAC;AAC3B,QAAI,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,qBAAqB,CAAC,UAAU,CAAC;AAC7D,KAAG;AACH,IACQ,eAAe;AACvB;AACoB,YADhB,IAAI,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE;AACxC,gBAAM,IAAI,CAAC,qBAAqB,CAAC,MAAM,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAC5E,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAC9B,EAAE,aAAa,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CACxC,CAAC;AACR,aAAK;AACL,SAAG;AAEF,KAFE;AACH,IACE,kBAAkB,CAAC,aAA6B;AAAI,QAClD,OAAO,GAAG,CAAC,aAAa,EAAE,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC;AACnG,KAAG;AACH,IACY,0BAA0B;AAAK,QACvC,MAAM,aAAa,GAAG;AAC1B,YAAM,IAAI,EAAE,IAAI,CAAC,qBAAqB,CAAC,iBAAiB;AACxD,YAAM,GAAG,EAAE,IAAI,CAAC,qBAAqB,CAAC,GAAG;AACzC,SAAK,CAAC;AACN,QACI,OAAO;AACX,YAAM,IAAI,EAAE,OAAO,CAAC,sBAAsB,CAAC;AAC3C,YAAM,WAAW,EAAE,GAAG,CAAC,IAAI,CAAC,qBAAqB,EAAE,MAAM,CAAC;AAC1D,YAAM,SAAS,EAAG;AAClB,gBAAQ,WAAW,EAAE,4BAA4B,IAAI,CAAC,qBAAqB,CAAC,IAAI,GAAG;AACnF,gBAAQ,sBAAsB,EAAE,aAAa;AAC7C,aAAiC;AACjC,SAAK,CAAC;AACN,KAAG;AACH,IACU,gBAAgB,CAAC,IAAa,EAAE,iBAA0B;AACpE,QAAI,MAAM,KAAK,GAAQ,IAAI,GAAG,EAAE,IAAI,EAAE,IAAI,IAAI,GAAG,EAAE,GAAG,EAAE,CAAC;AACzD,QAAI,IAAI,iBAAiB,EAAE;AAC3B,YAAM,KAAK,CAAC,IAAI,GAAG,CAAC,EAAE,iBAAiB,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,mBAAmB,EAAE,EAAE,CAAC,CAAC;AACtF,SAAK;AACL,QAAI,OAAO,IAAI,CAAC,iBAAiB,CAAC,qBAAqB,CAAC,cAAc,CAAC,aAAa,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;AACjG,KAAG;AACH;iEAnGC,SAAS,SAAC,kBACT,QAAQ,EAAE,qCAAqC,kBAC/C;;;;;;;;;;;;;8jBAEG;AAAC;AAA+D,YARnE,qBAAqB;AACrB,YARO,iBAAiB;AAAI,YACrB,gBAAgB;AAAG;;;;;4yHAYmC,cAC9D;;6JAb6B;AAAC;AAAC,WCsBhB;AAChB,IAAQ,IAAI,EAAE,iBAAiB,CAAC,aAAa;AAC7C,IAAQ,OAAO,EAAE,MAAM;AACvB,IAAQ,IAAI,EAAE,OAAO,CAAC,sBAAsB,CAAC;AAC7C,IAAQ,IAAI,EAAE,GAAG,OAAO,eAAe;AACvC,IAAQ,SAAS,EAAE,qCAAqC;AACxD,IAAQ,SAAS,EAAE,CAAC,wBAAwB,EAAE,mBAAmB,CAAC;AAClE,IAAQ,QAAQ,EAAE,KAAK;AACvB;AArBA;AACA,MA2Ba,kCAAkC;AAAG;8DA3BjD,QAAQ,SAAC,kBACR,YAAY,EAAE,CAAC,qCAAqC,CAAC;UACrD,OAAO,EAAE,sBACP,UAAU,sBACV,WAAW,sBACX,mBAAmB;oBACnB,0BAA0B,sBAC1B,gBAAgB;OACjB;eACD,SAAS,EAAE;MACT;MACE,OAAO,EAAE;;AAAmB;OAC5B,QAAQ,IAQP;qBACD;CAAK,EAAE,IAAI,sBACZ;cACF,kBACD;OAAe,EAAE,CAAC;;GAAqC,CAAC,kBACxD,OAAO,EAAE,CAAC,qCAAqC,CAAC,cACjD;;;;;;;;;;;;;;;;;;;;;;;;;;gHACI;AAAC;AC1CN;AACA;AACA;AACA;AACA;AACiE","sourcesContent":["import { CdkStep } from '@angular/cdk/stepper';\nimport { Component } from '@angular/core';\nimport { IManagedObject, IOperation, IResultList } from '@c8y/client';\nimport { C8yStepper, gettext } from '@c8y/ngx-components';\nimport { RepositoryService, RepositoryType } from '@c8y/ngx-components/repository';\nimport { TranslateService } from '@ngx-translate/core';\nimport { get, isEqual, uniqWith } from 'lodash-es';\nimport { BehaviorSubject, combineLatest, from, Observable, Subscription } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, shareReplay, switchMap } from 'rxjs/operators';\nimport { BaseStepperComponent } from '@c8y/ngx-components/operations/bulk-operation-stepper';\nimport {\n  BulkOperationsService,\n  OperationDetails\n} from '@c8y/ngx-components/operations/bulk-operations-service';\n\n@Component({\n  selector: 'c8y-stepper-bulk-type-configuration',\n  templateUrl: 'stepper-bulk-type-configuration.component.html'\n})\nexport class StepperBulkTypeConfigurationComponent extends BaseStepperComponent {\n  readonly NO_DEVICE_TYPE_AVAILABLE = gettext('Undefined`device type`');\n  selectedConfiguration: IManagedObject;\n  elementCount: number = 0;\n  DD_LOW_COUNT: number = 10;\n  textFilter$: BehaviorSubject<string> = new BehaviorSubject('');\n  configType$: BehaviorSubject<string> = new BehaviorSubject('');\n  configTypes = [];\n  selectedConfigType = { name: '' };\n  configurations$: Observable<IResultList<IManagedObject>> = combineLatest(\n    this.textFilter$,\n    this.configType$\n  ).pipe(\n    switchMap(([name, configType]) => this.getConfiguration(name, configType)),\n    shareReplay(1)\n  );\n  private configTypeSubscription: Subscription;\n\n  constructor(\n    private bulkOperationService: BulkOperationsService,\n    private repositoryService: RepositoryService,\n    private translate: TranslateService\n  ) {\n    super();\n    this.DD_LOW_COUNT = this.bulkOperationService.DD_LOW_COUNT;\n    this.loadConfigurationTypes();\n  }\n\n  loadConfigurationTypes() {\n    this.configTypeSubscription = this.configType$\n      .pipe(\n        debounceTime(300),\n        distinctUntilChanged(),\n        switchMap(searchStr => {\n          const query = { configurationType: `*${searchStr}*` };\n          return from(\n            this.repositoryService.listRepositoryEntries(RepositoryType.CONFIGURATION, { query })\n          );\n        })\n      )\n      .subscribe(result => {\n        const { data } = result;\n        this.configTypes = uniqWith(data.map(val => ({ name: val.configurationType })), isEqual);\n      });\n  }\n  ngOnDestroy(): void {\n    this.configTypeSubscription.unsubscribe();\n  }\n\n  selectConfiguration(configuration: IManagedObject) {\n    this.selectedConfiguration = configuration;\n  }\n\n  goToSecondStep($event: { stepper: C8yStepper; step: CdkStep }) {\n    $event.stepper.next();\n    this.getConfigBinary();\n    this.deviceTypes = this.selectedConfiguration.deviceType;\n  }\n\n  async getConfigBinary() {\n    if (this.selectedConfiguration.url) {\n      this.selectedConfiguration.binary = await this.repositoryService.getBinaryText(\n        this.selectedConfiguration.url,\n        { allowExternal: true, noAlerts: true }\n      );\n    }\n  }\n\n  getDeviceTypeTitle(configuration: IManagedObject): string {\n    return get(configuration, 'deviceType', this.translate.instant(this.NO_DEVICE_TYPE_AVAILABLE));\n  }\n\n  protected retrieveOperationPrototype(): OperationDetails {\n    const configuration = {\n      type: this.selectedConfiguration.configurationType,\n      url: this.selectedConfiguration.url\n    };\n\n    return {\n      name: gettext('Configuration update'),\n      description: get(this.selectedConfiguration, 'name'),\n      prototype: ({\n        description: `Update configuration to: ${this.selectedConfiguration.name}.`,\n        c8y_DownloadConfigFile: configuration\n      } as unknown) as IOperation\n    };\n  }\n\n  private getConfiguration(name?: string, configurationType?: string) {\n    const query: any = name ? { name: `*${name}*` } : {};\n    if (configurationType) {\n      query.__or = [{ configurationType }, { __not: { __has: `configurationType` } }];\n    }\n    return this.repositoryService.listRepositoryEntries(RepositoryType.CONFIGURATION, { query });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { ReactiveFormsModule } from '@angular/forms';\n\nimport { CoreModule, FormsModule, gettext } from '@c8y/ngx-components';\nimport { RepositoryModule } from '@c8y/ngx-components/repository';\nimport { BulkOperationStepperModule } from '@c8y/ngx-components/operations/bulk-operation-stepper';\nimport {\n  HOOK_LIST_BULK_TYPE,\n  baseUrl,\n  BulkOperationType\n} from '@c8y/ngx-components/operations/bulk-operations-service';\n\nimport { StepperBulkTypeConfigurationComponent } from './stepper-bulk-type-configuration.component';\n\n/** Module for the 'Configuration update' operation type stepper */\n@NgModule({\n  declarations: [StepperBulkTypeConfigurationComponent],\n  imports: [\n    CoreModule,\n    FormsModule,\n    ReactiveFormsModule,\n    BulkOperationStepperModule,\n    RepositoryModule\n  ],\n  providers: [\n    {\n      provide: HOOK_LIST_BULK_TYPE,\n      useValue: {\n        type: BulkOperationType.CONFIGURATION,\n        c8yIcon: 'cogs',\n        name: gettext('Configuration update'),\n        path: `${baseUrl}configuration`,\n        component: StepperBulkTypeConfigurationComponent,\n        fragments: ['c8y_DownloadConfigFile', 'c8y_Configuration'],\n        selected: false\n      },\n      multi: true\n    }\n  ],\n  entryComponents: [StepperBulkTypeConfigurationComponent],\n  exports: [StepperBulkTypeConfigurationComponent]\n})\nexport class StepperBulkTypeConfigurationModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"]}