{"version":3,"file":"c8y-ngx-components-operations-single-operation-details.js","sources":["../../operations/single-operation-details/single-operation-modal.component.ts","../../operations/single-operation-details/single-operation-details.service.ts","../../operations/single-operation-details/single-operation.component.ts","../../operations/single-operation-details/single-operation-list-item.component.ts","../../operations/single-operation-details/single-operation-details.component.ts","../../operations/single-operation-details/single-operation-details.module.ts","../../operations/single-operation-details/c8y-ngx-components-operations-single-operation-details.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input } from '@angular/core';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { IOperation } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-single-operation-modal',\n  templateUrl: './single-operation-modal.component.html'\n})\nexport class SingleOperationModalComponent {\n  @Input() operation: Partial<IOperation>;\n  @Input() collapsed: boolean = false;\n  @Input() readOnly: boolean = false;\n\n  constructor(public modalRef: BsModalRef) {}\n}\n","import { Injectable } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { IOperation, OperationService } from '@c8y/client';\nimport { SingleOperationModalComponent } from './single-operation-modal.component';\n\n@Injectable()\nexport class SingleOperationDetailsService {\n  constructor(private operationService: OperationService, private modalService: BsModalService) {}\n\n  /**\n   * Opens a modal window with the details of given single operation.\n   * @param operationOrOperationId Operation's object or id.\n   * @param options Additional options:\n   * - `collapsed`: boolean - whether the details pane should be initially collapsed\n   * - `readOnly`: boolean - whether the details should be displayed in read-only mode\n   */\n  async openDetails(\n    operationOrOperationId: IOperation | string | number,\n    options?: { collapsed?: boolean; readOnly?: boolean }\n  ) {\n    const operation: IOperation = (operationOrOperationId as IOperation).id\n      ? (operationOrOperationId as IOperation)\n      : (await this.operationService.detail(operationOrOperationId)).data;\n    const initialState = { operation, ...options };\n\n    this.modalService.show(SingleOperationModalComponent, {\n      initialState,\n      class: 'modal-lg'\n    });\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { IOperation } from '@c8y/client';\nimport { operationStatusClasses, operationStatusIcons } from '@c8y/ngx-components';\nimport { SingleOperationDetailsService } from './single-operation-details.service';\n\n/**\n * Single operation component displays a single operation's status, description and creationTime.\n *\n * Example:\n *\n * ```html\n * <c8y-single-operation [operation]=\"operation\"></c8y-single-operation>\n * ```\n */\n@Component({\n  selector: 'c8y-single-operation',\n  templateUrl: './single-operation.component.html'\n})\nexport class SingleOperationComponent {\n  @Input() operation: IOperation;\n\n  statusIcons: object;\n  statusClasses: object;\n\n  constructor(private singleOperationDetailsService: SingleOperationDetailsService) {}\n\n  ngOnInit() {\n    this.statusIcons = operationStatusIcons;\n    this.statusClasses = operationStatusClasses;\n  }\n\n  openDetails() {\n    this.singleOperationDetailsService.openDetails(this.operation);\n  }\n}\n","import { Component, Input, OnInit, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { assign, get } from 'lodash-es';\nimport { IOperation, OperationService, OperationStatus } from '@c8y/client';\nimport {\n  AlertService,\n  ListItemComponent,\n  Tab,\n  gettext,\n  operationStatusClasses,\n  operationStatusIcons\n} from '@c8y/ngx-components';\n\n@Component({\n  selector: 'c8y-single-operation-list-item',\n  templateUrl: './single-operation-list-item.component.html'\n})\nexport class SingleOperationListItemComponent implements OnInit {\n  @Input() operation: Partial<IOperation>;\n  @Input() collapsed: boolean = true;\n  @Input() readOnly: boolean = false;\n\n  @ViewChild('listItem', { static: true }) listItem: ListItemComponent;\n  @ViewChild('details', { static: true }) detailsTabTemplate: any;\n  @ViewChild('historyOfChanges', { static: true }) historyOfChangesTabTemplate: any;\n\n  tabs: Tab[] = [];\n  selectedTab: Tab;\n  statusIcons = operationStatusIcons;\n  statusClasses = operationStatusClasses;\n  OperationStatus = OperationStatus;\n\n  get displayedDescription() {\n    const commandText = get(this.operation, 'c8y_Command.text');\n    const opDescription = get(this.operation, 'description');\n    return commandText || opDescription || gettext('(no command text or description available)');\n  }\n\n  constructor(\n    private router: Router,\n    private operationService: OperationService,\n    private alertService: AlertService\n  ) {}\n\n  ngOnInit() {\n    this.statusIcons = operationStatusIcons;\n    this.statusClasses = operationStatusClasses;\n\n    this.tabs = [\n      {\n        label: gettext('Details'),\n        icon: 'asterisk',\n        template: this.detailsTabTemplate\n      } as Tab,\n      {\n        label: gettext('History of changes'),\n        icon: 'archive',\n        template: this.historyOfChangesTabTemplate\n      } as Tab\n    ];\n    this.selectedTab = this.tabs[0];\n  }\n\n  scheduleAsBulkOperation() {\n    this.router.navigateByUrl(`/devicecontrol/single/create-bulk/${this.operation.id}`);\n  }\n\n  async cancel() {\n    try {\n      const operationAfterUpdate = (await this.operationService.update({\n        id: this.operation.id,\n        status: OperationStatus.FAILED,\n        failureReason: gettext('Operation cancelled by user.')\n      })).data;\n      assign(this.operation, operationAfterUpdate);\n      this.alertService.success(gettext('Operation cancelled.'));\n    } catch (ex) {\n      this.alertService.addServerFailure(ex);\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { IOperation } from '@c8y/client';\nimport { BulkOperationDetailsService } from '@c8y/ngx-components/operations/bulk-operations-list';\n\n@Component({\n  selector: 'c8y-single-operation-details',\n  templateUrl: './single-operation-details.component.html'\n})\nexport class SingleOperationDetailsComponent {\n  @Input() operation: Partial<IOperation>;\n  @Input() readOnly: boolean = false;\n\n  constructor(private bulkOperationDetailsService: BulkOperationDetailsService) {}\n\n  openBulkOperationDetails() {\n    this.bulkOperationDetailsService.openDetails(this.operation.bulkOperationId);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CollapseModule } from 'ngx-bootstrap/collapse';\nimport { PopoverModule } from 'ngx-bootstrap/popover';\nimport { TooltipModule } from 'ngx-bootstrap/tooltip';\n\nimport { CoreModule } from '@c8y/ngx-components';\nimport { BulkOperationsListModule } from '@c8y/ngx-components/operations/bulk-operations-list';\nimport { BulkOperationsServiceModule } from '@c8y/ngx-components/operations/bulk-operations-service';\n\nimport { SingleOperationDetailsService } from './single-operation-details.service';\nimport { SingleOperationComponent } from './single-operation.component';\nimport { SingleOperationModalComponent } from './single-operation-modal.component';\nimport { SingleOperationListItemComponent } from './single-operation-list-item.component';\nimport { SingleOperationDetailsComponent } from './single-operation-details.component';\n\n/**\n * This module allows to display details of a single operation in a modal.\n */\n@NgModule({\n  imports: [\n    CoreModule,\n    PopoverModule,\n    TooltipModule,\n    CollapseModule,\n    BulkOperationsListModule,\n    BulkOperationsServiceModule\n  ],\n  providers: [SingleOperationDetailsService],\n  declarations: [\n    SingleOperationComponent,\n    SingleOperationModalComponent,\n    SingleOperationListItemComponent,\n    SingleOperationDetailsComponent\n  ],\n  entryComponents: [\n    SingleOperationComponent,\n    SingleOperationModalComponent,\n    SingleOperationListItemComponent,\n    SingleOperationDetailsComponent\n  ],\n  exports: [SingleOperationComponent]\n})\nexport class SingleOperationDetailsModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"]}