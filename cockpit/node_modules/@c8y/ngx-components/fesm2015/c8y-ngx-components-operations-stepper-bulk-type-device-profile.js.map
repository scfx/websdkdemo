{"version":3,"file":"c8y-ngx-components-operations-stepper-bulk-type-device-profile.js","sources":["../../operations/stepper-bulk-type-device-profile/confirm-device-profile-selection-step.component.ts","../../operations/stepper-bulk-type-device-profile/select-device-profile-step.component.ts","../../operations/stepper-bulk-type-device-profile/stepper-bulk-type-device-profile.component.ts","../../operations/stepper-bulk-type-device-profile/stepper-bulk-type-device-profile.module.ts","../../operations/stepper-bulk-type-device-profile/c8y-ngx-components-operations-stepper-bulk-type-device-profile.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input } from '@angular/core';\nimport { get } from 'lodash-es';\nimport { IManagedObject } from '@c8y/client';\nimport { gettext } from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'c8y-confirm-device-profile-selection-step',\n  templateUrl: 'confirm-device-profile-selection-step.component.html'\n})\nexport class ConfirmDeviceProfileSelectionStepComponent {\n  @Input() selectedDeviceProfile: IManagedObject;\n  readonly DEVICE_TYPE_NOT_DEFINED = gettext('Device type not defined');\n\n  constructor(\n    private translate: TranslateService\n  ) {}\n\n  get softwares() {\n    return get(this.selectedDeviceProfile, ['c8y_DeviceProfile', 'software'], []);\n  }\n\n  get configurations() {\n    return get(this.selectedDeviceProfile, ['c8y_DeviceProfile', 'configuration'], []);\n  }\n\n  getDeviceTypeTitle(deviceProfile: IManagedObject): string {\n    return get(\n      deviceProfile,\n      'c8y_Filter.type',\n      this.translate.instant(this.DEVICE_TYPE_NOT_DEFINED));\n\n  }\n}\n","import { Component, Output, EventEmitter } from '@angular/core';\nimport { Observable, BehaviorSubject, combineLatest, Subscription, from } from 'rxjs';\nimport { switchMap, shareReplay, debounceTime, distinctUntilChanged, tap } from 'rxjs/operators';\nimport { IResultList, IManagedObject } from '@c8y/client';\nimport { property, isEqual, uniqWith, get } from 'lodash-es';\nimport { gettext } from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { DeviceProfileService } from '@c8y/ngx-components/device-profile';\n\n@Component({\n  selector: 'c8y-select-device-profile-step',\n  templateUrl: 'select-device-profile-step.component.html'\n})\nexport class SelectDeviceProfileStepComponent {\n  @Output() deviceProfile: EventEmitter<IManagedObject> = new EventEmitter<IManagedObject>();\n  textFilter$: BehaviorSubject<string> = new BehaviorSubject('');\n  deviceType$: BehaviorSubject<string> = new BehaviorSubject('');\n  readonly DEVICE_TYPE_NOT_DEFINED = gettext('Device type not defined');\n  deviceTypes = [];\n  selectedDeviceType = { name: '' };\n  deviceProfile$: Observable<IResultList<IManagedObject>> = combineLatest(\n    this.textFilter$,\n    this.deviceType$\n  ).pipe(\n    switchMap(([name, deviceType]) => this.getDeviceProfiles(name, deviceType)),\n    shareReplay(1)\n  );\n  private deviceTypeSubscription: Subscription;\n\n  constructor(\n    private deviceProfileService: DeviceProfileService,\n    private translate: TranslateService\n  ) {\n    this.loadDeviceTypes();\n  }\n\n  loadDeviceTypes() {\n    this.deviceTypeSubscription = this.deviceType$\n      .pipe(\n        debounceTime(300),\n        distinctUntilChanged(),\n        switchMap(searchStr => {\n          const query = { 'c8y_Filter.type': `*${searchStr}*` };\n          return from(this.deviceProfileService.getDeviceProfiles(query));\n        })\n      )\n      .subscribe( ({ data }) => {\n        this.deviceTypes = uniqWith(\n          data.map(val => ({ name: val.c8y_Filter.type })).filter(val => val.name),\n          isEqual\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.deviceTypeSubscription.unsubscribe();\n  }\n\n  selectDeviceProfile(deviceProfile: IManagedObject) {\n    this.deviceProfile.emit(deviceProfile);\n  }\n\n  getDeviceTypeTitle(deviceProfile: IManagedObject): string {\n    return get(\n      deviceProfile,\n      'c8y_Filter.type',\n      this.translate.instant(this.DEVICE_TYPE_NOT_DEFINED));\n  }\n\n  private getDeviceProfiles(name?: string, deviceType?: string) {\n    const query: any = deviceType ? { 'c8y_Filter.type': deviceType } : {};\n    if (name) {\n      query.name = `*${name}*`;\n    }\n    return this.deviceProfileService.getDeviceProfiles(query);\n  }\n\n}\n","import { CdkStep } from '@angular/cdk/stepper';\nimport { Component } from '@angular/core';\nimport { IManagedObject, IOperation } from '@c8y/client';\nimport { C8yStepper, gettext } from '@c8y/ngx-components';\nimport { get } from 'lodash-es';\nimport { BaseStepperComponent } from '@c8y/ngx-components/operations/bulk-operation-stepper';\nimport { OperationDetails } from '@c8y/ngx-components/operations/bulk-operations-service';\n\n@Component({\n  selector: 'c8y-stepper-bulk-type-device-profile',\n  templateUrl: 'stepper-bulk-type-device-profile.component.html'\n})\nexport class StepperBulkTypeDeviceProfileComponent extends BaseStepperComponent {\n  selectedDeviceProfile: IManagedObject;\n\n  goToConfirmSelection($event: { stepper: C8yStepper; step: CdkStep }) {\n    this.deviceTypes = get(this.selectedDeviceProfile, 'c8y_Filter.type');\n    $event.stepper.next();\n  }\n\n  onDeviceProfileSelected(selectedItem) {\n    this.selectedDeviceProfile = selectedItem;\n  }\n\n  protected retrieveOperationPrototype(): OperationDetails {\n    return {\n      name: gettext('Apply device profile'),\n      description: get(this.selectedDeviceProfile, 'name'),\n      prototype: ({\n        description: `Apply device profile: ${this.selectedDeviceProfile.name}`,\n        profileId: this.selectedDeviceProfile.id,\n        profileName: this.selectedDeviceProfile.name,\n        c8y_DeviceProfile: this.selectedDeviceProfile.c8y_DeviceProfile\n      } as unknown) as IOperation\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { ReactiveFormsModule } from '@angular/forms';\n\nimport { CoreModule, FormsModule, gettext } from '@c8y/ngx-components';\nimport { DeviceProfileModule } from '@c8y/ngx-components/device-profile';\nimport { BulkOperationStepperModule } from '@c8y/ngx-components/operations/bulk-operation-stepper';\nimport {\n  HOOK_LIST_BULK_TYPE,\n  baseUrl,\n  BulkOperationType\n} from '@c8y/ngx-components/operations/bulk-operations-service';\n\nimport { ConfirmDeviceProfileSelectionStepComponent } from './confirm-device-profile-selection-step.component';\nimport { SelectDeviceProfileStepComponent } from './select-device-profile-step.component';\nimport { StepperBulkTypeDeviceProfileComponent } from './stepper-bulk-type-device-profile.component';\n\n/** Module for the 'Apply device profile' operation type stepper */\n@NgModule({\n  declarations: [\n    StepperBulkTypeDeviceProfileComponent,\n    SelectDeviceProfileStepComponent,\n    ConfirmDeviceProfileSelectionStepComponent\n  ],\n  imports: [\n    CoreModule,\n    FormsModule,\n    ReactiveFormsModule,\n    BulkOperationStepperModule,\n    DeviceProfileModule\n  ],\n  providers: [\n    {\n      provide: HOOK_LIST_BULK_TYPE,\n      useValue: {\n        type: BulkOperationType.DEVICE_PROFILE,\n        c8yIcon: 'c8y-device-profile',\n        name: gettext('Apply device profile'),\n        path: `${baseUrl}device-profile`,\n        component: StepperBulkTypeDeviceProfileComponent,\n        fragments: ['c8y_DeviceProfile'],\n        selected: false\n      },\n      multi: true\n    }\n  ],\n  entryComponents: [StepperBulkTypeDeviceProfileComponent],\n  exports: [StepperBulkTypeDeviceProfileComponent]\n})\nexport class StepperBulkTypeDeviceProfileModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"]}