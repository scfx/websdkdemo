"use strict";function _slicedToArray(n,t){return _arrayWithHoles(n)||_iterableToArrayLimit(n,t)||_unsupportedIterableToArray(n,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(n,t){if(n){if("string"==typeof n)return _arrayLikeToArray(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(n,t):void 0}}function _arrayLikeToArray(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function _iterableToArrayLimit(n,t){var r=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=r){var e,o,a=[],i=!0,c=!1;try{for(r=r.call(n);!(i=(e=r.next()).done)&&(a.push(e.value),!t||a.length!==t);i=!0);}catch(n){c=!0,o=n}finally{try{i||null==r.return||r.return()}finally{if(c)throw o}}return a}}function _arrayWithHoles(n){if(Array.isArray(n))return n}!function(){function n(r,i,n,e,t,o,a,p){var c=[{key:"appLogo",filename:"logo-nav",cssVar:"navigator-platform-logo"},{key:"brand-logo-img",filename:"logo",cssVar:"brand-logo-img"},{key:"favicon",filename:"favicon",option:"faviconUrl"}],l=["__import-font","html_title"],u=["cookieBannerDisabled","cookieBannerTitle","cookieBannerText","policyUrl"];return{keyToCssVar:s,getFontFamilyCssVar:y,reset:function(){return f(),n.remove().then(function(){return i.remove()})},deploy:function(t){var r={},e={brandingCssVars:r},o=function(n){return _.assign(r,n)},a=function(n){return _.assign(e,n)};return o(function(e){var n=c.map(function(n){var t=n.key;return t}).concat(l,u),o={};return _.keys(_.omit(e,n)).forEach(function(n){var t=e[n];if(_.isNumber(t)){var r="px";/logo.*height/i.test(n)&&(r="%"),t="".concat(t).concat(r)}o[s(n)]=t}),o["navigator-font-family"]=y(o["navigator-font-family"]),o}(t)),a(function(n){var t={};if(n.html_title&&(t.globalTitle=n.html_title),n["__import-font"]){var r=n["__import-font"];t.extraCssUrls=[r]}var e=_.pick(n,u);return e.cookieBannerDisabled&&u.forEach(function(n){e[n]=null}),t.cookieBanner=_.omit(e,"cookieBannerDisabled"),t}(t)),i.contextPath().then(function(n){return function(u,f){var s=[],y={},g={};return c.forEach(function(n){var t=n.key,r=n.cssVar,e=n.filename,o=n.option;if(f[t]){var a=function(n){for(var t=atob(n.split(",")[1]),r=_slicedToArray(n.split(",")[0].split(":")[1].split(";"),1)[0],e=new ArrayBuffer(t.length),o=new Uint8Array(e),a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return new Blob([e],{type:r})}(f[t].fileSrc),i=function(t){return _.find(["jpg","jpeg","svg","png","gif","webp","ico"],function(n){return new RegExp(n).test(t)})}(a.type),c="?nocache=".concat(String(Math.random()).substr(2)),l="".concat(e,".").concat(i);r&&(y[r]="url(/apps/public/".concat(u,"/").concat(l).concat(c,")")),o&&(g[o]="/apps/public/".concat(u,"/").concat(l).concat(c)),s.push(p([a],l))}}),i.update(s).then(function(){return{cssVars:y,options:g}})}(n,t)}).then(function(n){var t=n.cssVars,r=n.options;o(t),a(r)}).then(function(){return n.save(e)}).then(f)},removeLegacyBrandedApplications:function(){return e.listByOwner().then(function(n){return n.filter(function(n){return n.manifest&&n.manifest.originalAppId&&n.manifest.originalActiveVersionId})}).then(function(n){return 0<n.length?t({status:"danger",title:a("Delete legacy branded applications"),body:a("Before applying new branding configuration, legacy branded applications must be deleted.")}).then(function(){return function(n){var t=[];return n.forEach(function(n){return t.push(e.remove(n))}),r.all(t)}(n)}).then(function(){return o.success(a("Legacy branded applications deleted."))},function(n){return o.danger(n)}):r.resolve()})}};function f(){window.localStorage.removeItem("OPTIONS")}function s(n){return{navColor:"navigator-bg-color",navColorHeader:"navigator-header-bg","appLogo-height":"navigator-platform-logo-height","font-family-sans-serif":"font-family-base","headings-font-family":"font-family-headings","brand-logo-height":"brand-logo-img-height"}[n]||_.kebabCase(n)}function y(n){return"var(--".concat({"@font-family-sans-serif":"font-family-base","@headings-font-family":"font-family-headings"}[n],")")}}n.$inject=["$q","c8yUiAssets","c8yPublicOptions","c8yApplication","c8yModal","c8yAlert","gettext","createFile"],angular.module("c8y.custom-branding").factory("c8yBrandingDeploy",n)}();