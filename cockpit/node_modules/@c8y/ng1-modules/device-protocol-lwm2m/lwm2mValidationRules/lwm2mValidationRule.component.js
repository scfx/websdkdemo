"use strict";!function(){function e(e,n,r){var a,t=e.Validation.RuleType,l=e.Validation.ResourceDataType,u=e.Validation.ValueType,o=e.Validation.RuleName,i=[{type:t.GT,name:o.GT},{type:t.LT,name:o.LT},{type:t.GTE,name:o.GTE},{type:t.LTE,name:o.LTE},{type:t.EQ,name:o.EQ},{type:t.NEQ,name:o.NEQ}],s=this;function m(){if(s.showDateTime=c()&&T(),s.showDateTime){var e=function(e){var a;if(_.isString(e)){var t=(a=moment(e)).isValid();if(!t){var n=_.toNumber(e);_.isNumber(n)&&(a=moment(new Date(n)))}}else _.isNumber(e)&&(a=moment(new Date(e)));return{asString:_.get(a,"_d"),asMs:a?a.valueOf():void 0}}(s.dateTimeValue||_.get(s.rule,"arg.value"));s.value=e.asMs,s.dateTimeValue=e.asString,s.rule.arg.value=e.asMs}}function T(){return!(!_.isUndefined(s.selectedType)||s.resourceDataType!==l.TIME)||s.selectedType===u.DATE}function c(){return s.resourceDataType===l.TIME}function d(){var e=_.get(s.rule,"arg.valueType"),a="",t="";return e===u.STRING&&s.resourceDataType===l.BOOLEAN&&(t='"true"'.concat(" ",r.getString("or"),' "false"'),a="(true|false)"),e===u.OBJECTLINK&&(t=n("Refer to a resource using the following format: /Object/Instance/Resource, e.g. /3303/0/5700."),a="/[\\d*/]*\\d+"),e===u.NUMBER&&s.resourceDataType===l.INTEGER&&(t=n("Only values of type Integer allowed."),a="-?\\d+"),e===u.NUMBER&&s.resourceDataType===l.FLOAT&&(t=n("Only values of type Float allowed."),a="-?\\d*[.]\\d+"),e===u.DATE&&s.resourceDataType===l.TIME&&(t=n("Only numbers allowed, e.g. 1528197925677."),a="\\d+"),{pattern:a,tooltip:t}}function p(e){var a=_.find(i,{type:e});return a?a.name:void 0}_.assign(s,{change:function(){s.rule.type=function(e){var a=_.find(i,{name:e});return a?a.type:void 0}(s.selectedRule),s.rule.arg.valueType=s.selectedType,s.rule.arg.value=s.value,s.showDateTime=T()&&c(),s.formValidation=d(),s.onChange({rule:s.rule})},dateTimeChange:m,reflectInDateTimePicker:function(){s.dateTimeValue=moment(new Date(_.toNumber(s.value)))},selectedRule:p(_.get(s.rule,"type",_.first(s.options))),selectedType:_.get(s.rule,"arg.valueType"),ruleOptions:(a=s.options,_.map(a,function(e){return p(e)})),formValidation:d(),value:_.get(s.rule,"arg.value"),dateTimeValue:m(),$onChange:s.onChange({rule:s.rule})})}e.$inject=["c8yLwm2m","gettext","gettextCatalog"],angular.module("c8y.lwm2m").component("c8yLwm2mValidationRule",{templateUrl:":::PLUGIN_PATH:::/lwm2mValidationRules/lwm2mValidationRule.html",controller:e,controllerAs:"vm",bindings:{rule:"<",options:"<",isLast:"<",valueTypes:"<",onAdd:"&",onRemove:"&",onChange:"&",resourceDataType:"@"}})}();