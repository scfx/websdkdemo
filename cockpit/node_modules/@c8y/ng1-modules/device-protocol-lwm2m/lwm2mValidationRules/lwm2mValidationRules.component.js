"use strict";!function(){function e(e,a){var u=this;_.assign(u,{changes:function(){T()},addOrGroup:y,addAndRule:function(e){if(_.isEmpty(e)&&0===u.rules.length)y();else{for(var a=-1,r=0;r<u.rules.length;r++){var t=u.rules[r];if(_.find(t,e)){a=r;break}}-1<a&&u.rules[a].push(c())}T()},remove:function(a){_.forEach(u.rules,function(e){_.remove(e,a)}),_.remove(u.rules,function(e){return 0===e.length}),u.mappingForm.$setDirty(),T()},rules:[],valueTypes:[],isLast:function(e){return _.last(u.rules)===e},resourceDataType:u.resource.dataType});var r=a.Validation.RuleType,t=a.Validation.ValueType,n=a.Validation.ResourceDataType,s=[n.INTEGER,n.FLOAT,n.TIME],l=[n.INTEGER,n.FLOAT,n.TIME,n.STRING,n.BOOLEAN,n.OBJECTLINK],p=[{type:r.GT,valueTypes:s},{type:r.LT,valueTypes:s},{type:r.EQ,valueTypes:l},{type:r.NEQ,valueTypes:l},{type:r.GTE,valueTypes:s},{type:r.LTE,valueTypes:s}],i=[{resourceTypes:[n.INTEGER,n.FLOAT],valueTypes:[t.NUMBER,t.OBJECTLINK]},{resourceTypes:[n.TIME],valueTypes:[t.DATE,t.OBJECTLINK]},{resourceTypes:[n.STRING,n.OBJECTLINK],valueTypes:[t.STRING,t.REGEX,t.OBJECTLINK]},{resourceTypes:[n.BOOLEAN],valueTypes:[t.STRING,t.OBJECTLINK]}];function o(){u.options=_.filter(p,{valueTypes:[u.resource.dataType]}).map(function(e){return e.type}),u.valueTypes=_.flatten(_.filter(i,{resourceTypes:[u.resource.dataType]}).map(function(e){return e.valueTypes})),function(){var e=_.get(u.mapping,"validation");e&&e.type&&e.arg&&e.type===r.OR&&_.forEach(e.arg,function(e){u.rules.push(e.arg)})}()}function T(){var a={type:r.OR,arg:[]};_.map(u.rules,function(e){a.arg.push({type:r.AND,arg:e})}),_.assign(u.mapping,{validation:0<a.arg.length?a:null})}function y(){u.rules.push([c()])}function c(){return{type:_.first(u.options),arg:{valueType:_.first(u.valueTypes),value:void 0}}}e.$watch("vm.mapping.validation",function(){u.rules=[],o()})}e.$inject=["$scope","c8yLwm2m"],angular.module("c8y.lwm2m").component("c8yLwm2mValidationRules",{templateUrl:":::PLUGIN_PATH:::/lwm2mValidationRules/lwm2mValidationRules.html",controller:e,controllerAs:"vm",bindings:{mapping:"=",resource:"<"}})}();