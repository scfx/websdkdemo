"use strict";!function(){function e(o,i,c,n,t,e,s,a,r,u,d,l,f){function v(e){o.counters={},function(e){_.forEach(e,function(t){o.counters[t.id]={},_.forEach(_.filter(d,g),function(e){!function(e,t){var n=o.counters[e.id],i=t.counter({dateFrom:t.dateFrom,type:o.options.data[t.name].type,source:e.id});(n[t.name]=i).onNotification(function(){o.realtimeAnimation=!0}),i.start()}(t,e)})})}(e),o.devices=e}function m(e){_.forEach(e,function(t){_.forEach(d,function(e){!function(e,t){var n=o.counters[e.id][t.name];n&&n.stop()}(t,e)})})}function g(e){return!!o.options.data[e.name]}function p(e){o.devices&&m(o.devices),o.options=e,function(e){var t=_.map(e,"id").join(",");n.list({ids:t}).then(v)}(o.options.assets)}function h(e){return u.checkIfModulesExist(["c8y.deviceDetailControl","c8y.parts.deviceControlList"])?f.getString('To see the result click <a href="#/device/{{deviceId}}/control">here</a>',{deviceId:e}):""}o.counterColumns=d,o.realtimeChannel="/managedobjects/*",o.lastValidMessageIcon=t.lastValidMessageIcon,o.lastValidMessageColor=t.lastValidMessageColor,o.lastValidMessageTooltip=t.lastValidMessageTooltip,o.orderBy=function(e){o.devices=i("orderBy")(o.devices,e)},o.getIcon=function(e,t,n){if(!e)return{icon:"question-circle-o",color:"red"};var i=function(t){return _.find(o.options.iconsMap,function(e){return e.id===t})}(e);return _.find(i.map,function(e){return s.compare(e.comparison,angular.lowercase(e.value),function(e,t){var n={obj:t},i=c("obj.".concat(e))(n);return _.isObjectLike(i)&&(i=angular.toJson(i)),angular.lowercase(String(i))}(t,n))})},o.switchMaintenance=function(e){t.switchResponseInterval(e)},o.orderAlarms=function(e){o.devices=_.sortBy(o.devices,function(e){var t=e.c8y_ActiveAlarmsStatus||{};return[t.critical,t.major,t.minor,t.warning]}),e&&o.devices.reverse()},o.orderLastValidMessage=function(e){o.devices=_.sortBy(o.devices,function(e){return t.isLastValidMessage(e)}),e&&o.devices.reverse()},o.orderByCount=function(e,t){var n=_.map(o.devices,function(e){return _.assign({},e,{counter:o.counters[e.id]})});n=i("orderBy")(n,"counter.".concat(e,".count"),t),o.devices=_.map(n,function(e){return delete e.counter,e})},o.executeOperation=function(t,n){var i=_.cloneDeep(t.json);i.deviceId=n,t.isPending=t.isPending||{},a.createWithNotifications(i).then(function(e){t.isPending[n]=!0,e.created.then(function(){return r.success(f.getString('"{{description | translate}}" will be executed.',i))}),e.completed.then(function(e){t.isPending[n]=!1,e.status===a.status.SUCCESSFUL?r.info("".concat(f.getString('"{{description | translate}}" completed.',i)," ").concat(h(n))):e.status===a.status.FAILED&&r.danger("".concat(f.getString("{{description | translate}} failed.",i)," ").concat(h(n)))})})},o.statusIcon=t.statusIcon,o.statusClass=t.statusClass,o.tooltip=_.memoize(t.availabilityTooltip,function(e){return e.id}),o.$watch("child.config.options",function(e,t){e&&!_.isEqual(e,t)&&p(e)}),e.addListener(o.$id,o.realtimeChannel,"".concat(o.$id,"-subscribed"),function(){o.realtimeAnimation=!1,p(o.child.config.options)}),e.addListener(o.$id,o.realtimeChannel,e.realtimeActions().UPDATE,function(e,t){for(var n in o.realtimeAnimation=!0,o.devices)o.devices[n].id===t.id&&(o.devices[n]=t)}),e.switchRealtime(o.$id,o.realtimeChannel)}e.$inject=["$scope","$filter","$parse","c8yInventory","c8yDevices","c8yRealtime","c8yComparisons","c8yDeviceControl","c8yAlert","c8yBase","counterColumns","gettext","gettextCatalog"],angular.module("c8y.assets").controller("AssetsCtrl",e)}();