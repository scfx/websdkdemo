"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,i,o=[],c=!0,a=!1;try{for(t=t.call(e);!(c=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);c=!0);}catch(e){a=!0,i=e}finally{try{c||null==t.return||t.return()}finally{if(a)throw i}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){function e(c,n,i,o,r,t,a,s,u){var l=20,f={};function d(e){c.properties=[],f={},c.renderedDevices=f,c.parentId=e.device&&e.device.id||e.options&&e.options.parentId,s.list().then(angular.bind(u,u.filterAndExtendWithStoredProperties,c.child.config.options.properties)).then(p).then(function(e){c.properties=e,c.parentId?function(e){return i.detailRealtime(e,c)}(c.parentId).then(y).then(h):c.devices=_.map(c.devices,b)})}function p(e){return _.filter(e,"__active")}function y(e){r.isGroup(e)||(c.devices||(c.devices=[]),c.devices.push(e))}function h(){return function(e){var r={pageSize:l},t=o.createListMapper(function(e){return e.managedObject});return n.all([v(e,"childAssets",r).then(t),v(e,"childDevices",r).then(t)]).then(o.combineLists)}(c.parentId).then(e)}function v(r,t,e){var n=o.cleanListCallback("references",function(e){return v(r,t,e)},e,!0);return i.children(r,t,{params:e}).then(n)}function e(e){c.devices||(c.devices=[]),e.forEach(function(e){i.detailRealtime(e,c),c.devices.push(e)}),c.paging=e.paging}function g(e){var r=e;_.isArray(r)&&(r=r.join("."));var t=_slicedToArray(r.match(/^(-?)(.*)$/),3),n=t[1],i=t[2],o="-"===n?"desc":"asc";-1<i.indexOf("lastMeasurement")?c.devices=_.orderBy(c.devices,[function(t){return function(e){if("object"!==_typeof(e[t])&&""!==e[t]){var r=String(e[t]).split("|");if(2===r.length)return moment(r[0],"L, LTS").toDate()}}}(i),function(t){return function(e){if("object"!==_typeof(e[t])&&""!==e[t]){var r=String(e[t]).split("|");return 2===r.length?parseFloat(r[1]):parseFloat(r[0])}}}(i)],[o,o]):c.devices=_.orderBy(c.devices,i,o),c.$broadcast("c8yScrollLoad::refresh")}function b(e){return a.attach(e),t.attach(e,c.properties),e}c.$watch("child.config",function(e,r){e&&!_.isEqual(e,r)&&d(c.child.config)}),_.assign(c,{getArrows:function(e){return!!c.child.config.options.arrows[e]},orderBy:g,orderDownBy:function(e){var r=e;_.isArray(r)&&(r=r.join("."));g("-".concat(r))},loadNext:function(){c.paging.loading=!0,c.paging.next().then(e).finally(function(){c.paging.loading=!1})},buildFields:function(e,r){return function(e,r){for(var t=e,n=0;n<(r||[]).length&&null!=t;n++)t=t[r[n]];return t}(e,r)},getAssetLinkIfNeeded:function(e,r){var t=null;(function(e){return e===_.findIndex(c.properties,function(e){var r=e.renderType;return _.isUndefined(r)})})(r)&&(t=u.getAssetLink(e));return t},setArrows:function(e){c.child.config.options.arrows[e]=!c.child.config.options.arrows[e]},renderedDevices:f,renderDevice:function(e){var r=e.id;f[r]||(b(e),f[r]=!0)},renderedAllDevices:function(){return Boolean(c.devices&&c.devices.length===_.keys(f).length)}}),d(c.child.config)}e.$inject=["$scope","$q","c8yInventory","c8yBase","c8yGroups","c8yComputedProperties","c8yObjectActions","c8yPropertiesLibrary","assetsSvc"],angular.module("c8y.assets").controller("AssetsCtrl",e)}();