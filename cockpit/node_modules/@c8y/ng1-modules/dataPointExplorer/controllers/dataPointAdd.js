"use strict";!function(){function t(e,t,n,i,a,o,r,c,d){var l,u,f,s=_.partial(h,!1);function g(t){var e=t;return o.kpisOnly&&(e=_(t).filter("_kpiId").uniqBy("_kpiId").value()),e}function p(t){return _.reject(t,function(t){return!!_.find(r,_.pick(t,["fragment","series","__target"]))})}function v(t){e.datapoints=t}function h(t){e.data.loadingDataPoints=t}function S(){return _.union(_.filter(e.datapoints,"__active"),_.filter(e.datapointsSelected,"__active"))}function C(t){var n=_.get(e,"data.device.id");if(n){var i=_.filter(e.datapointsSelected,function(t){var e=t.__target;return n===e.id});return t.filter(function(t){var e=t._kpiId;return!e||!_.find(i,{_kpiId:e})})}return t}e.config=o,e.shouldDisableSelection=function(t){return!t.__active&&o&&o.maxSelectCount<=S().length},e.cancel=t.dismiss,e.getSelected=S,e.add=function(){t.close(S())},e.data={},e.$watch("data.device",function(t){if(!t)return;e.noContext=!1,h(!0),e.datapointsSelected=S(),delete e.datapoints,i.listPossible(t).then(g).then(p).then(C).then(v).then(s)}),e.getConfigTitle=function(t){return t.title||d("Add data point")},e.getConfigBtnLabel=function(t){return t.addButtonLabel||d("Add")},u=a.getContext(),f=c.SHARED_CONTEXTS.COMPUTED_PROPERTY_LAST_MEASUREMENT.value,!(l=u.context)||"device"!==l&&"group"!==l?(h(e.noContext=!0),i.listForFirstDevices(2).then(g).then(p).then(v).then(s)):(e.rootId=u.id,c.isAvailable(f)&&(e.rootId=_.get(c.get(f),"id",e.rootId)))}t.$inject=["$scope","$uibModalInstance","$injector","c8yDataPointSvc","c8yUiUtil","config","addedDataPoints","contextDetailsSharedService","gettext"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointAddCtrl",t)}();