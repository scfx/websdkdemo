"use strict";!function(){function e(e,i,n,t,a,o){i.availableKpi=function(){return n.getCompatibleKpi(i.kpis,i.dp||{})},i.isKpiAvailable=function(){return i.dp._kpiId&&d(i.dp._kpiId)},i.saveToLibrary=function(t){i.isopen=!1;var e=!!t._kpiId;t._kpiId&&!d(t._kpiId)&&(e=!1,delete t._kpiId);n.saveDataPointToLibrary(t,e).then(function(e){_.isEmpty(e.data)||(t._kpiId=e.data.id),a.success(o("Saved to library.")),i.listKpi()})},i.updateDataPointWithKpi=function(e,t){i.isopen=!1,n.updateDataPointWithKpi(e,t)},i.chartTypes=t.renderTypes,i.lineTypes=t.lineTypes,i.axisTypes=t.axisTypes,i.dpDebounce=300,i.getLinkedKpiLabel=function(){if(i.dp._kpiId){var e=_.find(i.availableKpi(),{id:i.dp._kpiId});return _.get(e,"c8y_Kpi.label","")}return},i.setRangesFieldsAsTouched=_.once(function(){_.forEach(l,function(e){return _.get(i.singleDpForm,e).$setTouched()})}),i.isCollapsed=!1,i.collapse=function(){i.isCollapsed=!i.isCollapsed,i.defaultDatapoint||n.listForObject(i.dp.__target).then(p)},i.localIsEqualToTargetDp=function(){return n.equals(i.defaultDatapoint,i.dp)},i.localIsEqualToTargetDpValue=function(e){var t=_.get(i.defaultDatapoint,e),a=_.get(i.dp,e);return n.equals(t,a)},i.defaultDatapoint=void 0,i.save=function(){i.dp&&!i.dontSave&&n.save(i.dp.__target,i.dp).then(p)},i.onRangeFieldChange=function(){r(),i.setRangesFieldsAsTouched()};var l=["min","max","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax"];function p(e){i.defaultDatapoint=e[i.dp._id]}function d(e){return _.some(i.availableKpi(),{id:e})}function r(){var e=i.singleDpForm;u(e.min,e.max),u(e.yellowRangeMin,e.yellowRangeMax),u(e.redRangeMin,e.redRangeMax)}function u(e,t){if(e&&t){var a="range-ends-must-not-be-equal",i=s(e),n=s(t),o=!(null!==i&&null!==n)||i!==n;e.$setValidity(a,o),t.$setValidity(a,o)}}function s(e){var t=e.$modelValue;return _.isNumber(t)||_.isString(t)&&!_.isEmpty(t)?_.toNumber(t):null}e(function(){return r()})}e.$inject=["$timeout","$scope","c8yDataPointSvc","c8yChart","c8yAlert","gettext"],angular.module("c8y.cockpit.dataPointExplorer").controller("c8yDataPointItemCtrl",e)}();