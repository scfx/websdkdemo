"use strict";!function(){n.$inject=["$parse","$timeout","gettext"],angular.module("c8y.ui").factory("c8yAggregationSvc",function(){return{calculate:y}}).directive("c8yAggregation",n);var v="NONE",a="MINUTELY",e="HOURLY",t="DAILY",o=moment.duration(10,"minute"),g=moment.duration(1,"day"),i=moment.duration(4,"days");function y(n){return i<=n?t:g<=n?e:o<n?a:v}function n(o,s,n){var _=[{value:v,name:n("None")},{value:a,name:n("Minutely")},{value:e,name:n("Hourly")},{value:t,name:n("Daily")}],f=!1;return{restrict:"E",template:'\n        <div class="c8y-select-wrapper"><select\n          class="form-control"\n          ng-disabled="__realtime()"\n          ng-model="__aggregation"\n          ng-change="__onChange()">\n          <option\n            title="{{agg.name | translate}}"\n            ng-repeat="agg in __aggregations"\n            value="{{agg.value}}"\n            ng-disabled="__disabled[agg.value]">\n            {{agg.name | translate}}\n          </option>\n        </select><span></span></div>',replace:!0,scope:!0,link:function(g,n,i){var r=o(i.dateFrom),u=o(i.dateTo),l=o(i.aggregation),a=o(i.realtime),e=f||!!i.aggregateRealtime,m=function(n){return void 0===n?v:n},c=function(n){return n===v?void 0:n};g.__aggregations=_;var d=null;g.__onChange=function(){d=moment.duration(moment(u(g)).diff(r(g))),l.assign(g,c(g.__aggregation))},g.__realtime=function(){return a(g)};var t="{\n        dataFrom: ".concat(i.dateFrom,", \n        dateTo: ").concat(i.dateTo,", \n        aggregation: ").concat(i.aggregation,", \n        realtime: ").concat(i.realtime,"\n      }");g.$on("$destroy",function(){e&&(f=!1)}),g.$watch(t,function(n,a){if(i.auto&&"false"!==i.auto){if(n.realtime&&!f)return g.__aggregation=m(),void l.assign(g,c(g.__aggregation));if(n!==a)if(n.aggregation===a.aggregation){var e=moment.duration(moment(u(g)).diff(r(g))),t=y(e),o=d&&y(d);t!==o&&(d=null,s(function(){g.__disabled={DAILY:e<=moment.duration(1,"day"),HOURLY:e<=moment.duration(1,"hour"),MINUTELY:e<=moment.duration(1,"minute")}}),g.__aggregation=t,l.assign(g,c(t)))}else g.__aggregation=m(n.aggregation);else g.__aggregation=m(n.aggregation)}},!0)}}}}();