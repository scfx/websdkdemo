"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],o=!0,c=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){c=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(c)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){function e(l,p,g,d,f,h,y,m,v,b){var A={when:!0,what:!0,who:!0,text:!1,type:!1,time:!1};function w(e){return e.time=moment(e.time).toDate(),e}return{restrict:"EA",link:function(n){function r(e){return"apps/devicemanagement/#/device/".concat(e,"/")}function t(e){return _(_.cloneDeep(e)).map(w).map(o).map(c).map(s).value()}function a(e){e&&(e.map(function(e){return _.assign(e,{showCogWheel:function(){if(_.get(n,"sourceDeviceId")){var e=n.sourceDeviceId,t=_.toNumber(e);if(!_.isNumber(t)||_.isNaN(t))return!0;var r=d.path().match(e);return!(t===_.toNumber(r))}return!0}()})}),n.data=t(e))}function e(e){e&&(n.data=n.data||[],n.data=_.concat(n.data,t(e)),n.paging=e.paging)}function i(){var t=_.clone(n.filter())||{},r={},e=t.source;r.source=_.isObjectLike(e)?e.id:e,n.isFiltered=0<Object.keys(t).filter(function(e){return"source"!==e&&t[e]}).length,delete t.source,_.assign(r,t),r.pageSize=n.pageSize()||100,r.withTotalPages=!0,r.revert=!(!n.reverse||!n.reverse()),h.list(r).then(function(e){return n.paging=e.paging,r.source&&_.remove(e,{activity:"Availability monitoring record"}),e}).then(a)}function o(e){return _.set(e,"_parsedChanges",u(e)),e}function c(e){var t=e.user;if(t){var r=t.match(/\$/);if(_.set(e,"_isSupport",!!r),r&&f.appOption("support_user_string")){var n=_slicedToArray(t.split("$"),2),a=n[0],i=n[1];e.user=v.getString(f.appOption("support_user_string"),{support_user:a,supported_user:i})}}return e}function s(e){var t,r=_.get(e,"source.id"),n="Group"===e.type?"global":"inventory";switch(e.type){case"Alarm":case"Operation":e.sourceInfo={id:r,type:e.type};break;case"CepModule":t="apps/administration/#/eventprocessing";break;case"Tenant":t="apps/administration/#/tenants/".concat(r,"/properties");break;case"Group":case"InventoryRole":t="apps/administration/#/roles/".concat(n,"/").concat(r);break;case"UserAuthentication":case"User":var a={id:_.get(e,"source.id",_.get(e,"user"))},i="apps/administration/#/users/".concat(a.id),o="apps/devicemanagement/#/deviceusers/".concat(a.id);t=b.isDeviceUser(a)?o:i;break;case"SmartRule":t="apps/cockpit/#/rules";break;case"TrustedCertificates":t="/apps/devicemanagement/#/trusted-certificates";break;case"TenantAuthConfig":t="/apps/administration/#/auth-configuration";break;case"DevicesAvailabilityMonitoring":t="apps/devicemanagement/#/device/".concat(r)}return e.sourceLink=t?f.url(t):void 0,e}function u(e){var t=e.changes||[],r=[];return _.forEach(t,function(e){"revision"!==e.attribute&&r.push("".concat(v.getString(l("humanize2")(e.attribute)),": ").concat(v.getString(e.previousValue)," > ").concat(v.getString(e.newValue)))}),r.join(" ; ")}_.assign(n,{goToAuditDetail:function(e){var t=p.when();switch(e.type){case"Alarm":t=y.detail(e.id).then(f.getResData).then(function(e){return"".concat(r(e.source.id),"alarms")});break;case"Operation":t=m.detail(e.id).then(f.getResData).then(function(e){return"".concat(r(e.deviceId),"control")})}t.then(function(e){e&&(g.location=f.url(e))})}}),n.convertType=function(e){return h.types[e]},n.convertTypeIcon=function(e){return h.typeicons[e]||"wrench"},n.refresh=function(){return i()},n.changePage=function(e,t){e!==t&&(n.changeInProgress=!0,n.paging.changePage(e).then(function(e){return n.paging=e.paging,e}).then(a).finally(function(){n.changeInProgress=!1}))},n.loadNext=function(){n.refreshLoading||(n.paging.loading=!0,n.refreshLoading=!0,n.paging.next().then(e).finally(function(){n.paging.loading=!1,n.refreshLoading=!1}))},n.parseChanges=u,n.$watch("filter()",i,!0),n.columnsConfig=_.merge({},A,n.columns())},scope:{filter:"&",data:"=?",reverse:"&",columns:"&",pageSize:"&",paging:"=?",refresh:"=?",borderless:"=?",striped:"=?",sourceDeviceId:"@?",hideDevice:"=?"},templateUrl:":::PLUGIN_PATH:::/ui/views/auditList.html"}}e.$inject=["$filter","$q","$window","$location","c8yBase","c8yAudits","c8yAlarms","c8yDeviceControl","gettextCatalog","c8yUser"],angular.module("c8y.ui").directive("c8yAuditList",e)}();