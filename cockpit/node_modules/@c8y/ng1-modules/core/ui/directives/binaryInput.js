"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,l,i=[],a=!0,o=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){o=!0,l=e}finally{try{a||null==r.return||r.return()}finally{if(o)throw l}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}angular.module("c8y.ui").directive("c8yBinaryInput",function(){return e.$inject=["$scope","$element","c8yBase","c8yBinary","c8yModal","c8yAlert","gettext","gettextCatalog"],{restrict:"E",require:"?^form",scope:{initialId:"=?",initialUrl:"=?",editable:"=?",file:"=?outputFile",allowFreeUrlInput:"=?",uploadable:"=?",downloadable:"=?",clearable:"=?",removable:"=?",fileRequired:"=?",setGlobal:"=?"},link:function(e,t,r,n){e.form=n},templateUrl:":::PLUGIN_PATH:::/ui/views/binaryInput.html",controller:e};function e(r,e,t,n,l,i,a,o){var u={url:""},d={upload:{inProgress:!1},download:{progress:0,inProgress:!1}};function s(e,t){return _.isUndefined(e)?t:e}function c(e){return g(n.getIdFromUrl(e.headers("Location")))}function f(e){e&&e.data&&e.data.messsage&&i.danger(e.data.message)}function y(e){e.icon=n.icon(e),e.url=n.getDownloadUrl(e),r.file=e,r.form&&r.form.$setDirty()}function b(){u={url:""},r.file=u,e.find("input[type='file']").val(null)}function p(){r.initialUrl&&(r.initialId=n.getIdFromUrl(r.initialUrl)),r.initialId?g(r.initialId):function(e){u={url:e},r.file=u}(r.initialUrl)}function g(e){return n.detail(e,{},{silentError:!0}).then(t.getResData).then(y).catch(function(){r.fileNotAvailable=!0})}_.assign(r,{file:u,onFileSelect:function(e){if(!(e.length<1)){var t=_slicedToArray(e,1)[0];return n.hasValidSize(t)?function(e){d.upload.inProgress=!0;var t=r.setGlobal?{c8y_Global:{}}:void 0;return n.upload(e,t).then(c,f).finally(function(){d.upload.inProgress=!1})}(t):void i.danger(o.getString("Selected file is too large â€“ size limit is {{limitBytes | bytes}}.",{limitBytes:n.getBytesSizeLimit()}))}},chooseFile:function(){l({templateUrl:":::PLUGIN_PATH:::/ui/views/binaryInputModal.html",controller:"binaryInputModalCtrl"}).then(function(e){var t=e.file;return y(t)})},download:function(e){d.download.inProgress=!0,d.download.progress=0;var t=n.downloadAndSaveAs(e);return t.then(null,null,function(e){d.download.progress=100*e}),t.finally(function(){d.download.inProgress=!1,d.download.progress=100})},remove:function(e){return l({title:a("Delete file"),body:o.getString('You are about to delete file "{{name}}". Do you want to proceed?',e),labels:{ok:a("Delete")},status:"danger"}).then(angular.bind(n,n.removeBinary,e)).then(b)},clear:function(){b()},status:d}),r.editable=s(r.editable,!0),r.allowFreeUrlInput=r.editable&&s(r.allowFreeUrlInput,!0),r.uploadable=r.editable&&s(r.uploadable,!0),r.downloadable=s(r.downloadable,!0),r.clearable=r.editable&&s(r.clearable,!0),r.removable=r.editable&&s(r.removable,!1),r.fileRequired=r.editable&&s(r.fileRequired,!1),r.$watch("initialId",p),r.$watch("initialUrl",p)}});