"use strict";angular.module("c8y.ui").directive("c8yPieChart",function(){var o="<svg></svg>";return{restrict:"EA",template:o,scope:{measurements:"=",dps:"=",options:"="},link:function(r,i){var a,s,u,c,l=r.options;function e(){var t=function(){var t=nv.models.pieChart().x(d).y(p).color(h).tooltipContent(f);return l&&(t.showLabels(r.options.showLabels||!1),t.showLegend(r.options.showLegend||!1),t.options({tooltips:r.options.showTooltips||!1}),l.showLegend||t.margin({top:0})),t.pie.pieLabelsOutside(!1).labelType("percent"),t}(),n=d3.select(i[0]).select("svg"),e=i.children().first(),o=function(t,n,e){!function(t){t&&t.update&&t.update()}(t);var o=r.measurements,i=n.datum()||r.dps;if(o&&i){(i.length!==r.dps.length||0<_.differenceBy(i,r.dps,"_id").length)&&(i=r.dps);var a=_.map(i,function(t,n){return{_id:t._id,label:t.label,value:o[n].value,color:t.color,unit:t.unit,disabled:t.disabled}});n.datum(a).transition().duration(500).call(t)}}.bind(void 0,t,n,e);return a=r.$watch("measurements",o),s=r.$watch("dps",o),u=r.$watch(v,o),c=r.$watch(m,o),i.onresize=g,t}function d(t){return t.label}function p(t){return t.value}function h(t){return t.data.color}function f(t,n,e){return _.escape("".concat(t,": ").concat(n," ").concat(e.point.unit||""))}function v(){return i.parent().width()}function m(){return i.parent().height()}function g(){r.$apply()}nv.addGraph(e),r.$watch("options",function(t,n){t&&!_.isEqual(t,n)&&(l=t,i.html(o),a(),s(),u(),c(),nv.addGraph(e))})}}});