"use strict";!function(){function e(d,v,y,e,r,g,h,f,E){var k;return{list:function(){return d.all({nbDevices:v.getCount(),currentApp:r.getCurrent(),buildTarget:d.resolve(y.appOption("target")),userApps:r.listByUser().then(n)}).then(function(e){var n=_.get(e,"currentApp.name"),r=e.nbDevices,i=e.buildTarget;k=e.userApps;var c=[],t=function(r){return d.all({currentUser:h.current(),userHierarchyActive:g.userHierarchyActive()}).then(function(e){var r=e.currentUser,n=e.userHierarchyActive;return(h.hasRole(r,"ROLE_USER_MANAGEMENT_ADMIN")||n&&h.hasRole(r,"ROLE_USER_MANAGEMENT_CREATE"))&&A("administration")}).then(function(e){return e?_.assign({priority:2,icon:"c8y-icon c8y-icon-add-user",label:f("Add user"),url:"/apps/administration/index.html#/users/new",color:"#FEFEFE",backgroundColorClass:C("a")},r):null})}(),o=function(e){var r;A("devicemanagement")&&(r=_.assign({priority:2,icon:"c8y-icon c8y-icon-device-connect",label:f("Add device"),url:"/apps/devicemanagement/#/deviceregistration",color:"#FEFEFE",backgroundColorClass:C("b")},e));return r}(),a=function(e){var r;if(E){var n={dt:{backgroundColorClass:C("d")}};if(A("devicemanagement")){var i=(n[e]||{}).backgroundColorClass||"e";r={priority:2,icon:"c8y-icon c8y-icon-group-add",label:f("Add group"),click:m,color:"#FEFEFE",backgroundColorClass:C(i)}}}return r}(i),u=function(e){return{priority:({dt:{priority:2}}[e]||{}).priority||3,icon:"c8y-icon c8y-icon-device-management",label:f("Device management"),url:"/apps/devicemanagement",color:"#EFEFEF",backgroundColorClass:C("f")}}(i),l=function(e){return{priority:({dt:{priority:2}}[e]||{}).priority||3,icon:"c8y-icon c8y-icon-cockpit",label:f("Cockpit"),url:"/apps/cockpit",color:"#EFEFEF",backgroundColorClass:C("e")}}(i),s={priority:2,iconSrc:":::PLUGIN_PATH:::/icons/HelpAndService.svg",label:f("Help & Service"),url:"/apps/HelpAndService",color:"#EFEFEF",backgroundColorClass:C("f")};if(0===r)void 0!==o&&(o.priority=1);else if(r<=5){var p=1===r?1:3;c.push(v.list({pageSize:r}).then(function(e){var r=[];return _.forEach(e,function(e){r.push(function(e,r,n,i){var c,t=_.filter(["cockpit","devicemanagement"],function(e){return A(e)});if(t.length){var o=_.includes(t,i)?i:_.head(t);c=_.assign({priority:({dt:{priority:2}}[n]||{}).priority||3,icon:"c8y-icon c8y-icon-device",label:e.name||f("Device ")+e.id,url:"/apps/".concat(o,"/#/device/").concat(e.id),color:"#FEFEFE",backgroundColorClass:C("c")},r)}return c}(e,{priority:p},i,n))}),r}))}else l.priority=1;return c.push(function(){var e,r=y.getPluginService("phoneRegistrationService");r&&(e=r.createAddPhoneLink());return e}()),c.push(d.when(t)),c.push(d.when(o)),c.push(d.when(a)),"devicemanagement"!==n&&A("devicemanagement")&&c.push(d.when(u)),"cockpit"!==n&&A("cockpit")&&c.push(d.when(l)),"HelpAndService"!==n&&"dt"===i&&A("HelpAndService")&&c.push(d.when(s)),d.all(c).then(_.flattenDeep).then(_.partialRight(_.filter,_.identity))})}};function m(){E.addAssetUI()}function A(e){return _.includes(k,e)}function C(e){return["quick-link","quick-link-".concat(e.priority),"quick-link-bgcolor-".concat(e.backgroundColorClass)]}function n(e){return _(e).map("contextPath").uniq().value()}}e.$inject=["$q","c8yDevices","c8yBase","c8yPermissions","c8yApplication","c8yUserUtil","c8yUser","gettext","groupsHierarchySvc"],angular.module("c8y.ui").factory("c8yQuickLinks",e)}();