"use strict";!function(){function t(a){t.$inject=["$rootScope","$timeout","$location","$routeParams","c8yUiUtil","gettextCatalog"];var o={};return{addTab:function(t,e){var n,r=/:[^/]+/g;if(!o[t]){var i="".concat(t.replace(r,"(.+)"),"/([^/]+)$").replace(/\/+/g,"/");o[t]=[],(n=o[t]).regexp=new RegExp(i),n.routeParams=_.map(t.match(r),function(t){return t.replace(/^:/,"")})}null!==e.path&&void 0!==e.path||(e.path=a.appendSegment(t,e.name));_.isUndefined(e.priority)&&(e.priority=0);(n=o[t]).push(e)},sortTabsViews:g,removeForAll:v,$get:t};function l(r,i,t){return g(_.find(o,function(t){var e=t.regexp.test(r),n=!i||_.every(t.routeParams,function(t){return _.get(i,t)});return e&&n}),t)||null}function g(t,e){var n=["priority",function(t){return e.getString(t.label||t.name)}];return _.orderBy(t,n,["desc","asc"])}function v(t){var e=_.flattenDeep(_.map(o)),n=_.find(e,{path:t});return n&&_.forEach(o,function(t){return!_.remove(t,function(t){return t===n}).length}),n}function t(t,n,o,r,i,e){var a,c="c8yTabs.update",u=[],p=t.$new(!0),f=_.memoize(function(t){return(t||"").split("/").map(function(e){var n;try{n=decodeURIComponent(e)}catch(t){n=e}return n}).join("/")}),h=_.partialRight(g,e);return t.$on("$routeChangeSuccess",function(){if(u.forEach(function(t){t.active=s(t.path)}),_.some(u,{active:!0,redirectedTo:!0}))return;u.length=0,l(o.path(),r,e).forEach(d),n.cancel(a),a=n(function(){return p.$emit(c)})}),_.assign(p,{EVENT_UPDATE:c,routeTabs:u,sort:h,removeForAll:v,getTabsByURL:function(t){return l(t,r,e)},get:function(t){return l(t,r,e)},addTab:function(t){d(t),function(){var t=o.path(),e=u.filter(function(t){var e=t.show;return!1!==e}),n=_.maxBy(e,"priority"),r=_.find(e,{path:t}),i=_.find(e,"redirectedTo");if(i&&r!==n){var a=n.path;o.replace(),o.path(a),i.redirectedTo=!1,n.redirectedTo=!0}}()}});function d(t){if(_.some(u,{path:t.path}))!function(t){var e=_.find(u,{path:t.path}),n=_.pick(t,["name","icon","priority","redirectedTo","active"]);_.assign(e,n)}(t);else{var e=_.cloneDeep(t);e.originalPath=e.path,e.path=function(t){return _.reduce(r,function(t,e,n){var r,i=new RegExp(":".concat(n),"g");try{r=encodeURIComponent(e)}catch(t){r=e}return t.replace(i,r)},t)}(e.path),e.active=s(e.path),e.path===p.redirectedViewPath&&(e.redirectedTo=!0,p.redirectedViewPath=null),e.checkingVisibility=i.configureVisibility(e,"show",!1).then(function(n){return function(t){var e=t.show;n.show=e}}(t)).then(function(){return e}),u.push(e),function(){var t=h(u);u.length=0,t.forEach(function(t){return u.push(t)})}(),n.cancel(a),a=n(function(){return p.$emit(c)})}}function s(t){return new RegExp("^".concat(f(t))).test(o.path())}}}t.$inject=["c8yPathUtils"],angular.module("c8y.ui").provider("c8yTabs",t)}();