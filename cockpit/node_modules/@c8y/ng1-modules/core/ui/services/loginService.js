"use strict";!function(){function e(a,s,o,t,e,r){var i={minlength:r("Password must have at least 8 characters and no more than 32."),required:r("Required"),password_missmatch:r("Password confirmation does not match."),maxlength:r("Password must have at least 8 characters and no more than 32."),password_strength:r("Your password is not strong enough. Please include numbers, lower and upper case characters"),remote_error:r("Server error occurred."),email:r("Invalid email address."),password_change:r("Your password is expired. Please set a new password."),password_reset_token_expired:r("Password reset link expired. Please enter your email address to receive a new one."),tfa_pin_invalid:r("The code you entered is invalid. Please try again."),pattern_phonenumber:window.c8yConfig.validation.phoneNumber.message,pattern_newPassword:window.c8yConfig.validation.password.message,international_number_required:r("International phone number required, in the format +49 9 876 543 210."),phone_number_error:r("Could not update phone number."),pinAlreadySent:r("The verification code was already sent. For a new verification code, please click on the link above.")},n={password_changed:r("Password changed. You can now log in using new password."),password_reset_requested:r("Password reset request has been sent. Please check your email."),resend_sms:r("Verification code SMS resent.")},d={LOGIN:"login",PASSWORD_RESET:"password_reset",NEW_PASSWORD:"new_password",PHONE_NUMBER:"phone_number",SMS_TOKEN:"sms_token"},c={};function u(e){return e&&e.recoverPassword?d.NEW_PASSWORD:d.LOGIN}function w(e){var r,n=e.headers("passwordresettoken");return n&&(o.setRecoverPassToken(n),r={form:d.NEW_PASSWORD,msg:["warning",i,"password_change"]}),e.headers("tfatokenexpired")&&(r={form:d.SMS_TOKEN}),e.headers("pinalreadysent")&&(r={form:d.SMS_TOKEN,msg:["warning",i,"pinAlreadySent"]}),e.headers("NoPhoneHeader")&&!o.isSupportUser()&&(r={form:d.PHONE_NUMBER,keepCredentials:!0}),e.action=r,s.reject(e)}return c[d.NEW_PASSWORD]=function(e,r){var n=e.newPassword,s=e.newPasswordConfirm,a=n.$modelValue===s.$modelValue,o=!r||!r.enforcePasswordStrength||"GREEN"===(r.passwordStrength||"").toUpperCase();s.$dirty&&s.$setValidity("password_missmatch",a);n.$dirty&&(n.$error.pattern||n.$error.required?n.$setValidity("password_strength",!0):n.$setValidity("password_strength",o))},{MESSAGES:{ERROR:i,SUCCESS:n},FORMS:d,initializing:o.initializing.then(u,u),login:function(e,r,n,s){return t.login(e,r,n,s).catch(w)},showTenant:function(){return e.getFlag("isLocal")||e.getFlag("showTenant")},resetPassword:o.resetPasword,changePassword:o.changePasswordWithResetToken,savePhoneNumber:t.savePhoneNumber,verifyTFACode:o.verifyTFACode,resendTFASms:function(){return o.verifyTFACode("0").catch(function(e){return 403===e.status?e:s.reject(e)})},validateForm:function(e,r){var n=e.$name.replace("form_",""),s=c[n]||_.noop;return a(_.partial(s,e,r),10)},mustEnforcePasswordStrength:o.mustEnforcePasswordStrength,getPasswordMinGreenLength:o.getPasswordMinGreenLength,getLoginOptions:o.getLoginOptions}}e.$inject=["$timeout","$q","c8yAuth","c8yUser","c8yBase","gettext"],angular.module("c8y.ui").factory("c8yLoginService",e)}();