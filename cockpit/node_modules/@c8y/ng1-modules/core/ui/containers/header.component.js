"use strict";!function(){function e(e,t,n,a,o,i,c,r,s,u,p,l,d,g,f){var h,y,m,v,A=this,S=a.current();function O(e){A.canEdit=function(e){return e.owner.tenant.id===A.user.tenant}(e)&&function(e){return!!e.manifest&&!e.manifest.noAppSwitcher}(e),A.appid=e.id,A.currentApp=e}function U(e){A.user=e,A.supportActivated=e.supportUserEnabled}function b(){n.listByVisibleLinks().then(N).then(function(e){A.applications=e,function(){var t=n.getCurrentContextPath();A.applications.forEach(function(e){e.currentApp=t===e.contextPath})}()})}function N(e){var t=c.appOption("hideCloudApps"),n=function(e){return!!_.get(e,"cloud")};return t||(A.oneCloudApplications=e.filter(n)),e.filter(function(e){return!n(e)})}function $(){A.navOpen=!A.navOpen}function w(){document.documentElement.clientWidth<1200&&$()}function k(){e.$emit("userUpdated")}function D(e){u.success(e)}function E(e){_.set(A,"supportUrl",e)}function V(e){A.backendVersion=e.value}function C(e){A.uiVersion=e}_.assign(A,{$onInit:function(){h=e.$on("c8yUser:update",function(e,t){A.user.userName===t.user.userName&&_.assign(A.user,t.user)}),S.then(U),b(),y=e.$on("c8yApplication:update",b),m=e.$on("c8yApplication:create",b),v=e.$on("c8yApplication:delete",b),p.getSystemOptionValue({category:"support-user",key:"enabled"},!0).then(function(e){A.activateSupportUserAvailable=!e}),p.getSupportUrl().then(E),n.getConfig().then(O),l.getBackendVersion().then(V),l.getUIVersion().then(C),A.hideAppEdit=c.getFlag("hideAppEdit"),A.hideVersions=c.appOption("hide_powered"),A.showRightDrawer=c.appOption("rightDrawer"),A.beta=c.getFlag("beta"),A.menuStatus={},1200<document.documentElement.clientWidth&&!A.navHiddenOnStartup&&_.delay($,300);t.$on("navigateByMenu",w)},$onDestroy:function(){h(),y(),m(),v()},toggleNav:$,getUserName:function(){var e=A.user||{};return function(e,t){var n=(e||"").trim().split(/\s+/).shift().substr(0,1),o=(t||"").trim().split(/\s+/).pop();n=o?"".concat(n,". "):(e||"").split(/\s+/).shift();return n+o}(e.firstName,e.lastName)||e.userName},editUser:function(){r.editUserUI().then(k)},isLoading:function(){return e.loading},activateSupportAccess:function(){var e=c.appOption("company_name"),t=g("Activate support user access"),n=g("Support user access activated."),o=f.getString("When clicking OK you agree that a support user gets access to your tenant to help you in your specific problem."),i=e?f.getString("When clicking OK you agree that support personnel from {{company_name}} gets access to your user interface in order to be able to help you with your specific problem.",{company_name:e}):o,r=s({status:"danger",title:t,body:i});return r.then(a.activateSupportUser).then(function(){A.supportActivated=!0,D(n)})},deactivateSupportAccess:function(){var e=c.appOption("company_name"),t=g("Deactivate support user access"),n=g("Support user access deactivated."),o=f.getString("When clicking OK you agree that you no longer need support."),i=e?f.getString("When clicking OK you agree that you no longer need support from support personnel of {{company_name}}.",{company_name:e}):o,r=s({status:"danger",title:t,body:i});return r.then(a.deactivateSupportUser).then(function(){A.supportActivated=!1,D(n)})},logout:o.logout,getHref:n.getHref,rootNodes:i.rootNodes,showAccessDeniedRequestsList:d.showAccessDeniedRequestsList,navOpen:!1,toggle:function(){A.headerOpen=!A.headerOpen,A.onToggle({open:A.headerOpen})}})}e.$inject=["$rootScope","$scope","c8yApplication","c8yUser","c8yAuth","c8yNavigator","c8yBase","c8yUiUtil","c8yModal","c8yAlert","c8ySettings","c8ySystem","c8yAccessDenied","gettext","gettextCatalog"],angular.module("c8y.ui").component("c8yUiHeader",{templateUrl:":::PLUGIN_PATH:::/ui/containers/header.html",controllerAs:"vm",controller:e,bindings:{navOpen:"=",navHiddenOnStartup:"=",onToggle:"&"}})}();