"use strict";!function(){function e(n,o){var t,r,i=this,e="username",l=e,u="single",s="multiple",a=u,c={};c.object=function(e){return _.omit(e,["_selected","_expanded","_owner","_owns"])},c[e]=function(e){return e.userName};var d=o.mapToUsersInMemory;function f(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i.loading=!0,_.defaults(e,{pageSize:100}),t=n.list(e).then(function(e){return r=e.statistics,e}).then(_.map).finally(function(){i.loading=!1})}function p(){var e=i.ngModelController.$modelValue,n=[];e&&(_.isString(e)&&(n=[e]),_.isArray(e)&&(n=_.map(e,function(e){return e&&e.id||e})),_.isObject(e)&&(n=[e.id])),_.forEach(i.userFlatTree,function(e){e._selected=_.includes(n,e.id)})}function g(e){var n=o.hideUsers(e,i.hiddenUsers),t=_.reject(e,_.partial(_.includes,n)),r=o.buildUserTree(t);r=function(e,n){var t=e,r=i.includeRoot,o=_(i.rootUsers).map(d(n)).filter().value();o.length&&(t=r?o:_(o).map("_owns").flatten().uniq().value());return t}(r,t),i.userFlatTree=o.flattenTree(r),p()}function h(e){return e._selected}function m(e){delete e._selected}function U(e){e._expanded=!1,_.forEach(e._owns,U)}function y(){switch(_.toLower(i.selectionType)){case u:return u;case s:return s;default:return a}}_.assign(i,{$onInit:function(){i.ngModelController.$render=p},$onChanges:function(e){(e.includeRoot||e.rootUsers||i.hiddenUsers)&&t.then(g)},isSelected:h,isVisible:function(e){return i.searchQuery||0===_.get(e,"_depth")||_.get(e,"_owner._expanded")},toggleSelection:function(e){h(e)?m(e):function(e){y()===u&&_(i.userFlatTree).filter(h).forEach(m);e._selected=!0}(e);!function(){var e=c[_.toLower(i.modelType)]||c[l],n=_(i.userFlatTree).filter(h).map(e).value();y()===u&&(n=_.first(n)||null);!n&&i.defaultUser&&(n=e(i.defaultUser));i.ngModelController.$setViewValue(n)}()},toggleExpanded:function(e){e._expanded=!e._expanded,e._expanded||U(e)},onSearchQuery:function(e){i.userFlatTree=[],_.isEmpty(e)?f():f({username:e});t.then(g)},shouldShowWarning:function(){var e=!1;if(r){var n=r,t=n.totalPages;e=1<t}return e},userDepth:function(e){return i.searchQuery?20:20+30*e._depth},loading:!1}),f()}e.$inject=["c8yUser","c8yUserUtil"],angular.module("c8y.ui").component("c8yUiUserPicker",{templateUrl:":::PLUGIN_PATH:::/ui/user/userPicker.html",require:{ngModelController:"ngModel"},bindings:{modelType:"@",selectionType:"@",includeRoot:"<",rootUsers:"<",hiddenUsers:"<",defaultUser:"<"},controller:e,controllerAs:"vm"})}();