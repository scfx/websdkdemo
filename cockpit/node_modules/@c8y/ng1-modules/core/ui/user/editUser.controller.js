"use strict";!function(){function e(r,e,t,n,i,s,o,a,c,u,l,d,g,f,m,h,v){var y,p,w;function U(e){p=e,r.user=_.cloneDeep(e),r.password.showPassword=!e.id,y=e.email}function S(e){return e?x(r.user):i.resolve()}function x(e){var t=!1;if(_.isEqual(p,e))P();else try{(function(e){if(!e.language)return i.when();var t=e.language.code;return _.unset(e,"language"),d.set("language",t).then(function(){return l.switchToLanguage(t)}).catch(b)})(e).then(function(){return h.isActivatedFor("units-conversion")?(_.get(e,"measurementUnit.value")!==w&&(t=!0),function(e){var t=_.get(e,"measurementUnit.value");return _.unset(e,"measurementUnit"),d.set("unit",t)}(e)):i.when()}).then(function(){return o.saveCurrent(e)}).then(P).then(function(){t&&m({title:u("Reload application"),body:u("You are about to reload application in order to correctly apply measurement units setting changes. Do you want to proceed?"),labels:{ok:u("Reload")}}).then(function(){n.location.reload()})})}catch(e){a.danger(e.message)}}function P(){a.success(u("User saved.")),e.close(),t.reload()}function b(){l.switchToDefaultLanguage()}r.userSettingsBlocks=g.list(),r.checkPassword=function(e){r.password.showPassword||function(e){return e.email!==y}(e)?c.askForPassword().then(S):x(e)},r.dismiss=function(){b(),e.dismiss()},r.forms={},r.password={},r.updateRoutesVisibilitySettings=function(e){var t=r.user,n={};n[e.externalServiceName]={visibility:e.visibility},t.customProperties=_.merge({},t.customProperties,n)},r.disconnectRoutesExportingService=function(e){return f.disconnectRoutesExportingService(e).then(function(){_.unset(r.user.customProperties,e),a.warning(v.getString("Disconnected from {{externalServiceName}}. Log into your account at {{externalServiceName}} and finalize deregistration.",{externalServiceName:_.capitalize(e)}))})},o.detailCurrent().then(s.getResData).then(U).then(function(){d.get("unit",r.user).then(function(e){w=e})})}e.$inject=["$scope","$uibModalInstance","$route","$window","$q","c8yBase","c8yUser","c8yAlert","c8yUserUtil","gettext","c8yLocales","c8yUserPreferences","c8yUserSettingsBlocks","c8yEditUser","c8yModal","c8yBeta","gettextCatalog"],angular.module("c8y.ui").controller("EditUserCtrl",e)}();