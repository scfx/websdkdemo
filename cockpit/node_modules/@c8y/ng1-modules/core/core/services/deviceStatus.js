"use strict";angular.module("c8y.core").factory("c8yDeviceStatus",["$rootScope","$filter","c8yBase","gettext","gettextCatalog",function(c,i,n,N,u){var r={sendData:{AVAILABLE:{icon:"long-arrow-right",class:"statusOk"},UNAVAILABLE:{icon:"long-arrow-right",class:"statusNok"},UNKNOWN:{icon:"long-arrow-right",class:"statusUnknown"},NOT_MONITORED:{icon:"long-arrow-right",class:"statusUnknown"}},push:{CONNECTED:{icon:"long-arrow-left",class:"statusOk"},DISCONNECTED:{icon:"long-arrow-left",class:"statusUnknown"},UNKNOWN:{icon:"long-arrow-left",class:"statusUnknown"}},device:{MAINTENANCE:{icon:"wrench",class:"statusAlert"}}},l={CONNECTED:N("Push connection: active"),DISCONNECTED:N("Push connection: inactive"),UNKNOWN:N("Push connection: inactive")},A={AVAILABLE:N("Send connection: online"),NOT_MONITORED:N("Send connection: not monitored"),UNAVAILABLE:N("Send connection: offline"),UNKNOWN:N("Send connection status unknown"),MAINTENANCE:N("Device is under maintenance")};function E(n){return n&&n.c8y_Availability&&n.c8y_Availability.status}return{status:function(n){var t,e=_.get(n,"c8y_RequiredAvailability"),s=E(n),o=s||(e?"UNKNOWN":"NOT_MONITORED"),a=_.get(n,"c8y_Connection.status")||"UNKNOWN";return t="MAINTENANCE"===s||"MAINTENANCE"===a?{sendStatus:!1,pushStatus:!1,maintenanceStatus:{icon:r.device.MAINTENANCE.icon,class:r.device.MAINTENANCE.class,tooltip:N("Device is under maintenance")}}:{sendStatus:{icon:r.sendData[o].icon,class:r.sendData[o].class,status:o,label:A[o],tooltip:function(n){var t=n&&n.c8y_Availability,e=t&&t.lastMessage;return e?u.getString("Device last request:\n{{date}}",{date:i("absoluteDate")(e)}):N("Connection not monitored")}(n)},pushStatus:{icon:r.push[a].icon,class:r.push[a].class,status:a,label:l[a],tooltip:function(n,t){return N(t?"Connection to device established":"Connection to device not established (not supported by device or no connectivity)")}(0,"CONNECTED"===a)},maintenanceStatus:!1},c.$emit("c8yDeviceStatus:update",n),t},isDeviceAvailable:function(n){return"AVAILABLE"===E(n)},isDeviceMaintenance:function(n){return"MAINTENANCE"===E(n)},canReceiveCommands:function(n){return"CONNECTED"===_.get(n,"c8y_Connection.status")}}}]);