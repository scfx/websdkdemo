"use strict";function _slicedToArray(n,r){return _arrayWithHoles(n)||_iterableToArrayLimit(n,r)||_unsupportedIterableToArray(n,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(n,r){if(n){if("string"==typeof n)return _arrayLikeToArray(n,r);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(n,r):void 0}}function _arrayLikeToArray(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=new Array(r);t<r;t++)e[t]=n[t];return e}function _iterableToArrayLimit(n,r){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var e,u,o=[],a=!0,c=!1;try{for(t=t.call(n);!(a=(e=t.next()).done)&&(o.push(e.value),!r||o.length!==r);a=!0);}catch(n){c=!0,u=n}finally{try{a||null==t.return||t.return()}finally{if(c)throw u}}return o}}function _arrayWithHoles(n){if(Array.isArray(n))return n}!function(){function n(o,a,c,r){var u="user/";function i(){return r.current().then(function(n){var r=n.tenant;return c.url("".concat(u+r,"/groups"))})}function e(n){var t=n.id||n;return r.current().then(function(n){var r=n.tenant;return c.url("".concat(u+r,"/groups/").concat(t))})}function f(n,r){return e(n).then(function(n){return"".concat(n,"/users").concat(r?"/".concat(encodeURIComponent(r.id||r)):"")})}function l(n){return e(n).then(function(n){return"".concat(n,"/roles")})}function s(n){return e(n).then(function(n){return o.get(n)})}function t(r){var t={headers:c.contentHeaders("group")};return e(r).then(function(n){return o.put(n,r,t).then(function(){return r})})}function h(r){var t={headers:c.contentHeaders("group")};return i().then(function(n){return o.post(n,r,t).then(function(n){return s(_slicedToArray(n.headers("location").match(/\d+$/),1)[0]).then(function(n){return n.data})})})}function d(n){var r=c.pageSizeFilter(n),t={params:r},e=c.cleanListCallback("roles",d,r);return a.when(c.url("".concat(u,"roles"))).then(function(n){return o.get(n,t).then(e)})}function p(n,r){return function(n,r){var t=r.id||r;return l(n).then(function(n){return"".concat(n,"/").concat(t)})}(n,r).then(function(n){return o.delete(n)})}return{list:function n(r){var t=c.pageSizeFilter(r),e={params:t},u=c.cleanListCallback("groups",n,t);return i().then(function(n){return o.get(n,e).then(u)})},detail:s,remove:function(n){return e(n).then(function(n){return o.delete(n)})},create:h,update:t,save:function(n){return n.id?t(n):h(n)},listRoles:d,updateGroups:function(r,t){var e=_.get(r,"groups.references",[]).map(function(n){return n.group.id}),u=[];return t.forEach(function(n){-1===e.indexOf(n)&&u.push(function(n,r){var t={user:_.pick(r,["id","self"])};return f(n).then(function(n){return o.post(n,t)})}(n,r))}),e.forEach(function(n){-1===t.indexOf(n)&&u.push(function(n,r){return f(n,r).then(function(n){return o.delete(n)})}(n,r))}),a.all(u)},updateRoles:function(r,t){var e=r.roles.references.map(function(n){return n.role.id}),u=[];return t.forEach(function(n){-1===e.indexOf(n)&&u.push(function(e){return d().then(function(n){var t;return n.forEach(function(n){var r;return n.id===e&&(t=n,r=!1),r}),t})}(n).then(function(n){return function(n,r){var t={headers:c.contentHeaders("roleReference")};return l(n).then(function(n){return o.post(n,{role:r},t)})}(r,n)}))}),e.forEach(function(n){-1===t.indexOf(n)&&u.push(p(r,n))}),a.all(u)}}}n.$inject=["$http","$q","c8yBase","c8yUser"],angular.module("c8y.core").factory("c8yUserGroup",n)}();