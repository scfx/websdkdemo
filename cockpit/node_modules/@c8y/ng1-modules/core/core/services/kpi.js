"use strict";function _objectSpread(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?Object(arguments[e]):{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&t.push.apply(t,Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.forEach(function(e){_defineProperty(n,e,r[e])})}return n}function _defineProperty(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}!function(){function e(r,e,c,t,i,n,u){var a="c8y_Kpi",o=["target","min","max","yellowRangeMin","yellowRangeMax","redRangeMin","redRangeMax"];function s(){return t.list({fragmentType:a,pageSize:u.MAX_PAGESIZE})}return{list:s,listByIds:function(n){return s().then(function(e){return n&&n.length?_.filter(e,function(e){return-1<n.indexOf(e.id)}):e})},detail:function(e){return t.detail(e).then(function(e){var n=e.data.c8y_Kpi;return _.forEach(o,function(e){_.isUndefined(n[e])||(n[e]=parseFloat(n[e]),Number.isNaN(Number(n[e]))&&delete n[e])}),e})},remove:t.remove,save:function(e){var n=_.cloneDeep(e);return delete n._measurement,n.c8y_Global={},t.save(n)},listKpiForDevice:function(e){var n=e.id||e;return t.getSupportedSeries(n).then(function(e){return r.all({kpis:function(e){var a=u.url("inventory/managedObjects/".concat(e,"/kpis"));return function e(n){var r=_.assign({pageSize:u.MAX_PAGESIZE},n),t={params:r},i=u.cleanListCallback("managedObjects",e,r);return c.get(a,t).then(i)}()}(n),series:e})}).then(function(e){var r=e.kpis,n=e.series;return{matchKpi:_.filter(r,function(e){return _.find(n,{fragment:e.c8y_Kpi.fragment,series:e.c8y_Kpi.series})}),nonKpiSeries:_.filter(n,function(n){return!_.find(r,function(e){return e.c8y_Kpi.fragment===n.fragment&&e.c8y_Kpi.series===n.series})})}})},getMeasurement:function(e,n){var r=e.c8y_Kpi||e,t=_objectSpread({},u.timeOrderFilter(),{source:n,valueFragmentType:r.fragment,valueFragmentSeries:r.series,pageSize:1,revert:!0});return i.list(t).then(_.head).then(function(e){return function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _objectSpread({kpi:e,time:n.time,source:n.source},_.get(n,e.fragment,{}))}(r,e)})}}}e.$inject=["$q","$log","$http","c8yInventory","c8yMeasurements","c8yUser","c8yBase"],angular.module("c8y.core").factory("c8yKpi",e)}();