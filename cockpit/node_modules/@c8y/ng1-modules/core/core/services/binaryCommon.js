"use strict";!function(){function e(n,r,i){var s={upload:function(e,n){var t={method:"POST",data:{filesize:e.size},file:e},o=_.assign({},t,n);return r.upload(o)},download:o,downloadAndSaveAs:function(e,n,t){return o(e,n,t).then(function(e){var n=e.getResponseHeader("Content-Type"),t=e.getResponseHeader("Content-Disposition"),o=new Blob([e.response],{type:n});window.saveAs(o,a(t))})},getFilenameFromContentDisposition:a,arrayBufferToBase64:function(e){for(var n="",t=new Uint8Array(e),o=t.byteLength,r=0;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)},size:u};function o(o,e,r){var a=n.defer(),t=new XMLHttpRequest;return t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){200===t.status?a.resolve(t):a.reject(t)},t.onprogress=function(e){if(!_.isUndefined(e.loaded)){var n=_.isNumber(Number(r))&&r||u(o);if(!_.isUndefined(n)){var t=e.loaded/n;a.notify(t)}}},_.forEach(i.headers(),function(e,n){e&&t.setRequestHeader(n,e)}),s.__test?s.__downloadDeferred=a:t.send(),a.promise}function u(e){var n=_.get(e,"length")||_.get(e,"size"),t=_.get(e,"_attachments"),o=_.get(t,_.first(_.keys(t)));return _.isUndefined(n)?_.get(o,"length"):n}function a(e){return/filename="(.*)"/.exec(e)[1]}return s}e.$inject=["$q","$upload","c8yAuth"],angular.module("c8y.core").constant("utoa",function(e){return window.btoa(unescape(encodeURIComponent(e)))}).constant("atou",function(e){return decodeURIComponent(escape(window.atob(e)))}).constant("atob",function(e){return window.atob(e)}).factory("c8yBinaryCommon",e)}();