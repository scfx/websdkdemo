"use strict";!function(){function t(l,d,f,t){var m="cep/modules",p="cepModule",n={};return{list:function t(e){var n=f.url(m);var r=f.pageSizeFilter(e);var a={params:r};var u=f.cleanListCallback("modules",t,r);return l.get(n,a).then(o).then(u)},listWithSmartRules:u,isSmartRuleModule:e,detail:c,save:r,changeName:function(t,e){return c(t).then(function(t){return t.name=e,t}).then(r)},remove:function(t){var e=t.id||t,n=f.url("".concat(m,"/").concat(e));return l.delete(n)},examples:function(){return d.when(t)},detailByName:a,createOrDeploy:function(t){var e=t.name;n[e]||(n[e]=a(e).then(function(t){return"DEPLOYED"!==t.status?(t.status="DEPLOYED",r(t)):t},function(){return r(t)}));return n[e]},deploy:s,redeploy:function(t){return i(t).then(s)},undeploy:i};function o(t){return t.data.modules=_.filter(t.data.modules,_.negate(e)),t}function e(t){return t&&/^smartRule\d+$/.test(t.name)}function u(t){var e=f.url(m),n=f.pageSizeFilter(t),r={params:n},a=f.cleanListCallback("modules",u,n);return l.get(e,r).then(a)}function c(t,e,n){var r=t.id||t,a=f.url("".concat(m,"/").concat(r)),u=d.defer(),o=null,c=null,s=_.assign({headers:{"Content-Type":"text/plain",Accept:"text/plain"}},n),i=_.assign({headers:{Accept:f.mimeType(p)}},e);return l.get(a,i).then(function(t){c=t.data,l.get("".concat(a,"?text"),s).then(function(t){o=t.data,function(){if(o&&c){var t=/module (\w*);\s*\n*/;c.name=o.match(t)[1],c.body=o.replace(t,""),u.resolve(c)}}()})}),u.promise}function r(t,n){var r=d.defer(),a=_.cloneDeep(t);return(a.body?(a.name&&(a.body="module ".concat(a.name,";\n").concat(a.body)),function(t,e){var n=t.id,r=f.url(m+(n?"/".concat(n):"")),a=n?"put":"post",u=_.assign(f.contentHeaders(p,!0),{"Content-Type":"text/plain"}),o=_.assign({headers:u},e);return l[a](r,t.body,o)}(a,n).then(null,function(t){return r.reject(t),d.reject()})):c(a,n,n)).then(function(t){var e=t.body?t:t.data;a.status&&e.status!==a.status?(e.status=a.status,function(t,e){var n=f.url("".concat(m,"/").concat(t.id)),r=_.assign({headers:f.contentHeaders(p,!0)},e),a={status:t.status};if(!t.id)throw new Error("Module id no defined");return l.put(n,a,r)}(e,n).then(function(t){r.resolve(t.data)},function(t){r.reject(t.data)})):r.resolve(e)}),r.promise}function a(e){return u().then(function(t){return _.find(t,{name:e})||d.reject("not found")})}function s(t){return t.status="DEPLOYED",r(t)}function i(t){return t.status="NOT_DEPLOYED",r(t)}}t.$inject=["$http","$q","c8yBase","c8yCepModuleExamples"],angular.module("c8y.core").factory("c8yCepModule",t)}();