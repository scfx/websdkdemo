"use strict";!function(){function e(n,t,i,r,s,l,a,e,o,u){var c=this,g=[];function f(e){return n.refreshLoading=!0,r.list(_.assign({onlyDevices:!0},e)).then(d).finally(function(){n.refreshLoading=!1})}function d(e){return n.users&&!n.refreshLoading||(n.users=[],c.users=n.users),e.forEach(function(e){n.users.push(e)}),n.paging=e.paging,n.users.length}function p(e){return r.detail(e).then(a.getResData).then(_.partial(_.assign,e))}_.assign(c,{filtering:{applied:!1,filters:{}},applyFilters:function(){f(c.filtering.filters).then(function(){c.filtering.applied=!0})},clearFilters:function(){c.filtering.filters={},f(c.filtering.filters).then(function(){c.filtering.applied=!1})},isAnyFilterSelected:function(){return 0<_.get(c.filtering.filters,"username","").length}}),_.assign(n,{enabledIcon:function(e){return e.enabled?"check-circle":"minus-circle"},enabledClass:function(e){return e.enabled?"text-success":"text-danger"},enabledTooltip:function(e){return e.enabled?"Enabled":"Disabled"},activate:function(e){e.enabled=!0,r.save(e).then(function(){i.success(o("User enabled."))})},deactivate:function(e){e.enabled=!1,r.save(e).then(function(){i.success(o("User disabled."))})},groups:r.groups,navigateToDetail:function(e){t.path("/deviceusers/".concat(e.id))},onClickDelete:function(e){l({title:o("Delete user"),body:u.getString('You are about to delete user "{{userName}}". Do you want to proceed?',e),status:"danger",labels:{ok:o("Delete")}}).then(angular.bind(r,r.remove,e)).then(angular.bind(a,a.removeFromList,n.users,e)).then(function(){i.success(o("User deleted."))})},refresh:function(){n.refreshLoading=!0,n.paging.refresh().then(d).finally(function(){n.refreshLoading=!1})},loadNext:function(){n.paging.loading=!0,n.paging.next().then(d).finally(function(){n.paging.loading=!1})},mapRolesForUser:_.memoize(function(e){return _.map(e,"group")}),globalRolesAvailable:function(e){return _.get(e,"_owner._globalRoles",g)},onChangeRoles:function(e,n){return s.global.updateGroups(e,_.map(n,"id")).then(_.partial(p,e))},getSubtitle:function(){return u.getPlural(n.users?n.users.length:0,"1 device credentials","{{$count}} device credentials",{})},getUsers:f}),s.global.list({pageSize:1e3}).then(function(e){g=e,n.globalRoles=g}),f()}e.$inject=["$scope","$location","c8yAlert","c8yUser","c8yRoles","c8yModal","c8yBase","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.deviceUsers").controller("deviceUserListCtrl",e)}();