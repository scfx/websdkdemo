"use strict";!function(){function e(e,t,i,n,o){var r=this;_.assign(r,{$onInit:function(){e.all([i.getDeviceTypes().then(function(e){r.deviceTypes=_.uniqBy(e,"id"),0===e.length&&l(c)}),i.getConnectivityPlans().then(u).then(function(e){r.connectivityPlans=_.uniqBy(e,"id"),0===r.connectivityPlans.length&&l(a)}),i.getDeviceProfiles().then(function(e){r.deviceProfiles=_.uniqBy(e,"id"),0===e.length&&l(s)})]).catch(function(e){r.errMsg.push(e.data)}).finally(function(){r.providerSettingsLoaded=!0})},save:function(){n.disableInteractionWhenRequestInProgress(r,!0),n.setFormData(r.wizardCtrl.data,{device:r.device}),i.createNewDeviceRequest(function(e){var t=_.pick(e.deviceType,["name","id"]),i=_.cloneDeep(e);return _.unset(i,"deviceType"),_.set(i,"deviceType",t),i}(r.device)).then(function(e){n.setSuccessData(r.wizardCtrl.data,e),r.wizardCtrl.goTo("finish")}).catch(function(e){n.setErrorData(r.wizardCtrl.data,e),r.wizardCtrl.goTo("finish")}).finally(function(){n.disableInteractionWhenRequestInProgress(r,!1),t(d,500)})},doResize:d,errMsg:[]});var c=o("No device protocols configured. Create a LoRa device protocol on the Device protocols page."),a=o("No LoRa provider settings found. Connectivity settings have to be configured."),s=o("No device profiles.");function d(){n.doResize()}function u(e){return _.filter(e,function(e){return _.parseInt(e.grantedConnections)>_.parseInt(e.usedConnections)})}function l(e){r.errMsg.push({message:e})}}e.$inject=["$q","$timeout","deviceRegistrationLoraProviderService","deviceRegistrationWizardUtils","gettext"],angular.module("c8y.deviceRegistrationLora").component("deviceRegistrationLora",{controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/deviceRegistrationLora.html",require:{wizardCtrl:"^c8yWizardStep"},bindings:{backStep:"@?"},controller:e})}();