"use strict";!function(){function e(n,o){var a,l,d,u,c,f;function r(e,t,n){var r=e.deviceId;return t.detailCached(r).then(n.getResData).then(function(e){return t.supportsOperation(e,"c8y_LogfileRequest")})}function s(e){var t;if(e&&e.c8y_LogfileRequest&&e.c8y_LogfileRequest.file){if(t=e.c8y_LogfileRequest.file,c.isEventBinary(t)){var n=c.getEventIdFromUrl(t);return n?c.downloadAsText(n):a.get(t)}var r=u.getIdFromUrl(t);return r?u.downloadAsText(r):a.get(t)}return l.when({data:o("Loading logfilesâ€¦")})}function g(e){if(e.c8y_LogfileRequest.file){var t=e.c8y_LogfileRequest.file;if(c.isEventBinary(t)){var n=c.getEventIdFromUrl(t);if(n)return c.detail(n).then(function(e){return f.downloadAndSaveAs(e.data)}).catch(function(){d.danger(o("Could not download the log file."))})}else{var r=u.getIdFromUrl(t);if(r)return u.downloadAndSaveAs(r).catch(function(){d.danger(o("Could not download the log file."))})}}return!1}return{$get:["$http","$q","c8yAlert","c8yBinary","c8yEvents","eventsBinaryService",function(e,t,n,r,o,i){return a=e,l=t,d=n,u=r,c=o,f=i,{getLogfile:s,download:g}}],when:function(e,t){n.when(e,_.assign(t,{showIf:["$routeParams","c8yDevices","c8yBase",r]}))},showIf:r}}e.$inject=["c8yViewsProvider","gettext"],angular.module("c8y.logViewer").provider("logViewer",e)}();