"use strict";!function(){function e(i,t){var n,o,c,s,r,a,l=this;function d(){if(l.endpoint.config.credentialsType=l.selectedCredentialsType.value,e(!1),p(!1),f(!1),u(!1),l.selectedCredentialsType.value!==l.initialCredentialType)switch(l.endpoint.config.credentialsType){case"KEY_PAIR":_.set(l.endpoint,"config.privateKey",""),_.set(l.endpoint,"config.publicKey","");break;case"CERTIFICATE":_.set(l.endpoint,"config.privateKey",""),_.set(l.endpoint,"config.certificate","")}}function e(e){g("config.password",l.changingPassword=e,n)}function p(e){g("config.username",l.changingCredentials=e,o),g("config.password",e,n)}function f(e){g("config.privateKey",l.changingKeyPair=e,s),g("config.publicKey",e,c)}function u(e){g("config.privateKey",l.changingCertificate=e,s),g("config.certificate",e,a)}function g(e,t,n){t?_.set(l.endpoint,e,""):n&&!t&&_.set(l.endpoint,e,n)}_.assign(l,{$onInit:function(){i.getProtocols().then(function(e){l.protocols=e}).then(function(){!function(t,e){n=_.get(t,"config.credentials.password"),o=_.get(t,"config.credentials.username"),c=_.get(t,"config.credentials.publicKey"),s=_.get(t,"config.credentials.privateKey"),r=_.get(t,"config.credentials.hostKey"),a=_.get(t,"config.credentials.certificate"),l.passwordAlreadyExists=!_.isEmpty(n),l.usernameAlreadyExists=!_.isEmpty(o),l.publicKeyAlreadyExists=!_.isEmpty(c),l.privateKeyAlreadyExists=!_.isEmpty(s),l.hostKeyAlreadyExists=!_.isEmpty(r),l.certificateAlreadyExists=!_.isEmpty(a),l.generating=!1,l.initialCredentialType=_.get(t,"config.credentials.type"),void 0===t?(l.selectedProtocol=_.find(l.protocols,function(e){return"VNC"===e.value}),l.selectedCredentialsType=l.selectedProtocol.supportedCredentialsTypes[0]):(l.selectedProtocol=_.find(l.protocols,function(e){return e.value===t.config.protocol}),l.selectedCredentialsType=t.config.credentials.type?_.find(l.credentialsTypes.values(),{value:t.config.credentials.type}):l.selectedProtocol.supportedCredentialsTypes[0]);l.endpoint=_.defaults(t,{device:e,config:{hostname:l.selectedProtocol.defaults.host,port:l.selectedProtocol.defaults.port,protocol:l.selectedProtocol.value,credentialsType:l.selectedCredentialsType.value}}),d()}(l.resolve.endpoint,l.resolve.rootDevice),function(e){t.getSuggestedIPAddresses(e).then(function(e){l.suggestedIPAddresses=e})}(l.resolve.rootDevice)})},save:function(){var e=l.endpoint,t=e.device,n=e.config;i.save(t,n).then(function(){return l.modalInstance.close(l.endpoint)})},cancel:function(){l.modalInstance.dismiss()},changePassword:function(){return e(!0)},cancelChangePassword:function(){return e(!1)},changeCredentials:function(){return p(!0)},cancelChangeCredentials:function(){return p(!1)},changeKeyPair:function(){return f(!0)},cancelChangeKeyPair:function(){return f(!1)},changeCertificate:function(){return u(!0)},cancelChangeCertificate:function(){return u(!1)},onProtocolChange:function(){l.selectedCredentialsType=l.selectedProtocol.supportedCredentialsTypes[0],_.assign(l.endpoint.config,{protocol:_.get(l,"selectedProtocol.value"),port:_.get(l,"selectedProtocol.defaults.port"),hostname:_.get(l,"selectedProtocol.defaults.host"),credentialsType:_.get(l,"selectedCredentialsType.value","NONE")})},onCredentialsTypeChange:d,credentialsTypes:i.CREDENTIALS_TYPES,credentialsAvailable:function(){return!!o&&!!n},keyPairAvailable:function(){return s&&c&&"KEY_PAIR"===l.initialCredentialType},certificateAvailable:function(){return a&&s&&"CERTIFICATE"===l.initialCredentialType},downloadPublicKey:function(){i.exportSshKey(_.get(l,"endpoint.config.publicKey"))},generateKeys:function(){var e=l.endpoint.config.hostname||l.selectedProtocol.defaults.host;l.generating=!0,i.generateKeys(e).then(function(e){var t=e.privateKey,n=e.publicKey;t&&n&&_.assign(l.endpoint.config,{privateKey:t,publicKey:n})}).finally(function(){l.generating=!1})},showIdentifiedType:function(e){l.identifiedType=e}})}e.$inject=["c8yRemoteAccess","c8yRemoteAccessUI"],angular.module("c8y.remoteAccess").component("c8yRemoteAccessEndpointModal",{bindings:{resolve:"<",modalInstance:"<"},templateUrl:":::PLUGIN_PATH:::/remoteAccessEndpointModal/remoteAccessEndpointModal.html",controller:e,controllerAs:"vm"})}();