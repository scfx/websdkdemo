"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(n,a,e,i,r,o,c,s,l,u,t){var d="service/remoteaccess",p="127.0.0.1",f=":::PLUGIN_PATH:::/clients/terminal/index.html",v="top=30,left=30,height=933,width=1350,location=no,menubar=no,toolbar=no,status=no,resizable=no",S=i.url("".concat(d,"/keypair/generate")),y={http:"ws:",https:"wss:"}[e.protocol()]||"ws:",m="wss:"===y,h="XSRF-TOKEN",g={category:"remoteaccess",key:"pass-through.enabled"},P=i.createEnum([{name:"NONE",value:"NONE",label:l("No password")},{name:"USER_PASS",value:"USER_PASS",label:l("Username and password")},{name:"PASS_ONLY",value:"PASS_ONLY",label:l("Password only")},{name:"KEY_PAIR",value:"KEY_PAIR",label:l("Public/private keys")},{name:"CERTIFICATE",value:"CERTIFICATE",label:l("Certificate")}]),b=[{name:"VNC",value:"VNC",label:l("VNC"),supportedCredentialsTypes:[P.NONE,P.PASS_ONLY],defaults:{host:p,port:5900},clientWindowPath:":::PLUGIN_PATH:::/clients/vnc/vncClient.html",clientWindowParams:"top=0,left=0,location=no,menubar=no,toolbar=no,status=no,resizable=yes",extraConnectionParams:{encrypt:m,true_color:!0,local_cursor:!1,viewport:!0,shared:!0,view_only:!1,disconnectTimeout:10,repeaterID:"",port:443,password:""}},{name:"TELNET",value:"TELNET",label:l("Telnet"),supportedCredentialsTypes:[P.NONE],defaults:{host:p,port:23},clientWindowPath:f,clientWindowParams:v},{name:"SSH",value:"SSH",label:l("SSH"),supportedCredentialsTypes:[P.USER_PASS,P.KEY_PAIR,P.CERTIFICATE],defaults:{host:p,port:22},clientWindowPath:f,clientWindowParams:v},{name:"PASSTHROUGH",value:"PASSTHROUGH",label:l("PASSTHROUGH"),supportedCredentialsTypes:[],defaults:{host:p,port:22},isConnectDissalowed:!0,tooltipConnectDissalowed:l("PASSTHROUGH protocol configuration should be used with native client only."),showIf:function(){return t.getSystemOptionValue(g)}}];return{DEFAULT_HOST:p,getProtocols:function(){return n.all(_.map(b,function(e){return s.configureVisibility(e,"visible")})).then(function(e){return _.filter(e,"visible")})},CREDENTIALS_TYPES:P,save:function(t,n){try{return function(e,t){var n=_.includes([P.USER_PASS.value,P.PASS_ONLY.value],t.credentialsType),r=_.includes([P.KEY_PAIR.value],t.credentialsType);_.defaults(t,{password:n?_.get(t,"credentials.password"):void 0,privateKey:r?_.get(t,"credentials.privateKey"):void 0}),_.unset(t,"credentials"),_.unset(t,"attrs");var o=T(e,t);return a.put(o,t).then(i.getResData)}(t,n)}catch(e){return function(e,t){var n=w(e);return a.post(n,t).then(i.getResData)}(t,n)}},list:function(e){var t=w(e);return a.get(t).then(i.getResData)},detail:function(e,t){var n=T(e,t);return a.get(n).then(i.getResData)},remove:function(e,t){var n=T(e,t);return a.delete(n)},getConnectionParams:function(e,t){return n.all({title:u.getString("Connected to: {{name}}",t),protocol:_.find(b,{value:t.protocol}),host:c.current().then(function(e){return e.domainName}),path:function(t,n){return o.current().then(function(e){return function(e){var t="service/remoteaccess/client/".concat(e.deviceId,"/configurations/").concat(e.configurationId,"?token=").concat(e.token),n=s.getCookieValue(h);if(n){var r=encodeURIComponent(n);t="".concat(t,"&").concat(h,"=").concat(r)}return t}({deviceId:i.getId(t),configurationId:n.id,token:r.encodeToken(e.userName,r.getPassword(),e.tenant)})})}(e,t),wsProtocol:y}).then(function(e){return _objectSpread({},e,e.protocol.extraConnectionParams)})},isMicroServiceAvailable:function(e){return a.head(w(e),{silentError:!0}).then(_.constant(!0),_.constant(!1))},parseSshKeyFile:function(r){return n(function(n,e){var t=new FileReader;t.onload=function(e){var t=e.target;return n(t.result)},t.onerror=function(){return e({feedback:{type:"error",summary:l("Could not read file.")}})},t.readAsText(r)})},generateKeys:function(e){return a.post(S,{hostname:e}).then(i.getResData)},exportSshKey:function(e){var t=new Blob([e],{type:"text/plain"});window.saveAs(t,"key.pub")}};function w(e){var t=[d,"devices",i.getId(e),"configurations"].join("/");return i.url(t)}function T(e,t){return[w(e),i.getId(t)].join("/")}}e.$inject=["$q","$http","$location","c8yBase","c8yAuth","c8yUser","c8yTenant","c8yUiUtil","gettext","gettextCatalog","c8ySettings"],angular.module("c8y.remoteAccess").factory("c8yRemoteAccess",e)}();