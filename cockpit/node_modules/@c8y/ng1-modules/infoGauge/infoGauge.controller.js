"use strict";!function(){function e(n,s,t,e){var i,f=this,o=s.find(".gauge-svg"),r=s.find(".gauge-legend"),g=s.parents(".card-inner-scroll"),u=[],c=[],l=e.COLORS,a=_.debounce(d,100);function d(){var e=o.position().left===r.position().left,a=g.innerHeight(),n=a;e&&(n=a-r.height()),o.height(n)}function v(e){i=e,h()}function p(e){return{series:e.series,fragment:e.fragment,device:e.__target.id}}function m(){_.invoke(u,"stop"),u=[]}function h(){var e=f.gaugeDatapoint;if(i){var a=i[e.fragment],n=a&&a[e.series];f.gaugeValue=n&&n.value,f.gaugeDateTime=i.time,function(){var e=f.gaugeValue,a=Number(f.gaugeDatapoint.min||0),n=Number(f.gaugeDatapoint.max||0),t=Number(f.gaugeDatapoint.yellowRangeMin),i=Number(f.gaugeDatapoint.yellowRangeMax),o=Number(f.gaugeDatapoint.redRangeMin),r=Number(f.gaugeDatapoint.redRangeMax),g=377.25-d3.scale.linear().domain([a,n]).range([0,100])(e)/100*377.25+125.75,u=l.GREEN;_.isFinite(t)&&_.isFinite(i)&&t<=e&&e<=i&&(u=l.YELLOW);_.isFinite(o)&&_.isFinite(r)&&o<=e&&e<=r&&(u=l.RED);s.find(".gauge-svg svg path.track-value").css({"stroke-dashoffset":-g,stroke:u})}()}}_.assign(f,{getLabelValue:function(e,a){var n=c[a];if(n){var t=n[e.fragment],i=t&&t[e.series];return i&&i.value}return n},getLabelDateTime:function(e,a){var n=c[a];return _.get(n,"time",n)}}),n.$watch("child.config",function(){var e=n.child.config,a="__active";f.gaugeDatapoint=_.find(e.datapointsGauge,a),f.labelDatapoints=_.filter(e.datapointsLabels,a),function(){m();var e=f.gaugeDatapoint,a=f.labelDatapoints;if(e){var n=t.latest(p(e),!0);n.then(v),u.push(n)}c=[],_.forEach(a,function(e,a){var n=t.latest(p(e),!0);n.then(function(e){c[a]=e}),u.push(n)})}()},!0),n.$watch(function(){return i},h,!0),n.$on("$destroy",function(){m(),$(window).off("resize",a)}),n.$on("dashboardResize",a),d(),g.length&&$(window).on("resize",a)}e.$inject=["$scope","$element","c8yMeasurements","infoGaugeService"],angular.module("c8y.infoGauge").controller("infoGaugeWidgetController",e)}();