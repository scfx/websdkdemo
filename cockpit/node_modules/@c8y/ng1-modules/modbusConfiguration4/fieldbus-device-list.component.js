"use strict";!function(){function e(r,i,n,o,a,c,d,s,u,l,t){var e,m=this,v=u.snmpVersions,f=u.snmpAuthPrivProtocols,p=u.snmpAuthProtocols,g=u.snmpSecurityLevels;function D(){m.expandedId="",m.reloadDevices(),n.success(t("Child device changes saved."))}function b(e){e.adding=!1,n.danger(t("Failed to change child device."))}function y(){E(),m.reloadDevices(),n.success(t("New child device added."))}function N(){m.newDevice.adding=!1,n.danger(t("Failed to add new child device."))}function E(){m.expandedId="",_.unset(m,"newDevice"),m[e].$setPristine(),document.getElementsByName("vm.".concat(e))[0].reset()}function I(){return"modbus"===m.tab}function x(){return"canbus"===m.tab}function A(){return"opcua"===m.tab}function S(){return"profibus"===m.tab}function V(){return"canopen"===m.tab}function $(){return"snmp"===m.tab}_.assign(m,{$onInit:function(){e="new".concat(m.mode,"DeviceForm"),m.expandedId=""},shouldShowSection:function(){var e=m.device,n=m.mode,t=!1;I()?"TCP"===n?t=l.supportsOperation(e,"c8y_ModbusDevice"):"RTU"===n&&(t=l.supportsOperation(e,"c8y_ModbusDevice")&&e.c8y_SerialConfiguration):x()&&"CAN"===n?t=l.supportsOperation(e,"c8y_CanDevice"):S()&&"Profibus"===n?t=l.supportsOperation(e,"c8y_ProfibusDevice"):V()&&"CANopen"===n&&(t=l.supportsOperation(e,"c8y_CANopenAddDevice"));return t},isModbusTab:I,isCanBusTab:x,isOPCUATab:A,isProfibusTab:S,isCanOpenTab:V,isSNMPTab:$,invalid:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"new".concat(m.mode,"DeviceForm");return function(e){var n=m.mode,t=m.fieldErrors;if("TCP"===n||"RTU"===n){var i=m[e],r=i.address;if(r){var o=r.$modelValue;if("TCP"===n){var a=i.ipAddress,c=a.$modelValue;_.isUndefined(o)||r.$setValidity(t.ADDRESS_INVALID,function(e){return e<=247||255===e}(o));var d=o&&c&&_.some(m.devices,{address:o,ipAddress:c,protocol:"TCP"});r.$setValidity(t.ADDRESSES_IN_USE,!d),a.$setValidity(t.ADDRESSES_IN_USE,!d)}else if("RTU"===n){var s=o&&_.some(m.devices,{address:o,protocol:"RTU"});r.$setValidity(t.ADDRESS_IN_USE,!s)}}}else if("CANopen"===n){var u=m[e],l=u.nodeId;if(l){var v=l.$modelValue;if(v){var f=function(e){return 1<=e&&e<=127}(v),p=function(n){return m.devices.find(function(e){return!(!e||!e.nodeId)&&e.nodeId===n})}(v);f?p?(l.$setValidity(t.NODE_OUT_OF_RANGE,!0),l.$setValidity(t.NODE_IN_USE,!1)):(l.$setValidity(t.NODE_OUT_OF_RANGE,!0),l.$setValidity(t.NODE_IN_USE,!0)):(l.$setValidity(t.NODE_OUT_OF_RANGE,!1),l.$setValidity(t.NODE_IN_USE,!0))}}}else"SNMP"===n&&function(e){var n,t=m[e];e&&(n=function(e){return _.toNumber(e.replace("form",""))}(e)),function(e,n){var t=m.fieldErrors;if(e.snmpVersionEngineId){var i=e.snmpVersionEngineId,r=i.$modelValue;r&&i.$setValidity(t.ENGINEID_IN_USE,!function(n,t){return t?_.some(m.devices,function(e){return(_.toNumber(e.id)!==t||n!==e.auth.engineId)&&e.engineId===n}):_.some(m.devices,function(e){return e.auth.engineId===n})}(r,n))}}(t,n),function(e,n){var t=m.fieldErrors,i=e.ipAddress,r=i.$modelValue;i.$setValidity(t.ADDRESS_IN_USE,!function(n,t){return t?_.some(m.devices,function(e){return(_.toNumber(e.id)!==t||n!==e.ipAddress)&&e.ipAddress===n}):_.some(m.devices,{ipAddress:n})}(r,n))}(t,n),function(e){var n=m.fieldErrors,t=e.port,i=t.$modelValue;t.$setValidity(n.PORT_INVALID,!_.isNaN(_.toNumber(i)))}(t)}(e)}(n),i.invalid(m,n,e)},getFieldValidationHints:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"new".concat(m.mode,"DeviceForm"),t=_.get(m,"".concat(n,".").concat(e));if(t)return i.validationHints(t,m.fieldErrorsToMessages);return""},isFormInvalid:function(){return _.get(m,"".concat(e,".$invalid"))||_.get(m,"newDevice.adding")},startAddingNewDevice:function(){m.newDevice={name:null,deviceType:null,address:null},$()&&(m.newDevice=_.extend(m.newDevice,{version:null,port:null,auth:{}}),m.toggle("newDevice"))},addNewDevice:function(){var n,t,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.mode,t=m.device,(i=m.newDevice).adding=!0,i.protocol=n,e.prev=3,I())return e.next=7,regeneratorRuntime.awrap(o.create(t,i));e.next=9;break;case 7:e.next=32;break;case 9:if(x())return e.next=12,regeneratorRuntime.awrap(a.create(t,i));e.next=14;break;case 12:e.next=32;break;case 14:if(A())return e.next=17,regeneratorRuntime.awrap(c.create(t,i));e.next=19;break;case 17:e.next=32;break;case 19:if(S())return e.next=22,regeneratorRuntime.awrap(d.create(t,i));e.next=24;break;case 22:e.next=32;break;case 24:if(V())return e.next=27,regeneratorRuntime.awrap(s.create(t,i));e.next=29;break;case 27:e.next=32;break;case 29:if($())return e.next=32,regeneratorRuntime.awrap(u.create(t,i));e.next=32;break;case 32:y(),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(3),N();case 38:r.$apply();case 39:case"end":return e.stop()}},null,null,[[3,35]],Promise)},clearNewDevice:E,filterByMode:function(){if(I())return function(e){var n=_.get(e,"protocol");return n===m.mode};if(V())return function(e){return e.nodeId};return function(){return!0}},snmpVersions:v,snmpAuthPrivProtocols:f,snmpAuthProtocols:p,snmpSecurityLevels:g,updateDevice:function(n){var t,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.mode,i=m.device,n.adding=!0,n.protocol=t,e.prev=3,$())return e.next=7,regeneratorRuntime.awrap(u.update(i,n));e.next=7;break;case 7:D(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),b(n);case 13:r.$apply();case 14:case"end":return e.stop()}},null,null,[[3,10]],Promise)},startEditDevice:function(e){var n=_.cloneDeep(e);if(n.adding=!1,!_.isUndefined(n.deviceType)){var t=m.deviceConfigurationOptions;n.deviceType=_.find(t.types,function(e){return e.name===n.deviceType})}return n},isEditFormInvalid:function(e,n){return _.get(m,"".concat(e,".$invalid"))||_.get(n,"adding")},toggle:function(e){m.expandedId===e?m.expandedId="":m.expandedId=e},clearEditDevice:function(){m.expandedId=""},getSnmpVersionLabel:function(e){var n=_.find(v,{value:e});return _.get(n,"label")},getFormName:function(e){if(e){var n=e.id;return"vm.form".concat(_.toString(n))}return"vm.form"},getDeviceFormName:function(e){return"form".concat(e.id)},expandedId:void 0})}e.$inject=["$rootScope","c8yBase","c8yAlert","c8yModbusDevice","c8yCanbusDevice","c8yOPCUADevice","c8yProfibusDevice","c8yCanopenDevice","c8ySNMPDevice","c8yDevices","gettext"],angular.module("c8y.modbusConfiguration4").component("c8yFieldbusDeviceList",{templateUrl:":::PLUGIN_PATH:::/fieldbus-device-list.html",bindings:{tab:"@",mode:"@",fieldErrors:"<",fieldErrorsToMessages:"<",deviceConfigurationOptions:"<",device:"<",devices:"<",reloadDevices:"<",onClickDelete:"<",navigateToDetail:"<"},controllerAs:"vm",controller:e})}();