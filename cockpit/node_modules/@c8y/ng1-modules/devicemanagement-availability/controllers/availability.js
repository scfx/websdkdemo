"use strict";!function(){function t(i,t,r,n,a,o){var e,u,l=t.deviceId,c={},d=a("Availability percentage is based on the number of critical alarms raised and cleared."),m=a("Operability chart displays how many devices had their average availability on particular level in the last month."),v=r.createEnum([{name:"DAY",value:"day",label:a("Last 24 hours availability")},{name:"WEEK",value:"week",label:a("Last 7 days availability")},{name:"MONTH",value:"month",label:a("Last 30 days availability")}]),f=r.createEnum([{name:"DOWNTIME",value:"downtime",label:a("Downtime"),color:"#d9534f"},{name:"UPTIME",value:"uptime",label:a("Uptime"),color:"#5cb85c"}]);function s(a){var e=function(t){var a=moment().add(1,"day"),e=moment().subtract(1,t.value),n=r.dateFullFormat;return{dateFrom:e.format(n),dateTo:a.format(n),id:l}}(a);return(e.id?n.reports.downtimeDuration(e):n.reports.downtimeDurationAggregation(e)).then(function(t){return function(t,a,e){var n=e.downtimeDuration,r=y(a,e)-n;c[t.name]={name:t.name,label:t.label,order:t.ordinal,data:[{key:f.DOWNTIME.value,val:n},{key:f.UPTIME.value,val:r}]}}(a,e,t.data)})}function y(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=moment(t.dateFrom),n=moment(t.dateTo),r=1;return"number"==typeof a.deviceCount?r=a.deviceCount:Array.isArray(a.availabilityStats)&&(r=a.availabilityStats.length),n.diff(e,"seconds")*(r||1)}function p(t){var a=_.find(t,{key:f.UPTIME.value}).val;return a/(a+_.find(t,{key:f.DOWNTIME.value}).val)*100}_.assign(i,{intervalsData:c,availabilityTooltip:d,operabilityTooltip:m,x:function(){return function(t){return t.key}},y:function(){return function(t){return t.val}},xGraph:function(){return function(t){return t[0]}},yGraph:function(){return function(t){return t[1]}},xTickFormat:function(){return function(t){return"".concat(t,"%")}},color:function(){return function(t){return _.find(f,{value:t.data.key}).color}},colorGraph:function(){return function(){return f.UPTIME.color}},tooltip:function(){return function(t){return o.getString(_.find(f,{value:t}).label)}},tooltipGraph:function(){return function(t,a,e){var n=Math.round(e);return o.getPlural(n,"1 device","{{$count}} devices",{})}},percentage:p,percentageClass:function(t){return 50<p(t)?"text-success":"text-danger"}}),v.values().forEach(s),l||(e=r.dateFullFormat,u={dateFrom:moment().subtract(1,"month").format(e),dateTo:moment().add(1,"day").format(e)},n.reports.downtimeDuration(u).then(function(t){return function(t,a){var e=a.availabilityStats,n=y(t),r=e.map(function(t){var a=t.downtimeDuration;return t.percent=100*(n-a)/n,t});i.graphData=[{key:"operability",values:function(n){for(var r=[],t=function(t){var a=10*t,e=n.filter(function(t){return function(t,a){return a.percent<=t&&a.percent>t-10}(a,t)}).length;r.push([a,e])},a=0;a<=10;a++)t(a);return r}(r)}]}(u,t.data)}))}t.$inject=["$scope","$routeParams","c8yBase","c8yAlarms","gettext","gettextCatalog"],angular.module("c8y.parts.availability").controller("availabilityReportCtrl",t)}();