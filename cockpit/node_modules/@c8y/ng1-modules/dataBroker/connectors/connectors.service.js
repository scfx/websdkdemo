"use strict";!function(){function e(a,o,r,c,i,l,d){var s=c.url("databroker/connectors"),u=c.contentHeaders("connector",!0),e=c.createEnum([{name:"ALARM",value:"alarm",label:l("Alarms"),icon:"bell"},{name:"EVENT",value:"event",label:l("Events"),icon:"c8y-events"},{name:"MEASUREMENT",value:"measurement",label:l("Measurements"),icon:"line-chart"},{name:"MANAGED_OBJECT",value:"managedObject",label:l("Managed objects"),icon:"cubes"},{name:"OPERATION",value:"operation",label:l("Operations"),icon:"code"},{name:"ALL",value:"*",hidden:!0}]),g=c.createEnum([{name:"ACTIVE",label:l("active`connector`")},{name:"ACTIVATING",label:l("activating`connector`")},{name:"SUSPENDED",label:l("suspended`connector`")},{name:"WAITING",label:l("waiting`connector`")}]),m=c.createEnum([{name:"ACTIVE",label:l("active`connector`")},{name:"SUSPENDED",label:l("suspended`connector`")},{name:"WAITING",label:l("waiting`connector`")}]),v=c.createEnum([{name:"ACTIVE",label:l("active`connector`")},{name:"ACTIVATING",label:l("activating`connector`")},{name:"PENDING",label:l("pending`connector`")},{name:"SUSPENDED",label:l("suspended`connector`")},{name:"WAITING",label:l("waiting`connector`")}]),t=["id","status","destinationStatus","instanceUrl","tenantId","username","password","code","self","suspendReason"];return{getConnectors:function e(){var t={params:c.pageSizeNoTotalFilter()};var n=c.cleanListCallback("connectors",e,t.params);return o.get(s,t).then(n).then(function(e){return _.forEach(e,T),e})},saveConnector:function(e){var t;t=c.hasId(e)?f(c.getId(e),e):n(e);return t},createConnector:n,updateConnector:f,toggleConnectorStatus:function(t){t.status===g.ACTIVE.value?t.status=g.SUSPENDED.value:t.status=g.ACTIVE.value;return _.unset(t,"visibleStatus"),f(t.id,{status:t.status}).then(function(e){t.status=e.status,T(t)})},getConnector:function(e){return o.get(p(e)).then(c.getResData).then(T)},getConnectorStub:function(){return{name:"",instanceUrl:"",description:"",filters:[]}},getConnectorDuplicate:function(e){return o.get(p(e)).then(c.getResData).then(function(e){return e.name=d.getString("Duplicate of {{name}}",e),_.omit(e,t)})},deleteConnector:function(e){return o({method:"DELETE",url:p(e)})},updateConnectorName:function(t,n){var e=a.when();t.id?e=f(t.id,{name:n}).then(function(e){return t.name=n,e}):t.name=n;return e},convertToViewModel:function(e){var t=_.cloneDeep(e);return t.filters=_.map(t.filters,function(e){return e.apis=_.transform(e.apis,function(e,t){e[t]=!0},{}),e.fragmentsToFilter=I(e.fragmentsToFilter),e.copyAllFragments=_.isNull(e.fragmentsToCopy)||_.isUndefined(e.fragmentsToCopy),e.fragmentsToCopy=I(e.fragmentsToCopy),e.selectedGroupOrDevice=function(e){var t,n=e.deviceGroupId||e.sourceId;return n&&(t={id:n}),t}(e),e}),t},convertToBackendModel:function(e){var t=_.cloneDeep(e);return t.filters=_.map(t.filters,function(e){var t,n,a=function(e){return _(e).map(function(e,t){return e?t:void 0}).compact().value()}(e.apis),o=C(e.fragmentsToFilter),r=e.copyAllFragments?null:C(e.fragmentsToCopy),c=e.selectedGroupOrDevice;return c&&c.isDevice&&(t=c.id),c&&!c.isDevice&&(n=c.id),_.assign(e,{isOpen:void 0,apis:a,fragmentsToFilter:o,fragmentsToCopy:r,copyAllFragments:void 0,sourceId:t,deviceGroupId:n,selectedGroupOrDevice:void 0})}),t},getFilterFragmentsSummary:function(e){var t=C(_.get(e,"fragmentsToFilter",[])),n=C(_.get(e,"fragmentsToCopy",[])),a=_.get(e,"copyAllFragments"),o="",r="";o=0<t.length?d.getString("Filter: {{fragments}}",{fragments:t.join(", ")}):d.getString("Filter: none");r=a?d.getString("Copy: all"):0<n.length?d.getString("Copy: {{fragments}}",{fragments:n.join(", ")}):d.getString("Copy: standard only");return[o,r].join("; ")},navigateToList:function(){var e=i.CONNECTOR_BASE_URL;r.path(e)},navigateToNew:function(e){var t="new",n=i.CONNECTOR_BASE_URL,a="";c.hasId(e)&&(t=c.getId(e),a="/duplicate");r.path("".concat(n,"/").concat(t).concat(a))},navigateToDetails:function(e){var t=c.getId(e),n="".concat(i.CONNECTOR_BASE_URL,"/").concat(t);r.path(n)},getMappedStatus:E,getStatusTooltip:function(e){var t={},n=g.WAITING.value,a=g.ACTIVE.value,o=g.ACTIVATING.value,r=g.SUSPENDED.value,c=m.ACTIVE.value,i=m.WAITING.value,s=m.SUSPENDED.value;t[n]=l("Connector not bootstrapped yet."),t[a]={},t[a][c]=l("Connector is working."),t[o]={},t[o][c]=l("Inventory structure synchronization in progress."),t[a][s]=l("Subscription in destination tenant disabled."),t[r]={},t[r][i]=l("Connector not bootstrapped but suspended by source tenant."),t[r][c]=l("Connector suspended by source tenant."),t[r][s]=l("Subscription in destination tenant disabled and then connector suspended by source tenant.");var u=t[e.status];return(e.status===r?d.getString(e.suspendReason):void 0)||_.get(u,e.destinationStatus)||u},APIS:e,STATUS:g,MAPPED_STATUS:v,DESTINATION_STATUS:m};function p(e){return[s,e].join("/")}function n(e){return o({method:"POST",url:s,data:e,headers:u}).then(c.getResData)}function f(e,t){var n=_.omit(t,["instanceUrl","tenantId","code","suspendReason"]);return o({method:"PUT",url:p(e),data:n,headers:u}).then(c.getResData)}function T(e){return e.visibleStatus=E(e),e}function E(e){var t={},n=g.WAITING.value,a=g.ACTIVE.value,o=g.ACTIVATING.value,r=g.SUSPENDED.value,c=m.ACTIVE.value,i=m.SUSPENDED.value;t[n]=v.WAITING,t[a]={},t[a][c]=v.ACTIVE,t[o]={},t[o][c]=v.ACTIVATING,t[a][i]=v.PENDING,t[r]=v.SUSPENDED;var s=t[e.status];return _.get(s,e.destinationStatus)||s}function I(e){var t=e||[];return t.length||t.push(""),_.map(t,S)}function S(e){return{fragment:e}}function C(e){return _(e).map("fragment").compact().value()}}e.$inject=["$q","$http","$location","c8yBase","dataBrokerConstants","gettext","gettextCatalog"],angular.module("c8y.dataBroker").factory("dataBrokerConnectorsSvc",e)}();