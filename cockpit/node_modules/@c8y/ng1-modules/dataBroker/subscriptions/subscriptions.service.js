"use strict";!function(){function e(n,r,c,a,i,e,s,u){var o=i.url("devicecontrol/newDeviceRequests"),l=i.createEnum([{name:e.status.WAITING_FOR_CONNECTION,label:u("Waiting for connection")},{name:e.status.PENDING_ACCEPTANCE,label:u("Pending acceptance")},{name:e.status.ACCEPTED,label:u("Accepted")}]),d="c8y_BrokerSource",t="c8y_DataBroker",v={type:t};return{list:function(){var e={fragmentType:d};return c.list(e).then(p)},getUserDetails:S,updateUserStatus:function(e,t){return(t?a.enable(e):a.disable(e)).then(i.getResData)},listPending:function e(){var t=i.cleanListCallback("newDeviceRequests",e,{});return n.get(o).then(t).then(g)},acceptSubscription:function(e){var t=b(e);return n.put(t,{status:l.ACCEPTED.name},{headers:i.contentHeaders("newDeviceRequest")})},discardSubscription:function(e){var t=b(e);return n.delete(t)},registerNewSubscription:function(e){return n.post(o,{id:e,type:t},{headers:i.contentHeaders("newDeviceRequest")})},NEW_DEVICE_REQUEST_STATUS:l,removeSubscription:function(e){var t="_".concat(d);return _.set(e,d,null),c.save(_.pick(e,["id",d,t]))},getVisibleUserStatusText:f};function p(e){var t=_.map(e,function(t){return S(t.owner).then(function(e){return _.assign({},{userStatus:e.enabled,visibleUserStatus:f(e),userId:e.id,status:_.assign({},function(e){var t={};switch(e){case s.STATUS.ACTIVE.value:t={icon:"check-circle",textClass:"text-success",text:u("Active`subscription`")};break;case s.STATUS.SUSPENDED.value:t={icon:"exclamation-triangle",textClass:"text-warning",text:u("Inactive`subscription`")};break;case s.STATUS.WAITING.value:t={icon:"spinner",iconClass:"icon-spin",textClass:"text-warning",text:u("Waiting")}}return _.assign(t,{value:e}),t}(t.c8y_BrokerSource.status)),id:t.id,_c8y_BrokerSource:t.c8y_BrokerSource})})});return r.all(t)}function S(e){return a.detail(e).then(i.getResData)}function f(e){return e.enabled?u("active`subscription`"):u("inactive`subscription`")}function g(e){return _(e).filter(v).map(function(e){return _.assign({},_.get(e,"customProperties.c8y_BrokerSource"),{status:l[e.status],type:e.type,id:e.id})}).value()}function b(e){return"".concat(o,"/").concat(encodeURIComponent(e))}}e.$inject=["$http","$q","c8yInventory","c8yUser","c8yBase","c8yDeviceRegistration","dataBrokerConnectorsSvc","gettext"],angular.module("c8y.dataBroker").factory("dataBrokerSubscriptionsSvc",e)}();