"use strict";!function(){function n(t,e,n,i,o,a,r,u,s,c,g){var f,l=this,d=[],p="#add-configuration-snapshot-btn";function h(n){var t=n.then(function(n){return{title:c("Configuration snapshots repository"),subtitle:!_.isUndefined(n)&&0<n?g.getPlural(n,"1 snapshot","{{$count}} snapshots",{}):""}});r.changeTitle(t)}function y(n){t.configurations&&!t.refreshLoading||(t.configurations=[]),t.paging=n.paging,n.forEach(function(n){t.configurations.push(n),n.id===i.id&&d.push(n)}),h(e.when(n.length))}function C(){t.refreshLoading=!0,t.paging.refresh().then(y).finally(function(){t.refreshLoading=!1})}function m(n){return d.indexOf(n)}function v(n){return-1<m(n)}function b(){$(p).attr("aria-expanded","false"),l.dropdownOpen=!1,l.newCfg=null}t.onToggle=function(n){n&&(l.newCfgForm.$setPristine(),l.newCfgForm.$setUntouched())},t.loadNext=function(){t.paging.loading=!0,t.paging.next().then(y).finally(function(){t.paging.loading=!1})},t.refresh=C,t.toggle=function(n){v(n)?d.splice(m(n),1):d.push(n)},t.isOpen=v,t.onClickDelete=function(n){u({title:c("Delete configuration"),body:g.getString('You are about to delete the configuration "{{name}}". Do you want to proceed?',n),status:"danger",labels:{ok:c("Delete")},size:"sm"}).then(angular.bind(s,s.remove,n)).then(angular.bind(a,a.removeFromList,t.configurations,n)).then(function(){o.success(c("Configuration deleted.")),h(e.when(t.configurations.length))})},t.save=function(n){s.save(n).then(angular.bind({},C)).finally(b)},t.add=function(){l.newCfg=s.getEmpty(),l.newCfg.deviceType=i.type},t.cancelAdd=b,t.invalid=angular.bind(a,a.invalid,t),t.getConfigurationsCopy=function(n){return _.cloneDeep(n)},t.status={isOpen:!1},s.list(f).then(y),i.add&&n(function(){$(p).click()})}n.$inject=["$scope","$q","$timeout","$routeParams","c8yAlert","c8yBase","c8yTitle","c8yModal","configurationRepositorySvc","gettext","gettextCatalog"],angular.module("c8y.configurationRepository").controller("configurationRepositoryListCtrl",n)}();