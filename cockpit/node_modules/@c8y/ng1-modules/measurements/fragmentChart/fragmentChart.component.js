"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(i,a,e){var o,u=this,m=d3.scale.category10();function r(e){var t=e.currentValue,n=e.previousValue;return!_.isEmpty(t)&&!_.isEmpty(n)&&!_.isEqual(t,n)}function s(e){u.fragmentSeriesPairs=_.groupBy(e,"fragment")}function c(){u.channel="/measurements/".concat(o)}function f(){var e=function(e){var n=0,a=u.fragment,r={__target:{id:o},fragment:a,lineType:"line",renderType:"area"};return _.map(e,function(e,t){return _.assign({series:t,unit:e.unit,label:i.humanizeFragment("".concat(a," => ").concat(t)),color:m(n++),__active:!0},r)})}(function(e){return _.reduce(e,function(e,t){var n=t.series,a=t.unit;return _.assign(e,_defineProperty({},n,{unit:a}))},{})}(_.get(u.fragmentSeriesPairs,u.fragment)));_.set(u,"dataPoints",e)}u.aggregation="MINUTELY",u.interval=e._defaultDuration,_.assign(u,{$onChanges:function(e){var t=e.device,n=e.fragment;u.device&&u.fragment&&((r(t)||r(n))&&(u.fragmentSeriesPairs=void 0),o=i.getId(u.device),u.fragmentSeriesPairs?(c(),f()):a.getSupportedSeries(o,{withUnits:!0}).then(s).then(function(){c(),f()}))},$onInit:function(){u.dateFrom=moment().subtract(1,"hour").toDate(),u.dateTo=new Date},onUpdateDates:function(e,t){u.dateFrom=e;var n=moment().diff(moment(t),"seconds")<10;u.realtime&&!n&&(u.realtime=!1);u.dateTo=t},updateScale:function(e){_.forEach(e.series,function(e){var t=e.dataPoint,n=_.find(u.dataPoints,function(e){return e.fragment===t.fragment&&e.series===t.series});if(n){var a=e.values,r=_.minBy(a,"val.min").val.min,i=_.maxBy(a,"val.max").val.max;r===i&&(r-=1,i+=1),n.min=r,n.max=i}})}})}e.$inject=["c8yBase","c8yDevices","INTERVAL_CONSTANTS"],angular.module("c8y.core.measurements2").component("c8yMeasurementsFragmentChart",{templateUrl:":::PLUGIN_PATH:::/fragmentChart/fragmentChart.html",controllerAs:"vm",controller:e,bindings:{fragment:"<",device:"<",dateFrom:"=",dateTo:"=",realtime:"=?",hideRealtimeButton:"=?"}})}();