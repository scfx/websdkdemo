"use strict";!function(){function e(i,o,r,a,s,u,f){var n=i.$watch("device",function(e){e&&e.id&&(function(e){i.geofence=e.c8y_Geofence&&e.c8y_Geofence.active,i.motion=e.c8y_MotionTracking&&e.c8y_MotionTracking.active||!1,i.radius=e.c8y_Geofence&&e.c8y_Geofence.radius||100}(e),n())});_.assign(i,{supports:function(e){return a.supportsOperation(i.device,e)},updateConfig:function(){var e=[],n=i.device,t=n.id,c=n.c8y_Position;if(i.geofence&&!c)return void function(e){i.$emit("message",{text:e,type:"error"})}(f("Device current position not defined"));a.supportsOperation(n,"c8y_Geofence")&&e.push(function(e,n,t,c){var i=f(c?"Activate geofence":"Deactivate geofence");return r.create({deviceId:e,description:i,c8y_Geofence:{lat:n&&n.lat,lng:n&&n.lng,radius:t,active:!0}})}(t,c,i.radius,i.geofence));a.supportsOperation(n,"c8y_MotionTracking")&&e.push(function(e,n){var t=f(n?"Activate motion tracking":"Deactivate motion tracking");return r.create({deviceId:e,description:t,c8y_MotionTracking:{active:!!n}})}(t,i.motion));e.length?o.all(e).then(function(){i.$emit("message",{text:f("Operations created"),type:"success"})}):_.isUndefined(i.radius)||(function(e){_.assign(e,{c8y_Radius:{value:i.radius}},{c8y_CopyPosition:_.cloneDeep(e.c8y_Position)})}(n),function(e){s.save(e).then(function(){u.success(f("Changes saved."))})}(n))}})}e.$inject=["$scope","$q","c8yDeviceControl","c8yDevices","c8yInventory","c8yAlert","gettext"],angular.module("c8y.parts.tracking").controller("trackingConfigCtrl",e)}();