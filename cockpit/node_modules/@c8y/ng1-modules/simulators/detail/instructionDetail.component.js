"use strict";!function(){function e(t,e,n,a,s){var u=this,r=_(a.Types.values()).filter("numeric").map("name").value();function o(){n(function(){e.find(".optionsForm input").first().trigger("focus")})}function i(){var e=u.selectedMessage||{},t=l(e);u.valuesData=[];var n=u.valuesData,s=0,i=a.findMessageForInstruction(u.instruction,u.messages);_.forEach(e.mandatoryValues,function(e){e.mandatory=!0}),_.forEach(t,function(e){s+=1,e.order=s,function(e){return!e.value&&e.type!==a.Types.DATE.name}(e)&&n.push(e)}),function(n){var e=l(u.selectedMessage||{});_.forEach(e,function(e,t){e.inputValue=n?void 0:u.values[t],_.includes(r,e.type)&&!_.isUndefined(e.inputValue)&&(e.inputValue=Number(e.inputValue))})}(!(e&&i===e)),o()}function l(e){var t=_.union(e.mandatoryValues,e.customValues,e.values);return _.reject(t,"value")}function c(e){var t=u.editInstruction;u.messages=e,u.selectedMessage=a.findMessageForInstruction(t,u.messages),"sleep"!==t.type&&i(),o()}_.assign(u,{$onInit:function(){_.assign(u,{icons:s.icons})},$onChanges:function(){u.editInstruction=_.clone(u.instruction);var e=u.editInstruction;e&&((u.messages?t.when(u.messages):a.listAllPublishMessages()).then(c),u.values=e.values||[]);delete u.valuesForm},onSelectedMessage:i,remove:function(){u.simulatorCtrl.remove(u.instruction)},canSave:function(e){var t=e.$valid,n=u.instruction,s=u.selectedMessage,i=_.includes(["message","builtin"],n&&n.type);(!n||i&&!s)&&(t=!1);return t},save:function(){var e=u.instruction,t=u.editInstruction;if("sleep"===e.type)e.seconds=t.seconds;else{var n=u.selectedMessage,s=l(n);e.type=n._template?"message":"builtin",e.values=_.map(s,function(e){var t=_([e.value,e.inputValue]).reject(_.isNil).reject(function(e){return""===e}).head();return _.isUndefined(t)?"":t}),e.messageId=n.msgId,e.templateId=n._template?n._template.__externalId:void 0}u.simulatorCtrl.saveCurrentSimulatorCommands()},cancel:function(){var e=u.instruction,t=e.messageId,n=e.type;t||"message"!==n&&"builtin"!==n?u.simulatorCtrl.selectInstruction():u.simulatorCtrl.remove(u.instruction)}})}e.$inject=["$q","$element","$timeout","c8ySimulators","c8ySimulatorsUi"],angular.module("c8y.simulators").component("c8ySimulatorInstructionDetail",{templateUrl:":::PLUGIN_PATH:::/detail/instructionDetail.html",require:{simulatorCtrl:"^c8ySimulatorDetail"},bindings:{instruction:"<"},controllerAs:"vm",controller:e})}();