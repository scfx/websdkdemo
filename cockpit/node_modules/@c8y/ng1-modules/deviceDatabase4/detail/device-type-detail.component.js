"use strict";!function(){function e(s,e,r,n,i,c,t,a,u,o,p){var l=this,d=l.id,y=!0;function g(n){var r,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap((t=n,v()?c.getEmptyDeviceType():c.getDeviceType(t)));case 2:r=e.sent,i=r.fieldbusType,_.assign(l,{deviceType:r,formValue:{fieldbusType:i},features:_.find(l.deviceTypesFeatures,{fieldbusType:i})}),s.$apply();case 6:case"end":return e.stop()}var t},null,null,null,Promise)}function v(){return"new"===d}function m(){l.deviceType.name?t.changeTitle({title:l.deviceType.name},{skipTitleTranslation:!0}):t.changeTitle({title:o("New device type")})}function f(e){return b(e,c.addElementId(c.getEmptyDiscreteOutput()),l.deviceType.c8y_Coils)}function T(e){return b(e,c.addElementId(c.getEmptyDiscreteInput()),l.deviceType.c8y_Coils)}function R(e){return w(e,c.addElementId(c.getEmptyHoldingRegister(l.deviceType)),l.deviceType.c8y_Registers)}function h(e){return w(e,c.addElementId(c.getEmptyInputRegister()),l.deviceType.c8y_Registers)}function b(e,t,n){return D("DiscreteIO",e,t,n)}function w(e,t,n){return D("Register",e,t,n)}function D(t,n,r,i){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(c["edit".concat(t,"WithUI")](n||r,l.deviceType));case 3:a=e.sent,x(n,i,a),C(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0&&"escape key press"!==e.t0&&u.danger(e.t0);case 11:s.$apply();case 12:case"end":return e.stop()}},null,null,[[0,8]],Promise)}function x(e,t,n){(_.get(l.features,"holdingRegisters.number.useHex",!1)&&!n.number.startsWith("0x")&&(n.number="0x".concat(n.number)),e)?t[_.indexOf(t,e)]=n:t.push(n)}function I(t,n,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(a({title:o("Delete item"),body:p.getString(r,t),labels:{ok:o("Delete")},status:"danger"}));case 3:i.removeFromList(n,t),C(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0&&u.danger(e.t0);case 10:s.$apply();case 11:case"end":return e.stop()}},null,null,[[0,7]],Promise)}function $(){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(a({title:o("Confirm device type change?"),body:p.getString("By changing device type, all changes will be lost. Do you really want to proceed?")}));case 3:return c.removeAllElements(l.deviceType),C(),t=l.formValue.fieldbusType,l.deviceType.fieldbusType=t,e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(0),n=l.deviceType.fieldbusType,l.formValue.fieldbusType=n,e.abrupt("return",n);case 15:case"end":return e.stop()}},null,null,[[0,10]],Promise)}function C(){var e=l.deviceType;_.assign(l,{discreteOutputsCategorized:c.getDiscreteOutputsCategorized(e),discreteInputsCategorized:c.getDiscreteInputsCategorized(e),holdingRegistersCategorized:c.getHoldingRegistersCategorized(e),inputRegistersCategorized:c.getInputRegistersCategorized(e)})}_.assign(l,{$onInit:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(c.getFeaturesManifestsAsync());case 2:l.deviceTypesFeatures=e.sent,s.$apply();case 4:case"end":return e.stop()}},null,null,null,Promise));case 2:return e.next=4,regeneratorRuntime.awrap(g(d));case 4:C(),m(),s.$apply();case 7:case"end":return e.stop()}},null,null,null,Promise)},isNew:v,isEmpty:_.isEmpty,editDiscreteOutput:f,editDiscreteInput:T,editHoldingRegister:R,editInputRegister:h,addDiscreteOutput:f,addDiscreteInput:T,addHoldingRegister:R,addInputRegister:h,removeDiscreteOutput:function(e){return I(e,l.deviceType.c8y_Coils,o('Do you really want to remove "{{name}}"?'))},removeDiscreteInput:function(e){return I(e,l.deviceType.c8y_Coils,o('Do you really want to remove "{{name}}"?'))},removeHoldingRegister:function(e){return I(e,l.deviceType.c8y_Registers,o('Do you really want to remove "{{name}}"?'))},removeInputRegister:function(e){return I(e,l.deviceType.c8y_Registers,o('Do you really want to remove "{{name}}"?'))},save:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(c.save(t));case 3:u.success(o("Device type saved.")),y=!0,n.path("/deviceprotocols"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),u.danger(e.t0.errorMessage);case 11:s.$apply();case 12:case"end":return e.stop()}},null,null,[[0,8]],Promise)},saveDisabled:function(){var e=l.deviceType;return _.get(l,"deviceTypeForm.$invalid")||!e||_.isEmpty(e.c8y_Coils)&&_.isEmpty(e.c8y_Registers)},changeDeviceType:function(){if(l.deviceType.fieldbusType)!function(){var t;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap($());case 2:t=e.sent,l.features=_.find(l.deviceTypesFeatures,{fieldbusType:t}),s.$apply();case 5:case"end":return e.stop()}},null,null,null,Promise)}();else{var e=l.formValue.fieldbusType;l.deviceType.fieldbusType=e,l.features=_.find(l.deviceTypesFeatures,{fieldbusType:e})}},messageIdSources:c.MessageIdSources,toggleMainEdit:function(){l.editingMain=!l.editingMain}}),e.$watch("vm.deviceType",function(e,t){t&&e!==t&&(y=!1)},!0),e.$on("$locationChangeStart",function(t,n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=13;break}return t.preventDefault(),e.prev=2,e.next=5,regeneratorRuntime.awrap(a({title:o("Discard changes"),body:o("You are about to leave this page and discard the changes made. Do you want to proceed?"),status:"warning",labels:{ok:o("Discard")}}));case 5:y=!0,r.location.href=n,s.$apply(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0&&u.danger(e.t0);case 13:case"end":return e.stop()}},null,null,[[2,10]],Promise)})}e.$inject=["$rootScope","$scope","$window","$location","c8yBase","c8yDeviceDatabase","c8yTitle","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yDeviceTypeDetail",{templateUrl:":::PLUGIN_PATH:::/detail/device-type-detail.html",bindings:{id:"<"},controllerAs:"vm",controller:e})}();