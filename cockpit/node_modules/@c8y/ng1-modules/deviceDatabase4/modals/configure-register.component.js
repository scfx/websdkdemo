"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(){function e(e,t,i,s,a,n,r){var o,l,d,u,m,c,g,S=this,I="elementForm",f={IS_REQUIRED:"required",IS_VALID_NAME:"valid-name",IS_VALID_BIT_RANGE:"valid-bit-range",IS_VALID_MEASUREMENT:"valid-measurement",IS_VALUE_IN_REGISTER_RANGE:"value-in-register-range",IS_VALID_NO_BITS_FOR_SIGNED_REGISTER:"no-bits-for-signed-register",IS_VALID_MESSAGEID:"valid-messageID",IS_VALID_BROWSEPATH:"valid-browsePath",IS_VALID_OID:"valid-oid",IS_MIN:"min",IS_MAX:"max",IS_UNIQUE:"unique",PATTERN:"pattern",HEXNUMBER:"hexnumber"},v=n("Value out of range. Allowed values from {{min | number}} to {{max | number}}."),p=n('This will be matched with the message ID extracted from the protocol\'s data according to the "Source" setting.');function E(){"read"===S.readWriteMutexValue?(l.meta.showStatus=!0,l.meta.updateStatus=!1):(l.meta.showStatus=!1,l.meta.updateStatus=!0)}function h(e){var t=S.features.functionalities[e];return t&&(!t.showIf||t.showIf(S.element))}function V(){return _.get(o,"number.min",1)}function A(){return _.get(o,"number.max",65536)}function y(e){var t=_.get(o,"noBits.max");return _.isNumber(t)&&_.isNumber(e)?t-e:t}_.assign(S,{$onInit:function(){var e=S.resolve;l=e.element,d=e.existingElements,u=e.existingCategories,m=e.deviceType,c=e.fieldbusType,function(){var e=l.input?"input":"holding";o=S.resolve.features["".concat(e,"Registers")],_.assign(S,{features:o,dataTypes:_.get(o,"dataType.choices"),accessTypes:_.get(o,"accessType.choices")})}(),S.element=s.addRegisterMeta(l,m),S.categories=u,S.deviceType=m,S.fieldbusType=c,function(){var e;_defineProperty(e={},f.IS_REQUIRED,n("This field is required.")),_defineProperty(e,f.IS_VALID_NAME,_.get(o,"validation.invalidName",n("Name must be unique among registers."))),_defineProperty(e,f.IS_VALID_BIT_RANGE,n("Selected number, start bit or number of bits overlap with another register.")),_defineProperty(e,f.IS_VALID_MEASUREMENT,_.get(o,"validation.invalidMeasurement",n("Selected measurement type and series are already used by another register."))),_defineProperty(e,f.IS_MIN,n("Value cannot be lower than minimum.")),_defineProperty(e,f.IS_MAX,n("Value cannot be greater than maximum.")),_defineProperty(e,f.IS_UNIQUE,n("Value cannot be used more than once.")),_defineProperty(e,f.IS_VALID_NO_BITS_FOR_SIGNED_REGISTER,n("At least two bits needed for signed register.")),_defineProperty(e,f.IS_VALID_MESSAGEID,n("Invalid hexadecimal number.")),_defineProperty(e,f.IS_VALID_BROWSEPATH,n("Invalid browse path.")),_defineProperty(e,f.IS_VALID_OID,_.get(o,"validation.invalidOid",n("OID must be unique among components."))),_defineProperty(e,f.PATTERN,n("Dots not allowed.")),_defineProperty(e,f.HEXNUMBER,n("Must be a valid hexadecimal number.")),g=e}(),o.functionalities.readWriteMutex&&(S.readWriteMutexValue="read",l.meta.updateStatus&&(S.readWriteMutexValue="write"),E())},PATTERN_VALIDATE_FRAGMENT_SERIES:"^[^.]*$",alarmSeverities:a.severityList,getValuePlaceholder:function(e){var t=r.getString("no value");_.isUndefined(e)||_.isNaN(e)||(t=e);return"(".concat(t,")")},addEnumValue:s.addEmptyEnumValue,removeEnumValue:s.removeEnumValue,invalid:function(e){return function(e){if("number"===e&&_.get(o,"number.useHex")){var t=_.get(S,"".concat(I,".number")),a=_.get(t,"$modelValue");if(a){a.startsWith("0x")&&(a=a.substring(2));var n=parseInt(a,16),i=n.toString(16)===a.toLowerCase();t.$setValidity(f.IS_VALID_MESSAGEID,i),t.$setValidity(f.IS_MIN,!i||n>=V()),t.$setValidity(f.IS_MAX,!i||n<=A())}else t.$setValidity(f.IS_VALID_MESSAGEID,!0)}}(e),function(e){var t=S[I];if("browsePath"===e){var a=t.browsePath.$viewValue;t.browsePath.$setValidity(f.IS_VALID_BROWSEPATH,/^|((\d)+:[^/]+)([/](\d)+:[^/]+)*$/.test(a))}}(e),function(){var t=S[I].name,a=_.get(l,"meta"),e=_.isUndefined(t.$modelValue)||_.every(d,function(e){return e.name===_.get(a,"original.name")||e.name!==t.$modelValue});t.$setValidity(f.IS_VALID_NAME,e)}(),function(){var e=S[I],a=e.number,n=e.startBit,i=e.noBits,r=_.get(l,"meta"),t=!a||_.isUndefined(a.$modelValue)||_.isUndefined(n.$modelValue)||_.isUndefined(i.$modelValue)||!_.some(d,function(e){var t=a.$modelValue;return _.get(o,"number.useHex")&&t&&-1===t.indexOf("0x")&&(t="0x".concat(t)),(!r||!(_.get(r,"original.number")===e.number&&r.original.startBit===e.startBit))&&e.input===l.input&&s.areOverlappingRegisters(e,{number:t,startBit:n.$modelValue,noBits:i.$modelValue},o)});a&&a.$setValidity(f.IS_VALID_BIT_RANGE,t),n&&n.$setValidity(f.IS_VALID_BIT_RANGE,t),i&&i.$setValidity(f.IS_VALID_BIT_RANGE,t)}(),function(){var e=S[I],i=_.get(e,"messageTypeId.$modelValue"),t=e.measurementType,r=_.get(t,"$modelValue"),a=e.measurementSeries,s=_.get(a,"$modelValue"),u=_.get(l,"meta"),n=!_.get(u,"sendMeasurement")||_.isUndefined(r)||_.isUndefined(s)||!_.some(d,function(e){var t=!1,a=_.get(l,"id")===_.get(e,"id"),n=o.number&&_.get(u,"original.number")===e.number&&_.get(u,"original.startBit")===e.startBit&&_.get(u,"original.input")===e.input;return a||n||(t=(!o.messageTypeId||_.get(e,"messageTypeId")===i)&&_.get(e,"measurementMapping.type")===r&&_.get(e,"measurementMapping.series")===s),t});t&&t.$setValidity(f.IS_VALID_MEASUREMENT,n),a&&a.$setValidity(f.IS_VALID_MEASUREMENT,n)}(),function(){var e=_.get(S,"".concat(I,".noBits"));if(e){var t=!l.signed||l.signed&&!_.isUndefined(e.$modelValue)&&1<e.$modelValue;e.$setValidity(f.IS_VALID_NO_BITS_FOR_SIGNED_REGISTER,t)}}(),function(e){var t=S[I];if("oid"===e){var a=t.oid,n=_.get(l,"meta"),i=_.isUndefined(a.$modelValue)||_.every(d,function(e){return e.oid===_.get(n,"original.oid")||e.oid!==a.$modelValue});a.$setValidity(f.IS_VALID_OID,i)}}(e),i.invalid(S,I,e)},validationHints:function(e,t){var a=_.cloneDeep(g),n=_.get(t,"validateValueInRegisterRange");n&&(a[f.IS_VALUE_IN_REGISTER_RANGE]=r.getString(v,n));return i.validationHints(e,a)},onAccessTypeChange:function(){h("showStatus")||(S.element.meta.showStatus=!1);!S.element.input&&h("updateStatus")||(S.element.meta.updateStatus=!1);S.shouldEnableShowStatusStandardFunctionalities()&&h("sendMeasurement")||(S.element.meta.sendMeasurement=!1);S.shouldEnableShowStatusStandardFunctionalities()&&h("raiseAlarm")||(S.element.meta.raiseAlarm=!1);S.shouldEnableShowStatusStandardFunctionalities()&&h("sendEvent")||(S.element.meta.sendEvent=!1)},onUpdateStatusCheckboxChange:function(){l.meta.updateStatus&&(l.meta.showStatus=!0)},onStatusMappingRadiosChange:E,save:function(){(function(){var e=[];S.features.functionalities.readWriteMutex&&(e=["measurementMapping","eventMapping","alarmMapping"],"read"===S.readWriteMutexValue&&(e=["min","max"]));l.noBits<=8&&e.push("littleEndian");_.forEach(e,function(e){return _.unset(l,e)})})(),S.close({$value:s.removeRegisterMeta(l)})},messageTypeIdMax:function(){var e=void 0;if(_.get(m,"c8y_MessageIdConfiguration.source")!==s.MessageIdSources.PAYLOAD.value)return e;var t=_.get(m,"c8y_MessageIdConfiguration.messageIdMapping.noBits");return Math.pow(2,t)-1},startBitMax:function(){return _.get(o,"startBit.max")},noBitsMax:y,getNumberMin:V,getNumberMax:A,shouldShowOptions:function(){return _.some(S.features.options,Boolean)},shouldShowNormalisationSection:function(){return _.some([S.features.multiplier,S.features.divisor,S.features.offset,S.features.decimalPlaces,S.features.unit,_.get(S.element,"meta.updateStatus",!1)],Boolean)},shouldShowFunctionalities:function(){var e=S.features.functionalities,t=e.readWriteMutex,a=e.showStatus&&S.shouldShowFunctionality("showStatus"),n=e.updateStatus&&!S.element.input&&S.shouldShowFunctionality("updateStatus"),i=S.shouldEnableShowStatusStandardFunctionalities()&&(S.shouldShowFunctionality("sendMeasurement")||S.shouldShowFunctionality("raiseAlarm")||S.shouldShowFunctionality("sendEvent")),r=e.sendManagedObjectUpdate;return t||a||n||i||r},shouldEnableShowStatusStandardFunctionalities:function(){return!(S.features.functionalities.readWriteMutex&&"write"===S.readWriteMutexValue)},shouldShowFunctionality:h,messageIdTooltip:p}),e.$watch("vm.element.startBit",function(){var e=y(l.startBit);l.noBits>e&&(l.noBits=e)}),e.$watchGroup(["vm.element.min","vm.element.max","vm.element.noBits","vm.element.multiplier","vm.element.divisor","vm.element.decimalPlaces","vm.element.signed","vm.element.meta.dataType"],function(){var e=l.meta;e&&(e.valuesRange=s.getValuesRange(l))})}e.$inject=["$scope","$q","c8yBase","c8yDeviceDatabase","c8yAlarms","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yConfigureRegisterModal",{templateUrl:":::PLUGIN_PATH:::/modals/configure-register.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controllerAs:"vm",controller:e})}();