"use strict";!function(){function e(){return{restrict:"EA",scope:{acl:"="},templateUrl:":::PLUGIN_PATH:::/aclEditor/aclEditor.html",controller:n}}function n(t,e,i,r,l){var c,o;function s(){t.newPermission=t.newPermission||{},t.newPermission.deviceSearch=null,t.newPermission.device=null,t.newPermission.scopeType=null,t.newPermission.type=null,t.newPermission.permissionType=null}function n(e){return e&&null!==e&&""!==e}s(),r.current().then(function(e){var n=r.hasRole(e,"ROLE_USER_MANAGEMENT_READ"),i=r.hasRole(e,"ROLE_USER_MANAGEMENT_ADMIN");c=n||i,t.allowView=c,o=i,t.allowEdit=o}),t.isValidPermission=function(e){return n(e.device)&&n(e.device.id)&&null!==e.scopeType&&n(e.type)&&null!==e.permissionType},t.add=function(e){var n=e.device.id,i=function(e){return[e.scopeType.value,e.type,e.permissionType.value].join(":")}(e);t.acl[n]||(t.acl[n]=[]),_.includes(t.acl[n],i)||t.acl[n].push(i),s()},t.remove=function(e,n){t.acl[e]=t.acl[e].filter(function(e){return e!==n}),0===t.acl[e].length&&delete t.acl[e]},t.allowView=c,t.allowEdit=o,t.getDevices=function(e){var n={pageSize:20};return e&&(n.text=e),i.list(n).then(function(e){return function(e){return _.uniqBy(e,"id")}(e)})},t.setDevice=function(e){t.newPermission.device=e},t.translatePermissionString=function(e){var n=e.split(":");return[l.getString(n[0]),n[1],l.getString(n[2])].join(":")}}n.$inject=["$scope","$q","c8yInventory","c8yUser","gettextCatalog"],angular.module("c8y.users").directive("c8yAclEditor",e).directive("aclEditor",e)}();