"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _iterableToArrayLimit(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){s=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){function t(i,r,t,e,a,n,o,s,c,l,u,d){var m,h,f,y,g=t.tenantId,p=l("May contain lowercase letters, digits, and hyphens. Must start with a letter; hyphens only allowed in the middle; minimum 2 characters. ");function v(t){var e=t||{};i.storageLimitation.storageLimitPerDeviceEnabled=function(t){return i.storageLimitation.storageLimitFeatureEnabled&&!!t.storageLimitPerDevice}(e),e.storageLimitPerDevice=(e.storageLimitPerDevice||0)/1024/1024,i.tenant=e}function P(t){i.saveInProgress=t}function w(t){var e=!1;try{e=JSON.parse(t.value)}finally{i.passwordStrengthEnforced=e}}function T(t){i.tenantPolicies=_.union([{name:u.getString("None")}],t)}_.assign(i,{validation:d.validation,tenantIdDomainHelpText:p,maxStorageLimitPerDevice:(h=Number.MAX_SAFE_INTEGER||9007199254740991,Math.round(h/1024/1024)),passwordStrengthUser:{},cancel:function(){r.path("tenants")},save:function(t,n){i.isNew&&i.host&&(t.domain=t.id+i.host);var e=_.cloneDeep(t);i.storageLimitation.storageLimitPerDeviceEnabled?e.storageLimitPerDevice=1024*e.storageLimitPerDevice*1024:e.storageLimitPerDevice=0;P(!0),a.save(e).then(function(t){var e=t.data;return function(t,e){i.isNew&&r.path("/tenants/".concat(t.id));_.assign(i.tenant,t),s.success(l("Tenant saved.")),e.$setPristine()}(e,n)}).finally(function(){P(!1)})},shouldShowSubtenantCheckbox:function(){var t=i.tenant&&a.isParentTopTenant(i.tenant);return m&&(t||i.isNew)},storageLimitation:{storageLimitPerDeviceEnabled:!1,storageLimitFeatureEnabled:n.appOption("storageLimitationFeatureEnabled")},humanize:n.humanizeFragment,saveInProgress:!1,changePasswordConfirm:function(){var t=i.tenantForm,e=t.confirmPassword,n=t.adminPass;if(e){var r=e.$modelValue,a=n.$modelValue;e.$setValidity("password-mismatch",r===a)}},changePassword:!1,resetPassword:function(){i.changePassword=!i.changePassword,i.changePassword||(i.tenant.adminPass=null)},shouldDisplayConfirmPassword:function(){return!_.isEmpty(i.tenant.adminPass)}}),i.$watchGroup(["passwordStrengthEnforced","passwordStrengthUser.passwordStrength"],function(t){var e=_slicedToArray(t,2),n=e[0],r=e[1];i.tenantForm&&i.tenantForm.adminPass&&i.tenantForm.adminPass.$setValidity("password-strength",!n||"GREEN"===r)}),a.current().then(function(t){var e=t.domainName;return".".concat(e.split(".").slice(1).join("."))}).then(function(t){i.host=t}),a.isCurrentUserTopTenant().then(function(t){m=t}),g&&"new"!==g?a.detail(g).then(function(t){return t.data}).then(v):(v({sendPasswordResetEmail:i.isNew=!0}),o.changeTitle({title:l("New tenant")}),y=!(f="c8yTenantPolicies"),e.has(f)&&(y=!0,e.get(f).list().then(T)),i.selectTenantPolicy=y),c.checkIfStrongPasswordRequired().then(w),a.isEnterpriseEditionTenant().then(function(t){i.isEnterpriseEditionTenant=t})}t.$inject=["$scope","$location","$routeParams","$injector","c8yTenant","c8yBase","c8yTitle","c8yAlert","c8yTenantOptions","gettext","gettextCatalog","c8yConfig"],angular.module("c8y.tenants").controller("tenantDetailCtrl",t)}();