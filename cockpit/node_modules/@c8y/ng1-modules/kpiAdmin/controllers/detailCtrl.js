"use strict";!function(){function e(t,i,e,n,a,l,r,s,o,u){var d,E,c,m,A={IS_REQUIRED:"required",PATTERN:"pattern",SHOULD_CONTAIN_NUMBER:"number",SHOULD_BE_DEFINED:"should-be-defined",GREATER_THAN_SCALE_MAX:"greater-than-scale-max",LESS_THAN_SCALE_MIN:"less-than-scale-min",GREATER_THAN_RANGE_MAX:"greater-than-range-max",LESS_THAN_RANGE_MIN:"less-than-range-min"},N={};function f(e){d=e,t.kpiMO=d,(E=d.c8y_Kpi).orientation="horizontal",t.config=E,function(){var e=d.c8y_Kpi,i=u.getString("New data point");r.changeTitle({title:d.id?e.label:i,subtitle:e.fragment&&e.series?"".concat(e.fragment," / ").concat(e.series):""})}()}function R(){var e=i.history;1<e.length?e.back():n.path("/kpi")}function T(e,i,n,t){var a=e.$modelValue,l=i.$modelValue,r=[n,t];!_.isUndefined(a)&&null!==a&&!_.isUndefined(l)&&null!==l&&_.forEach(r,function(e){var i=e.$modelValue;!_.isUndefined(i)&&null!==i&&(e.$setValidity(A.GREATER_THAN_SCALE_MAX,i<=l),e.$setValidity(A.LESS_THAN_SCALE_MIN,a<=i))})}N[A.IS_REQUIRED]=o("This field is required."),N[A.PATTERN]=o("Dots not allowed."),N[A.SHOULD_CONTAIN_NUMBER]=o("This field must contain a number."),N[A.SHOULD_BE_DEFINED]=o("Value must be defined."),N[A.GREATER_THAN_SCALE_MAX]=o("Value must be less than scale maximum."),N[A.LESS_THAN_SCALE_MIN]=o("Value must be greater than scale minimum."),N[A.GREATER_THAN_RANGE_MAX]=o("Value must be less than respective maximum."),N[A.LESS_THAN_RANGE_MIN]=o("Value must be greater than respective minimum."),_.assign(t,{PATTERN_VALIDATE_FRAGMENT_SERIES:"^[^.]*$",save:function(){l.save(d).then(R)},cancel:R,invalidTxt:function(e){var i=t.editKpi[e];return _.filter(_.map(i&&i.$error,function(e,i){return e&&N[i]}),_.identity).join(" ")},invalid:function(e){var i=t.editKpi[e];return i&&i.$invalid&&i.$dirty},formValid:function(){var n=t.editKpi;return _.forEach([[n.min,n.max],[n.yellowRangeMin,n.yellowRangeMax],[n.redRangeMin,n.redRangeMax]],function(e,i){(function(e,i){var n=e.$modelValue,t=i.$modelValue,a=!_.isUndefined(n)&&null!==n,l=!_.isUndefined(t)&&null!==t;e.$setValidity(A.SHOULD_BE_DEFINED,!(l&&!a)),i.$setValidity(A.SHOULD_BE_DEFINED,!(a&&!l))}).apply(this,e),function(e,i){var n=e.$modelValue,t=i.$modelValue,a=!_.isUndefined(n)&&null!==n,l=!_.isUndefined(t)&&null!==t,r=a&&l;e.$setValidity(A.GREATER_THAN_RANGE_MAX,!r||n<t),i.$setValidity(A.LESS_THAN_RANGE_MIN,!r||n<t)}.apply(this,e),i&&_.partial(T,n.min,n.max).apply(this,e)}),n.$valid}}),(m=e.kpiId)?l.detail(m).then(a.getResData).then(f):(c=u.getString("New data point"),f({c8y_Kpi:{label:e.fragment&&e.series?a.humanizeFragment("".concat(e.fragment," => ").concat(e.series)):c,fragment:e.fragment,series:e.series,color:s.generateColor()}}))}e.$inject=["$scope","$window","$routeParams","$location","c8yBase","c8yKpi","c8yTitle","c8yUiUtil","gettext","gettextCatalog"],angular.module("c8y.parts.kpiAdmin").controller("KpiDetailCtrl",e)}();