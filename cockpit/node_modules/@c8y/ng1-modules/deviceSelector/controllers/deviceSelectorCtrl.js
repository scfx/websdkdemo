"use strict";!function(){function e(t,n,i,e){var a=5,s=a;function c(){r(null,a)}function r(e,n){t.searchDone=!1,t.searchProgress=!0,t.devices.length=0,s=a;var c=e?e.text:"";(c?i.searchIncludingChildDevices({text:c,pageSize:n}):i.list({pageSize:n})).then(o).then(l).finally(function(){t.searchDone=!0,t.searchProgress=!1})}function l(e){return t.paging.next&&e.length<s?t.paging.next().then(o).then(l):n.when()}function o(e){var n=_.uniqBy((t.selectedDevices||[]).concat(t.devices||[]).concat(e),"id");t.devices=n;var c=!!t.paging&&t.paging.loading;return t.paging=e.paging,t.paging.loading=c,n}function g(){t.selectedDevices.splice(0,t.selectedDevices.length)}t.devices=[],t.selectedDevices=[];t.placeholder=e("Device's name or value of any device's property"),t.search=r,t.loadNext=function(){s+=a,t.paging.loading=!0,t.paging.next().then(o).then(l).finally(function(){t.paging.loading=!1})},t.clearSearch=function(){t.devices.length=0,t.selectedDevices.length=0,t.searchDone=!1,t.searchProgress=!1,t.searchData=t.searchData||{},t.searchData.text="",c()},t.selectAll=function n(e,c){c||g(),_.forEach(e,function(e){(function(n){return _.find(t.disabledDevices,function(e){return e.id===n.id})})(e)||t.selectedDevices.push(e),n(e.children,!0)})},t.deselectAll=g,t.checkEnter=function(e){13===e.keyCode&&r(t.searchData)},c()}e.$inject=["$scope","$q","c8yDevices","gettext"],angular.module("c8y.deviceSelector").controller("deviceSelectorCtrl",e)}();