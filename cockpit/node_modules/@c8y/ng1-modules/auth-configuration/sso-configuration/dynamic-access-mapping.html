<div class="card">
  <div class="card-block overflow-visible">
    <div class="legend form-block m-t-4" translate>When</div>
    <div class="tight-grid hidden-sm hidden-xs">
      <div class="col-md-4">
        <label translate>Key</label>
      </div>
      <div class="col-md-2">
        <label translate>Operator`logical`</label>
      </div>
      <div class="col-md-4">
        <label translate>Value</label>
      </div>
    </div>
    <div class="tight-grid" ng-repeat="childPredicate in vm.accessMapping.when.childPredicates">
      <ng-form name="childPredicateForm">
        <div class="col-md-4">
          <div class="form-group">
            <label class="visible-sm visible-xs" translate>Key</label>
            <input
              name="key"
              type="text"
              class="form-control"
              ng-model="childPredicate.parameterPath"
              placeholder="{{ 'Key' | translate }}"
              required
            />
            <c8y-error-feedback field="childPredicateForm.key"> </c8y-error-feedback>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label class="visible-sm visible-xs" translate>Operator`logical`</label>
            <div class="c8y-select-wrapper">
              <select
                class="form-control"
                ng-model="childPredicate.operator"
                ng-options="relation.value as (relation.label | translate) for relation in vm.relations.values() | orderBy:'label'"
              ></select>
              <span></span>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label class="visible-sm visible-xs" translate>Value</label>
            <input
              name="value"
              type="text"
              class="form-control"
              ng-model="childPredicate.value"
              placeholder="{{ 'Value' | translate }}"
              required
            />
            <c8y-error-feedback field="childPredicateForm.value"> </c8y-error-feedback>
          </div>
        </div>
        <div class="col-md-1">
          <div class="form-group">
            <button
              class="btn btn-link hidden-xs hidden-sm"
              ng-click="vm.removeChildPredicate(childPredicate);  childPredicateForm.$setDirty()"
              uib-tooltip="{{ 'Remove' | translate }}"
              type="button"
            >
              <i c8y-icon="minus-circle" class="text-danger"></i>
            </button>
            <button
              class="btn btn-danger btn-block btn-sm visible-xs visible-sm"
              ng-click="vm.removeChildPredicate(childPredicate);  childPredicateForm.$setDirty()"
              uib-tooltip="{{ 'Remove' | translate }}"
              type="button"
            >
              <i c8y-icon="minus-circle"></i>
              <span translate>Remove</span>
            </button>
          </div>
        </div>
        <div class="col-md-1">
          <div class="form-group" ng-show="$last">
            <button
              title="{{ 'and' | translate }}"
              class="btn btn-default btn-xs hidden-xs hidden-sm"
              ng-click="vm.addChildPredicate();  childPredicateForm.$setDirty()"
              type="button"
              translate
            >
              and
            </button>
            <button
              title="{{ 'and' | translate }}"
              class="btn btn-default btn-block btn-sm visible-xs visible-sm"
              ng-click="vm.addChildPredicate();  childPredicateForm.$setDirty()"
              type="button"
              translate
            >
              and
            </button>
          </div>
        </div>
      </ng-form>
    </div>

    <div class="legend form-block" translate>Provide access to</div>
    <div class="row">
      <ng-form name="dynamicAccessForm">
        <div class="col-sm-6">
          <div title="{{ 'Default global roles' | translate }}" class="form-group">
            <label class="control-label">
              {{ 'Default global roles' | translate }}
            </label>
            <c8y-item-selector
              items="vm.groups"
              items-selected="vm.accessMapping.thenGroups"
              on-apply="vm.selectItems('thenGroups', items); dynamicAccessForm.$setDirty()"
              text-apply="{{ 'Apply' | translate }}"
              style-button="{'max-width': 'initial'}"
            >
            </c8y-item-selector>
          </div>
        </div>
        <div class="col-sm-6">
          <div title="{{ 'Default applications' | translate }}" class="form-group">
            <label class="control-label">
              {{ 'Default applications' | translate }}
            </label>
            <c8y-item-selector
              items="vm.apps"
              items-selected="vm.accessMapping.thenApplications"
              on-apply="vm.selectItems('thenApplications', items); dynamicAccessForm.$setDirty()"
              text-apply="{{ 'Apply' | translate }}"
              style-button="{'max-width': 'initial'}"
            >
            </c8y-item-selector>
          </div>
        </div>
      </ng-form>
    </div>
  </div>
</div>
