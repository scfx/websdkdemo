"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,a,o=[],i=!0,l=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==t.return||t.return()}finally{if(l)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){function e(e,r,t,n,a,o,i,l){var u=a.url("service/smartrule/smartrules/configurations"),c=e("smartRuleTemplates"),s="list";return 0<_.get(window,"c8y.collections.smartrules",[]).length&&t.warn("In-memory definitions of smart rules are not supported right now."),{list:f,getTemplateForRule:function(r){return f().then(function(e){return _.find(e,{name:r.ruleTemplateName})})},getTemplateByName:function(r){return f().then(function(e){return _.find(e,{name:r})}).then(y)},mustBeAvailable:function(e){return h(e).then(function(e){return e?n.when():n.reject()})},isAvailable:h};function f(){var e=c.get(s);return e?n.when(e):r.get(u).then(a.getResData).then(function(e){return _.filter(e,function(e){return!_.includes(i.smartRules.exclude,e.name)})}).then(m).then(function(e){return c.put(s,e),e})}function m(e){var r=[];return e.forEach(function(e){r.push(y(e))}),n.all(r)}function y(r){return h(r.name).then(function(e){return r._active=e,n.when(r)})}function h(e){switch(e){case"sendDashboardsViaEmail":return n.all({systemOption:o.getSystemOptionValue({category:"reportMailer",key:"available"},!1),featureActive:l.isAvailable({name:"feature-dashboard-mailer"})}).then(_.every);case"onAlarmSendSms":return n.all([l.isAvailable({contextPath:"messaging"}),o.detailValue({category:"messaging",key:"provider"})]).then(function(e){var r=_slicedToArray(e,2),t=r[0],n=r[1];return Boolean(t&&n)});case"onAlarmEscalateAlarm":return h("onAlarmSendSms");default:return n.when(!0)}}}e.$inject=["$cacheFactory","$http","$log","$q","c8yBase","c8ySettings","c8yConfig","c8yApplication"],angular.module("c8y.smartRules").factory("smartRuleTemplatesSvc",e)}();