"use strict";!function(){function e(a){var o=this,i="selected";function n(e,t){return _.get(o.reference,[e,t],"--")}function r(e,t){return _.get(o.context,[e,t],"--")}function c(e,t){return r(e,t)===n(e,t)}function s(e){var t=o.reference,i=e.key,n=_.get(e.schema,"c8y_JsonSchema"),r=_.reduce(n.properties,function(e,t,n){var r=!_.isUndefined(_.get(o.reference,[i,n]));if(!function(e){var t=!0;if("operations"!==e.type){if(t=function(e){return _.keys(e).map(function(e){return e.toLowerCase()}).includes("readonly")}(e)){var n=_.map(e.operations,"name").map(function(e){return e.toLowerCase()});t=!_.includes(n,"write")}}return t}(t)&&r){var c=_.clone(t);c.key=n,c.schemaMatchKey=i,e[n]=c}return e},{});if(!Object.keys(r).length)return null;var c=n.titleDisplay?a.replaceObjectPlaceholders(n.titleDisplay,t,e.key):n.title;return _.assign({title:c,properties:r,closed:!0},e)}function e(e){var t=e.properties;return!o.hideSynced||_.some(t,u)}function u(e){var t=e.schemaMatchKey,n=e.key;return!o.hideSynced||!c(t,n)}function l(){var r=[],e=o.schemaMatches;return _.forEach(e,function(t){var n=!0;_.forEach(t.properties,function(e){c(t.key,e.key)||(n&&(n=!1),r.push(e))}),n||r.push(t)}),r}function f(){var e=l(),t=!1;if(e.length){var n=_.every(e,i),r=_.filter(e,i),c=_.difference(e,r);o.onSelect({allSelected:n,selected:r,notSelected:c})}else t=!0;o.disableSelectAll({disabled:t})}function h(e){return _.filter(e.properties,function(e){return c(e.schemaMatchKey,e.key)}).length}_.assign(o,{$onChanges:function(e){(e.reference||e.schemas)&&o.reference&&o.schemas&&function(){var e=a.matchObjectWithSchemas(o.reference,o.schemas);o.schemaMatches=_.sortBy(_.filter(e.map(s)),"title");var t=o.schemaMatches;o.onSchemaMatch({matches:t}),f()}();e.selectAll&&function(t){var e=l();if(!1===t&&_.some(e,function(e){return!e[i]}))return;l().forEach(function(e){return _.set(e,i,t)}),f()}(o.selectAll)},getValueReference:n,getValueContext:r,valuesMatch:c,allValuesMatch:function(t){return _.every(t.properties,function(e){return c(t.key,e.key)})},fragmentExistsInContext:function(e){return!!_.get(o.context,e)},isPropertyVisible:u,isSchemaMatchVisible:e,countSyncedProperties:h,countUnsyncedProperties:function(e){var t=e.properties;return Object.keys(t).length-h(e)},updateSelectAll:f,onSelectChangeMatchSchema:function(e){var t=e[i],n=_.filter(e.properties,function(e){return!c(e.schemaMatchKey,e.key)});_.forEach(n,function(e){return _.set(e,i,t)}),f()},onSelectChangeProperty:function(e){var t=e.schemaMatchKey,n=_.find(o.schemaMatches,function(e){return e.key===t}),r=_.filter(n.properties,function(e){return!c(e.schemaMatchKey,e.key)});n[i]=_.every(r,i),f()},allSynced:function(){return o.matches&&_.every(o.matches,e)},SELECTED:i})}e.$inject=["c8yGenericUi"],angular.module("c8y.configAudit").component("c8yConfigAuditDiff",{templateUrl:":::PLUGIN_PATH:::/config-audit/config-audit-diff.html",controllerAs:"vm",controller:e,bindings:{context:"<",schemas:"<",reference:"<",onSchemaMatch:"&",hideSynced:"<",disableSelectAll:"&",selectAll:"<",onSelect:"&"}})}();