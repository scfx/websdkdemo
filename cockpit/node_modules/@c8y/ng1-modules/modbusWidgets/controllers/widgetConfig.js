"use strict";!function(){function e(t,e,s,n,c,u,r){var i=e.deviceId;function o(i){u.getDeviceTypeFromDevice(i).then(function(e){i.c8y_ModbusDevice&&function(e){t.discreteIOs=[],t.discreteInputs=[],t.discreteOutputs=[],e&&e.c8y_Coils&&_.forEach(e.c8y_Coils,function(e){e.statusMapping&&e.statusMapping.status&&(_.assign(e,{selected:function(e){return r.isDiscreteIOSelectedInConfig(e,t.config)}(e)}),t.discreteIOs.push(e),e.input?t.discreteInputs.push(e):t.discreteOutputs.push(e))})}(e),function(e){t.registers=[],t.inputRegisters=[],t.holdingRegisters=[],e&&e.c8y_Registers&&_.forEach(e.c8y_Registers,function(e){e.statusMapping&&e.statusMapping.status&&(_.assign(e,{selected:function(e){return r.isRegisterSelectedInConfig(e,t.config)}(e)}),t.registers.push(e),e.input?t.inputRegisters.push(e):t.holdingRegisters.push(e))})}(e),t.showOnlyHoldingRegisters=!i.c8y_ModbusDevice,t.isOPCUADevice=i.c8y_OPCUADevice||i.c8y_OPCUAGateway,g()})}function g(){var e=t.config.coils&&t.config.registers&&0<t.config.coils.length+t.config.registers.length;t.forms.componentForm.fieldsControl.$setValidity("fields_selected",e)}t.deviceId=i,t.updateFields=function(){t.config.coils=_(t.discreteIOs).filter({selected:!0}).map(function(e){return e.id||[e.input,e.number].join(",")}).value(),t.config.registers=_(t.registers).filter({selected:!0}).map(function(e){return e.id||[e.input,e.number,e.startBit].join(",")}).value(),g()},t.$watch("config.device",function(e){e&&function(e){var i=e.id||e;return u.isFieldbusDevice(e)?s.when(e):c.detail(i).then(n.getResData)}(e).then(o)})}e.$inject=["$scope","$routeParams","$q","c8yBase","c8yDevices","c8yDeviceDatabase","modbusWidgetSvc"],angular.module("c8y.modbusWidgets").controller("modbusWidgetConfigCtrl",e)}();