"use strict";!function(){function e(s,t,n,i,o,a,r,c){var u=this,g={icons:{OPERATING:{icon:"check-circle",class:"statusOk"},SUSPENDED:{icon:"exclamation-circle",class:"statusNok"},MAINTENANCE:{icon:"wrench",class:"statusAlert"}}},l={SIM_STATUS:[function(){return i.getStatuses().then(function(e){_.set(u,"statusMap.statuses",function(e){return _.map(e,function(e){return{status:e.status,readOnly:e.readOnly,text:t("humanize")(e.status).replace("NAME","").trim()}})}(e.statuses))})}],SESSION:[function(){return i.getTerminalDetails(s.deviceId).then(p).then(D).then(I)}],SMS_USAGE:[function(){"ericsson"!==u.provider&&(i.getTerminalSmsUsage(s.deviceId,{},f).then(E),i.getTerminalSmsUsage(s.deviceId,{},h).then(V))}],DATA_USAGE:[function(){"ericsson"===u.provider?a.getTerminalUsage(s.deviceId,!1).then(F):(i.getTerminalDataUsage(s.deviceId,{},f).then(N),(_.get(u,"commonData.currentMonthDataUsage")||i.getTerminalDataUsage(s.deviceId,{},h)).then(O))}],VOICE_USAGE:[function(){"ericsson"!==u.provider&&(i.getTerminalVoiceUsage(s.deviceId,{},f).then(L),i.getTerminalVoiceUsage(s.deviceId,{},f).then(w))}]},e=["currentMonthSmsUsage","currentDaySmsUsage"],d=["currentMonthDataUsage","currentDayDataUsage"],U=["currentMonthVoiceUsage","currentDayVoiceUsage"],h=a.getThisMonth(),f=a.getLastMonth();function S(e){return u.supportedFunctionalities=e,u.supportedFunctionalities}function m(e){i.getTerminalUsage(s.deviceId,{},h).then(R),_.forEach(e,function(e,t){var s=_.get(l,t);s&&_.forEach(s,function(e){return e()})})}function T(){return a.isAdmin().then(v)}function v(e){return u.isAdmin=e,n.resolve(u.isAdmin)}function p(e){var t=e.inSession?r("Yes"):r("No");return u.session=_.assign(u.session,e,{inSession:t,fixedIpAddress:e.fixedIpAddress||"-"}),u.currentStatus=_.get(e,"status.value"),u.session}function A(){var e=_.find(g.statuses,function(e){return e.status===u.session.status});u.currentStatus=e.status}function D(){u.statusIcon=_.get(u.statusMap,"icons[".concat(_.get(u,"session.status.activity"),"].icon"))}function I(){u.statusClass=_.get(u.statusMap,"icons[".concat(_.get(u,"session.status.activity"),"].class"))}function E(e){return u.session=_.assign(u.session,{lastMonthSmsUsage:e.billings?e.billings.length:0}),u.session}function M(){return"ericsson"===u.provider?a.getTodaysUsageTooltip():"comarch"===u.provider?a.getUsageTooltip(h):a.getUsageTooltip(h,f,_.get(u,"session.lastMonthSmsUsage"))}function V(e){return u.session=_.assign(u.session,{currentMonthSmsUsage:e.billings?e.billings.length:0}),u.session}function y(){return!_.isUndefined(C())}function C(){return H(u.session,e)}function N(e){var t=a.processUsageData(e.billings,"volume");return u.session=_.assign(u.session,{lastMonthDataUsage:t}),u.session}function R(e){return u.session=_.assign(u.session,{currentMonthDataUsage:_.toString(e.dataUsage),currentMonthSmsUsage:_.toString(e.smsUsage),currentMonthVoiceUsage:_.toString(e.voiceUsage||0)}),u.session}function b(){return!_.isUndefined(P())}function P(){return H(u.session,d)}function O(e){var t=a.processUsageData(e.billings,"volume");return u.session=_.assign(u.session,{currentMonthDataUsage:t}),u.session}function F(e){return u.session=_.assign(u.session,{currentDayDataUsage:_.toString(e.dataUsage),currentDaySmsUsage:_.toString(e.smsUsage),currentDayVoiceUsage:_.toString(e.voiceUsage||0)}),u.session}function x(){return"ericsson"===u.provider?a.getTodaysUsageTooltip():"comarch"===u.provider?a.getUsageTooltip(h):a.getUsageTooltip(h,f,_.get(u,"session.lastMonthDataUsage"))}function L(e){var t=a.processUsageData(e.billings,"duration");return u.session=_.assign(u.session,{lastMonthVoiceUsage:t}),u.session}function G(){return"ericsson"===u.provider?a.getTodaysUsageTooltip():"comarch"===u.provider?a.getUsageTooltip(h):a.getUsageTooltip(h,f,_.get(u,"session.lastMonthVoiceUsage"))}function Y(){return!_.isUndefined($())}function $(){return H(u.session,U)}function w(e){var t=a.processUsageData(e.billings,"duration");return u.session=_.assign(u.session,{currentMonthVoiceUsage:t}),u.session}function j(e){return i.setTerminalSimStatusV2(s.deviceId,{status:e}).then(function(e){u.currentStatus=e.status}).then(u.onReload).then(k)}function k(){var e=r("SIM status changed.");return o.success(e)}function H(e,t){return _(e).at(t).reject(_.isUndefined).first()}function q(){r("ACTIVATED"),r("ACTIVATION READY"),r("DEACTIVATED"),r("INVENTORY"),r("PURGED"),r("REPLACED"),r("RETIRED"),r("TEST READY"),r("TRIAL"),r("ACTIVATE"),r("DEACTIVATE"),r("PAUSE"),r("TERMINATE"),r("REACTIVATE"),r("Ordered"),r("SIM Allocated"),r("SIM Ordered"),r("Activated In HLR"),r("Active"),r("Deactivated"),r("Pause"),r("Terminated"),r("Closed"),r("APN"),r("LAST ACTIVITY"),r("MSISDN")}_.assign(u,{$onInit:function(){_.assign(u,{setStatus:A,statusMap:g,getLastMonthSmsUsageTooltip:M,getDataUsageTooltip:x,getVoiceUsageTooltip:G,setSimStatus:j,annotateStringsForTranslation:q,shouldShowSmsUsage:y,shouldShowDataUsage:b,shouldShowVoiceUsage:Y,getSmsUsageValue:C,getDataUsageValue:P,getVoiceUsageValue:$})},$onChanges:function(e){_.get(e,"available.currentValue")&&(T(),a.getProviderSupportedFunctionalities(u.provider).then(S).then(m))},supportedFunctionalities:{},disconnectSimFromSession:function(){var e=r("Disconnected SIM card from the session"),t=r("Failed to disconnect SIM card from the session.");T().then(function(e){var t=n.resolve();return!1===e&&(t=n.reject(c.getString("You don't have permission to execute this operation."))),t}).then(function(){return i.disconnectSimFromSession(s.deviceId,{},{silentError:!0})}).then(u.onReload).then(function(){return function(e){return o.success(e)}(e)}).catch(function(e){return function(e,t){return o.danger(e,t)}(t,e)})}})}e.$inject=["$routeParams","$filter","$q","c8yConnectivity","c8yAlert","connectivityService","gettext","gettextCatalog"],angular.module("c8y.connectivityV2").component("c8yConnectivityStatus",{controller:e,controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/status.html",bindings:{available:"<",onReload:"&",commonData:"<?",provider:"<"}})}();