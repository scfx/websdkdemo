"use strict";!function(){function e(l,u,p,s,f){return{require:"ngModel",restrict:"EA",link:function(t,e,n,i){var a={},c=f.SHARED_CONTEXTS.COMPUTED_PROPERTY_LAST_MEASUREMENT.value;function r(e){return _.find(t.devices,{id:e})}function o(){i.$setViewValue(_.cloneDeep(t.mappings))}function d(e){var n=t.deviceIds,i=t.devices,c=n[e.placeholder];c&&_.find(i,{id:c})||(n[e.placeholder]=(_.head(i)||{}).id)}i.$parsers.push(function(e){var n={};return _.each(e,function(e){n[e.placeholder]=e.config}),n}),i.$validators["c8y-scada-mapping"]=function(e){var c=!1;return _.forEach(e,function(e,n){var i=!_.isNull(e);a[n]=!i,c=c||!i}),!c},i.$overrideModelOptions({allowInvalid:!0}),i.$formatters.push(function(e){return _.map(e,function(e,n){return{placeholder:n,config:e}})}),i.$render=function(){t.mappings=i.$viewValue},_.assign(t,{hasError:a,clearMapping:function(e){e.config=null,o()},setMapping:function(n){f.set(c,r(t.deviceIds[n.placeholder])),(e=n,l.openSelector({selectSingle:!0,managedObject:r(t.deviceIds[e.placeholder])})).then(function(e){n.config=e}).then(o).finally(function(){f.clear(c)});var e},editComputedProperty:function(n){f.set(c,r(t.deviceIds[n.placeholder])),u.edit(n.config).then(function(e){n.config.config=e}).then(o).finally(function(){f.clear(c)})},setFieldbusMapping:function(n){s.openFieldbusSelector({device:r(t.deviceIds[n.placeholder])}).then(function(e){n.config=e}).then(o)},propertyValueFor:function(e){var n=r(t.deviceIds[e.placeholder]);return p.getValueForMapping(n,e.config)},humanizeValue:function(e){return p.humanizeMapping(e.config)}}),t.$watch("devices",function(e){e&&_.forEach(t.mappings,d)},!0)},templateUrl:":::PLUGIN_PATH:::/views/mapping.html",scope:{device:"=",devices:"=",deviceIds:"=",onDeviceIdsChange:"&"}}}e.$inject=["SchemaPropertiesSvc","c8yComputedProperties","ScadaWidgetUtilSvc","c8yDeviceDatabase","contextDetailsSharedService"],angular.module("c8y.parts.scadaWidget").directive("c8yScadaMapping",e)}();