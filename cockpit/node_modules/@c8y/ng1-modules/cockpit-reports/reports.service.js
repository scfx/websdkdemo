"use strict";!function(){t.$inject=["$q","$uibModal","c8yBase","c8yInventory","c8yNavigator","dashboardSvc","gettext"],angular.module("c8y.cockpit.reports").factory("c8yReports",t);var g="c8y_Report",y={fragmentType:g,pageSize:1e3},R="reports/";function t(n,r,a,o,i,e,u){function t(){return o.list(y)}function c(){var t=i.findNode(d);t&&t.update({sortAlphabetically:!0})}function d(t){return"Reports"===t.name}function f(t){i.addNavigation(_.map(t,p))}function p(t){return{report_id:t.id,path:R+t.id,name:t.name,icon:t.icon,parent:{name:u("Reports")}}}function s(e){return function(t){return t.report_id===e.id}}function l(t){return e.named(h(t)).then(e.remove)}function m(t){return o.remove(t)}function v(t){var e={templateUrl:":::PLUGIN_PATH:::/views/edit.html",controller:"ReportDetailCtrl",resolve:{report:function(){return t?o.detail(t).then(a.getResData):{}}}};return r.open(e).result}function h(t){if(!t)throw new Error("Must define a report");return"report_".concat(t.id||t)}return{initialize:function(){return t().then(f).then(c)},save:function(t){!function(t){t[g]||(t[g]={})}(t);var e=o[t.id?"save":"createConfirm"](t);return t.id?i.findNode(s(t)).update(t):e.then(a.getResData).then(function(t){i.addNavigation(p(t))}),e},list:t,remove:function(t){return function(t){var e=i.findNode(s(t));return n.when(i.removeNavigation(e))}(t).then(_.partial(l,t)).then(_.partial(m,t))},detail:o.detail,createUI:v,editUI:v,isReport:function(t){return!!t[g]},dashboardName:h,getReportFromDashboard:function(t){var e=_(t).keys().map(function(t){return _.get(t.match(/^c8y_Dashboard!name!report_(\d+)/),1)}).compact().first();return o.detail(e).then(a.getResData)}}}}();