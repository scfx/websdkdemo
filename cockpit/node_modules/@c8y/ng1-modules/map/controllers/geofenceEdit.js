"use strict";!function(){function e(e,n,t,l,a){var o,c=new l.Bounds,r=[],g={type:"polygon",stroke:!0,weight:1,color:"#2e3974",fillColor:"#2e3974",latlngs:[]},i={center:{},events:{},defaults:{doubleClickZoom:!1},bounds:c.get(),markers:r,paths:{geofencePath:g}};function s(e){e&&(i.center=_.assign(i.center,{lat:Number(e.lat),lng:Number(e.lon),zoom:17}))}function u(){0<g.latlngs.length&&(c.reset(),_.forEach(g.latlngs,function(e){c.add(e)}),i.bounds=c.get())}function d(){g.latlngs.length=0,r.length=0}function f(e,n){switch(e.name){case"leafletDirectiveMarker.dragstart":o={lat:n.model.lat,lng:n.model.lng,draggable:!0};break;case"leafletDirectiveMarker.dragend":g.latlngs[_.findIndex(g.latlngs,o)]={lat:n.model.lat,lng:n.model.lng,draggable:!0}}}e.gotoAddress=function(e){l.geoCode(e).then(function(e){return e.data[0]||null}).then(s)},e.centerMap=u,e.clearGeofence=d,e.chooseGeofence=function(){n.close(function(e){return _.map(e,function(e){return{lat:e.lat,lng:e.lng}})}(g.latlngs))},e.cancel=n.dismiss,e.map=i,e.$on("leafletDirectiveMap.click",function(e,n){var t={lat:n.leafletEvent.latlng.lat,lng:n.leafletEvent.latlng.lng,draggable:!0,icon:{type:"div",className:"normal-marker-icon",iconSize:[25,41],iconAnchor:[12.5,41]}};i.markers.push(t),g.latlngs.push(t),1===g.latlngs.length&&(i.paths={geofencePath:g})}),e.$on("leafletDirectiveMarker.dragend",f),e.$on("leafletDirectiveMarker.dragstart",f),d(),_.forEach(a,function(e){e.draggable=!0,e.icon={type:"div",className:"normal-marker-icon",iconSize:[25,41],iconAnchor:[12.5,41]},r.push(e),g.latlngs.push(e)}),0<g.latlngs.length?i.paths={geofencePath:g}:i.paths={},t(u,0)}e.$inject=["$scope","$uibModalInstance","$timeout","c8yGeo","geofenceLatLngs"],angular.module("c8y.cockpit.map").controller("GeofenceEditCtrl",e)}();