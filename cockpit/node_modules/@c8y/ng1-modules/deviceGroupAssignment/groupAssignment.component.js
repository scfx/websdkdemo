"use strict";!function(){function e(e,n,t,r,o,i,u,c,s,a,d,p,l,g){var f,h=this,m="c8y_DeviceGroup",v="c8y_IsDeviceGroup";function y(){return o.directParentAssets(f,m,v,{withChildren:!1}).then(G)}function G(e){h.currentGroups=e,o.clearBreadcrumbsCache(f),i.$emit("update")}function A(){return y().then(function(){return u.success(a("Device added to group"))})}_.assign(h,{group:{},$onInit:function(){if(!_.get(h.config,"device.id"))return;f=_.get(h.config,"device.id"),y(),d.hasAnyRole(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]).then(function(e){h.isCreateNewGroupAllowed=e})},addToGroup:function(e){return function(e){return function(e){return!_.isUndefined(e.newGroup)}(e)?function(e){return t({title:a("Create new group and assign device"),body:l.getString('You are about to create a new group "{{name}}" and assign the device to it. Do you want to proceed?',{name:e}),labels:{ok:a("Create and assign")},status:"warning",size:"sm"}).then(function(){return function(e){return p.create(e).then(c.getResData)}({name:e})}).then(function(e){return function(e){g.addGroupNavigation(e)}(e),e})}(e.name):n.resolve(e)}(e).then(function(e){return function(t){return o.detailCached(f).then(function(e){var n=e.data;return r.addChildAsset(t,n)})}(e)}).then(A)},removeFromGroup:function(t){return o.detailCached(f).then(function(e){var n=e.data;return s.unassignDevice(t,n)}).then(y).then(function(){return u.success(a("Device removed from group."))})},isCreateNewGroupAllowed:!1})}function n(t,e,n,r,o){var i=[];function u(e){return n.detail(e).then(function(e){var n=e.data;return r.getGroupItems(n).then(function(e){t.items=e,i.push(n)})})}t.title=o("Select group"),t.drillDown=u,t.upToGroup=function(e){for(;i[i.length-1]!==e;)i.pop();i.pop(),u(e.id)},t.select=e.close,t.dismiss=e.dismiss,t.isGroup=r.isGroup,r.getTopLevelGroups().then(function(e){t.items=e}),t.breadcrumbs=i,t.currentManagedObjectId=t.device.id}e.$inject=["$scope","$q","c8yModal","c8yInventory","c8yDevices","c8yBreadcrumbs","c8yAlert","c8yBase","groupsHierarchySvc","gettext","c8yPermissions","c8yDeviceGroup","gettextCatalog","groupTypesHierarchyNavigator"],n.$inject=["$scope","$uibModalInstance","c8yInventory","c8yGroups","gettext"],angular.module("c8y.deviceGroupAssignment").controller("GroupSelectModalCtrl",n).component("groupAssignment",{controller:e,controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/groupAssignment.component.html",bindings:{config:"<"}})}();