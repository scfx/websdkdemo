/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Pipe } from '@angular/core';
import { Observable, of as observableOf } from 'rxjs';
import { map } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
var FormlySelectOptionsPipe = /** @class */ (function () {
    function FormlySelectOptionsPipe() {
    }
    /**
     * @param {?} options
     * @param {?=} field
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.transform = /**
     * @param {?} options
     * @param {?=} field
     * @return {?}
     */
    function (options, field) {
        var _this = this;
        if (!(options instanceof Observable)) {
            options = observableOf(options);
        }
        return ((/** @type {?} */ (options))).pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return _this.toOptions(value, field || {}); })));
    };
    /**
     * @private
     * @param {?} options
     * @param {?} field
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.toOptions = /**
     * @private
     * @param {?} options
     * @param {?} field
     * @return {?}
     */
    function (options, field) {
        var _this = this;
        /** @type {?} */
        var gOptions = [];
        /** @type {?} */
        var groups = {};
        /** @type {?} */
        var to = field.templateOptions || {};
        to._flatOptions = true;
        options.map((/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            if (!_this.getGroupProp(option, to)) {
                gOptions.push(_this.toOption(option, to));
            }
            else {
                to._flatOptions = false;
                if (!groups[_this.getGroupProp(option, to)]) {
                    groups[_this.getGroupProp(option, to)] = [];
                    gOptions.push({
                        label: _this.getGroupProp(option, to),
                        group: groups[_this.getGroupProp(option, to)],
                    });
                }
                groups[_this.getGroupProp(option, to)].push(_this.toOption(option, to));
            }
        }));
        return gOptions;
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.toOption = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        return {
            label: this.getLabelProp(item, to),
            value: this.getValueProp(item, to),
            disabled: this.getDisabledProp(item, to) || false,
        };
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.getLabelProp = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        if (typeof to.labelProp === 'function') {
            return to.labelProp(item);
        }
        if (this.shouldUseLegacyOption(item, to)) {
            console.warn("NgxFormly: legacy select option '{key, value}' is deprecated since v5.5, use '{value, label}' instead.");
            return item.value;
        }
        return item[to.labelProp || 'label'];
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.getValueProp = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        if (typeof to.valueProp === 'function') {
            return to.valueProp(item);
        }
        if (this.shouldUseLegacyOption(item, to)) {
            return item.key;
        }
        return item[to.valueProp || 'value'];
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.getDisabledProp = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        if (typeof to.disabledProp === 'function') {
            return to.disabledProp(item);
        }
        return item[to.disabledProp || 'disabled'];
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.getGroupProp = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        if (typeof to.groupProp === 'function') {
            return to.groupProp(item);
        }
        return item[to.groupProp || 'group'];
    };
    /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    FormlySelectOptionsPipe.prototype.shouldUseLegacyOption = /**
     * @private
     * @param {?} item
     * @param {?} to
     * @return {?}
     */
    function (item, to) {
        return !to.valueProp
            && !to.labelProp
            && item != null
            && typeof item === 'object'
            && 'key' in item
            && 'value' in item;
    };
FormlySelectOptionsPipe.ɵfac = function FormlySelectOptionsPipe_Factory(t) { return new (t || FormlySelectOptionsPipe)(); };
FormlySelectOptionsPipe.ɵpipe = /*@__PURE__*/ ɵngcc0.ɵɵdefinePipe({ name: "formlySelectOptions", type: FormlySelectOptionsPipe, pure: true });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FormlySelectOptionsPipe, [{
        type: Pipe,
        args: [{ name: 'formlySelectOptions' }]
    }], function () { return []; }, null); })();
    return FormlySelectOptionsPipe;
}());
export { FormlySelectOptionsPipe };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LW9wdGlvbnMucGlwZS5qcyIsInNvdXJjZXMiOlsiQG5neC1mb3JtbHkvY29yZS9zZWxlY3Qvc2VsZWN0LW9wdGlvbnMucGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFFLElBQUksWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7QUFHckM7QUFDb0IsSUFEcEI7QUFBcUMsSUE2RnJDLENBQUM7QUFDRDtBQUFRO0FBQTBCO0FBQXlCO0FBQW1CO0FBQVEsSUE1RnBGLDJDQUFTO0FBQU87QUFBMEI7QUFDekI7QUFBbUI7QUFDcEMsSUFGQSxVQUFVLE9BQU8sRUFBRSxLQUF5QjtBQUM5QyxRQURFLGlCQVFDO0FBQ0gsUUFSSSxJQUFJLENBQUMsQ0FBQyxPQUFPLFlBQVksVUFBVSxDQUFDLEVBQUU7QUFDMUMsWUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RDLFNBQUs7QUFDTCxRQUNJLE9BQU8sQ0FBQyxtQkFBQSxPQUFPLEVBQW1CLENBQUMsQ0FBQyxJQUFJLENBQ3RDLEdBQUc7QUFBTTtBQUE0QjtBQUV4QztBQUVPLFFBSkEsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLEVBQWxDLENBQWtDLEVBQUMsQ0FDakQsQ0FBQztBQUNOLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBZ0I7QUFBMEI7QUFDakM7QUFDYjtBQUFRLElBRkYsMkNBQVM7QUFBTztBQUFnQjtBQUMvQjtBQUNSO0FBQW1CO0FBQVEsSUFGNUIsVUFBa0IsT0FBTyxFQUFFLEtBQXdCO0FBQ3JELFFBREUsaUJBdUJDO0FBQ0g7QUFDd0IsWUF4QmQsUUFBUSxHQUFVLEVBQUU7QUFDOUI7QUFBeUIsWUFBbkIsTUFBTSxHQUE2QixFQUFFO0FBQzNDO0FBQXlCLFlBQW5CLEVBQUUsR0FBRyxLQUFLLENBQUMsZUFBZSxJQUFJLEVBQUU7QUFDdEMsUUFDSSxFQUFFLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztBQUMzQixRQUFJLE9BQU8sQ0FBQyxHQUFHO0FBQU07QUFDTjtBQUF1QjtBQUNoQyxRQUZVLFVBQUMsTUFBVztBQUFJLFlBQzFCLElBQUksQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtBQUMxQyxnQkFBUSxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDakQsYUFBTztBQUFDLGlCQUFLO0FBQ2IsZ0JBQVEsRUFBRSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7QUFDaEMsZ0JBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFO0FBQ3BELG9CQUFVLE1BQU0sQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUNyRCxvQkFBVSxRQUFRLENBQUMsSUFBSSxDQUFDO0FBQ3hCLHdCQUFZLEtBQUssRUFBRSxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUM7QUFDaEQsd0JBQVksS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztBQUN4RCxxQkFBVyxDQUFDLENBQUM7QUFDYixpQkFBUztBQUNULGdCQUFRLE1BQU0sQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzlFLGFBQU87QUFDUCxRQUFJLENBQUMsRUFBQyxDQUFDO0FBQ1AsUUFDSSxPQUFPLFFBQVEsQ0FBQztBQUNwQixJQUFFLENBQUM7QUFFSDtBQUFRO0FBQWdCO0FBRXJCO0FBQXFCO0FBQ3ZCO0FBQVEsSUFIQywwQ0FBUTtBQUFPO0FBQ2Y7QUFDVTtBQUFxQjtBQUN2QjtBQUFRLElBSHhCLFVBQWlCLElBQUksRUFBRSxFQUFFO0FBQzNCLFFBQUksT0FBTztBQUNYLFlBQU0sS0FBSyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztBQUN4QyxZQUFNLEtBQUssRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7QUFDeEMsWUFBTSxRQUFRLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksS0FBSztBQUN2RCxTQUFLLENBQUM7QUFDTixJQUFFLENBQUM7QUFFSDtBQUFRO0FBQWdCO0FBQ3BCO0FBQXFCO0FBQW1CO0FBQ3RDLElBRkksOENBQVk7QUFBTztBQUMzQjtBQUF1QjtBQUN6QjtBQUFtQjtBQUFRLElBRnpCLFVBQXFCLElBQUksRUFBRSxFQUFFO0FBQUksUUFDL0IsSUFBSSxPQUFPLEVBQUUsQ0FBQyxTQUFTLEtBQUssVUFBVSxFQUFFO0FBQzVDLFlBQU0sT0FBTyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2hDLFNBQUs7QUFDTCxRQUNJLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRTtBQUM5QyxZQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsd0dBQXdHLENBQUMsQ0FBQztBQUM3SCxZQUFNLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztBQUN4QixTQUFLO0FBQ0wsUUFDSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxDQUFDO0FBQ3pDLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBZ0I7QUFDcEI7QUFBcUI7QUFBbUI7QUFDdEMsSUFGSSw4Q0FBWTtBQUFPO0FBQzNCO0FBQXVCO0FBQ3pCO0FBQW1CO0FBQVEsSUFGekIsVUFBcUIsSUFBSSxFQUFFLEVBQUU7QUFBSSxRQUMvQixJQUFJLE9BQU8sRUFBRSxDQUFDLFNBQVMsS0FBSyxVQUFVLEVBQUU7QUFDNUMsWUFBTSxPQUFPLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEMsU0FBSztBQUNMLFFBQ0ksSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxFQUFFO0FBQzlDLFlBQU0sT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO0FBQ3RCLFNBQUs7QUFDTCxRQUNJLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLENBQUM7QUFDekMsSUFBRSxDQUFDO0FBRUg7QUFBUTtBQUFnQjtBQUN2QjtBQUFxQjtBQUFtQjtBQUN6QyxJQUZVLGlEQUFlO0FBQU87QUFDOUI7QUFBdUI7QUFBcUI7QUFDOUI7QUFBUSxJQUZ0QixVQUF3QixJQUFJLEVBQUUsRUFBRTtBQUFJLFFBQ2xDLElBQUksT0FBTyxFQUFFLENBQUMsWUFBWSxLQUFLLFVBQVUsRUFBRTtBQUMvQyxZQUFNLE9BQU8sRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNuQyxTQUFLO0FBQ0wsUUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxJQUFJLFVBQVUsQ0FBQyxDQUFDO0FBQy9DLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBZ0I7QUFDcEI7QUFBcUI7QUFBbUI7QUFDdEMsSUFGSSw4Q0FBWTtBQUFPO0FBQzNCO0FBQXVCO0FBQ3pCO0FBQW1CO0FBQVEsSUFGekIsVUFBcUIsSUFBSSxFQUFFLEVBQUU7QUFBSSxRQUMvQixJQUFJLE9BQU8sRUFBRSxDQUFDLFNBQVMsS0FBSyxVQUFVLEVBQUU7QUFDNUMsWUFBTSxPQUFPLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEMsU0FBSztBQUNMLFFBQ0ksT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsQ0FBQztBQUN6QyxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQWdCO0FBQ3JCO0FBQXFCO0FBQ047QUFDZixJQUhPLHVEQUFxQjtBQUFPO0FBQzVCO0FBQ0Y7QUFDRjtBQUNIO0FBQVEsSUFKVCxVQUE4QixJQUFJLEVBQUUsRUFBRTtBQUN4QyxRQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsU0FBUztBQUN4QixlQUFTLENBQUMsRUFBRSxDQUFDLFNBQVM7QUFDdEIsZUFBUyxJQUFJLElBQUksSUFBSTtBQUNyQixlQUFTLE9BQU8sSUFBSSxLQUFLLFFBQVE7QUFDakMsZUFBUyxLQUFLLElBQUksSUFBSTtBQUN0QixlQUFTLE9BQU8sSUFBSSxJQUFJLENBQUM7QUFDekIsSUFBRSxDQUFDOzJEQTVGRixJQUFJLFNBQUMsRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUU7Ozs7O2dEQUM1QjtBQUFDLElBNEZWLDhCQUFDO0FBQ0EsQ0FEQSxBQTdGRCxJQTZGQztBQUNELFNBN0ZhLHVCQUF1QjtBQUFJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgYXMgb2JzZXJ2YWJsZU9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBGb3JtbHlGaWVsZENvbmZpZyB9IGZyb20gJ0BuZ3gtZm9ybWx5L2NvcmUnO1xuXG5AUGlwZSh7IG5hbWU6ICdmb3JtbHlTZWxlY3RPcHRpb25zJyB9KVxuZXhwb3J0IGNsYXNzIEZvcm1seVNlbGVjdE9wdGlvbnNQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gIHRyYW5zZm9ybShvcHRpb25zLCBmaWVsZD86IEZvcm1seUZpZWxkQ29uZmlnKSB7XG4gICAgaWYgKCEob3B0aW9ucyBpbnN0YW5jZW9mIE9ic2VydmFibGUpKSB7XG4gICAgICBvcHRpb25zID0gb2JzZXJ2YWJsZU9mKG9wdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiAob3B0aW9ucyBhcyBPYnNlcnZhYmxlPGFueT4pLnBpcGUoXG4gICAgICBtYXAodmFsdWUgPT4gdGhpcy50b09wdGlvbnModmFsdWUsIGZpZWxkIHx8IHt9KSksXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgdG9PcHRpb25zKG9wdGlvbnMsIGZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZykge1xuICAgIGNvbnN0IGdPcHRpb25zOiBhbnlbXSA9IFtdLFxuICAgICAgZ3JvdXBzOiB7IFtrZXk6IHN0cmluZ106IGFueVtdIH0gPSB7fSxcbiAgICAgIHRvID0gZmllbGQudGVtcGxhdGVPcHRpb25zIHx8IHt9O1xuXG4gICAgdG8uX2ZsYXRPcHRpb25zID0gdHJ1ZTtcbiAgICBvcHRpb25zLm1hcCgob3B0aW9uOiBhbnkpID0+IHtcbiAgICAgIGlmICghdGhpcy5nZXRHcm91cFByb3Aob3B0aW9uLCB0bykpIHtcbiAgICAgICAgZ09wdGlvbnMucHVzaCh0aGlzLnRvT3B0aW9uKG9wdGlvbiwgdG8pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvLl9mbGF0T3B0aW9ucyA9IGZhbHNlO1xuICAgICAgICBpZiAoIWdyb3Vwc1t0aGlzLmdldEdyb3VwUHJvcChvcHRpb24sIHRvKV0pIHtcbiAgICAgICAgICBncm91cHNbdGhpcy5nZXRHcm91cFByb3Aob3B0aW9uLCB0byldID0gW107XG4gICAgICAgICAgZ09wdGlvbnMucHVzaCh7XG4gICAgICAgICAgICBsYWJlbDogdGhpcy5nZXRHcm91cFByb3Aob3B0aW9uLCB0byksXG4gICAgICAgICAgICBncm91cDogZ3JvdXBzW3RoaXMuZ2V0R3JvdXBQcm9wKG9wdGlvbiwgdG8pXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBncm91cHNbdGhpcy5nZXRHcm91cFByb3Aob3B0aW9uLCB0byldLnB1c2godGhpcy50b09wdGlvbihvcHRpb24sIHRvKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZ09wdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIHRvT3B0aW9uKGl0ZW0sIHRvKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVsOiB0aGlzLmdldExhYmVsUHJvcChpdGVtLCB0byksXG4gICAgICB2YWx1ZTogdGhpcy5nZXRWYWx1ZVByb3AoaXRlbSwgdG8pLFxuICAgICAgZGlzYWJsZWQ6IHRoaXMuZ2V0RGlzYWJsZWRQcm9wKGl0ZW0sIHRvKSB8fCBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYWJlbFByb3AoaXRlbSwgdG8pOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgdG8ubGFiZWxQcm9wID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdG8ubGFiZWxQcm9wKGl0ZW0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3VsZFVzZUxlZ2FjeU9wdGlvbihpdGVtLCB0bykpIHtcbiAgICAgIGNvbnNvbGUud2FybihgTmd4Rm9ybWx5OiBsZWdhY3kgc2VsZWN0IG9wdGlvbiAne2tleSwgdmFsdWV9JyBpcyBkZXByZWNhdGVkIHNpbmNlIHY1LjUsIHVzZSAne3ZhbHVlLCBsYWJlbH0nIGluc3RlYWQuYCk7XG4gICAgICByZXR1cm4gaXRlbS52YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gaXRlbVt0by5sYWJlbFByb3AgfHwgJ2xhYmVsJ107XG4gIH1cblxuICBwcml2YXRlIGdldFZhbHVlUHJvcChpdGVtLCB0byk6IHN0cmluZyB7XG4gICAgaWYgKHR5cGVvZiB0by52YWx1ZVByb3AgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiB0by52YWx1ZVByb3AoaXRlbSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2hvdWxkVXNlTGVnYWN5T3B0aW9uKGl0ZW0sIHRvKSkge1xuICAgICAgcmV0dXJuIGl0ZW0ua2V5O1xuICAgIH1cblxuICAgIHJldHVybiBpdGVtW3RvLnZhbHVlUHJvcCB8fCAndmFsdWUnXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGlzYWJsZWRQcm9wKGl0ZW0sIHRvKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZW9mIHRvLmRpc2FibGVkUHJvcCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIHRvLmRpc2FibGVkUHJvcChpdGVtKTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1bdG8uZGlzYWJsZWRQcm9wIHx8ICdkaXNhYmxlZCddO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRHcm91cFByb3AoaXRlbSwgdG8pOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgdG8uZ3JvdXBQcm9wID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdG8uZ3JvdXBQcm9wKGl0ZW0pO1xuICAgIH1cblxuICAgIHJldHVybiBpdGVtW3RvLmdyb3VwUHJvcCB8fCAnZ3JvdXAnXTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkVXNlTGVnYWN5T3B0aW9uKGl0ZW0sIHRvKSB7XG4gICAgcmV0dXJuICF0by52YWx1ZVByb3BcbiAgICAgICYmICF0by5sYWJlbFByb3BcbiAgICAgICYmIGl0ZW0gIT0gbnVsbFxuICAgICAgJiYgdHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnXG4gICAgICAmJiAna2V5JyBpbiBpdGVtXG4gICAgICAmJiAndmFsdWUnIGluIGl0ZW07XG4gIH1cbn1cbiJdfQ==