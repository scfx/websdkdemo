/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, InjectionToken } from '@angular/core';
import { reverseDeepMerge, defineHiddenProp } from './../utils';
import * as i0 from "@angular/core";
/** @type {?} */
import * as Éµngcc0 from '@angular/core';
export var FORMLY_CONFIG = new InjectionToken('FORMLY_CONFIG');
/**
 * \@experimental
 * @record
 */
export function FormlyExtension() { }
if (false) {
    /**
     * @param {?} field
     * @return {?}
     */
    FormlyExtension.prototype.prePopulate = function (field) { };
    /**
     * @param {?} field
     * @return {?}
     */
    FormlyExtension.prototype.onPopulate = function (field) { };
    /**
     * @param {?} field
     * @return {?}
     */
    FormlyExtension.prototype.postPopulate = function (field) { };
}
/**
 * Maintains list of formly field directive types. This can be used to register new field templates.
 */
var FormlyConfig = /** @class */ (function () {
    function FormlyConfig() {
        this.types = {};
        this.validators = {};
        this.wrappers = {};
        this.messages = {};
        this.templateManipulators = {
            preWrapper: [],
            postWrapper: [],
        };
        this.extras = {
            checkExpressionOn: 'changeDetectionCheck',
            lazyRender: false,
            showError: (/**
             * @param {?} field
             * @return {?}
             */
            function (field) {
                return field.formControl && field.formControl.invalid && (field.formControl.touched || (field.options.parentForm && field.options.parentForm.submitted) || !!(field.field.validation && field.field.validation.show));
            }),
        };
        this.extensions = {};
    }
    /**
     * @param {?} config
     * @return {?}
     */
    FormlyConfig.prototype.addConfig = /**
     * @param {?} config
     * @return {?}
     */
    function (config) {
        var _this = this;
        if (config.types) {
            config.types.forEach((/**
             * @param {?} type
             * @return {?}
             */
            function (type) { return _this.setType(type); }));
        }
        if (config.validators) {
            config.validators.forEach((/**
             * @param {?} validator
             * @return {?}
             */
            function (validator) { return _this.setValidator(validator); }));
        }
        if (config.wrappers) {
            config.wrappers.forEach((/**
             * @param {?} wrapper
             * @return {?}
             */
            function (wrapper) { return _this.setWrapper(wrapper); }));
        }
        if (config.manipulators) {
            console.warn("NgxFormly: passing 'manipulators' config is deprecated, use custom extension instead.");
            config.manipulators.forEach((/**
             * @param {?} manipulator
             * @return {?}
             */
            function (manipulator) { return _this.setManipulator(manipulator); }));
        }
        if (config.validationMessages) {
            config.validationMessages.forEach((/**
             * @param {?} validation
             * @return {?}
             */
            function (validation) { return _this.addValidatorMessage(validation.name, validation.message); }));
        }
        if (config.extensions) {
            config.extensions.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return _this.extensions[c.name] = c.extension; }));
        }
        if (config.extras) {
            this.extras = tslib_1.__assign({}, this.extras, config.extras);
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    FormlyConfig.prototype.setType = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (Array.isArray(options)) {
            options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            function (option) { return _this.setType(option); }));
        }
        else {
            if (!this.types[options.name]) {
                this.types[options.name] = (/** @type {?} */ ({ name: options.name }));
            }
            ['component', 'extends', 'defaultOptions', 'wrappers'].forEach((/**
             * @param {?} prop
             * @return {?}
             */
            function (prop) {
                if (options.hasOwnProperty(prop)) {
                    _this.types[options.name][prop] = options[prop];
                }
            }));
        }
    };
    /**
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.getType = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!this.types[name]) {
            throw new Error("[Formly Error] The type \"" + name + "\" could not be found. Please make sure that is registered through the FormlyModule declaration.");
        }
        this.mergeExtendedType(name);
        return this.types[name];
    };
    /**
     * @param {?=} field
     * @return {?}
     */
    FormlyConfig.prototype.getMergedField = /**
     * @param {?=} field
     * @return {?}
     */
    function (field) {
        var _this = this;
        if (field === void 0) { field = {}; }
        /** @type {?} */
        var type = this.getType(field.type);
        if (type.defaultOptions) {
            reverseDeepMerge(field, type.defaultOptions);
        }
        /** @type {?} */
        var extendDefaults = type.extends && this.getType(type.extends).defaultOptions;
        if (extendDefaults) {
            reverseDeepMerge(field, extendDefaults);
        }
        if (field && field.optionsTypes) {
            field.optionsTypes.forEach((/**
             * @param {?} option
             * @return {?}
             */
            function (option) {
                /** @type {?} */
                var defaultOptions = _this.getType(option).defaultOptions;
                if (defaultOptions) {
                    reverseDeepMerge(field, defaultOptions);
                }
            }));
        }
        /** @type {?} */
        var componentRef = this.resolveFieldTypeRef(field);
        if (componentRef && componentRef.instance && componentRef.instance.defaultOptions) {
            reverseDeepMerge(field, componentRef.instance.defaultOptions);
        }
        if (!field.wrappers && type.wrappers) {
            field.wrappers = tslib_1.__spread(type.wrappers);
        }
    };
    /** @internal */
    /**
     * \@internal
     * @param {?=} field
     * @return {?}
     */
    FormlyConfig.prototype.resolveFieldTypeRef = /**
     * \@internal
     * @param {?=} field
     * @return {?}
     */
    function (field) {
        if (field === void 0) { field = {}; }
        if (!field.type) {
            return null;
        }
        /** @type {?} */
        var type = this.getType(field.type);
        if (!type.component || type['_componentRef']) {
            return type['_componentRef'];
        }
        var _a = field.parent.options, _resolver = _a._resolver, _injector = _a._injector;
        /** @type {?} */
        var componentRef = _resolver
            .resolveComponentFactory(type.component)
            .create(_injector);
        defineHiddenProp(type, '_componentRef', componentRef);
        componentRef.destroy();
        return type['_componentRef'];
    };
    /**
     * @param {?} options
     * @return {?}
     */
    FormlyConfig.prototype.setWrapper = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        this.wrappers[options.name] = options;
        if (options.types) {
            options.types.forEach((/**
             * @param {?} type
             * @return {?}
             */
            function (type) {
                _this.setTypeWrapper(type, options.name);
            }));
        }
    };
    /**
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.getWrapper = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!this.wrappers[name]) {
            throw new Error("[Formly Error] The wrapper \"" + name + "\" could not be found. Please make sure that is registered through the FormlyModule declaration.");
        }
        return this.wrappers[name];
    };
    /**
     * @param {?} type
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.setTypeWrapper = /**
     * @param {?} type
     * @param {?} name
     * @return {?}
     */
    function (type, name) {
        if (!this.types[type]) {
            this.types[type] = (/** @type {?} */ ({}));
        }
        if (!this.types[type].wrappers) {
            this.types[type].wrappers = [];
        }
        if (this.types[type].wrappers.indexOf(name) === -1) {
            this.types[type].wrappers.push(name);
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    FormlyConfig.prototype.setValidator = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.validators[options.name] = options;
    };
    /**
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.getValidator = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!this.validators[name]) {
            throw new Error("[Formly Error] The validator \"" + name + "\" could not be found. Please make sure that is registered through the FormlyModule declaration.");
        }
        return this.validators[name];
    };
    /**
     * @param {?} name
     * @param {?} message
     * @return {?}
     */
    FormlyConfig.prototype.addValidatorMessage = /**
     * @param {?} name
     * @param {?} message
     * @return {?}
     */
    function (name, message) {
        this.messages[name] = message;
    };
    /**
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.getValidatorMessage = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        return this.messages[name];
    };
    /**
     * @param {?} manipulator
     * @return {?}
     */
    FormlyConfig.prototype.setManipulator = /**
     * @param {?} manipulator
     * @return {?}
     */
    function (manipulator) {
        new manipulator.class()[manipulator.method](this);
    };
    /**
     * @private
     * @param {?} name
     * @return {?}
     */
    FormlyConfig.prototype.mergeExtendedType = /**
     * @private
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!this.types[name].extends) {
            return;
        }
        /** @type {?} */
        var extendedType = this.getType(this.types[name].extends);
        if (!this.types[name].component) {
            this.types[name].component = extendedType.component;
        }
        if (!this.types[name].wrappers) {
            this.types[name].wrappers = extendedType.wrappers;
        }
    };
    /** @nocollapse */ FormlyConfig.ngInjectableDef = i0.defineInjectable({ factory: function FormlyConfig_Factory() { return new FormlyConfig(); }, token: FormlyConfig, providedIn: "root" });
FormlyConfig.Éµfac = function FormlyConfig_Factory(t) { return new (t || FormlyConfig)(); };
FormlyConfig.Éµprov = /*@__PURE__*/ Éµngcc0.ÉµÉµdefineInjectable({ token: FormlyConfig, factory: function (t) { return FormlyConfig.Éµfac(t); }, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && Éµngcc0.ÉµsetClassMetadata(FormlyConfig, [{
        type: Injectable,
        args: [{ providedIn: 'root' }]
    }], function () { return []; }, null); })();
    return FormlyConfig;
}());
export { FormlyConfig };
if (false) {
    /** @type {?} */
    FormlyConfig.prototype.types;
    /** @type {?} */
    FormlyConfig.prototype.validators;
    /** @type {?} */
    FormlyConfig.prototype.wrappers;
    /** @type {?} */
    FormlyConfig.prototype.messages;
    /** @type {?} */
    FormlyConfig.prototype.templateManipulators;
    /** @type {?} */
    FormlyConfig.prototype.extras;
    /** @type {?} */
    FormlyConfig.prototype.extensions;
}
/**
 * @record
 */
export function TypeOption() { }
if (false) {
    /** @type {?} */
    TypeOption.prototype.name;
    /** @type {?|undefined} */
    TypeOption.prototype.component;
    /** @type {?|undefined} */
    TypeOption.prototype.wrappers;
    /** @type {?|undefined} */
    TypeOption.prototype.extends;
    /** @type {?|undefined} */
    TypeOption.prototype.defaultOptions;
}
/**
 * @record
 */
export function WrapperOption() { }
if (false) {
    /** @type {?} */
    WrapperOption.prototype.name;
    /** @type {?} */
    WrapperOption.prototype.component;
    /** @type {?|undefined} */
    WrapperOption.prototype.types;
}
/**
 * @record
 */
export function FieldValidatorFn() { }
/**
 * @record
 */
export function ValidatorOption() { }
if (false) {
    /** @type {?} */
    ValidatorOption.prototype.name;
    /** @type {?} */
    ValidatorOption.prototype.validation;
    /** @type {?|undefined} */
    ValidatorOption.prototype.options;
}
/**
 * @record
 */
export function ExtensionOption() { }
if (false) {
    /** @type {?} */
    ExtensionOption.prototype.name;
    /** @type {?} */
    ExtensionOption.prototype.extension;
}
/**
 * @record
 */
export function ValidationMessageOption() { }
if (false) {
    /** @type {?} */
    ValidationMessageOption.prototype.name;
    /** @type {?} */
    ValidationMessageOption.prototype.message;
}
/**
 * @record
 */
export function ManipulatorOption() { }
if (false) {
    /** @type {?|undefined} */
    ManipulatorOption.prototype.class;
    /** @type {?|undefined} */
    ManipulatorOption.prototype.method;
}
/**
 * @record
 */
export function ManipulatorWrapper() { }
/**
 * @record
 */
export function TemplateManipulators() { }
if (false) {
    /** @type {?|undefined} */
    TemplateManipulators.prototype.preWrapper;
    /** @type {?|undefined} */
    TemplateManipulators.prototype.postWrapper;
}
/**
 * @record
 */
export function ConfigOption() { }
if (false) {
    /** @type {?|undefined} */
    ConfigOption.prototype.types;
    /** @type {?|undefined} */
    ConfigOption.prototype.wrappers;
    /** @type {?|undefined} */
    ConfigOption.prototype.validators;
    /** @type {?|undefined} */
    ConfigOption.prototype.extensions;
    /** @type {?|undefined} */
    ConfigOption.prototype.validationMessages;
    /**
     * @deprecated use `extensions` instead
     * @type {?|undefined}
     */
    ConfigOption.prototype.manipulators;
    /** @type {?|undefined} */
    ConfigOption.prototype.extras;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWx5LmNvbmZpZy5qcyIsInNvdXJjZXMiOlsiQG5neC1mb3JtbHkvY29yZS9saWIvc2VydmljZXMvZm9ybWx5LmNvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFnQixNQUFNLGVBQWUsQ0FBQztBQUd6RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDaEU7QUFBcUM7O0FBR3JDLE1BQU0sS0FBTyxhQUFhLEdBQUcsSUFBSSxjQUFjLENBQWUsZUFBZSxDQUFDO0FBQzlFO0FBQ0c7QUFDSDtBQUFXO0FBQVgscUNBSUM7QUFDRDtBQUVRO0FBQVE7QUFBd0I7QUFBbUI7QUFBUSxJQU5qRSw2REFBNkM7QUFDL0M7QUFBUTtBQUF3QjtBQUM1QjtBQUFRLElBRFYsNERBQTRDO0FBQzlDO0FBQVE7QUFBd0I7QUFFaEM7QUFFRyxJQUpELDhEQUE4QztBQUNoRDtBQUNBO0FBQ0c7QUFDaUc7QUFFcEc7QUFDWSxJQURaO0FBQTBCLFFBRXhCLFVBQUssR0FBaUMsRUFBRSxDQUFDO0FBQzNDLFFBQUUsZUFBVSxHQUF3QyxFQUFFLENBQUM7QUFDdkQsUUFBRSxhQUFRLEdBQXNDLEVBQUUsQ0FBQztBQUNuRCxRQUFFLGFBQVEsR0FBMkQsRUFBRSxDQUFDO0FBQ3hFLFFBQUUseUJBQW9CLEdBR2hCO0FBQ04sWUFBSSxVQUFVLEVBQUUsRUFBRTtBQUNsQixZQUFJLFdBQVcsRUFBRSxFQUFFO0FBQ25CLFNBQUcsQ0FBQztBQUNKLFFBQUUsV0FBTSxHQUEyQjtBQUNuQyxZQUFJLGlCQUFpQixFQUFFLHNCQUFzQjtBQUM3QyxZQUFJLFVBQVUsRUFBRSxLQUFLO0FBQ3JCLFlBQUksU0FBUztBQUFPO0FBQ1o7QUFBMkI7QUFBZ0IsWUFEcEMsVUFBUyxLQUFnQjtBQUN4QyxnQkFBTSxPQUFPLEtBQUssQ0FBQyxXQUFXLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDNU4sWUFBSSxDQUFDLENBQUE7QUFDTCxTQUFHLENBQUM7QUFDSixRQUFFLGVBQVUsR0FBd0MsRUFBRSxDQUFDO0FBQ3ZELEtBMktDO0FBQ0Q7QUFBUTtBQUNMO0FBQ0c7QUFBUSxJQTdLWixnQ0FBUztBQUFPO0FBQ1g7QUFDTDtBQUFRLElBRlIsVUFBVSxNQUFvQjtBQUNoQyxRQURFLGlCQXVCQztBQUNILFFBdkJJLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRTtBQUN0QixZQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTztBQUFNO0FBRS9CO0FBQTJCO0FBQ2IsWUFIWSxVQUFBLElBQUksSUFBSSxPQUFBLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQWxCLENBQWtCLEVBQUMsQ0FBQztBQUN2RCxTQUFLO0FBQ0wsUUFBSSxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVBQUU7QUFDM0IsWUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU87QUFBTTtBQUFvQztBQUV2RDtBQUNYLFlBSHlCLFVBQUEsU0FBUyxJQUFJLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsRUFBNUIsQ0FBNEIsRUFBQyxDQUFDO0FBQzNFLFNBQUs7QUFDTCxRQUFJLElBQUksTUFBTSxDQUFDLFFBQVEsRUFBRTtBQUN6QixZQUFNLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTztBQUFNO0FBQ2xDO0FBQ3FCO0FBQ2YsWUFIdUIsVUFBQSxPQUFPLElBQUksT0FBQSxLQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUF4QixDQUF3QixFQUFDLENBQUM7QUFDbkUsU0FBSztBQUNMLFFBQUksSUFBSSxNQUFNLENBQUMsWUFBWSxFQUFFO0FBQzdCLFlBQU0sT0FBTyxDQUFDLElBQUksQ0FBQyx1RkFBdUYsQ0FBQyxDQUFDO0FBQzVHLFlBQU0sTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPO0FBQU07QUFBc0M7QUFFL0Q7QUFBZ0IsWUFGSSxVQUFBLFdBQVcsSUFBSSxPQUFBLEtBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEVBQWhDLENBQWdDLEVBQUMsQ0FBQztBQUNuRixTQUFLO0FBQ0wsUUFBSSxJQUFJLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTtBQUNuQyxZQUFNLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPO0FBQU07QUFBcUM7QUFBMkI7QUFFNUcsWUFGdUMsVUFBQSxVQUFVLElBQUksT0FBQSxLQUFJLENBQUMsbUJBQW1CLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQTdELENBQTZELEVBQUMsQ0FBQztBQUNySCxTQUFLO0FBQ0wsUUFBSSxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVBQUU7QUFDM0IsWUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU87QUFBTTtBQUE0QjtBQUV4RDtBQUNULFlBSGdDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBckMsQ0FBcUMsRUFBQyxDQUFDO0FBQzVFLFNBQUs7QUFDTCxRQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRTtBQUN2QixZQUFNLElBQUksQ0FBQyxNQUFNLHdCQUFRLElBQUksQ0FBQyxNQUFNLEVBQUssTUFBTSxDQUFDLE1BQU0sQ0FBRSxDQUFDO0FBQ3pELFNBQUs7QUFDTCxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQTBCO0FBQzdCO0FBQVEsSUFEWCw4QkFBTztBQUFPO0FBQTBCO0FBQzdCO0FBQVEsSUFEbkIsVUFBUSxPQUFrQztBQUM1QyxRQURFLGlCQWNDO0FBQ0gsUUFkSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7QUFDaEMsWUFBTSxPQUFPLENBQUMsT0FBTztBQUFNO0FBQ3hCO0FBQ2M7QUFBZ0IsWUFGWCxVQUFDLE1BQU0sSUFBSyxPQUFBLEtBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQXBCLENBQW9CLEVBQUMsQ0FBQztBQUN4RCxTQUFLO0FBQUMsYUFBSztBQUNYLFlBQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3JDLGdCQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLG1CQUFZLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBQSxDQUFDO0FBQ3RFLGFBQU87QUFDUCxZQUNNLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQyxPQUFPO0FBQU07QUFDaEQ7QUFDakI7QUFBZ0IsWUFGNEMsVUFBQSxJQUFJO0FBQUksZ0JBQ3JFLElBQUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUMxQyxvQkFBVSxLQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekQsaUJBQVM7QUFDVCxZQUFNLENBQUMsRUFBQyxDQUFDO0FBQ1QsU0FBSztBQUNMLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBdUI7QUFDbkI7QUFBUSxJQURsQiw4QkFBTztBQUFPO0FBQ2Y7QUFBbUI7QUFBUSxJQUQxQixVQUFRLElBQVk7QUFBSSxRQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUMzQixZQUFNLE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQTRCLElBQUkscUdBQWlHLENBQUMsQ0FBQztBQUN6SixTQUFLO0FBQ0wsUUFDSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDakMsUUFDSSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUIsSUFBRSxDQUFDO0FBRUg7QUFBUTtBQUF5QjtBQUFtQjtBQUMvQyxJQURILHFDQUFjO0FBQU87QUFBeUI7QUFDcEM7QUFBUSxJQURsQixVQUFlLEtBQTZCO0FBQUksUUFBaEQsaUJBNEJDO0FBQ0gsUUE3QmlCLHNCQUFBLEVBQUEsVUFBNkI7QUFBSTtBQUM5QixZQUFWLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7QUFDekMsUUFBSSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7QUFDN0IsWUFBTSxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ25ELFNBQUs7QUFDTDtBQUN3QixZQUFkLGNBQWMsR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGNBQWM7QUFDcEYsUUFBSSxJQUFJLGNBQWMsRUFBRTtBQUN4QixZQUFNLGdCQUFnQixDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQztBQUM5QyxTQUFLO0FBQ0wsUUFDSSxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsWUFBWSxFQUFFO0FBQ3JDLFlBQU0sS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPO0FBQU07QUFDWjtBQUEyQjtBQUNwRCxZQUZnQyxVQUFBLE1BQU07QUFBSTtBQUNaLG9CQUFqQixjQUFjLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjO0FBQ2xFLGdCQUFRLElBQUksY0FBYyxFQUFFO0FBQzVCLG9CQUFVLGdCQUFnQixDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQztBQUNsRCxpQkFBUztBQUNULFlBQU0sQ0FBQyxFQUFDLENBQUM7QUFDVCxTQUFLO0FBQ0w7QUFDd0IsWUFBZCxZQUFZLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQztBQUN4RCxRQUFJLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxRQUFRLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUU7QUFDdkYsWUFBTSxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUNwRSxTQUFLO0FBQ0wsUUFDSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO0FBQzFDLFlBQU0sS0FBSyxDQUFDLFFBQVEsb0JBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFDLFNBQUs7QUFDTCxJQUFFLENBQUM7QUFFSCxJQUFFLGdCQUFnQjtBQUNsQjtBQUFRO0FBQWtCO0FBQXlCO0FBQW1CO0FBQVEsSUFBNUUsMENBQW1CO0FBQU87QUFBa0I7QUFBeUI7QUFDbEU7QUFBUSxJQURYLFVBQW9CLEtBQWtDO0FBQUksUUFBdEMsc0JBQUEsRUFBQSxVQUFrQztBQUFJLFFBQ3hELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFO0FBQ3JCLFlBQU0sT0FBTyxJQUFJLENBQUM7QUFDbEIsU0FBSztBQUNMO0FBQ3dCLFlBQWQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztBQUN6QyxRQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRTtBQUNsRCxZQUFNLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ25DLFNBQUs7QUFDTCxRQUNVLElBQUEseUJBQStDLEVBQTdDLHdCQUFTLEVBQUUsd0JBQWtDO0FBQ3pEO0FBQXlCLFlBQWYsWUFBWSxHQUFHLFNBQVM7QUFDbEMsYUFBTyx1QkFBdUIsQ0FBWSxJQUFJLENBQUMsU0FBUyxDQUFDO0FBQ3pELGFBQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQztBQUN4QixRQUNJLGdCQUFnQixDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDMUQsUUFBSSxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDM0IsUUFDSSxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUNqQyxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQTBCO0FBQ3BCO0FBQVEsSUFEcEIsaUNBQVU7QUFBTztBQUNiO0FBQW1CO0FBQVEsSUFEL0IsVUFBVyxPQUFzQjtBQUNuQyxRQURFLGlCQU9DO0FBQ0gsUUFQSSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUM7QUFDMUMsUUFBSSxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7QUFDdkIsWUFBTSxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU87QUFBTTtBQUNUO0FBQ3RCO0FBRUEsWUFKMEIsVUFBQyxJQUFJO0FBQUksZ0JBQzdCLEtBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoRCxZQUFNLENBQUMsRUFBQyxDQUFDO0FBQ1QsU0FBSztBQUNMLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBdUI7QUFDekI7QUFBUSxJQURaLGlDQUFVO0FBQU87QUFBdUI7QUFDekI7QUFBUSxJQUR2QixVQUFXLElBQVk7QUFBSSxRQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUM5QixZQUFNLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQStCLElBQUkscUdBQWlHLENBQUMsQ0FBQztBQUM1SixTQUFLO0FBQ0wsUUFDSSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDL0IsSUFBRSxDQUFDO0FBRUg7QUFBUTtBQUF1QjtBQUN4QjtBQUFtQjtBQUNyQixJQUZILHFDQUFjO0FBQU87QUFBdUI7QUFDeEI7QUFDVjtBQUFRLElBRmxCLFVBQWUsSUFBWSxFQUFFLElBQVk7QUFDM0MsUUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUMzQixZQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsbUJBQVksRUFBRSxFQUFBLENBQUM7QUFDeEMsU0FBSztBQUNMLFFBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFO0FBQ3BDLFlBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0FBQ3JDLFNBQUs7QUFDTCxRQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO0FBQ3hELFlBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzNDLFNBQUs7QUFDTCxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQTBCO0FBQ3hCO0FBQVEsSUFEaEIsbUNBQVk7QUFBTztBQUNqQjtBQUFtQjtBQUFRLElBRDdCLFVBQWEsT0FBd0I7QUFDdkMsUUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUM7QUFDNUMsSUFBRSxDQUFDO0FBRUg7QUFBUTtBQUF1QjtBQUM3QjtBQUFRLElBRFIsbUNBQVk7QUFBTztBQUF1QjtBQUM3QjtBQUFRLElBRHJCLFVBQWEsSUFBWTtBQUFJLFFBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ2hDLFlBQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxvQ0FBaUMsSUFBSSxxR0FBaUcsQ0FBQyxDQUFDO0FBQzlKLFNBQUs7QUFDTCxRQUNJLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNqQyxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQXVCO0FBQTBCO0FBQW1CO0FBQzNFLElBREMsMENBQW1CO0FBQU87QUFBdUI7QUFBMEI7QUFDaEU7QUFBUSxJQURuQixVQUFvQixJQUFZLEVBQUUsT0FBMkM7QUFDL0UsUUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztBQUNsQyxJQUFFLENBQUM7QUFFSDtBQUFRO0FBQXVCO0FBQ25CO0FBQVEsSUFEbEIsMENBQW1CO0FBQU87QUFDZjtBQUNiO0FBRUcsSUFKRCxVQUFvQixJQUFZO0FBQ2xDLFFBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQy9CLElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBOEI7QUFDaEM7QUFBUSxJQURaLHFDQUFjO0FBQU87QUFDckI7QUFBbUI7QUFBUSxJQUQzQixVQUFlLFdBQThCO0FBQy9DLFFBQUksSUFBSSxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RELElBQUUsQ0FBQztBQUVIO0FBQVE7QUFBZ0I7QUFDckI7QUFBbUI7QUFBUSxJQURwQix3Q0FBaUI7QUFBTztBQUM1QjtBQUF1QjtBQUNsQjtBQUNOLElBSEgsVUFBMEIsSUFBWTtBQUN4QyxRQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRTtBQUNuQyxZQUFNLE9BQU87QUFDYixTQUFLO0FBQ0w7QUFDd0IsWUFBZCxZQUFZLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUMvRCxRQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRTtBQUNyQyxZQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUM7QUFDMUQsU0FBSztBQUNMLFFBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFO0FBQ3BDLFlBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQztBQUN4RCxTQUFLO0FBQ0wsSUFBRSxDQUFDLENBOUxNO2dEQURSLFVBQVUsU0FBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsekZBQ3hCOzs7Ozs7Z0RBSVk7QUFBQyx1QkF4QnZCO0FBQUUsQ0FtTkQsQUFoTUQsSUFnTUM7QUFDRCxTQWhNYSxZQUFZO0FBQ3hCO0FBQWE7QUFBcUIsSUFBakMsNkJBQXlDO0FBQzNDO0FBQXFCLElBQW5CLGtDQUFxRDtBQUN2RDtBQUFxQixJQUFuQixnQ0FBaUQ7QUFDbkQ7QUFBcUIsSUFBbkIsZ0NBQXNFO0FBQ3hFO0FBQXFCLElBQW5CLDRDQU1FO0FBQ0o7QUFBcUIsSUFBbkIsOEJBTUU7QUFDSjtBQUFxQixJQUFuQixrQ0FBcUQ7QUFDdkQ7QUFDQztBQUFJO0FBQVc7QUEyS2hCLGdDQU1DO0FBQ0Q7QUFDWTtBQUNaLElBUkUsMEJBQWE7QUFDZjtBQUNZLElBRFYsK0JBQWdCO0FBQ2xCO0FBQ1EsSUFETiw4QkFBb0I7QUFDdEI7QUFDVyxJQURULDZCQUFpQjtBQUNuQjtBQUErQixJQUE3QixvQ0FBbUM7QUFDckM7QUFDQTtBQUNHO0FBQVc7QUFBZCxtQ0FJQztBQUNEO0FBQ1k7QUFBcUIsSUFML0IsNkJBQWE7QUFDZjtBQUNHLElBREQsa0NBQWU7QUFDakI7QUFHUSxJQUhOLDhCQUFpQjtBQUNuQjtBQUNBO0FBQ0c7QUFBVztBQUFkLHNDQUVDO0FBQ0Q7QUFDRztBQUFXO0FBQWQscUNBSUM7QUFDRDtBQUNZO0FBQXFCLElBTC9CLCtCQUFhO0FBQ2Y7QUFBcUIsSUFBbkIscUNBQTZCO0FBQy9CO0FBQStCLElBQTdCLGtDQUFnQztBQUNsQztBQUNBO0FBQ0c7QUFBVztBQUFkLHFDQUdDO0FBQ0Q7QUFDWTtBQUFxQixJQUovQiwrQkFBYTtBQUNmO0FBQXFCLElBQW5CLG9DQUEyQjtBQUM3QjtBQUNBO0FBQ0c7QUFBVztBQUFkLDZDQUdDO0FBQ0Q7QUFDWTtBQUFxQixJQUovQix1Q0FBYTtBQUNmO0FBQXFCLElBQW5CLDBDQUEwRjtBQUM1RjtBQUNBO0FBQ0c7QUFBVztBQUFkLHVDQUdDO0FBQ0Q7QUFDWTtBQUNQLElBTEgsa0NBQXdCO0FBQzFCO0FBR1MsSUFIUCxtQ0FBZ0I7QUFDbEI7QUFDQTtBQUNHO0FBQVc7QUFBZCx3Q0FFQztBQUNEO0FBQ0c7QUFBVztBQUFkLDBDQUdDO0FBQ0Q7QUFDWTtBQUNELElBTFQsMENBQWtDO0FBQ3BDO0FBQStCLElBQTdCLDJDQUFtQztBQUNyQztBQUNBO0FBQ0c7QUFBVztBQUFkLGtDQXdDQztBQUNEO0FBQWE7QUFBK0IsSUF4QzFDLDZCQUFxQjtBQUN2QjtBQUNDLElBREMsZ0NBQTJCO0FBQzdCO0FBQStCLElBQTdCLGtDQUErQjtBQUNqQztBQUErQixJQUE3QixrQ0FBK0I7QUFDakM7QUFBK0IsSUFBN0IsMENBQStDO0FBQ2pEO0FBQ087QUFDRjtBQUEyQjtBQUM5QixJQURBLG9DQUFtQztBQUNyQztBQUNrQixJQURoQiw4QkE4QkU7QUFDSjtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0aW9uVG9rZW4sIENvbXBvbmVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9ycywgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRmllbGRUeXBlIH0gZnJvbSAnLi8uLi90ZW1wbGF0ZXMvZmllbGQudHlwZSc7XG5pbXBvcnQgeyByZXZlcnNlRGVlcE1lcmdlLCBkZWZpbmVIaWRkZW5Qcm9wIH0gZnJvbSAnLi8uLi91dGlscyc7XG5pbXBvcnQgeyBGb3JtbHlGaWVsZENvbmZpZywgRm9ybWx5RmllbGRDb25maWdDYWNoZSB9IGZyb20gJy4uL2NvbXBvbmVudHMvZm9ybWx5LmZpZWxkLmNvbmZpZyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmV4cG9ydCBjb25zdCBGT1JNTFlfQ09ORklHID0gbmV3IEluamVjdGlvblRva2VuPEZvcm1seUNvbmZpZz4oJ0ZPUk1MWV9DT05GSUcnKTtcblxuLyoqIEBleHBlcmltZW50YWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgRm9ybWx5RXh0ZW5zaW9uIHtcbiAgcHJlUG9wdWxhdGU/KGZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZyk6IHZvaWQ7XG4gIG9uUG9wdWxhdGU/KGZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZyk6IHZvaWQ7XG4gIHBvc3RQb3B1bGF0ZT8oZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnKTogdm9pZDtcbn1cblxuLyoqXG4gKiBNYWludGFpbnMgbGlzdCBvZiBmb3JtbHkgZmllbGQgZGlyZWN0aXZlIHR5cGVzLiBUaGlzIGNhbiBiZSB1c2VkIHRvIHJlZ2lzdGVyIG5ldyBmaWVsZCB0ZW1wbGF0ZXMuXG4gKi9cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgRm9ybWx5Q29uZmlnIHtcbiAgdHlwZXM6IHtbbmFtZTogc3RyaW5nXTogVHlwZU9wdGlvbn0gPSB7fTtcbiAgdmFsaWRhdG9yczogeyBbbmFtZTogc3RyaW5nXTogVmFsaWRhdG9yT3B0aW9uIH0gPSB7fTtcbiAgd3JhcHBlcnM6IHsgW25hbWU6IHN0cmluZ106IFdyYXBwZXJPcHRpb24gfSA9IHt9O1xuICBtZXNzYWdlczogeyBbbmFtZTogc3RyaW5nXTogVmFsaWRhdGlvbk1lc3NhZ2VPcHRpb25bJ21lc3NhZ2UnXSB9ID0ge307XG4gIHRlbXBsYXRlTWFuaXB1bGF0b3JzOiB7XG4gICAgcHJlV3JhcHBlcjogTWFuaXB1bGF0b3JXcmFwcGVyW107XG4gICAgcG9zdFdyYXBwZXI6IE1hbmlwdWxhdG9yV3JhcHBlcltdO1xuICB9ID0ge1xuICAgIHByZVdyYXBwZXI6IFtdLFxuICAgIHBvc3RXcmFwcGVyOiBbXSxcbiAgfTtcbiAgZXh0cmFzOiBDb25maWdPcHRpb25bJ2V4dHJhcyddID0ge1xuICAgIGNoZWNrRXhwcmVzc2lvbk9uOiAnY2hhbmdlRGV0ZWN0aW9uQ2hlY2snLFxuICAgIGxhenlSZW5kZXI6IGZhbHNlLFxuICAgIHNob3dFcnJvcjogZnVuY3Rpb24oZmllbGQ6IEZpZWxkVHlwZSkge1xuICAgICAgcmV0dXJuIGZpZWxkLmZvcm1Db250cm9sICYmIGZpZWxkLmZvcm1Db250cm9sLmludmFsaWQgJiYgKGZpZWxkLmZvcm1Db250cm9sLnRvdWNoZWQgfHwgKGZpZWxkLm9wdGlvbnMucGFyZW50Rm9ybSAmJiBmaWVsZC5vcHRpb25zLnBhcmVudEZvcm0uc3VibWl0dGVkKSB8fCAhIShmaWVsZC5maWVsZC52YWxpZGF0aW9uICYmIGZpZWxkLmZpZWxkLnZhbGlkYXRpb24uc2hvdykpO1xuICAgIH0sXG4gIH07XG4gIGV4dGVuc2lvbnM6IHsgW25hbWU6IHN0cmluZ106IEZvcm1seUV4dGVuc2lvbiB9ID0ge307XG5cbiAgYWRkQ29uZmlnKGNvbmZpZzogQ29uZmlnT3B0aW9uKSB7XG4gICAgaWYgKGNvbmZpZy50eXBlcykge1xuICAgICAgY29uZmlnLnR5cGVzLmZvckVhY2godHlwZSA9PiB0aGlzLnNldFR5cGUodHlwZSkpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnLnZhbGlkYXRvcnMpIHtcbiAgICAgIGNvbmZpZy52YWxpZGF0b3JzLmZvckVhY2godmFsaWRhdG9yID0+IHRoaXMuc2V0VmFsaWRhdG9yKHZhbGlkYXRvcikpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnLndyYXBwZXJzKSB7XG4gICAgICBjb25maWcud3JhcHBlcnMuZm9yRWFjaCh3cmFwcGVyID0+IHRoaXMuc2V0V3JhcHBlcih3cmFwcGVyKSk7XG4gICAgfVxuICAgIGlmIChjb25maWcubWFuaXB1bGF0b3JzKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE5neEZvcm1seTogcGFzc2luZyAnbWFuaXB1bGF0b3JzJyBjb25maWcgaXMgZGVwcmVjYXRlZCwgdXNlIGN1c3RvbSBleHRlbnNpb24gaW5zdGVhZC5gKTtcbiAgICAgIGNvbmZpZy5tYW5pcHVsYXRvcnMuZm9yRWFjaChtYW5pcHVsYXRvciA9PiB0aGlzLnNldE1hbmlwdWxhdG9yKG1hbmlwdWxhdG9yKSk7XG4gICAgfVxuICAgIGlmIChjb25maWcudmFsaWRhdGlvbk1lc3NhZ2VzKSB7XG4gICAgICBjb25maWcudmFsaWRhdGlvbk1lc3NhZ2VzLmZvckVhY2godmFsaWRhdGlvbiA9PiB0aGlzLmFkZFZhbGlkYXRvck1lc3NhZ2UodmFsaWRhdGlvbi5uYW1lLCB2YWxpZGF0aW9uLm1lc3NhZ2UpKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5leHRlbnNpb25zKSB7XG4gICAgICBjb25maWcuZXh0ZW5zaW9ucy5mb3JFYWNoKGMgPT4gdGhpcy5leHRlbnNpb25zW2MubmFtZV0gPSBjLmV4dGVuc2lvbik7XG4gICAgfVxuICAgIGlmIChjb25maWcuZXh0cmFzKSB7XG4gICAgICB0aGlzLmV4dHJhcyA9IHsgLi4udGhpcy5leHRyYXMsIC4uLmNvbmZpZy5leHRyYXMgfTtcbiAgICB9XG4gIH1cblxuICBzZXRUeXBlKG9wdGlvbnM6IFR5cGVPcHRpb24gfCBUeXBlT3B0aW9uW10pIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSkge1xuICAgICAgb3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHRoaXMuc2V0VHlwZShvcHRpb24pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCF0aGlzLnR5cGVzW29wdGlvbnMubmFtZV0pIHtcbiAgICAgICAgdGhpcy50eXBlc1tvcHRpb25zLm5hbWVdID0gPFR5cGVPcHRpb24+eyBuYW1lOiBvcHRpb25zLm5hbWUgfTtcbiAgICAgIH1cblxuICAgICAgWydjb21wb25lbnQnLCAnZXh0ZW5kcycsICdkZWZhdWx0T3B0aW9ucycsICd3cmFwcGVycyddLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgdGhpcy50eXBlc1tvcHRpb25zLm5hbWVdW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0VHlwZShuYW1lOiBzdHJpbmcpOiBUeXBlT3B0aW9uIHtcbiAgICBpZiAoIXRoaXMudHlwZXNbbmFtZV0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgW0Zvcm1seSBFcnJvcl0gVGhlIHR5cGUgXCIke25hbWV9XCIgY291bGQgbm90IGJlIGZvdW5kLiBQbGVhc2UgbWFrZSBzdXJlIHRoYXQgaXMgcmVnaXN0ZXJlZCB0aHJvdWdoIHRoZSBGb3JtbHlNb2R1bGUgZGVjbGFyYXRpb24uYCk7XG4gICAgfVxuXG4gICAgdGhpcy5tZXJnZUV4dGVuZGVkVHlwZShuYW1lKTtcblxuICAgIHJldHVybiB0aGlzLnR5cGVzW25hbWVdO1xuICB9XG5cbiAgZ2V0TWVyZ2VkRmllbGQoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnID0ge30pOiBhbnkge1xuICAgIGNvbnN0IHR5cGUgPSB0aGlzLmdldFR5cGUoZmllbGQudHlwZSk7XG4gICAgaWYgKHR5cGUuZGVmYXVsdE9wdGlvbnMpIHtcbiAgICAgIHJldmVyc2VEZWVwTWVyZ2UoZmllbGQsIHR5cGUuZGVmYXVsdE9wdGlvbnMpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dGVuZERlZmF1bHRzID0gdHlwZS5leHRlbmRzICYmIHRoaXMuZ2V0VHlwZSh0eXBlLmV4dGVuZHMpLmRlZmF1bHRPcHRpb25zO1xuICAgIGlmIChleHRlbmREZWZhdWx0cykge1xuICAgICAgcmV2ZXJzZURlZXBNZXJnZShmaWVsZCwgZXh0ZW5kRGVmYXVsdHMpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZCAmJiBmaWVsZC5vcHRpb25zVHlwZXMpIHtcbiAgICAgIGZpZWxkLm9wdGlvbnNUeXBlcy5mb3JFYWNoKG9wdGlvbiA9PiB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0gdGhpcy5nZXRUeXBlKG9wdGlvbikuZGVmYXVsdE9wdGlvbnM7XG4gICAgICAgIGlmIChkZWZhdWx0T3B0aW9ucykge1xuICAgICAgICAgIHJldmVyc2VEZWVwTWVyZ2UoZmllbGQsIGRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29tcG9uZW50UmVmID0gdGhpcy5yZXNvbHZlRmllbGRUeXBlUmVmKGZpZWxkKTtcbiAgICBpZiAoY29tcG9uZW50UmVmICYmIGNvbXBvbmVudFJlZi5pbnN0YW5jZSAmJiBjb21wb25lbnRSZWYuaW5zdGFuY2UuZGVmYXVsdE9wdGlvbnMpIHtcbiAgICAgIHJldmVyc2VEZWVwTWVyZ2UoZmllbGQsIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5kZWZhdWx0T3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWYgKCFmaWVsZC53cmFwcGVycyAmJiB0eXBlLndyYXBwZXJzKSB7XG4gICAgICBmaWVsZC53cmFwcGVycyA9IFsuLi50eXBlLndyYXBwZXJzXTtcbiAgICB9XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHJlc29sdmVGaWVsZFR5cGVSZWYoZmllbGQ6IEZvcm1seUZpZWxkQ29uZmlnQ2FjaGUgPSB7fSk6IENvbXBvbmVudFJlZjxGaWVsZFR5cGU+IHtcbiAgICBpZiAoIWZpZWxkLnR5cGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHR5cGUgPSB0aGlzLmdldFR5cGUoZmllbGQudHlwZSk7XG4gICAgaWYgKCF0eXBlLmNvbXBvbmVudCB8fCB0eXBlWydfY29tcG9uZW50UmVmJ10pIHtcbiAgICAgIHJldHVybiB0eXBlWydfY29tcG9uZW50UmVmJ107XG4gICAgfVxuXG4gICAgY29uc3QgeyBfcmVzb2x2ZXIsIF9pbmplY3RvciB9ID0gZmllbGQucGFyZW50Lm9wdGlvbnM7XG4gICAgY29uc3QgY29tcG9uZW50UmVmID0gX3Jlc29sdmVyXG4gICAgICAucmVzb2x2ZUNvbXBvbmVudEZhY3Rvcnk8RmllbGRUeXBlPih0eXBlLmNvbXBvbmVudClcbiAgICAgIC5jcmVhdGUoX2luamVjdG9yKTtcblxuICAgIGRlZmluZUhpZGRlblByb3AodHlwZSwgJ19jb21wb25lbnRSZWYnLCBjb21wb25lbnRSZWYpO1xuICAgIGNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG5cbiAgICByZXR1cm4gdHlwZVsnX2NvbXBvbmVudFJlZiddO1xuICB9XG5cbiAgc2V0V3JhcHBlcihvcHRpb25zOiBXcmFwcGVyT3B0aW9uKSB7XG4gICAgdGhpcy53cmFwcGVyc1tvcHRpb25zLm5hbWVdID0gb3B0aW9ucztcbiAgICBpZiAob3B0aW9ucy50eXBlcykge1xuICAgICAgb3B0aW9ucy50eXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0VHlwZVdyYXBwZXIodHlwZSwgb3B0aW9ucy5uYW1lKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldFdyYXBwZXIobmFtZTogc3RyaW5nKTogV3JhcHBlck9wdGlvbiB7XG4gICAgaWYgKCF0aGlzLndyYXBwZXJzW25hbWVdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFtGb3JtbHkgRXJyb3JdIFRoZSB3cmFwcGVyIFwiJHtuYW1lfVwiIGNvdWxkIG5vdCBiZSBmb3VuZC4gUGxlYXNlIG1ha2Ugc3VyZSB0aGF0IGlzIHJlZ2lzdGVyZWQgdGhyb3VnaCB0aGUgRm9ybWx5TW9kdWxlIGRlY2xhcmF0aW9uLmApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLndyYXBwZXJzW25hbWVdO1xuICB9XG5cbiAgc2V0VHlwZVdyYXBwZXIodHlwZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudHlwZXNbdHlwZV0pIHtcbiAgICAgIHRoaXMudHlwZXNbdHlwZV0gPSA8VHlwZU9wdGlvbj57fTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnR5cGVzW3R5cGVdLndyYXBwZXJzKSB7XG4gICAgICB0aGlzLnR5cGVzW3R5cGVdLndyYXBwZXJzID0gW107XG4gICAgfVxuICAgIGlmICh0aGlzLnR5cGVzW3R5cGVdLndyYXBwZXJzLmluZGV4T2YobmFtZSkgPT09IC0xKSB7XG4gICAgICB0aGlzLnR5cGVzW3R5cGVdLndyYXBwZXJzLnB1c2gobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgc2V0VmFsaWRhdG9yKG9wdGlvbnM6IFZhbGlkYXRvck9wdGlvbikge1xuICAgIHRoaXMudmFsaWRhdG9yc1tvcHRpb25zLm5hbWVdID0gb3B0aW9ucztcbiAgfVxuXG4gIGdldFZhbGlkYXRvcihuYW1lOiBzdHJpbmcpOiBWYWxpZGF0b3JPcHRpb24ge1xuICAgIGlmICghdGhpcy52YWxpZGF0b3JzW25hbWVdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFtGb3JtbHkgRXJyb3JdIFRoZSB2YWxpZGF0b3IgXCIke25hbWV9XCIgY291bGQgbm90IGJlIGZvdW5kLiBQbGVhc2UgbWFrZSBzdXJlIHRoYXQgaXMgcmVnaXN0ZXJlZCB0aHJvdWdoIHRoZSBGb3JtbHlNb2R1bGUgZGVjbGFyYXRpb24uYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMudmFsaWRhdG9yc1tuYW1lXTtcbiAgfVxuXG4gIGFkZFZhbGlkYXRvck1lc3NhZ2UobmFtZTogc3RyaW5nLCBtZXNzYWdlOiBWYWxpZGF0aW9uTWVzc2FnZU9wdGlvblsnbWVzc2FnZSddKSB7XG4gICAgdGhpcy5tZXNzYWdlc1tuYW1lXSA9IG1lc3NhZ2U7XG4gIH1cblxuICBnZXRWYWxpZGF0b3JNZXNzYWdlKG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzW25hbWVdO1xuICB9XG5cbiAgc2V0TWFuaXB1bGF0b3IobWFuaXB1bGF0b3I6IE1hbmlwdWxhdG9yT3B0aW9uKSB7XG4gICAgbmV3IG1hbmlwdWxhdG9yLmNsYXNzKClbbWFuaXB1bGF0b3IubWV0aG9kXSh0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgbWVyZ2VFeHRlbmRlZFR5cGUobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnR5cGVzW25hbWVdLmV4dGVuZHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbmRlZFR5cGUgPSB0aGlzLmdldFR5cGUodGhpcy50eXBlc1tuYW1lXS5leHRlbmRzKTtcbiAgICBpZiAoIXRoaXMudHlwZXNbbmFtZV0uY29tcG9uZW50KSB7XG4gICAgICB0aGlzLnR5cGVzW25hbWVdLmNvbXBvbmVudCA9IGV4dGVuZGVkVHlwZS5jb21wb25lbnQ7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnR5cGVzW25hbWVdLndyYXBwZXJzKSB7XG4gICAgICB0aGlzLnR5cGVzW25hbWVdLndyYXBwZXJzID0gZXh0ZW5kZWRUeXBlLndyYXBwZXJzO1xuICAgIH1cbiAgfVxufVxuZXhwb3J0IGludGVyZmFjZSBUeXBlT3B0aW9uIHtcbiAgbmFtZTogc3RyaW5nO1xuICBjb21wb25lbnQ/OiBhbnk7XG4gIHdyYXBwZXJzPzogc3RyaW5nW107XG4gIGV4dGVuZHM/OiBzdHJpbmc7XG4gIGRlZmF1bHRPcHRpb25zPzogRm9ybWx5RmllbGRDb25maWc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV3JhcHBlck9wdGlvbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgY29tcG9uZW50OiBhbnk7XG4gIHR5cGVzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGRWYWxpZGF0b3JGbiB7XG4gIChjOiBBYnN0cmFjdENvbnRyb2wsIGZpZWxkOiBGb3JtbHlGaWVsZENvbmZpZywgb3B0aW9ucz86IHsgW2lkOiBzdHJpbmddOiBhbnk7IH0pOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0b3JPcHRpb24ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbGlkYXRpb246IEZpZWxkVmFsaWRhdG9yRm47XG4gIG9wdGlvbnM/OiB7IFtpZDogc3RyaW5nXTogYW55IH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXh0ZW5zaW9uT3B0aW9uIHtcbiAgbmFtZTogc3RyaW5nO1xuICBleHRlbnNpb246IEZvcm1seUV4dGVuc2lvbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uTWVzc2FnZU9wdGlvbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nIHwgKChlcnJvcjogYW55LCBmaWVsZDogRm9ybWx5RmllbGRDb25maWcpID0+IHN0cmluZyB8IE9ic2VydmFibGU8c3RyaW5nPik7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWFuaXB1bGF0b3JPcHRpb24ge1xuICBjbGFzcz86IHsgbmV3ICgpOiBhbnkgfTtcbiAgbWV0aG9kPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1hbmlwdWxhdG9yV3JhcHBlciB7XG4gIChmOiBGb3JtbHlGaWVsZENvbmZpZyk6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZW1wbGF0ZU1hbmlwdWxhdG9ycyB7XG4gIHByZVdyYXBwZXI/OiBNYW5pcHVsYXRvcldyYXBwZXJbXTtcbiAgcG9zdFdyYXBwZXI/OiBNYW5pcHVsYXRvcldyYXBwZXJbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWdPcHRpb24ge1xuICB0eXBlcz86IFR5cGVPcHRpb25bXTtcbiAgd3JhcHBlcnM/OiBXcmFwcGVyT3B0aW9uW107XG4gIHZhbGlkYXRvcnM/OiBWYWxpZGF0b3JPcHRpb25bXTtcbiAgZXh0ZW5zaW9ucz86IEV4dGVuc2lvbk9wdGlvbltdO1xuICB2YWxpZGF0aW9uTWVzc2FnZXM/OiBWYWxpZGF0aW9uTWVzc2FnZU9wdGlvbltdO1xuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgYGV4dGVuc2lvbnNgIGluc3RlYWQgKi9cbiAgbWFuaXB1bGF0b3JzPzogTWFuaXB1bGF0b3JPcHRpb25bXTtcbiAgZXh0cmFzPzoge1xuICAgIC8qKiBAZGVwcmVjYXRlZCB1c2UgYGV4dGVuc2lvbnNgIGluc3RlYWQgKi9cbiAgICBmaWVsZFRyYW5zZm9ybT86IGFueSxcbiAgICBpbW11dGFibGU/OiBib29sZWFuLFxuICAgIHNob3dFcnJvcj86IChmaWVsZDogRmllbGRUeXBlKSA9PiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5lcyB0aGUgb3B0aW9uIHdoaWNoIGZvcm1seSByZWx5IG9uIHRvIGNoZWNrIGZpZWxkIGV4cHJlc3Npb24gcHJvcGVydGllcy5cbiAgICAgKiAtIGBtb2RlbENoYW5nZWA6IHBlcmZvcm0gYSBjaGVjayB3aGVuIHRoZSB2YWx1ZSBvZiB0aGUgZm9ybSBjb250cm9sIGNoYW5nZXMgKFdpbGwgYmUgc2V0IGJ5IGRlZmF1bHQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbikuXG4gICAgICogLSBgY2hhbmdlRGV0ZWN0aW9uQ2hlY2tgOiB0cmlnZ2VycyBhbiBpbW1lZGlhdGUgY2hlY2sgd2hlbiBgbmdEb0NoZWNrYCBpcyBjYWxsZWQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0cyB0byBgY2hhbmdlRGV0ZWN0aW9uQ2hlY2tgLlxuICAgICAqL1xuICAgIGNoZWNrRXhwcmVzc2lvbk9uPzogJ21vZGVsQ2hhbmdlJyB8ICdjaGFuZ2VEZXRlY3Rpb25DaGVjaycsXG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIGxhemlseSByZW5kZXIgZmllbGQgY29tcG9uZW50cyBvciBub3Qgd2hlbiBtYXJrZWQgYXMgaGlkZGVuLlxuICAgICAqIC0gYHRydWVgOiBsYXppbHkgcmVuZGVyIGZpZWxkIGNvbXBvbmVudHMgKFdpbGwgYmUgc2V0IGJ5IGRlZmF1bHQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbikuXG4gICAgICogLSBgZmFsc2VgOiByZW5kZXIgZmllbGQgY29tcG9uZW50cyBhbmQgdXNlIENTUyB0byBjb250cm9sIHRoZWlyIHZpc2liaWxpdHkuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgICAqL1xuICAgIGxhenlSZW5kZXI/OiBib29sZWFuLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCByZXNldCB0aGUgdmFsdWUgb2YgaGlkZGVuIGZpZWxkcy5cbiAgICAgKlxuICAgICAqIERlZmF1bHRzIHRvIGBmYWxzZWAuXG4gICAgICovXG4gICAgcmVzZXRGaWVsZE9uSGlkZT86IGJvb2xlYW4sXG4gIH07XG59XG4iXX0=